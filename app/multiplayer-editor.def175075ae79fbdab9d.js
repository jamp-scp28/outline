(window.webpackJsonp=window.webpackJsonp||[]).push([["multiplayer-editor"],{"2ncL":function(e,t,r){"use strict";r.r(t);r("tkto"),r("yXV3"),r("pNMO"),r("4Brf"),r("0oug"),r("4mDm"),r("PKPk"),r("3bBZ"),r("+2oP"),r("pjDv"),r("zKZe");var n=r("DzJC"),o=r.n(n),i=(r("rB9j"),r("UxlC"),r("07d7"),r("FZtP"),r("sMBO"),r("ma9I"),r("yq1k"),r("JTJg"),r("KvOp")),a=r("q1tI"),u=r("9Koi"),l=r("Ty5D"),s=r("g86O"),c=r("dCgF"),f=r("hzRC"),y=r("pXru"),d=r("QLaP"),p=r.n(d),b=r("1RBS");var m=r("6BWE");function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(e,t)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=["click","mousemove","keydown","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","focus"];var v=r("vp35");function usePageVisibility_slicedToArray(e,t){return function usePageVisibility_arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function usePageVisibility_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(e,t)||function usePageVisibility_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return usePageVisibility_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return usePageVisibility_arrayLikeToArray(e,t)}(e,t)||function usePageVisibility_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function usePageVisibility_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g=r("Y8J7"),w=(r("ExoC"),r("NBAS"),r("SuFq"),r("sjV4")),_=r("xJPr"),E=r("sRc5"),O=r("fwbU");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&_setPrototypeOf(e,t)}(MultiplayerExtension,e);var t=_createSuper(MultiplayerExtension);function MultiplayerExtension(){return _classCallCheck(this,MultiplayerExtension),t.apply(this,arguments)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(MultiplayerExtension,[{key:"name",get:function get(){return"multiplayer"}},{key:"plugins",get:function get(){var e=this.options,t=e.user,r=e.provider,n=e.document,o=n.get("default",c.l);return r.on("authenticated",(function(){r.setAwarenessField("user",t)})),n.on("afterTransaction",(function assignUser(e){var r=Array.from(n.store.clients.keys());e.local&&e.changed.size>0&&!r.includes(n.clientID)&&(new c.f(n).setUserMapping(n,n.clientID,t.id),n.off("afterTransaction",assignUser))})),[Object(w.c)(o),Object(_.a)(r.awareness),Object(E.c)(),Object(O.b)({"Mod-z":E.b,"Mod-y":E.a,"Mod-Shift-z":E.a})]}}]),MultiplayerExtension}(r("LDt7").Extension),T=r("G6XK"),S=r("92Fa"),j=r("R9tu"),M=["onSynced"];function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return MultiplayerEditor_arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||MultiplayerEditor_unsupportedIterableToArray(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MultiplayerEditor_slicedToArray(e,t){return function MultiplayerEditor_arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function MultiplayerEditor_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(e,t)||MultiplayerEditor_unsupportedIterableToArray(e,t)||function MultiplayerEditor_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MultiplayerEditor_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return MultiplayerEditor_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?MultiplayerEditor_arrayLikeToArray(e,t):void 0}}function MultiplayerEditor_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function MultiplayerEditor(e,t){var r=e.onSynced,n=_objectWithoutProperties(e,M),d=n.id,w=Object(l.h)(),_=Object(u.a)().t,E=Object(m.a)(),O=Object(b.a)(),P=O.presence,k=O.ui,I=function useCurrentToken(){var e=Object(b.a)().auth;return p()(e.token,"token is required"),e.token}(),L=MultiplayerEditor_slicedToArray(a.useState(!1),2),C=L[0],x=L[1],R=MultiplayerEditor_slicedToArray(a.useState(null),2),U=R[0],V=R[1],B=MultiplayerEditor_slicedToArray(a.useState(!1),2),D=B[0],N=B[1],F=MultiplayerEditor_slicedToArray(a.useState(!1),2),W=F[0],z=F[1],J=MultiplayerEditor_slicedToArray(a.useState((function(){return new c.d})),1)[0],H=Object(g.a)().showToast,K=function useIdle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:18e4,t=_slicedToArray(a.useState(!1),2),r=t[0],n=t[1],o=a.useRef(),i=a.useCallback((function(){o.current&&clearTimeout(o.current),o.current=setTimeout((function(){n(!0)}),e)}),[e]);return a.useEffect((function(){var e=function handleUserActivityEvent(){n(!1),i()};return h.forEach((function(t){return window.addEventListener(t,e)})),function(){h.forEach((function(t){return window.removeEventListener(t,e)}))}}),[i]),r}(),q=function usePageVisibility(){var e=usePageVisibility_slicedToArray(a.useState(!0),2),t=e[0],r=e[1];return Object(v.a)("visibilitychange",(function(){return r(!document.hidden)}),document),t}(),Y=function useIsMounted(){var e=a.useRef(!1);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),a.useCallback((function(){return e.current}),[])}();a.useLayoutEffect((function(){var e="development"===y.a.ENVIRONMENT,t="document.".concat(d),r=new s.a(t,J),n=new i.a({url:"".concat(y.a.COLLABORATION_URL,"/collaboration"),name:t,document:J,token:I}),a=o()((function(){n.setAwarenessField("scrollY",window.scrollY/window.innerHeight)}),250),u=function finishObserving(){k.observingUserId&&k.setObservingUser(void 0)};window.addEventListener("click",u),window.addEventListener("wheel",u),window.addEventListener("scroll",a,!!S.c&&{passive:!0}),n.on("authenticationFailed",(function(){H(_("Sorry, it looks like you don’t have permission to access the document")),w.replace(Object(j.i)())})),n.on("awarenessChange",(function(e){e.states.forEach((function(e){var t=e.user,r=e.cursor,n=e.scrollY;t&&(P.touch(d,t.id,!!r),void 0!==n&&t.id===k.observingUserId&&window.scrollTo({top:n*window.innerHeight,behavior:"smooth"}))}))}));return n.on("awarenessChange",(function showCursorNames(){x(!0),setTimeout((function(){Y()&&x(!1)}),2e3),n.off("awarenessChange",showCursorNames)})),r.on("synced",(function(){return N(!!J.get("default")._start)})),n.on("synced",(function(){P.touch(d,E.id,!1),z(!0)})),e&&(n.on("message",(function(e){return T.a.debug("collaboration","incoming",{message:e.message})})),n.on("outgoingMessage",(function(e){return T.a.debug("collaboration","outgoing",{message:e.message})})),r.on("synced",(function(){return T.a.debug("collaboration","local synced")}))),n.on("status",(function(e){return k.setMultiplayerStatus(e.status)})),V(n),function(){window.removeEventListener("click",u),window.removeEventListener("wheel",u),window.removeEventListener("scroll",a),null==n||n.destroy(),null==r||r.destroy(),V(null),k.setMultiplayerStatus(void 0)}}),[w,H,_,d,k,P,I,J,E.id,Y]);var X=a.useMemo((function(){return{id:E.id,name:E.name,color:E.color}}),[E.id,E.color,E.name]),Z=a.useMemo((function(){return U?[].concat(_toConsumableArray(n.extensions||[]),[new A({user:X,provider:U,document:J})]):n.extensions}),[U,X,J,n.extensions]);if(a.useEffect((function(){D&&W&&(null==r||r())}),[r,D,W]),a.useEffect((function(){U&&(K&&!q&&U.status===i.b.Connected&&U.disconnect(),K&&!q||U.status!==i.b.Disconnected||U.connect())}),[U,K,q]),a.useEffect((function(){function onUnhandledError(e){e.message.includes("URIError: URI malformed")&&H(_("Sorry, the last change could not be persisted – please reload the page"),{type:"error",timeout:0})}return window.addEventListener("error",onUnhandledError),function(){return window.removeEventListener("error",onUnhandledError)}}),[H,_]),!U)return null;var $=!D&&!W;return a.createElement(a.Fragment,null,$&&a.createElement(f.a,{defaultValue:n.defaultValue,extensions:n.extensions,readOnly:!0,ref:t}),a.createElement(f.a,_extends({},n,{value:void 0,defaultValue:void 0,extensions:Z,ref:$?void 0:t,style:$?{display:"none"}:void 0,className:C?"show-cursor-names":void 0})))}t.default=a.forwardRef(MultiplayerEditor)}}]);
//# sourceMappingURL=multiplayer-editor.def175075ae79fbdab9d.js.map
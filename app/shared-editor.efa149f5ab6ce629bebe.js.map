{"version":3,"sources":["webpack:///./shared/editor/lib/markdown/rules.ts","webpack:///./shared/editor/lib/markdown/serializer.ts","webpack:///./shared/editor/lib/ExtensionManager.ts","webpack:///./shared/utils/events.ts","webpack:///./app/editor/components/BlockMenuItem.tsx","webpack:///./shared/editor/lib/filterExcessSeparators.ts","webpack:///./app/editor/components/Input.tsx","webpack:///./app/editor/components/CommandMenu.tsx","webpack:///./app/editor/components/BlockMenu.tsx","webpack:///./app/editor/menus/block.ts","webpack:///./app/editor/components/ComponentView.tsx","webpack:///./app/editor/components/EditorContext.tsx","webpack:///./app/editor/components/EmojiMenuItem.tsx","webpack:///./app/editor/components/EmojiMenu.tsx","webpack:///./shared/editor/commands/createAndInsertLink.ts","webpack:///./app/editor/components/FloatingToolbar.tsx","webpack:///./app/hooks/useComponentSize.ts","webpack:///./app/hooks/useViewportHeight.ts","webpack:///./app/editor/components/LinkSearchResult.tsx","webpack:///./app/editor/components/ToolbarButton.tsx","webpack:///./app/editor/components/Tooltip.tsx","webpack:///./app/editor/components/LinkEditor.tsx","webpack:///./app/editor/components/LinkToolbar.tsx","webpack:///./app/editor/components/ToolbarSeparator.tsx","webpack:///./app/editor/components/ToolbarMenu.tsx","webpack:///./app/editor/components/SelectionToolbar.tsx","webpack:///./shared/editor/queries/getColumnIndex.ts","webpack:///./shared/editor/queries/getRowIndex.ts","webpack:///./app/editor/menus/table.tsx","webpack:///./app/editor/menus/tableCol.tsx","webpack:///./app/editor/menus/tableRow.tsx","webpack:///./app/editor/menus/image.tsx","webpack:///./app/editor/menus/divider.tsx","webpack:///./app/editor/menus/formatting.ts","webpack:///./app/editor/components/Styles.ts","webpack:///./app/editor/components/WithTheme.tsx","webpack:///./app/editor/index.tsx","webpack:///./shared/editor/lib/getHeadings.ts","webpack:///./shared/editor/lib/getTasks.ts"],"names":["rules","plugins","markdownIt","markdownit","breaks","html","linkify","forEach","plugin","use","MarkdownSerializer","nodes","marks","this","serialize","content","options","state","MarkdownSerializerState","renderContent","out","inTable","inTightList","closed","delim","tightLists","flushClose","size","atBlank","delimMin","trim","exec","slice","length","i","wrapBlock","firstDelim","node","f","old","write","closeBlock","test","ensureNewLine","text","escape","lines","split","startOfLine","esc","render","parent","index","Error","type","name","_","renderInline","active","trailing","progress","filter","m","childCount","next","child","isInSet","isText","leading","some","mark","info","expelEnclosingWhitespace","lead","inner","trail","withText","noEsc","len","outer","mixable","j","other","eq","concat","keep","Math","min","markString","pop","add","push","renderList","isTight","attrs","tight","prevTight","prevList","inList","renderTable","headerBuffer","prevTable","row","cell","para","textContent","alignment","undefined","str","replace","quote","wrap","indexOf","repeat","n","open","value","close","getEnclosingWhitespace","match","ExtensionManager","extensions","editor","ext","extension","props","bindEditor","get","reduce","schema","serializer","toMarkdown","parser","tokens","md","parseMarkdown","markdownToken","MarkdownParser","makeRules","allPlugins","allRulePlugins","rulePlugins","keymaps","keys","map","includes","keymap","inputRules","extensionInputRules","nodeMarkInputRules","allInputRules","commands","view","allCommands","apply","callback","editable","focus","dispatch","handle","_name","_value","Array","isArray","Object","entries","commandName","commandValue","EventEmitter","listeners","on","addListener","off","removeListener","cb","data","Shortcut","styled","span","theme","textTertiary","MenuItem","button","disabled","selected","white","textSecondary","primary","BlockMenuItem","onClick","title","shortcut","icon","containerId","Icon","ref","React","scrollIntoView","scrollMode","block","boundary","id","color","filterExcessSeparators","items","acc","item","arr","Input","input","toolbarInput","toolbarItem","defaultPosition","left","top","bottom","isAbove","CommandMenu","menuRef","inputRef","selectedIndex","insertItem","handleKeyDown","event","isActive","key","preventDefault","stopPropagation","filtered","onClose","shiftKey","ctrlKey","prevIndex","prev","setState","max","total","nextIndex","triggerFilePick","supportedImageMimeTypes","join","triggerLinkInput","clearSearch","onLinkToolbarOpen","insertBlock","handleLinkInputKeydown","href","currentTarget","matcher","onShowToast","dictionary","embedInvalidLink","handleLinkInputPaste","clipboardData","getData","accept","current","click","handleFilePicked","files","getDataTransferFiles","uploadFile","onFileUploadStart","onFileUploadStop","findParentNode","selection","insertFiles","pos","isAttachment","onClearSearch","componentDidMount","window","addEventListener","shouldComponentUpdate","nextProps","nextState","search","componentDidUpdate","prevProps","scroll","position","calculatePosition","componentWillUnmount","removeEventListener","command","document","getSelection","anchorNode","focusNode","range","createRange","setStart","anchorOffset","setEnd","focusOffset","getClientRects","startContainer","collapsed","selectNodeContents","rect","getBoundingClientRect","startPos","coordsAtPos","from","err","console","warn","domAtPos","bind","offsetHeight","paragraph","findDomRefAtPos","caretPosition","right","leftPos","scrollX","rtl","scrollWidth","innerHeight","scrollY","embeds","filterable","embedItems","embed","defaultHidden","toLowerCase","keywords","positioning","Wrapper","hiddenScrollbars","LinkInputWrapper","LinkInput","placeholder","pasteLinkWithTitle","pasteLink","onKeyDown","onPaste","autoFocus","List","ListItem","handlePointer","onPointerMove","onPointerDown","renderMenuItem","Empty","noResults","VisuallyHidden","Trans","onChange","div","ol","li","Scrollable","fontFamily","depths","editorToolbar","menuBackground","divider","BlockMenu","tr","insertText","to","_index","h1","Heading1Icon","level","h2","Heading2Icon","h3","Heading3Icon","checkboxList","TodoListIcon","bulletList","BulletedListIcon","orderedList","OrderedListIcon","image","ImageIcon","link","LinkIcon","metaDisplay","file","AttachmentIcon","table","TableIcon","rowsCount","colsCount","BlockQuoteIcon","codeBlock","CodeIcon","hr","HorizontalRuleIcon","pageBreak","PageBreakIcon","markup","insertDate","CalendarIcon","insertTime","ClockIcon","insertDateTime","infoNotice","InfoIcon","style","warningNotice","WarningIcon","tipNotice","StarredIcon","ComponentView","component","getPos","decorations","isSelected","renderElement","children","isEditable","ReactDOM","dom","spec","inline","createElement","classList","update","selectNode","deselectNode","stopEvent","startsWith","destroy","unmountComponentAtNode","ignoreMutation","EditorContext","Emoji","EmojiTitle","emoji","className","EmojiMenuItem","searcher","FuzzySearch","gemojies","caseSensitive","sort","EmojiMenu","$from","description","names","PureComponent","findPlaceholderLink","doc","result","findLinks","descendants","createAndInsertLink","onCreateLink","url","removeMark","nodeSize","addMark","create","createLinkError","offset","visible","usePosition","fromPos","toPos","isSelectingText","useComponentSize","useState","width","clientWidth","height","clientHeight","setSize","useEffect","sizeObserver","ResizeObserver","target","observe","disconnect","menuWidth","menuHeight","viewportHeight","useViewportHeight","visualViewport","setHeight","useLayoutEffect","handleResize","isTouchDevice","useMediaQuery","selectionBounds","isColSelection","CellSelection","isRowSelection","NodeSelection","nodeDOM","getElementsByTagName","round","halfSelection","abs","centerOfSelection","innerWidth","FloatingToolbar","forwardedRef","setSelectingText","useEventListener","toolbarBackground","IconWrapper","toolbarHoverBackground","compact","Title","Subtitle","LinkSearchResult","subtitle","rest","TooltipContent","WrappedTooltip","tooltip","Tooltip","delay","placement","LinkEditor","discardInputValue","initialValue","initialSelectionLength","previousValue","results","handleRemoveLink","save","isUrl","onSelectLink","handleCreateLink","suggestedLinkTitle","moveSelectionToEnd","handleFocusLink","handleChange","trimmedValue","onSearchLink","error","handlePaste","setTimeout","handleOpenLink","onClickLink","onRemoveLink","handleSelectLink","setTextSelection","selectionText","cut","looksLikeUrl","isInternal","isInternalUrl","showCreateLink","showResults","findOrCreateDoc","searchOrPasteLink","goToLink","openLink","ToolbarButton","removeLink","SearchResults","createNewDoc","Flex","LinkToolbar","handleClickOutside","HTMLElement","contains","handleOnCreateLink","handleOnSelectLink","Separator","FlexibleWrapper","ToolbarMenu","useEditor","ToolbarSeparator","isVisible","isMarkActive","empty","TextSelection","SelectionToolbar","ev","hasFocus","setSelection","resolve","markType","onOpen","isTemplate","isCodeSelection","isNodeActive","code_block","isDividerSelection","colIndex","getColumnIndex","path","rowIndex","getRowIndex","isTableSelection","getMarkRange","isImageSelection","tableMenuItems","deleteTable","TrashIcon","getTableMenuItems","tableColMenuItems","alignLeft","AlignLeftIcon","th","colspan","rowspan","alignCenter","AlignCenterIcon","alignRight","AlignRightIcon","addColumnAfter","addColumnBefore","InsertLeftIcon","InsertRightIcon","deleteColumn","getTableColMenuItems","tableRowMenuItems","addRowBefore","InsertAboveIcon","addRowAfter","InsertBelowIcon","deleteRow","getTableRowMenuItems","imageMenuItems","isLeftAligned","layoutClass","isRightAligned","AlignImageLeftIcon","AlignImageCenterIcon","AlignImageRightIcon","downloadImage","DownloadIcon","fetch","replaceImage","ReplaceIcon","deleteImage","getImageMenuItems","dividerMenuItems","getDividerMenuItems","formattingMenuItems","isTable","isInTable","isList","isInList","allowBlocks","InputIcon","strong","BoldIcon","strikethrough","StrikethroughIcon","HighlightIcon","highlight","codeInline","code_inline","heading","subheading","blockquote","checkbox_list","bullet_list","ordered_list","createLink","getFormattingMenuItems","EditorStyles","grow","fontWeight","readOnly","background","fontFamilyMono","transparentize","noticeInfoBackground","noticeInfoText","noticeTipBackground","noticeTipText","noticeWarningBackground","noticeWarningText","lighten","readOnlyWriteCheckboxes","horizontalRule","codeBorder","codeBackground","textHighlightForeground","textHighlight","code","codeComment","codePunctuation","codeNumber","codeProperty","codeTag","codeString","codeSelector","codeAttr","codeEntity","codeKeyword","codeFunction","codeStatement","codePlaceholder","codeInserted","codeImportant","tableDivider","tableHeaderBackground","tableSelectedBackground","tableSelected","scrollbarThumb","scrollbarBackground","secondaryBackground","cursor","WithTheme","useTheme","Editor","isRTL","isEditorFocused","selectionMenuOpen","blockMenuOpen","linkMenuOpen","blockMenuSearch","emojiMenuOpen","element","events","calculateDir","dir","getComputedStyle","direction","handleEditorBlur","handleEditorFocus","handleOpenSelectionMenu","handleCloseSelectionMenu","handleOpenEmojiMenu","handleCloseEmojiMenu","handleOpenLinkMenu","handleCloseLinkMenu","handleOpenBlockMenu","handleCloseBlockMenu","focusAtStart","Selection","atStart","transaction","focusAtEnd","atEnd","getHeadings","headings","previouslySeen","headingToSlug","getTasks","tasks","isBlock","listItem","contentNode","completed","checked","EventType","linkMenuClose","blockMenuClose","emojiMenuClose","init","scrollTo","scrollToAnchor","newState","createState","updateState","isBlurred","onBlur","onFocus","createExtensions","createNodes","createMarks","createSchema","createPlugins","createRulePlugins","createKeymaps","createSerializer","createParser","pasteParser","createPasteParser","createInputRules","nodeViews","createNodeViews","createView","createCommands","nodeView","Schema","createDocument","defaultValue","EditorState","dropCursor","gapCursor","baseKeymap","parse","isEditingCheckbox","steps","step","firstChild","checkbox_item","self","EditorView","handleDOMEvents","blur","dispatchTransaction","applyTransaction","transactions","docChanged","forceUpdate","setAttribute","hash","querySelector","behavior","Logger","debug","Provider","align","justify","column","template","defaultProps","fullExtensionsPackage","LazyLoadedEditor"],"mappings":"q8BAEe,SAASA,YAAT,GAMZ,QALDA,aAKC,MALO,GAKP,MAJDC,eAIC,MAJS,GAIT,EACKC,EAAaC,IAAW,U,uYAAD,EAC3BC,QAAQ,EACRC,MAAM,EACNC,SAAS,GACNN,IAGL,OADAC,EAAQM,SAAQ,SAACC,GAAD,OAAYN,EAAWO,IAAID,MACpCN,E,ikDCTF,IAAMQ,EAAb,WAkCE,4BAAYC,EAAOC,GAAO,yCAGxBC,KAAKF,MAAQA,EAEbE,KAAKD,MAAQA,EAvCjB,+DA6CE,SAAAE,UAAUC,EAASC,GACjB,IAAMC,EAAQ,IAAIC,EAAwBL,KAAKF,MAAOE,KAAKD,MAAOI,GAElE,OADAC,EAAME,cAAcJ,GACbE,EAAMG,QAhDjB,sBAuDaF,EAAb,WAME,iCAAYP,EAAOC,EAAOI,GAAS,mDALnCK,SAAU,EAKyB,KAJnCC,aAAc,EAIqB,KAHnCC,QAAS,EAG0B,KAFnCC,MAAQ,GAGNX,KAAKF,MAAQA,EACbE,KAAKD,MAAQA,EACbC,KAAKW,MAAQX,KAAKO,IAAM,GACxBP,KAAKU,QAAS,EACdV,KAAKS,aAAc,EACnBT,KAAKQ,SAAU,EAOfR,KAAKG,QAAUA,GAAW,QACa,IAA5BH,KAAKG,QAAQS,aACtBZ,KAAKG,QAAQS,YAAa,GArBhC,qEAyBE,SAAAC,WAAWC,GACT,GAAId,KAAKU,OAAQ,CAOf,GANKV,KAAKe,YACRf,KAAKO,KAAO,MAEVO,UACFA,EAAO,GAELA,EAAO,EAAG,CACZ,IAAIE,EAAWhB,KAAKW,MACdM,EAAO,OAAOC,KAAKF,GACrBC,IACFD,EAAWA,EAASG,MAAM,EAAGH,EAASI,OAASH,EAAK,GAAGG,SAEzD,IAAK,IAAIC,EAAI,EAAGA,EAAIP,EAAMO,IACxBrB,KAAKO,KAAOS,EAAW,KAG3BhB,KAAKU,QAAS,KA3CpB,uBAoDE,SAAAY,UAAUX,EAAOY,EAAYC,EAAMC,GACjC,IAAMC,EAAM1B,KAAKW,MACjBX,KAAK2B,MAAMJ,GAAcZ,GACzBX,KAAKW,OAASA,EACdc,IACAzB,KAAKW,MAAQe,EACb1B,KAAK4B,WAAWJ,KA1DpB,qBA6DE,SAAAT,UACE,MAAO,UAAUc,KAAK7B,KAAKO,OA9D/B,2BAmEE,SAAAuB,gBACO9B,KAAKe,YACRf,KAAKO,KAAO,QArElB,mBA6EE,SAAAoB,MAAMzB,GACJF,KAAKa,aACDb,KAAKW,OAASX,KAAKe,YACrBf,KAAKO,KAAOP,KAAKW,OAEfT,IACFF,KAAKO,KAAOL,KAnFlB,wBAyFE,SAAA0B,WAAWJ,GACTxB,KAAKU,OAASc,IA1FlB,kBAgGE,SAAAO,KAAKA,EAAMC,GAET,IADA,IAAMC,EAAQF,EAAKG,MAAM,MAChBb,EAAI,EAAGA,EAAIY,EAAMb,OAAQC,IAAK,CACrC,IAAMc,EAAcnC,KAAKe,WAAaf,KAAKU,OAC3CV,KAAK2B,QACL3B,KAAKO,MAAkB,IAAXyB,EAAmBhC,KAAKoC,IAAIH,EAAMZ,GAAIc,GAAeF,EAAMZ,GACnEA,IAAMY,EAAMb,OAAS,IACvBpB,KAAKO,KAAO,SAvGpB,oBA8GE,SAAA8B,OAAOb,EAAMc,EAAQC,GACnB,GAAsB,iBAAXD,EACT,MAAM,IAAIE,MAAM,KAElBxC,KAAKF,MAAM0B,EAAKiB,KAAKC,MAAM1C,KAAMwB,EAAMc,EAAQC,KAlHnD,2BAuHE,SAAAjC,cAAcgC,GAAQ,WACpBA,EAAO5C,SAAQ,SAAC8B,EAAMmB,EAAGtB,GAAV,OAAgB,EAAKgB,OAAOb,EAAMc,EAAQjB,QAxH7D,0BA6HE,SAAAuB,aAAaN,GAAQ,WACbO,EAAS,GACXC,EAAW,GACTC,EAAW,SAAXA,SAAYvB,EAAMmB,EAAGJ,GACzB,IAAIxC,EAAQyB,EAAOA,EAAKzB,MAAQ,GAO5ByB,GAA2B,eAAnBA,EAAKiB,KAAKC,OACpB3C,EAAQA,EAAMiD,QAAO,SAACC,GACpB,GAAIV,EAAQ,IAAMD,EAAOY,WACvB,OAAO,EAET,IAAMC,EAAOb,EAAOc,MAAMb,EAAQ,GAClC,OACEU,EAAEI,QAAQF,EAAKpD,UAAYoD,EAAKG,QAAU,KAAKzB,KAAKsB,EAAKpB,WAK/D,IAAIwB,EAAUT,EAId,GAHAA,EAAW,GAITtB,GACAA,EAAK8B,QACLvD,EAAMyD,MAAK,SAACC,GACV,IAAMC,EAAO,EAAK3D,MAAM0D,EAAKhB,KAAKC,QAClC,OAAOgB,GAAQA,EAAKC,4BAEtB,CAEA,qBAAgC,qBAAqBzC,KAAKM,EAAKO,MAA/D,GAAU6B,GAAV,WAAgBC,EAAhB,KAAuBC,EAAvB,KACAP,GAAWK,EACXd,EAAWgB,GACPF,GAAQE,MACVtC,EAAOqC,EAAQrC,EAAKuC,SAASF,GAAS,QAEpC9D,EAAQ8C,IAKd,IAAMgB,EAAQ9D,EAAMqB,QAAUrB,EAAMA,EAAMqB,OAAS,GACjD4C,EAAQH,IAAkD,IAAzC,EAAK9D,MAAM8D,EAAMpB,KAAKC,QAAQV,OAC3CiC,EAAMlE,EAAMqB,QAAU4C,EAAQ,EAAI,GAMxCE,EAAO,IAAK,IAAI7C,EAAI,EAAGA,EAAI4C,EAAK5C,IAAK,CACnC,IAAMoC,EAAO1D,EAAMsB,GACnB,IAAK,EAAKtB,MAAM0D,EAAKhB,KAAKC,QAAQyB,QAChC,MAEF,IAAK,IAAIC,EAAI,EAAGA,EAAIvB,EAAOzB,OAAQgD,IAAK,CACtC,IAAMC,EAAQxB,EAAOuB,GACrB,IAAK,EAAKrE,MAAMsE,EAAM5B,KAAKC,QAAQyB,QACjC,MAEF,GAAIV,EAAKa,GAAGD,GAAQ,CACdhD,EAAI+C,EACNrE,EAAQA,EACLoB,MAAM,EAAGiD,GACTG,OAAOd,GACPc,OAAOxE,EAAMoB,MAAMiD,EAAG/C,IACtBkD,OAAOxE,EAAMoB,MAAME,EAAI,EAAG4C,IACpBG,EAAI/C,IACbtB,EAAQA,EACLoB,MAAM,EAAGE,GACTkD,OAAOxE,EAAMoB,MAAME,EAAI,EAAG+C,IAC1BG,OAAOd,GACPc,OAAOxE,EAAMoB,MAAMiD,EAAGH,KAE3B,SAASC,IAOf,IADA,IAAIM,EAAO,EAETA,EAAOC,KAAKC,IAAI7B,EAAOzB,OAAQ6C,IAC/BlE,EAAMyE,GAAMF,GAAGzB,EAAO2B,OAEpBA,EAIJ,KAAOA,EAAO3B,EAAOzB,QACnB,EAAKW,KAAK,EAAK4C,WAAW9B,EAAO+B,OAAO,EAAOtC,EAAQC,IAAQ,GASjE,GALIgB,GACF,EAAKxB,KAAKwB,GAIR/B,EAAM,CACR,KAAOqB,EAAOzB,OAAS6C,GAAK,CAC1B,IAAMY,EAAM9E,EAAM8C,EAAOzB,QACzByB,EAAOiC,KAAKD,GACZ,EAAK9C,KAAK,EAAK4C,WAAWE,GAAK,EAAMvC,EAAQC,IAAQ,GAKnDyB,GAASxC,EAAK8B,OAChB,EAAKvB,KACH,EAAK4C,WAAWd,GAAO,EAAMvB,EAAQC,GACnCf,EAAKO,KACL,EAAK4C,WAAWd,GAAO,EAAOvB,EAAQC,EAAQ,IAChD,GAGF,EAAKF,OAAOb,EAAMc,EAAQC,KAIhCD,EAAO5C,QAAQqD,GACfA,EAAS,KAAM,EAAMT,EAAOY,cA3PhC,wBAmQE,SAAA6B,WAAWvD,EAAMb,EAAOY,GAAY,WAC9BvB,KAAKU,QAAUV,KAAKU,OAAO+B,OAASjB,EAAKiB,KAC3CzC,KAAKa,WAAW,GACPb,KAAKS,aACdT,KAAKa,WAAW,GAGlB,IAAMmE,OACwB,IAArBxD,EAAKyD,MAAMC,MACd1D,EAAKyD,MAAMC,MACXlF,KAAKG,QAAQS,WACbuE,EAAYnF,KAAKS,YACjB2E,EAAWpF,KAAKqF,OACtBrF,KAAKqF,QAAS,EACdrF,KAAKS,YAAcuE,EACnBxD,EAAK9B,SAAQ,SAAC0D,EAAOT,EAAGtB,GAClBA,GAAK2D,GACP,EAAKnE,WAAW,GAElB,EAAKS,UAAUX,EAAOY,EAAWF,GAAIG,GAAM,kBACzC,EAAKa,OAAOe,EAAO5B,EAAMH,SAG7BrB,KAAKqF,OAASD,EACdpF,KAAKS,YAAc0E,IA3RvB,yBA8RE,SAAAG,YAAY9D,GAAM,WAChBxB,KAAKa,WAAW,GAEhB,IAAI0E,EAAe,GACbC,EAAYxF,KAAKQ,QACvBR,KAAKQ,SAAU,EAGfR,KAAKO,KAAO,KAGZiB,EAAK9B,SAAQ,SAAC+F,EAAK9C,EAAGtB,GAEpBoE,EAAI/F,SAAQ,SAACgG,EAAM/C,EAAGyB,GACpB,EAAK7D,KAAa,IAAN6D,EAAU,KAAO,MAE7BsB,EAAKhG,SAAQ,SAACiG,GAKa,KAArBA,EAAKC,aAA4C,IAAtBD,EAAKzF,QAAQY,KAC1C,EAAKP,KAAO,MAEZ,EAAKG,QAAS,EACd,EAAK2B,OAAOsD,EAAMF,EAAKrB,OAIjB,IAAN/C,IAC2B,WAAzBqE,EAAKT,MAAMY,UACbN,GAAgB,SACkB,SAAzBG,EAAKT,MAAMY,UACpBN,GAAgB,QACkB,UAAzBG,EAAKT,MAAMY,UACpBN,GAAgB,QAEhBA,GAAgB,YAKtB,EAAKhF,KAAO,OAERgF,IACF,EAAKhF,KAAL,UAAegF,EAAf,OACAA,OAAeO,MAInB9F,KAAKQ,QAAUgF,IAhVnB,iBAuVE,SAAApD,MAA2B,IAAvB2D,EAAuB,uDAAjB,GAAI5D,EAAa,uCAUzB,OATA4D,EAAMA,EAAIC,QAAQ,cAAe,QAC7B7D,IACF4D,EAAMA,EAAIC,QAAQ,YAAa,QAAQA,QAAQ,WAAY,UAGzDhG,KAAKQ,UACPuF,EAAMA,EAAIC,QAAQ,OAAQ,SAGrBD,IAjWX,mBAoWE,SAAAE,MAAMF,GACJ,IAAMG,GACkB,IAAtBH,EAAII,QAAQ,KAAc,MAA6B,IAAtBJ,EAAII,QAAQ,KAAc,KAAO,KACpE,OAAOD,EAAK,GAAKH,EAAMG,EAAK,KAvWhC,oBA4WE,SAAAE,OAAOL,EAAKM,GAEV,IADA,IAAI9F,EAAM,GACDc,EAAI,EAAGA,EAAIgF,EAAGhF,IACrBd,GAAOwF,EAET,OAAOxF,IAjXX,wBAsXE,SAAAoE,WAAWlB,EAAM6C,EAAMhE,EAAQC,GAC7B,IAAMmB,EAAO1D,KAAKD,MAAM0D,EAAKhB,KAAKC,QAC5B6D,EAAQD,EAAO5C,EAAK4C,KAAO5C,EAAK8C,MACtC,MAAwB,iBAAVD,EAAqBA,EAAQA,EAAMvG,KAAMyD,EAAMnB,EAAQC,KAzXzE,oCAgYE,SAAAkE,uBAAuB1E,GACrB,MAAO,CACLwB,SAAUxB,EAAK2E,MAAM,WAAa,IAAI,GACtC5D,UAAWf,EAAK2E,MAAM,WAAa,IAAI,QAnY7C,2B,soGClDqBC,E,WAGnB,4BAQE,WAPAC,EAOA,uDAFM,GACNC,EACA,mGAVFD,WAA0C,GAWxCA,EAAWlH,SAAQ,SAACoH,GAClB,IAAIC,EAGFA,EADiB,mBAARD,EACG,IAAIA,EAAID,aAAR,EAAQA,EAAQG,OAEhBF,EAGVD,GACFE,EAAUE,WAAWJ,GAGvB,EAAKD,WAAW9B,KAAKiC,M,kPAIzB,SAAAG,MACE,OAAOlH,KAAK4G,WACT5D,QAAO,SAAC+D,GAAD,MAAkC,SAAnBA,EAAUtE,QAChC0E,QACC,SAACrH,EAAO0B,GAAR,qCAAC,iCACI1B,GADL,sCAEG0B,EAAKkB,KAAOlB,EAAK4F,WAEpB,M,wBAIN,SAAAC,aACE,IAAMvH,EAAQE,KAAK4G,WAChB5D,QAAO,SAAC+D,GAAD,MAAkC,SAAnBA,EAAUtE,QAChC0E,QACC,SAACrH,EAAOiH,GAAR,qCAAC,iCACIjH,GADL,sCAEGiH,EAAUrE,KAAOqE,EAAUO,eAE9B,IAGEvH,EAAQC,KAAK4G,WAChB5D,QAAO,SAAC+D,GAAD,MAAkC,SAAnBA,EAAUtE,QAChC0E,QACC,SAACpH,EAAOgH,GAAR,qCAAC,iCACIhH,GADL,sCAEGgH,EAAUrE,KAAOqE,EAAUO,eAE9B,IAGJ,OAAO,IAAIzH,EAAmBC,EAAOC,K,oBAGvC,SAAAwH,OAAA,GAQmB,IAPjBH,EAOiB,EAPjBA,OACAjI,EAMiB,EANjBA,MACAC,EAKiB,EALjBA,QAMMoI,EAAsCxH,KAAK4G,WAC9C5D,QACC,SAAC+D,GAAD,MAAkC,SAAnBA,EAAUtE,MAAsC,SAAnBsE,EAAUtE,QAEvD0E,QAAO,SAACrH,EAAOiH,GACd,IAAMU,EAAKV,EAAUW,gBACrB,OAAKD,EAIL,+DACK3H,GADL,sCAEGiH,EAAUY,eAAiBZ,EAAUrE,KAAO+E,IALtC3H,IAOR,IAEL,OAAO,IAAI8H,IAAeR,EAAQS,YAAU,CAAE1I,QAAOC,YAAYoI,K,iBAGnE,SAAAN,MACE,OAAOlH,KAAK4G,WACT5D,QAAO,SAAC+D,GAAD,MAAkC,SAAnBA,EAAUtE,QAChC0E,QACC,SAACpH,EAAD,OAAU2C,EAAV,EAAUA,KAAM0E,EAAhB,EAAgBA,OAAhB,qCAAC,iCACIrH,GADL,sCAEG2C,EAAO0E,MAEV,M,mBAIN,SAAAF,MACE,OAAOlH,KAAK4G,WACT5D,QAAO,SAAC+D,GAAD,MAAe,YAAaA,KACnCI,QAAO,SAACW,EAAD,OAAe1I,EAAf,EAAeA,QAAf,mCAAiC0I,GAAjC,mBAAgD1I,MAAU,M,uBAGtE,SAAA8H,MACE,OAAOlH,KAAK4G,WACT5D,QAAO,SAAC+D,GAAD,MAAe,gBAAiBA,KACvCI,QACC,SAACY,EAAD,OAAmBC,EAAnB,EAAmBA,YAAnB,mCACKD,GADL,mBAEKC,MAEL,M,qBAIN,SAAAC,QAAA,GAAwC,IAA9Bb,EAA8B,EAA9BA,OACFa,QAAUjI,KAAK4G,WAClB5D,QAAO,SAAC+D,GAAD,OAAeA,EAAUmB,QAChCC,KAAI,SAACpB,GAAD,MACH,CAAC,OAAQ,QAAQqB,SAASrB,EAAUtE,MAChCsE,EAAUmB,KAAK,CACbzF,KAAM2E,EAAO,GAAD,OAAIL,EAAUtE,KAAd,MAAuBsE,EAAUrE,MAC7C0E,WAEDL,EAAwBmB,KAAK,CAAEd,cAGxC,OAAOa,QAAQE,IAAIE,O,wBAGrB,SAAAC,WAAA,GAA2C,IAA9BlB,EAA8B,EAA9BA,OACLmB,EAAsBvI,KAAK4G,WAC9B5D,QAAO,SAAC+D,GAAD,MAAe,CAAC,aAAaqB,SAASrB,EAAUtE,SACvDO,QAAO,SAAC+D,GAAD,OAAeA,EAAUuB,cAChCH,KAAI,SAACpB,GAAD,OAA0BA,EAAUuB,WAAW,CAAElB,cAElDoB,EAAqBxI,KAAK4G,WAC7B5D,QAAO,SAAC+D,GAAD,MAAe,CAAC,OAAQ,QAAQqB,SAASrB,EAAUtE,SAC1DO,QAAO,SAAC+D,GAAD,OAAeA,EAAUuB,cAChCH,KAAI,SAACpB,GAAD,OACHA,EAAUuB,WAAW,CACnB7F,KAAM2E,EAAO,GAAD,OAAIL,EAAUtE,KAAd,MAAuBsE,EAAUrE,MAC7C0E,cAIN,MAAO,6BAAImB,GAAJ,mBAA4BC,IAAoBrB,QACrD,SAACsB,EAAeH,GAAhB,mCAAmCG,GAAnC,mBAAqDH,MACrD,M,sBAIJ,SAAAI,SAAA,GAAiE,IAAtDtB,EAAsD,EAAtDA,OAAQuB,EAA8C,EAA9CA,KACjB,OAAO3I,KAAK4G,WACT5D,QAAO,SAAC+D,GAAD,OAAeA,EAAU2B,YAChCvB,QAAO,SAACyB,EAAa7B,GACpB,IAAQrE,EAAeqE,EAAfrE,KAAMD,EAASsE,EAATtE,KACRiG,EAAW,GAGXnC,EAAQQ,EAAU2B,SAAV,+BACZtB,UACI,CAAC,OAAQ,QAAQgB,SAAS3F,GAC1B,CACEA,KAAM2E,EAAO,GAAD,OAAI3E,EAAJ,MAAaC,IAE3B,KAGAmG,EAAQ,SAARA,MACJC,EACA7D,GAEA,QAAK0D,EAAKI,WAGVJ,EAAKK,QACEF,EAAS7D,EAAT6D,CAAgBH,EAAKvI,MAAOuI,EAAKM,SAAUN,KAG9CO,EAAS,SAATA,OAAUC,EAAeC,GACzBC,MAAMC,QAAQF,GAChBV,EAASS,GAAS,SAAClE,GAAD,OAChBmE,EAAO1J,SAAQ,SAACoJ,GAAD,OAAcD,EAAMC,EAAU7D,OACpB,mBAAXmE,IAChBV,EAASS,GAAS,SAAClE,GAAD,OAChB4D,EAAMO,EAAQnE,MAYpB,MARqB,WAAjB,QAAOsB,GACTgD,OAAOC,QAAQjD,GAAO7G,SAAQ,YAAiC,0CAA/B+J,EAA+B,KAAlBC,EAAkB,KAC7DR,EAAOO,EAAaC,MAGtBR,EAAOxG,EAAM6D,GAGf,+DACKqC,GACAF,KAEJ,Q,4PC3NYiB,E,+KACXC,UAAgE,G,KAgBjEC,GAAK7J,KAAK8J,Y,KACVC,IAAM/J,KAAKgK,e,wNAflB,qBAAmBtH,EAAcoG,GAC1B9I,KAAK4J,UAAUlH,KAClB1C,KAAK4J,UAAUlH,GAAQ,IAGzB1C,KAAK4J,UAAUlH,GAAMoC,KAAKgE,K,4BAG5B,wBAAsBpG,EAAcoG,GAAsC,MACxE9I,KAAK4J,UAAUlH,GAAf,UAAuB1C,KAAK4J,UAAUlH,UAAtC,aAAuB,EAAsBM,QAC3C,SAACiH,GAAD,OAAQA,IAAOnB,O,kBAOnB,cAAYpG,EAAcwH,GAAgB,MACxC,UAAAlK,KAAK4J,UAAUlH,UAAf,SAAsBhD,SAAQ,SAACoJ,GAC7BA,EAASoB,U,oHCoCf,IAAMC,EAAWC,UAAOC,KAAV,0EAAGD,CAAH,6CACH,SAACpD,GAAD,OAAWA,EAAMsD,MAAMC,gBAK5BC,EAAWJ,UAAOK,OAAV,0EAAGL,CAAH,mRAaD,SAACpD,GAAD,OAAYA,EAAM0D,SAAW,KAAO,OACtC,SAAC1D,GAAD,OACPA,EAAM2D,SAAW3D,EAAMsD,MAAMM,MAAQ5D,EAAMsD,MAAMO,iBACrC,SAAC7D,GAAD,OAAYA,EAAM2D,SAAW3D,EAAMsD,MAAMQ,QAAU,UAKtD,SAAC9D,GAAD,OAAWA,EAAMsD,MAAMM,SAClB,SAAC5D,GAAD,OAAYA,EAAM2D,SAAW3D,EAAMsD,MAAMQ,QAAU,SAE/DX,GACS,SAACnD,GAAD,OAAWA,EAAMsD,MAAMO,iBAKvBE,EAnFf,SAASA,cAAT,GAQU,IAPRJ,EAOQ,EAPRA,SACAD,EAMQ,EANRA,SACAM,EAKQ,EALRA,QACAC,EAIQ,EAJRA,MACAC,EAGQ,EAHRA,SACAC,EAEQ,EAFRA,KAEQ,IADRC,mBACQ,MADM,uBACN,EACFC,EAAOF,EAEPG,EAAMC,eACV,SAAC/J,GACKmJ,GAAYnJ,GACdgK,YAAehK,EAAM,CACnBiK,WAAY,YACZC,MAAO,UACPC,SAAU,kBAACrJ,GAIT,OAAOA,EAAOsJ,KAAOR,OAK7B,CAACT,EAAUS,IAGb,OACE,gBAACZ,EAAD,CACEG,SAAUA,EACVK,QAASN,OAAW5E,EAAYkF,EAChCM,IAAKA,GAEJD,GACC,gCACE,gBAACA,EAAD,CAAMQ,MAAM,iBADd,MAKDZ,EACAC,GAAY,gBAACf,EAAD,KAAWe,K,4sCCpDf,SAASY,uBAAuBC,GAC7C,OAAOA,EACJ5E,QAAO,SAAC6E,EAAKC,GAAS,MAErB,MACgB,cAAdA,EAAKvJ,MACyB,eAA9B,UAAAsJ,EAAIA,EAAI5K,OAAS,UAAjB,eAAqBsB,MAEdsJ,EAET,mDAAWA,GAAX,CAAgBC,MACf,IACFjJ,QAAO,SAACiJ,EAAM1J,EAAO2J,GACpB,MACgB,cAAdD,EAAKvJ,MACM,IAAVH,GAAeA,IAAU2J,EAAI9K,OAAS,K,oDCDhC+K,EAhBD/B,UAAOgC,MAAV,wDAAGhC,CAAH,oLAEK,SAACpD,GAAD,OAAWA,EAAMsD,MAAM+B,gBAC5B,SAACrF,GAAD,OAAWA,EAAMsD,MAAMgC,e,kuICclC,IAAMC,EAAkB,CACtBC,MAAO,IACPC,IAAK,EACLC,YAAQ5G,EACR6G,SAAS,GAwCLC,E,okBACJC,QAAUtB,c,EACVuB,SAAWvB,c,EAEXnL,MAAe,CACboM,MAAO,IACPC,IAAK,EACLC,YAAQ5G,EACR6G,SAAS,EACTI,cAAe,EACfC,gBAAYlH,G,EAsCdmH,cAAgB,SAACC,GACf,GAAK,EAAKlG,MAAMmG,SAAhB,CAIA,GAAkB,UAAdD,EAAME,IAAiB,CACzBF,EAAMG,iBACNH,EAAMI,kBAEN,IAAMrB,EAAO,EAAKsB,SAAS,EAAKnN,MAAM2M,eAElCd,EACF,EAAKe,WAAWf,GAEhB,EAAKjF,MAAMwG,UAIf,GACgB,YAAdN,EAAME,KACS,QAAdF,EAAME,KAAiBF,EAAMO,UAC7BP,EAAMQ,SAAyB,MAAdR,EAAME,IAKxB,GAHAF,EAAMG,iBACNH,EAAMI,kBAEF,EAAKC,SAASnM,OAAQ,CACxB,IAAMuM,EAAY,EAAKvN,MAAM2M,cAAgB,EACvCa,EAAO,EAAKL,SAASI,GAE3B,EAAKE,SAAS,CACZd,cAAetI,KAAKqJ,IAClB,EACe,eAAfF,aAAA,EAAAA,EAAMlL,MAAuBiL,EAAY,EAAIA,UAIjD,EAAKnH,QAIT,GACgB,cAAd0G,EAAME,KACS,QAAdF,EAAME,MAAkBF,EAAMO,UAC9BP,EAAMQ,SAAyB,MAAdR,EAAME,IAKxB,GAHAF,EAAMG,iBACNH,EAAMI,kBAEF,EAAKC,SAASnM,OAAQ,CACxB,IAAM2M,EAAQ,EAAKR,SAASnM,OAAS,EAC/B4M,EAAY,EAAK5N,MAAM2M,cAAgB,EACvC5J,EAAO,EAAKoK,SAASS,GAE3B,EAAKH,SAAS,CACZd,cAAetI,KAAKC,IACH,eAAfvB,aAAA,EAAAA,EAAMT,MAAuBsL,EAAY,EAAIA,EAC7CD,UAIJ,EAAKvH,QAIS,WAAd0G,EAAME,KACR,EAAK5G,U,EAITwG,WAAa,SAACf,GACZ,OAAQA,EAAKvJ,MACX,IAAK,QACH,OAAO,EAAKuL,gBAAgBC,IAAwBC,KAAK,OAC3D,IAAK,aACH,OAAO,EAAKF,gBAAgB,KAC9B,IAAK,QACH,OAAO,EAAKG,iBAAiBnC,GAC/B,IAAK,OAAQ,QAIX,OAHA,EAAKoC,cACL,EAAKrH,MAAMwG,eACX,eAAKxG,OAAMsH,yBAAX,kBAGF,QACE,EAAKC,YAAYtC,K,EAIvBzF,MAAQ,WACN,EAAKQ,MAAMwG,UACX,EAAKxG,MAAM2B,KAAKK,S,EAGlBwF,uBAAyB,SAACtB,GACxB,GAAK,EAAKlG,MAAMmG,UAGX,EAAK/M,MAAM4M,WAAhB,CAIA,GAAkB,UAAdE,EAAME,IAAiB,CACzBF,EAAMG,iBACNH,EAAMI,kBAEN,IAAMmB,EAAOvB,EAAMwB,cAAcnI,MAGjC,IAFgB,EAAKnG,MAAM4M,WAAW2B,QAAQF,GAI5C,YADA,EAAKzH,MAAM4H,YAAY,EAAK5H,MAAM6H,WAAWC,kBAI/C,EAAKP,YAAY,CACf7L,KAAM,QACNuC,MAAO,CACLwJ,UAKY,WAAdvB,EAAME,MACR,EAAKpG,MAAMwG,UACX,EAAKxG,MAAM2B,KAAKK,W,EAIpB+F,qBAAuB,SAAC7B,GACtB,GAAK,EAAKlG,MAAMmG,UAGX,EAAK/M,MAAM4M,WAAhB,CAIA,IAAMyB,EAAOvB,EAAM8B,cAAcC,QAAQ,cACzB,EAAK7O,MAAM4M,WAAW2B,QAAQF,KAG5CvB,EAAMG,iBACNH,EAAMI,kBAEN,EAAKiB,YAAY,CACf7L,KAAM,QACNuC,MAAO,CACLwJ,a,EAMRR,gBAAkB,SAACiB,GACb,EAAKpC,SAASqC,UACZD,IACF,EAAKpC,SAASqC,QAAQD,OAASA,GAEjC,EAAKpC,SAASqC,QAAQC,U,EAI1BhB,iBAAmB,SAACnC,GAClB,EAAK4B,SAAS,CAAEb,WAAYf,K,EAG9BoD,iBAAmB,SAACnC,GAClB,IAkBY,EAlBNoC,EAAQC,YAAqBrC,GAEnC,EAMI,EAAKlG,MALP2B,EADF,EACEA,KACA6G,EAFF,EAEEA,WACAC,EAHF,EAGEA,kBACAC,EAJF,EAIEA,iBACAd,EALF,EAKEA,YAEMxO,EAAUuI,EAAVvI,MACFkC,EAASqN,0BAAe,SAACnO,GAAD,QAAYA,IAA3BmO,CAAiCvP,EAAMwP,WAItD,GAFA,EAAKvB,eAEAmB,EACH,MAAM,IAAIhN,MAAM,gDAGdF,GACFuN,YAAYlH,EAAMuE,EAAO5K,EAAOwN,IAAKR,EAAO,CAC1CE,aACAC,oBACAC,mBACAd,cACAC,WAAY,EAAK7H,MAAM6H,WACvBkB,aAAgD,OAAlC,YAAKjD,SAASqC,eAAd,eAAuBD,UAIrC,EAAKpC,SAASqC,UAChB,EAAKrC,SAASqC,QAAQ5I,MAAQ,IAGhC,EAAKS,MAAMwG,W,EAGba,YAAc,WACZ,EAAKrH,MAAMgJ,iB,gPA9Ob,SAAAC,oBACEC,OAAOC,iBAAiB,UAAWnQ,KAAKiN,iB,mCAG1C,SAAAmD,sBAAsBC,EAAkBC,GACtC,OACED,EAAUE,SAAWvQ,KAAKgH,MAAMuJ,QAChCF,EAAUlD,WAAanN,KAAKgH,MAAMmG,UAClCmD,IAActQ,KAAKI,Q,gCAIvB,SAAAoQ,mBAAmBC,GACjB,IAAKA,EAAUtD,UAAYnN,KAAKgH,MAAMmG,SAAU,CAG1CnN,KAAK6M,QAAQsC,SACfnP,KAAK6M,QAAQsC,QAAQuB,OAAO,CAAEjE,IAAK,IAErC,IAAMkE,EAAW3Q,KAAK4Q,kBAAkB5Q,KAAKgH,OAE7ChH,KAAK6N,SAAL,0BACEb,gBAAYlH,EACZiH,cAAe,GACZ4D,SAEIF,EAAUF,SAAWvQ,KAAKgH,MAAMuJ,QACzCvQ,KAAK6N,SAAS,CAAEd,cAAe,M,kCAInC,SAAA8D,uBACEX,OAAOY,oBAAoB,UAAW9Q,KAAKiN,iB,yBAiN7C,SAAAsB,YAAYtC,GACVjM,KAAKqO,cAEL,IAAM0C,EAAU9E,EAAKvJ,KAAO1C,KAAKgH,MAAM0B,SAASuD,EAAKvJ,WAAQoD,EAEzDiL,EACFA,EAAQ9E,EAAKhH,OAEbjF,KAAKgH,MAAM0B,SAAX,gBAA6B,IAAWuD,EAAKvJ,QAASuJ,EAAKhH,OAG7DjF,KAAKgH,MAAMwG,Y,yBAGb,SAAAtG,MACE,IAAM0I,EAAYM,OAAOc,SAASC,eAClC,IAAKrB,IAAcA,EAAUsB,aAAetB,EAAUuB,UACpD,MAAO,CACL1E,IAAK,EACLD,KAAM,GAIV,IAAM4E,EAAQlB,OAAOc,SAASK,cAC9BD,EAAME,SAAS1B,EAAUsB,WAAYtB,EAAU2B,cAC/CH,EAAMI,OAAO5B,EAAUuB,UAAWvB,EAAU6B,aAMvB,IADPL,EAAMM,iBACVtQ,QAEJgQ,EAAMO,gBAAkBP,EAAMQ,WAChCR,EAAMS,mBAAmBT,EAAMO,gBAInC,IAAMG,EAAOV,EAAMW,wBACnB,MAAO,CACLtF,IAAKqF,EAAKrF,IACVD,KAAMsF,EAAKtF,Q,+BAIf,SAAAoE,kBAAkB5J,GAChB,IAEIgL,EAFIrJ,EAAS3B,EAAT2B,KACAiH,EAAcjH,EAAKvI,MAAnBwP,UAER,IACEoC,EAAWrJ,EAAKsJ,YAAYrC,EAAUsC,MACtC,MAAOC,GAEP,OADAC,QAAQC,KAAKF,GACN5F,EAGT,IAAM+F,EAAW3J,EAAK2J,SAASC,KAAK5J,GAE9B2C,EAAMtL,KAAK6M,QAAQsC,QACnBqD,EAAelH,EAAMA,EAAIkH,aAAe,EAExCC,EAAiB,CAAEjR,KADZkR,0BAAgB9C,EAAUsC,KAAMI,IAG7C,IACGtL,EAAMmG,WACNsF,EAAUjR,OACViR,EAAUjR,KAAKuQ,sBAEhB,OAAOxF,EAGT,IAAQC,EAASxM,KAAK2S,cAAdnG,KACR,EAA+BiG,EAAUjR,KAAKuQ,wBAAtCtF,EAAR,EAAQA,IAAKC,EAAb,EAAaA,OAAQkG,EAArB,EAAqBA,MAGjBC,EAAUrG,EAAO0D,OAAO4C,QAK5B,OAJI9L,EAAM+L,KAAOzH,IACfuH,EAAUD,EAAQtH,EAAI0H,aAGpBhB,EAASvF,IAAM+F,EAPJ,GAQN,CACLhG,KAAMqG,EACNpG,SAAK3G,EACL4G,OAAQwD,OAAO+C,YAAcxG,EAAMyD,OAAOgD,QAC1CvG,SAAS,GAGJ,CACLH,KAAMqG,EACNpG,IAAKC,EAASwD,OAAOgD,QACrBxG,YAAQ5G,EACR6G,SAAS,K,oBAKf,SAAAzF,MACE,IADa,EACb,EAMIlH,KAAKgH,MANT,IACEmM,cADF,MACW,GADX,MAEE5C,cAFF,MAEW,GAFX,EAGEf,EAHF,EAGEA,WACA9G,EAJF,EAIEA,SAJF,IAKE0K,kBALF,SAOIrH,EAAwC,8BAAI/L,KAAKgH,MAAM+E,OACrDsH,EAAgC,GATzB,E,8sBAAA,CAWOF,GAXP,IAWb,2BAA4B,KAAjBG,EAAiB,QACtBA,EAAMrI,OAASqI,EAAMnI,MACvBkI,EAAWvO,KAAX,qDACKwO,GADL,IAEE5Q,KAAM,YAfC,8BA+Db,OA3CI2Q,EAAWjS,SACb2K,EAAQA,EAAMxH,OACZ,CACE7B,KAAM,aAER2Q,IAsCGvH,uBAlCUC,EAAM/I,QAAO,SAACiJ,GAC7B,GAAkB,cAAdA,EAAKvJ,KACP,OAAO,EAIT,GACEuJ,EAAKvJ,OACJgG,EAASuD,EAAKvJ,QACdgG,EAAS,SAAD,OAAU,IAAWuD,EAAKvJ,QAEnC,OAAO,EAIT,IAAK8M,GAA4B,UAAdvD,EAAKvJ,KACtB,OAAO,EAIT,IAAK6N,EACH,OAAQtE,EAAKsH,cAGf,IAAMlN,EAAIkK,EAAOiD,cACjB,OAAKJ,GAIFnH,EAAKhB,OAAS,IAAIuI,cAAcpL,SAAS/B,KACzC4F,EAAKwH,UAAY,IAAID,cAAcpL,SAAS/B,GAJtC4F,Q,oBAWb,SAAA5J,SAAS,WACP,EAA6CrC,KAAKgH,MAA1C6H,EAAR,EAAQA,WAAY1B,EAApB,EAAoBA,SAAUqC,EAA9B,EAA8BA,WACxBzD,EAAQ/L,KAAKuN,SACnB,EAAuCvN,KAAKI,MAApC4M,EAAR,EAAQA,WAAe0G,EAAvB,8BAEA,OACE,gBAAC,IAAD,KACE,gBAACC,GAAD,UACE/H,GAAI5L,KAAKgH,MAAM4E,IAAM,uBACrB/I,OAAQsK,EACR7B,IAAKtL,KAAK6M,QACV+G,kBAAgB,GACZF,GAEH1G,EACC,gBAAC6G,EAAD,KACE,gBAACC,EAAD,CACErR,KAAK,OACLsR,YACE/G,EAAW/B,MACP4D,EAAWmF,mBAAmBhH,EAAW/B,OACzC4D,EAAWoF,UAEjBC,UAAWlU,KAAKwO,uBAChB2F,QAASnU,KAAK+O,qBACdqF,WAAS,KAIb,gBAACC,GAAD,KACGtI,EAAM5D,KAAI,SAAC8D,EAAM1J,GAChB,GAAkB,cAAd0J,EAAKvJ,KACP,OACE,gBAAC4R,GAAD,CAAUlH,IAAK7K,GACb,4BAKN,IAAK0J,EAAKhB,MACR,OAAO,KAGT,IAAMsJ,EAAgB,SAAhBA,gBACA,EAAKnU,MAAM2M,gBAAkBxK,GAC/B,EAAKsL,SAAS,CAAEd,cAAexK,KAInC,OACE,gBAAC+R,GAAD,CACElH,IAAK7K,EACLiS,cAAeD,EACfE,cAAeF,GAEd,EAAKvN,MAAM0N,eAAezI,EAAa1J,EAAO,CAC7CoI,SAAUpI,IAAU,EAAKnC,MAAM2M,cAC/B/B,QAAS,0BAAM,EAAKgC,WAAWf,UAKrB,IAAjBF,EAAM3K,QACL,gBAACkT,GAAD,KACE,gBAACK,GAAD,KAAQ9F,EAAW+F,aAK1BpF,GACC,gBAACqF,EAAA,EAAD,KACE,6BACE,gBAACC,EAAA,EAAD,wBACA,yBACErS,KAAK,OACL6I,IAAKtL,KAAK8M,SACViI,SAAU/U,KAAKqP,2B,aA7eO9D,aAwflCsI,EAAmBzJ,UAAO4K,IAAV,gFAAG5K,CAAH,iBAIhB0J,EAAY1J,kBAAO+B,GAAV,yEAAG/B,CAAH,uCAGJ,SAACpD,GAAD,OAAWA,EAAMsD,MAAMO,iBAG5BwJ,GAAOjK,UAAO6K,GAAV,oEAAG7K,CAAH,yEAQJkK,GAAWlK,UAAO8K,GAAV,wEAAG9K,CAAH,yBAKRuK,GAAQvK,UAAO4K,IAAV,qEAAG5K,CAAH,0GAGA,SAACpD,GAAD,OAAWA,EAAMsD,MAAMO,iBAOrB8I,GAAUvJ,kBAAO+K,KAAV,uEAAG/K,CAAH,6lBAOT,SAACpD,GAAD,OAAWA,EAAMsD,MAAMO,iBACjB,SAAC7D,GAAD,OAAWA,EAAMsD,MAAM8K,aAE3BC,IAAOC,eAChB,SAACtO,GAAD,YAAyBlB,IAAdkB,EAAMyF,KAAN,eAAmCzF,EAAMyF,IAAzC,SACX,SAACzF,GAAD,YAA4BlB,IAAjBkB,EAAM0F,QAAN,kBAAyC1F,EAAM0F,OAA/C,SACL,SAAC1F,GAAD,OAAWA,EAAMwF,QACX,SAACxF,GAAD,OAAWA,EAAMsD,MAAMiL,kBAwBX,SAACvO,GAAD,OAAWA,EAAMsD,MAAMkL,WAG/C,gBAAG3S,EAAH,EAAGA,OAAQ8J,EAAX,EAAWA,QAAX,OACA9J,GAAM,sCAEkB8J,EAAU,MAAQ,OAFpC,iEAYKC,K,+OCrmBA6I,OA7Bf,SAASA,UAAUzO,GACjB,ICYqC6H,EDHrC,OACE,kBAAC,GAAD,qBACM7H,EADN,CAEEoM,YAAY,EACZpD,cAbgB,SAAd3B,cACJ,MAA4BrH,EAAM2B,KAA1BvI,EAAR,EAAQA,MAAO6I,EAAf,EAAeA,SACT3G,EAASqN,0BAAe,SAACnO,GAAD,QAAYA,IAA3BmO,CAAiCvP,EAAMwP,WAElDtN,GACF2G,EAAS7I,EAAMsV,GAAGC,WAAW,GAAIrT,EAAOwN,IAAK1P,EAAMwP,UAAUgG,MAS7DlB,eAAgB,wBAACzI,EAAM4J,EAAQ1V,GAAf,OACd,kBAAC,EAAD,CACE6K,QAAS7K,EAAQ6K,QACjBL,SAAUxK,EAAQwK,SAClBQ,KAAMc,EAAKd,KACXF,MAAOgB,EAAKhB,MACZC,SAAUe,EAAKf,YAGnBa,OCXiC8C,EDWb7H,EAAM6H,WCVvB,CACL,CACEnM,KAAM,UACNuI,MAAO4D,EAAWiH,GAClBrC,SAAU,oBACVtI,KAAM4K,eACN7K,SAAU,QACVjG,MAAO,CAAE+Q,MAAO,IAElB,CACEtT,KAAM,UACNuI,MAAO4D,EAAWoH,GAClBxC,SAAU,cACVtI,KAAM+K,eACNhL,SAAU,QACVjG,MAAO,CAAE+Q,MAAO,IAElB,CACEtT,KAAM,UACNuI,MAAO4D,EAAWsH,GAClB1C,SAAU,cACVtI,KAAMiL,eACNlL,SAAU,QACVjG,MAAO,CAAE+Q,MAAO,IAElB,CACEtT,KAAM,aAER,CACEA,KAAM,gBACNuI,MAAO4D,EAAWwH,aAClBlL,KAAMmL,eACN7C,SAAU,0BACVvI,SAAU,SAEZ,CACExI,KAAM,cACNuI,MAAO4D,EAAW0H,WAClBpL,KAAMqL,mBACNtL,SAAU,SAEZ,CACExI,KAAM,eACNuI,MAAO4D,EAAW4H,YAClBtL,KAAMuL,kBACNxL,SAAU,SAEZ,CACExI,KAAM,aAER,CACEA,KAAM,QACNuI,MAAO4D,EAAW8H,MAClBxL,KAAMyL,YACNnD,SAAU,iBAEZ,CACE/Q,KAAM,OACNuI,MAAO4D,EAAWgI,KAClB1L,KAAM2L,WACN5L,SAAU,GAAF,OAAK6L,IAAL,MACRtD,SAAU,qBAEZ,CACE/Q,KAAM,aACNuI,MAAO4D,EAAWmI,KAClB7L,KAAM8L,iBACNxD,SAAU,sBAEZ,CACE/Q,KAAM,QACNuI,MAAO4D,EAAWqI,MAClB/L,KAAMgM,YACNlS,MAAO,CAAEmS,UAAW,EAAGC,UAAW,IAEpC,CACE3U,KAAM,aACNuI,MAAO4D,EAAW5I,MAClBkF,KAAMmM,iBACNpM,SAAU,GAAF,OAAK6L,IAAL,OAEV,CACErU,KAAM,aACNuI,MAAO4D,EAAW0I,UAClBpM,KAAMqM,WACNtM,SAAU,SACVuI,SAAU,UAEZ,CACE/Q,KAAM,KACNuI,MAAO4D,EAAW4I,GAClBtM,KAAMuM,qBACNxM,SAAU,GAAF,OAAK6L,IAAL,MACRtD,SAAU,8BAEZ,CACE/Q,KAAM,KACNuI,MAAO4D,EAAW8I,UAClBxM,KAAMyM,gBACNnE,SAAU,wBACVxO,MAAO,CAAE4S,OAAQ,QAEnB,CACEnV,KAAM,OACNuI,MAAO4D,EAAWiJ,WAClBrE,SAAU,QACVtI,KAAM4M,gBAER,CACErV,KAAM,OACNuI,MAAO4D,EAAWmJ,WAClBvE,SAAU,QACVtI,KAAM8M,aAER,CACEvV,KAAM,WACNuI,MAAO4D,EAAWqJ,eAClBzE,SAAU,QACVtI,KAAM4M,gBAER,CACErV,KAAM,aAER,CACEA,KAAM,mBACNuI,MAAO4D,EAAWsJ,WAClBhN,KAAMiN,WACN3E,SAAU,0BACVxO,MAAO,CAAEoT,MAAO,SAElB,CACE3V,KAAM,mBACNuI,MAAO4D,EAAWyJ,cAClBnN,KAAMoN,cACN9E,SAAU,oBACVxO,MAAO,CAAEoT,MAAO,YAElB,CACE3V,KAAM,mBACNuI,MAAO4D,EAAW2J,UAClBrN,KAAMsN,cACNhF,SAAU,yBACVxO,MAAO,CAAEoT,MAAO,c,2OC7JDK,G,WAenB,uBACEC,EADF,GAmBE,WAhBE9R,EAgBF,EAhBEA,OACAE,EAeF,EAfEA,UACAvF,EAcF,EAdEA,KACAmH,EAaF,EAbEA,KACAiQ,EAYF,EAZEA,OACAC,EAWF,EAXEA,a,yHAWF,0BAvBFC,YAAa,EAuBX,KAkBFC,cAAgB,WACd,IAAQzO,EAAU,EAAKzD,OAAOG,MAAtBsD,MAEF0O,EAAW,EAAKL,UAAU,CAC9BrO,QACA9I,KAAM,EAAKA,KACXsX,WAAY,EAAKA,WACjBG,WAAY,EAAKtQ,KAAKI,SACtB6P,OAAQ,EAAKA,SAGfM,KAAS7W,OACP,gBAAC,gBAAD,CAAeiI,MAAOA,GAAQ0O,GAC9B,EAAKG,MA9BPnZ,KAAK2Y,UAAYA,EACjB3Y,KAAK6G,OAASA,EACd7G,KAAK+G,UAAYA,EACjB/G,KAAK4Y,OAASA,EACd5Y,KAAK6Y,YAAcA,EACnB7Y,KAAKwB,KAAOA,EACZxB,KAAK2I,KAAOA,EACZ3I,KAAKmZ,IAAM3X,EAAKiB,KAAK2W,KAAKC,OACtBrI,SAASsI,cAAc,QACvBtI,SAASsI,cAAc,OAE3BtZ,KAAKmZ,IAAII,UAAU1U,IAAnB,oBAAoCrD,EAAKiB,KAAKC,OAE9C1C,KAAK+Y,gBACL7I,OAAOC,iBAAiB,gBAAiBnQ,KAAK+Y,e,yOAoBhD,SAAAS,OAAOhY,GACL,OAAIA,EAAKiB,OAASzC,KAAKwB,KAAKiB,OAI5BzC,KAAKwB,KAAOA,EACZxB,KAAK+Y,iBACE,K,wBAGT,SAAAU,aACMzZ,KAAK2I,KAAKI,WACZ/I,KAAK8Y,YAAa,EAClB9Y,KAAK+Y,mB,0BAIT,SAAAW,eACM1Z,KAAK2I,KAAKI,WACZ/I,KAAK8Y,YAAa,EAClB9Y,KAAK+Y,mB,uBAIT,SAAAY,UAAUzM,GACR,MAAsB,cAAfA,EAAMzK,OAAyByK,EAAMzK,KAAKmX,WAAW,U,qBAG9D,SAAAC,UACM7Z,KAAKmZ,MACPD,KAASY,uBAAuB9Z,KAAKmZ,KACrCjJ,OAAOY,oBAAoB,gBAAiB9Q,KAAK+Y,gBAEnD/Y,KAAKmZ,IAAM,O,4BAGb,SAAAY,iBACE,OAAO,M,iBClHLC,GAAgBzO,gBAA4B,IAInCyO,M,iRCHf,IAAMC,GAAQ7P,UAAOC,KAAV,2EAAGD,CAAH,qBASL8P,GAAa,SAAbA,WAAc,GAA4B,IAA1BC,EAA0B,EAA1BA,MAAOlP,EAAmB,EAAnBA,MAC3B,OACE,yBACE,gBAACgP,GAAD,CAAOG,UAAU,SAASD,GAD5B,KAGGlP,IASQ,SAASoP,cAAcrT,GACpC,OACE,gBAAC,EAAD,yBACMA,EADN,CAEEiE,MAAO,gBAAC,GAAD,CAAYkP,MAAOnT,EAAMmT,MAAOlP,MAAOjE,EAAMiE,W,s2FCjB1D,IAAMqP,GAAW,IAAIC,KAIlBC,GAAU,CAAC,SAAU,CACtBC,eAAe,EACfC,MAAM,IAoEOC,G,8lBApCbtM,YAAc,WAAM,MAClB,EAA4B,EAAKrH,MAAM2B,KAA/BvI,EAAR,EAAQA,OAGR6I,EAHA,EAAeA,UAIb7I,EAAMsV,GAAGC,WACP,GACAvV,EAAMwP,UAAUgL,MAAM9K,KAAM,UAAC,EAAK9I,MAAMuJ,cAAZ,QAAsB,IAAInP,OAAS,EAC/DhB,EAAMwP,UAAUgG,M,0NA3BtB,SAAA1O,MACE,MAAwBlH,KAAKgH,MAArBuJ,OAEFlK,QAFN,MAAiB,GAAjB,GAEiBmN,cAajB,OAZe8G,GAAS/J,OAAOlK,GAAG8B,KAAI,SAAC8D,GACrC,IAAM4O,EAAc5O,EAAK4O,YACnBnY,EAAOuJ,EAAK6O,MAAM,GACxB,wDACK7O,GADL,IAEEvJ,KAAM,QACNuI,MAAOvI,EACPmY,cACA5V,MAAO,CAAE4S,OAAQnV,EAAM,YAAaA,QAI1BvB,MAAM,EAAG,M,oBAgBzB,SAAAkB,SACE,IAAM+I,EAAc,uBACpB,OACE,kBAAC,GAAD,qBACMpL,KAAKgH,MADX,CAEE4E,GAAIR,EACJgI,YAAY,EACZpD,cAAehQ,KAAKqO,YACpBqG,eAAgB,wBAACzI,EAAM4J,EAAQ1V,GAAf,OACd,kBAACka,cAAD,CACErP,QAAS7K,EAAQ6K,QACjBL,SAAUxK,EAAQwK,SAClBM,MAAOgB,EAAK4O,YACZV,MAAOlO,EAAKkO,MACZ/O,YAAaA,KAGjBW,MAAO/L,KAAK+L,a,WA3DIR,IAAMwP,e,8JCpB9B,SAASC,oBAAoBC,EAAWxM,GACtC,IAAIyM,EAyBJ,OAvBA,SAASC,UAAU3Z,GAAqB,IAATsO,EAAS,uDAAH,EAEZ,SAAnBtO,EAAKiB,KAAKC,MAEZlB,EAAKzB,MAAML,SAAQ,SAAC+D,GAEK,SAAnBA,EAAKhB,KAAKC,MAERe,EAAKwB,MAAMwJ,OAASA,IACtByM,EAAS,CAAE1Z,OAAMsO,WAMpBtO,EAAKtB,QAAQY,MAIlBU,EAAK4Z,YAAYD,WAGnBA,CAAUF,GACHC,EAGT,IAoDeG,GApDU,iB,oRAAA,0BAAG,iBAC1B1S,EACAsC,EACAwD,EACAtO,GAJ0B,kHAUlB8I,EAAoBN,EAApBM,SAAU7I,EAAUuI,EAAVvI,MACVkb,EAA8Bnb,EAA9Bmb,aAAc1M,EAAgBzO,EAAhByO,YAXI,kBAcN0M,EAAarQ,GAdP,UAclBsQ,EAdkB,OAelBL,EAASF,oBAAoBrS,EAAKvI,MAAM6a,IAAKxM,GAf3B,iDAqBxBxF,EACEN,EAAKvI,MAAMsV,GACR8F,WACCN,EAAOpL,IACPoL,EAAOpL,IAAMoL,EAAO1Z,KAAKia,SACzBrb,EAAMgH,OAAOrH,MAAM8W,MAEpB6E,QACCR,EAAOpL,IACPoL,EAAOpL,IAAMoL,EAAO1Z,KAAKia,SACzBrb,EAAMgH,OAAOrH,MAAM8W,KAAK8E,OAAO,CAAElN,KAAM8M,MA/BrB,qDAmClBL,EAASF,oBAAoBrS,EAAKvI,MAAM6a,IAAKxM,GAnC3B,mDAwCxBxF,EACEN,EAAKvI,MAAMsV,GAAG8F,WACZN,EAAOpL,IACPoL,EAAOpL,IAAMoL,EAAO1Z,KAAKia,SACzBrb,EAAMgH,OAAOrH,MAAM8W,OAIvBjI,EAAYzO,EAAQ0O,WAAW+M,iBAhDP,gEAAH,gBAAnBP,oBAAmB,4C,2sHCbzB,IAAM9O,GAAkB,CACtBC,MAAO,IACPC,IAAK,EACLoP,OAAQ,EACRC,SAAS,GAGX,SAASC,YAAT,GAQG,MA+BGC,EACAC,EAvCJpP,EAOC,EAPDA,QACAqP,EAMC,EANDA,gBACAlV,EAKC,EALDA,MAMQ2B,EAAiB3B,EAAjB2B,KAAM9F,EAAWmE,EAAXnE,OACN+M,EAAcjH,EAAKvI,MAAnBwP,UACR,ECnCa,SAASuM,iBACtB7Q,GACmC,QACnC,iCAAwB8Q,mBAAS,CAC/BC,OAAO,UAAA/Q,EAAI6D,eAAJ,eAAamN,cAAe,EACnCC,QAAQ,UAAAjR,EAAI6D,eAAJ,eAAaqN,eAAgB,IAFvC,GAAO1b,EAAP,KAAa2b,EAAb,KAwBA,OAnBAC,qBAAU,WACR,IAAMC,EAAe,IAAIC,gBAAe,SAACpT,GACvCA,EAAQ9J,SAAQ,YAAgB,IAAbmd,EAAa,EAAbA,OAEf/b,EAAKub,QAAUQ,EAAOP,aACtBxb,EAAKyb,SAAWM,EAAOL,cAEvBC,EAAQ,CAAEJ,MAAOQ,EAAOP,YAAaC,OAAQM,EAAOL,qBAS1D,OAJIlR,EAAI6D,SACNwN,EAAaG,QAAQxR,EAAI6D,SAGpB,kBAAMwN,EAAaI,gBACzB,CAACzR,IAEGxK,EDQ0Cqb,CAAiBtP,GAAnDmQ,EAAf,EAAQX,MAA0BY,EAAlC,EAA0BV,OACpBW,EEpCO,SAASC,oBAItB,sCAA4Bf,oBAC1B,wBAAM,UAAAlM,OAAOkN,sBAAP,eAAuBb,SAAUrM,OAAO+C,eADhD,GAAOsJ,EAAP,KAAec,EAAf,KAgBA,OAZAC,2BAAgB,WAAM,MACdC,EAAe,SAAfA,eACJF,GAAU,wBAAM,UAAAnN,OAAOkN,sBAAP,eAAuBb,SAAUrM,OAAO+C,gBAK1D,OAFA,UAAA/C,OAAOkN,sBAAP,SAAuBjN,iBAAiB,SAAUoN,GAE3C,WAAM,MACX,UAAArN,OAAOkN,sBAAP,SAAuBtM,oBAAoB,SAAUyM,MAEtD,IAEIhB,EFgBgBY,GACjBK,EAAgBC,aAAc,uCAEpC,IACG5a,IACAma,IACAC,IACApQ,EAAQsC,SACT+M,EAEA,OAAO3P,GAKT,GAAIiR,GAAiBN,EACnB,MAAO,CACL1Q,KAAM,EACNoG,MAAO,EACPnG,IAAKyQ,EAAiBD,EACtBpB,OAAQ,EACRC,SAAS,GAQb,IACEE,EAAUrT,EAAKsJ,YAAYrC,EAAUsC,MACrC+J,EAAQtT,EAAKsJ,YAAYrC,EAAUgG,IAAK,GACxC,MAAOzD,GAEP,OADAC,QAAQC,KAAKF,GACN5F,GAIT,IAAMmR,EAAkB,CACtBjR,IAAKhI,KAAKC,IAAIsX,EAAQvP,IAAKwP,EAAMxP,KACjCC,OAAQjI,KAAKqJ,IAAIkO,EAAQtP,OAAQuP,EAAMvP,QACvCF,KAAM/H,KAAKC,IAAIsX,EAAQxP,KAAMyP,EAAMzP,MACnCoG,MAAOnO,KAAKqJ,IAAIkO,EAAQpJ,MAAOqJ,EAAMrJ,QAIjC+K,EACJ/N,aAAqBgO,kBACrBhO,EAAU+N,gBACV/N,EAAU+N,iBACNE,EACJjO,aAAqBgO,kBACrBhO,EAAUiO,gBACVjO,EAAUiO,iBAEZ,GAAIF,EAAgB,CAClB,IACQtB,EADkB1T,EAAK2J,SAAS1C,EAAUsC,MAA1C1Q,KACmCuQ,wBAAnCsK,MACRqB,EAAgBjR,KAAO,GACvBiR,EAAgB9K,MAAQ8K,EAAgBlR,KAAO6P,EAWjD,GARIwB,IACFH,EAAgB9K,MAAQ8K,EAAgBlR,KAAOkR,EAAgBlR,KAAO,IAItEoD,aAAqBkO,iBAA+C,WAA9B,UAAAlO,EAAUpO,YAAV,eAAgBiB,KAAKC,MAGvC,CACpB,IAOA,EAPgBiG,EAAKoV,QAAQnO,EAAUsC,MAIO8L,qBAC5C,OACA,GACwCjM,wBAAlCvF,EAAR,EAAQA,KAAMC,EAAd,EAAcA,IAAK4P,EAAnB,EAAmBA,MAEnB,MAAO,CACL7P,KAAM/H,KAAKwZ,MAAMzR,EAAO6P,EAAQ,EAAInM,OAAO4C,QAAUkK,EAAY,GACjEvQ,IAAKhI,KAAKwZ,MAAMxR,EAAMyD,OAAOgD,QAAU+J,GACvCpB,OAAQ,EACRC,SAAS,GAIX,IAAMoC,EACJzZ,KAAK0Z,IAAIT,EAAgB9K,MAAQ8K,EAAgBlR,MAAQ,EACrD4R,EAAoBV,EAAgBlR,KAAO0R,EAM3C1R,EAAO/H,KAAKC,IAChBwL,OAAOmO,WAAarB,EAFP,GAGbvY,KAAKqJ,IAHQ,GAGIsQ,EAAoBpB,EAAY,IAE7CvQ,EAAMhI,KAAKC,IACfwL,OAAO+C,YAAcgK,EANR,GAObxY,KAAKqJ,IAPQ,GAOI4P,EAAgBjR,IAAMwQ,IAMnCpB,EAASrP,GAAQ4R,EAAoBpB,EAAY,GACvD,MAAO,CACLxQ,KAAM/H,KAAKwZ,MAAMzR,EAAO0D,OAAO4C,SAC/BrG,IAAKhI,KAAKwZ,MAAMxR,EAAMyD,OAAOgD,SAC7B2I,OAAQpX,KAAKwZ,MAAMpC,GACnBC,SAAS,GAKf,IAAMwC,GAAkB/S,cACtB,SAACvE,EAAcuX,GACb,IAAM1R,EAAU0R,GAAgBhT,cAChC,gCAA4CA,YAAe,GAA3D,GAAO2Q,EAAP,KAAwBsC,EAAxB,KAEM7N,EAAWoL,YAAY,CAC3BlP,UACAqP,kBACAlV,UAaF,OAVAyX,aAAiB,WAAW,WAC1BD,GAAiB,MAGnBC,aAAiB,aAAa,WACvBzX,EAAMnE,QACT2b,GAAiB,MAKnB,gBAAC,IAAD,KACE,gBAAC,GAAD,CACE3b,OAAQmE,EAAMnE,QAAU8N,EAASmL,QACjCxQ,IAAKuB,EACLgP,OAAQlL,EAASkL,OACjBxD,MAAO,CACL5L,IAAK,GAAF,OAAKkE,EAASlE,IAAd,MACHD,KAAM,GAAF,OAAKmE,EAASnE,KAAd,QAGLxF,EAAMgS,cAOXrF,GAAUvJ,UAAO4K,IAAV,8EAAG5K,CAAH,w0BAOAiL,IAAOC,eAEE,SAACtO,GAAD,OAAWA,EAAMsD,MAAMoU,qBAkB3B,SAAC1X,GAAD,OAAWA,EAAMsD,MAAMoU,qBAKlB,SAAC1X,GAAD,OAAWA,EAAM6U,QAAU,KAQ9C,qBAAGhZ,QACG,sEAuBKyb,M,sxBG1Nf,IAAMK,GAAcvU,UAAOC,KAAV,gFAAGD,CAAH,2DAIN,SAACpD,GAAD,OAAWA,EAAMsD,MAAMgC,eAG5BgI,GAAWlK,UAAO8K,GAAV,6EAAG9K,CAAH,gOAQH,SAACpD,GAAD,OAAWA,EAAMsD,MAAMgC,eAClB,SAACtF,GAAD,OACZA,EAAM2D,SAAW3D,EAAMsD,MAAMsU,uBAAyB,iBACzC,SAAC5X,GAAD,OAAWA,EAAMsD,MAAM8K,cAMvB,SAACpO,GAAD,OAAYA,EAAM6X,QAAU,UAAY,SAC7C,SAAC7X,GAAD,OAAYA,EAAM6X,QAAU,OAAS,UAG3CC,GAAQ1U,UAAO4K,IAAV,0EAAG5K,CAAH,qCAKL2U,GAAW3U,UAAO4K,IAAV,6EAAG5K,CAAH,iCAID,SAACpD,GAAD,OAAYA,EAAM2D,SAAW,IAAO,MAGlCqU,GAtEf,SAASA,iBAAT,GAA+E,IAAnD/T,EAAmD,EAAnDA,MAAOgU,EAA4C,EAA5CA,SAAUtU,EAAkC,EAAlCA,SAAUQ,EAAwB,EAAxBA,KAAS+T,EAAe,+CACvE5T,EAAMC,eACV,SAAC/J,GACKmJ,GAAYnJ,GACdgK,YAAehK,EAAM,CACnBiK,WAAY,YACZC,MAAO,SACPC,SAAU,kBAACrJ,GAIT,MAAqB,wBAAdA,EAAOsJ,QAKtB,CAACjB,IAGH,OACE,gBAAC,GAAD,0BAAUW,IAAKA,EAAKuT,SAAUI,EAAUtU,SAAUA,GAAcuU,GAC9D,gBAACP,GAAD,KAAcxT,GACd,2BACE,gBAAC2T,GAAD,KAAQ7T,GACPgU,EAAW,gBAACF,GAAD,CAAUpU,SAAUA,GAAWsU,GAAuB,QC/B3D7U,aAAOK,OAAtB,oEAAeL,CAAf,0WAcW,SAACpD,GAAD,OAAWA,EAAMsD,MAAMgC,eAoB9B,SAACtF,GAAD,OAAWA,EAAMnE,QAAU,iB,aCxBzBsc,GAAiB/U,UAAOC,KAAV,6EAAGD,CAAH,mBAILgV,GAVyB,SAAlCA,eAAmC,GAAD,IAAGpG,EAAH,EAAGA,SAAUqG,EAAb,EAAaA,QAAb,OACtC,gBAACC,GAAA,EAAD,CAASzD,OAAO,OAAO0D,MAAO,IAAKF,QAASA,EAASG,UAAU,OAC7D,gBAACL,GAAD,KAAiBnG,K,0lGCkDfyG,G,umBACJC,mBAAoB,E,EACpBC,aAAe,EAAKlR,K,EACpBmR,uBAAyB,EAAK5Y,MAAM4O,GAAK,EAAK5O,MAAMkL,K,EAEpD9R,MAAe,CACb2M,eAAgB,EAChBxG,MAAO,EAAKkI,KACZoR,cAAe,GACfC,QAAS,I,EAkBXjP,qBAAuB,WAErB,IAAI,EAAK6O,mBAKL,EAAKtf,MAAMmG,QAAU,EAAKoZ,aAA9B,CAKA,IAAMlR,GAAQ,EAAKrO,MAAMmG,OAAS,IAAItF,OACtC,IAAKwN,EACH,OAAO,EAAKsR,mBAGd,EAAKC,KAAKvR,EAAMA,K,EAGlBuR,KAAO,SAACvR,EAAcxD,GAGpB,GAAoB,KAFpBwD,EAAOA,EAAKxN,QAEHG,OAAT,CAIA,EAAKse,mBAAoB,EACzB,MAAqB,EAAK1Y,MAAlBkL,EAAR,EAAQA,KAAM0D,EAAd,EAAcA,GAKXqK,aAAMxR,IACNA,EAAKmL,WAAW,MAChBnL,EAAKmL,WAAW,MAChBnL,EAAKmL,WAAW,aAEjBnL,EAAO,WAAH,OAAcA,IAGpB,EAAKzH,MAAMkZ,aAAa,CAAEzR,OAAMxD,QAAOiH,OAAM0D,S,EAG/C3I,cAAgB,SAACC,GACf,OAAQA,EAAME,KACZ,IAAK,QACHF,EAAMG,iBACN,MAAiC,EAAKjN,MAA9B2M,EAAR,EAAQA,cAAexG,EAAvB,EAAuBA,MACjBuZ,EAAU,EAAK1f,MAAM0f,QAAQvZ,IAAU,GACrC+U,EAAiB,EAAKtU,MAAtBsU,aAER,GAAIvO,GAAiB,EAAG,CACtB,IAAMmO,EAAS4E,EAAQ/S,GACnBmO,EACF,EAAK8E,KAAK9E,EAAOK,IAAKL,EAAOjQ,OACpBqQ,GAAgBvO,IAAkB+S,EAAQ1e,QACnD,EAAK+e,iBAAiB,EAAKC,yBAI7B,EAAKJ,KAAKzZ,EAAOA,GAOnB,YAJI,EAAKqZ,wBACP,EAAKS,sBAMT,IAAK,SAQH,OAPAnT,EAAMG,sBAEF,EAAKsS,aACP,EAAK9R,SAAS,CAAEtH,MAAO,EAAKoZ,cAAgB,EAAKU,oBAEjD,EAAKN,oBAKT,IAAK,UACH,GAAI7S,EAAMO,SACR,OAEFP,EAAMG,iBACNH,EAAMI,kBACN,IAAMK,EAAY,EAAKvN,MAAM2M,cAAgB,EAK7C,YAHA,EAAKc,SAAS,CACZd,cAAetI,KAAKqJ,KAAK,EAAGH,KAKhC,IAAK,YACL,IAAK,MACH,GAAIT,EAAMO,SACR,OAGFP,EAAMG,iBACNH,EAAMI,kBACN,MAAiC,EAAKlN,MAA9B2M,EAAR,EAAQA,cAAexG,EAAvB,EAAuBA,MAEjBwH,GADU,EAAK3N,MAAM0f,QAAQvZ,IAAU,IACvBnF,OAChB4M,EAAYjB,EAAgB,EAKlC,YAHA,EAAKc,SAAS,CACZd,cAAetI,KAAKC,IAAIsJ,EAAWD,O,EAO3CuS,gBAAkB,SAACvT,GACjB,EAAKc,SAAS,CAAEd,mB,EAGlBwT,a,sEAAe,iBACbrT,GADa,sGAGP3G,EAAQ2G,EAAM2P,OAAOtW,MAE3B,EAAKsH,SAAS,CACZtH,QACAwG,eAAgB,MAGZyT,EAAeja,EAAMtF,UAEP,EAAK+F,MAAMyZ,aAZlB,0CAca,EAAKzZ,MAAMyZ,aAAaD,GAdrC,OAcHV,EAdG,OAeT,EAAKjS,UAAS,SAACzN,GAAD,MAAY,CACxB0f,QAAS,mDACJ1f,EAAM0f,SADJ,gCAEJU,EAAeV,IAElBD,cAAeW,MApBR,kDAuBTpO,QAAQsO,MAAR,MAvBS,gE,wDA4BfC,YAAc,WACZC,YAAW,kBAAM,EAAKZ,KAAK,EAAK5f,MAAMmG,MAAO,EAAKnG,MAAMmG,SAAQ,I,EAGlEsa,eAAiB,SAAC3T,GAChBA,EAAMG,iBACN,EAAKrG,MAAM8Z,YAAY,EAAKrS,KAAMvB,I,EAGpCiT,iB,sEAAmB,kBAAO5Z,GAAP,mGACjB,EAAKmZ,mBAAoB,EACjBpE,EAAiB,EAAKtU,MAAtBsU,aAGa,KADrB/U,EAAQA,EAAMtF,QACJG,OALO,qDASbka,EATa,yCAURA,EAAa/U,IAVL,kD,wDAcnBwZ,iBAAmB,WACjB,EAAKL,mBAAoB,EAEzB,MAA+C,EAAK1Y,MAA5CkL,EAAR,EAAQA,KAAM0D,EAAd,EAAcA,GAAInS,EAAlB,EAAkBA,KAAMkF,EAAxB,EAAwBA,KAAMoY,EAA9B,EAA8BA,aAC9B,EAA4B,EAAK/Z,MAAM2B,KAA/BvI,EAAR,EAAQA,MAAO6I,EAAf,EAAeA,SAEXxF,GACFwF,EAAS7I,EAAMsV,GAAG8F,WAAWtJ,EAAM0D,EAAInS,IAGrCsd,GACFA,IAGFpY,EAAKK,S,EAGPgY,iBAAmB,SAACzF,EAAatQ,GAAd,OAAgC,SACjDiC,GAEAA,EAAMG,iBACN,EAAK2S,KAAKzE,EAAKtQ,GAEX,EAAK2U,wBACP,EAAKS,uB,EAITA,mBAAqB,WACnB,MAAqB,EAAKrZ,MAAlB4O,EAAR,EAAQA,GAAIjN,EAAZ,EAAYA,KACJvI,EAAoBuI,EAApBvI,OACR6I,EAD4BN,EAAbM,UACNgY,2BAAiBrL,EAAjBqL,CAAqB7gB,EAAMsV,KACpC/M,EAAKK,S,6NA3NP,SAAA9B,MACE,OAAOlH,KAAKgH,MAAMvD,KAAOzD,KAAKgH,MAAMvD,KAAKwB,MAAMwJ,KAAO,K,8BAGxD,SAAAvH,MACE,IAAQ9G,EAAUJ,KAAKgH,MAAM2B,KAArBvI,MACAmG,EAAUvG,KAAKI,MAAfmG,MACF2a,EAAgB9gB,EAAM6a,IAAIkG,IAC9B/gB,EAAMwP,UAAUsC,KAChB9R,EAAMwP,UAAUgG,IAChBhQ,YAEF,OAAOW,EAAMtF,QAAUigB,EAAcjgB,S,oBAkNvC,SAAAoB,SAAS,WACCwM,EAAe7O,KAAKgH,MAApB6H,WACR,EAAiC7O,KAAKI,MAA9BmG,EAAR,EAAQA,MAAOwG,EAAf,EAAeA,cACT+S,EACJ9f,KAAKI,MAAM0f,QAAQvZ,EAAMtF,SACzBjB,KAAKI,MAAM0f,QAAQ9f,KAAKI,MAAMyf,gBAC9B,GAEIuB,EAAe7a,EAAMG,MAAM,iBAC3B0Z,EAAqBpgB,KAAKogB,mBAC1BiB,EAAaC,aAAc/a,GAE3Bgb,IACFvhB,KAAKgH,MAAMsU,gBACX8E,IAAuBpgB,KAAK2f,eAC9BS,EAAmBhf,OAAS,IAC3BggB,EAEGI,IACFpB,IAAuBmB,GAAkBzB,EAAQ1e,OAAS,GAE9D,OACE,gBAAC,GAAD,KACE,gBAAC,EAAD,CACEmF,MAAOA,EACPwN,YACEwN,EACI1S,EAAW4S,gBACX5S,EAAW6S,kBAEjBxN,UAAWlU,KAAKiN,cAChBkH,QAASnU,KAAK2gB,YACd5L,SAAU/U,KAAKugB,aACfnM,UAAyB,KAAdpU,KAAKyO,OAGlB,gBAAC,GAAD,CACE4Q,QAASgC,EAAaxS,EAAW8S,SAAW9S,EAAW+S,UAEvD,gBAACC,GAAD,CAAe7W,QAAShL,KAAK6gB,eAAgBnW,UAAWnE,GACrD8a,EACC,gBAAC,YAAD,CAAWxV,MAAM,iBAEjB,gBAAC,WAAD,CAAUA,MAAM,mBAItB,gBAAC,GAAD,CAASwT,QAASxQ,EAAWiT,YAC3B,gBAACD,GAAD,CAAe7W,QAAShL,KAAK+f,kBAC1B/f,KAAK2f,aACJ,gBAAC,YAAD,CAAW9T,MAAM,iBAEjB,gBAAC,YAAD,CAAWA,MAAM,mBAKtB2V,GACC,gBAACO,GAAD,CAAenW,GAAG,uBACfkU,EAAQ3X,KAAI,SAAC+S,EAAQ3Y,GAAT,OACX,gBAAC,GAAD,CACE6K,IAAK8N,EAAOK,IACZtQ,MAAOiQ,EAAOjQ,MACdgU,SAAU/D,EAAO+D,SACjB9T,KAAM,gBAAC,eAAD,CAAcU,MAAM,iBAC1B2I,cAAe,gCAAM,EAAK8L,gBAAgB/d,IAC1CyI,QAAS,EAAKgW,iBAAiB9F,EAAOK,IAAKL,EAAOjQ,OAClDN,SAAUpI,IAAUwK,OAIvBwU,GACC,gBAAC,GAAD,CACEnU,IAAI,SACJnC,MAAOmV,EACPnB,SAAUpQ,EAAWmT,aACrB7W,KAAM,gBAAC,WAAD,CAAUU,MAAM,iBACtB2I,cAAe,gCAAM,EAAK8L,gBAAgBR,EAAQ1e,SAClD4J,QAAS,mBACP,EAAKmV,iBAAiBC,GAElB,EAAKR,wBACP,EAAKS,sBAGT1V,SAAUmV,EAAQ1e,SAAW2L,U,YA/TpBxB,aAyUnBoI,GAAUvJ,kBAAO6X,KAAV,0EAAG7X,CAAH,oFAQP2X,GAAgB3X,UAAO6K,GAAV,gFAAG7K,CAAH,uVACH,SAACpD,GAAD,OAAWA,EAAMsD,MAAMoU,qBAyBxBe,M,khGCtYMyC,G,gnBACnBrV,QAAUtB,c,EAEVnL,MAAQ,CACNoM,MAAO,IACPC,SAAK3G,G,EAWPqc,mBAAqB,SAACjV,GAElBA,EAAM2P,kBAAkBuF,aACxB,EAAKvV,QAAQsC,SACb,EAAKtC,QAAQsC,QAAQkT,SAASnV,EAAM2P,SAKtC,EAAK7V,MAAMwG,W,EAGb8U,mB,uEAAqB,iBAAOrX,GAAP,0HAC8C,EAAKjE,MAA9D6H,EADW,EACXA,WAAYyM,EADD,EACCA,aAAc3S,EADf,EACeA,KAAM6E,EADrB,EACqBA,QAASoB,EAD9B,EAC8BA,YAEjDpB,IACA,EAAKxG,MAAM2B,KAAKK,QAEXsS,EANc,oDAUXrS,EAAoBN,EAApBM,SAAU7I,EAAUuI,EAAVvI,MAVC,EAWEA,EAAMwP,UAAnBsC,EAXW,EAWXA,KAAM0D,EAXK,EAWLA,GACV1D,IAAS0D,EAZM,iDAiBbnH,EAjBa,mBAiBMxD,EAjBN,KAoBnBhC,EACEN,EAAKvI,MAAMsV,GACRC,WAAW1K,EAAOiH,EAAM0D,GACxB8F,QACCxJ,EACA0D,EAAK3K,EAAM7J,OACXhB,EAAMgH,OAAOrH,MAAM8W,KAAK8E,OAAO,CAAElN,WAIvC4M,GAAoB1S,EAAMsC,EAAOwD,EAAM,CACrC6M,eACA1M,cACAC,eAjCiB,kD,wDAqCrB0T,mBAAqB,YAQf,IAPJ9T,EAOI,EAPJA,KACAxD,EAMI,EANJA,MAOA,EAA0B,EAAKjE,MAAvB2B,EAAR,EAAQA,MAER6E,EAFA,EAAcA,WAGd,EAAKxG,MAAM2B,KAAKK,QAEhB,IAAQC,EAAoBN,EAApBM,SAAU7I,EAAUuI,EAAVvI,MAClB,EAAqBA,EAAMwP,UAAnBsC,EAAR,EAAQA,KAAM0D,EAAd,EAAcA,GACV1D,IAAS0D,GAKb3M,EACEN,EAAKvI,MAAMsV,GACRC,WAAW1K,EAAOiH,EAAM0D,GACxB8F,QACCxJ,EACA0D,EAAK3K,EAAM7J,OACXhB,EAAMgH,OAAOrH,MAAM8W,KAAK8E,OAAO,CAAElN,Y,gPApFzC,SAAAwB,oBACEC,OAAOC,iBAAiB,YAAanQ,KAAKmiB,sB,kCAG5C,SAAAtR,uBACEX,OAAOY,oBAAoB,YAAa9Q,KAAKmiB,sB,oBAoF/C,SAAA9f,SACE,MAA2CrC,KAAKgH,MAAxCsU,EAAR,EAAQA,aAAc9N,EAAtB,EAAsBA,QAAY0R,EAAlC,0CACQtP,EAAc5P,KAAKgH,MAAM2B,KAAKvI,MAA9BwP,UACF/M,EAhHV,SAASsK,qBAASnG,GAChB,IAAQ2B,EAAS3B,EAAT2B,KACAiH,EAAcjH,EAAKvI,MAAnBwP,UAER,IACE,IAAM6C,EAAY9J,EAAK2J,SAAS1C,EAAUsC,MAC1C,OAAOlL,EAAMmG,YAAcsF,EAAUjR,KACrC,MAAO2Q,GACP,OAAO,GAwGQhF,CAASnN,KAAKgH,OAE7B,OACE,gBAAC,GAAD,qBAAiBsE,IAAKtL,KAAK6M,QAAShK,OAAQA,GAAYqc,GACrDrc,GACC,gBAAC,GAAD,qBACEuK,IAAG,UAAKwC,EAAUsC,KAAf,YAAuBtC,EAAUgG,IACpC1D,KAAMtC,EAAUsC,KAChB0D,GAAIhG,EAAUgG,GACd0F,aAAcA,EAAetb,KAAKsiB,wBAAqBxc,EACvDoa,aAAclgB,KAAKuiB,mBACnBxB,aAAcvT,GACV0R,S,aAhHyB3T,a,wFC/BzC,IASeiX,GATGpY,UAAO4K,IAAV,8EAAG5K,CAAH,4FAGC,SAACpD,GAAD,OAAWA,EAAMsD,MAAMgC,eCOjCmW,GAAkBrY,UAAO4K,IAAV,mFAAG5K,CAAH,qCACV,SAACpD,GAAD,OAAWA,EAAMsD,MAAMgC,eAqCnBoW,OAhCf,SAASA,YAAY1b,GACnB,MbduB,SAAZ2b,YAAY,OAAMpX,aAAiByO,IacnB2I,GAAnBja,EAAR,EAAQA,SAAUC,EAAlB,EAAkBA,KACVoD,EAAU/E,EAAV+E,MACA3L,EAAUuI,EAAVvI,MAER,OACE,gBAACqiB,GAAD,KACG1W,EAAM5D,KAAI,SAAC8D,EAAM1J,GAChB,GAAkB,cAAd0J,EAAKvJ,OAAyC,IAAjBuJ,EAAK6P,QACpC,OAAO,gBAAC8G,GAAD,CAAkBxV,IAAK7K,IAEhC,IAAqB,IAAjB0J,EAAK6P,UAAsB7P,EAAKd,KAClC,OAAO,KAET,IAAME,EAAOY,EAAKd,KACZgC,IAAWlB,EAAKpJ,QAASoJ,EAAKpJ,OAAOzC,GAE3C,OACE,gBAAC,GAAD,CAASif,QAASpT,EAAKoT,QAASjS,IAAK7K,GACnC,gBAACsf,GAAD,CACE7W,QAAS,0BAAMiB,EAAKvJ,MAAQgG,EAASuD,EAAKvJ,MAAMuJ,EAAKhH,QACrDpC,OAAQsK,GAER,gBAAC9B,EAAD,CAAMQ,MAAM,wB,4pGCC1B,SAASgX,UAAU7b,GACjB,IAAQ2B,EAAS3B,EAAT2B,KACR,EAA2BA,EAAKvI,MAAxBwP,EAAR,EAAQA,UAAWqL,EAAnB,EAAmBA,IAEnB,GAAI6H,aAAana,EAAKvI,MAAMgH,OAAOrH,MAAM8W,KAArCiM,CAA2Cna,EAAKvI,OAClD,OAAO,EAET,IAAKwP,GAAaA,EAAUmT,MAC1B,OAAO,EAET,GAAInT,aAAqBkO,iBAA8C,OAA7BlO,EAAUpO,KAAKiB,KAAKC,KAC5D,OAAO,EAET,GACEkN,aAAqBkO,iBACQ,UAA7BlO,EAAUpO,KAAKiB,KAAKC,KAEpB,OAAO,EAET,GAAIkN,aAAqBkO,gBACvB,OAAO,EAGT,IAAMoD,EAAgBjG,EAAIkG,IAAIvR,EAAUsC,KAAMtC,EAAUgG,IAAIhQ,YAC5D,GAAIgK,aAAqBoT,kBAAkB9B,EACzC,OAAO,EAGT,IAEMphB,EAFQ8P,EAAU1P,UACDA,QACSA,QAEhC,OAAO,KAAKJ,GAAO,SAACuG,GAAD,OAAOA,EAAEnG,QAAQY,Q,IAGjBmiB,G,6pBACnB9V,UAAW,E,EACXN,QAAUtB,c,EAsBV4W,mBAAqB,SAACe,GACpB,KACEA,EAAGrG,kBAAkBuF,aACrB,EAAKvV,QAAQsC,SACb,EAAKtC,QAAQsC,QAAQkT,SAASa,EAAGrG,UAK9B,EAAK1P,SAAV,CAIA,IAAQxE,EAAS,EAAK3B,MAAd2B,KACR,IAAIA,EAAKwa,YAMTla,EAFqBN,EAAbM,UAGNN,EAAKvI,MAAMsV,GAAG0N,aAAa,IAAIJ,gBAAcra,EAAKvI,MAAM6a,IAAIoI,QAAQ,Q,EAIxEf,mB,4EAAqB,iBAAOrX,GAAP,0HACqC,EAAKjE,MAArD6H,EADW,EACXA,WAAYyM,EADD,EACCA,aAAc3S,EADf,EACeA,KAAMiG,EADrB,EACqBA,YAEnC0M,EAHc,oDAOXrS,EAAoBN,EAApBM,SAAU7I,EAAUuI,EAAVvI,MAPC,EAQEA,EAAMwP,UAAnBsC,EARW,EAQXA,KAAM0D,EARK,EAQLA,GACV1D,IAAS0D,EATM,iDAcbnH,EAda,mBAcMxD,EAdN,KAebqY,EAAWljB,EAAMgH,OAAOrH,MAAM8W,KAGpC5N,EACEN,EAAKvI,MAAMsV,GACR8F,WAAWtJ,EAAM0D,EAAI0N,GACrB5H,QAAQxJ,EAAM0D,EAAI0N,EAAS3H,OAAO,CAAElN,WAGzC4M,GAAoB1S,EAAMsC,EAAOwD,EAAM,CACrC6M,eACA1M,cACAC,eA3BiB,kD,wDA+BrB0T,mBAAqB,YAQT,IAPV9T,EAOU,EAPVA,KACAyD,EAMU,EANVA,KACA0D,EAKU,EALVA,GAMQjN,EAAS,EAAK3B,MAAd2B,KACAvI,EAAoBuI,EAApBvI,MAAO6I,EAAaN,EAAbM,SAETqa,EAAWljB,EAAMgH,OAAOrH,MAAM8W,KAEpC5N,EACE7I,EAAMsV,GACH8F,WAAWtJ,EAAM0D,EAAI0N,GACrB5H,QAAQxJ,EAAM0D,EAAI0N,EAAS3H,OAAO,CAAElN,Y,qQA7F3C,SAAA+B,qBACE,IAAMsL,EAAU+G,UAAU7iB,KAAKgH,OAC3BhH,KAAKmN,WAAa2O,IACpB9b,KAAKmN,UAAW,EAChBnN,KAAKgH,MAAMwG,YAERxN,KAAKmN,UAAY2O,IACpB9b,KAAKmN,UAAW,EAChBnN,KAAKgH,MAAMuc,Y,+BAIf,SAAAtT,oBACEC,OAAOC,iBAAiB,UAAWnQ,KAAKmiB,sB,kCAG1C,SAAAtR,uBACEX,OAAOY,oBAAoB,UAAW9Q,KAAKmiB,sB,oBAgF7C,SAAA9f,SAAS,eACP,EAA+DrC,KAAKgH,MAA5D6H,EAAR,EAAQA,WAAYyM,EAApB,EAAoBA,aAAckI,EAAlC,EAAkCA,WAAYzQ,EAA9C,EAA8CA,IAAQmM,EAAtD,+CACQvW,EAASuW,EAATvW,KACAvI,EAAUuI,EAAVvI,MACAwP,EAAkCxP,EAAlCwP,UACF6T,EAAkBC,aAAatjB,EAAMgH,OAAOtH,MAAM6jB,WAAhCD,CAA4CtjB,GAC9DwjB,EAAqBF,aAAatjB,EAAMgH,OAAOtH,MAAM2X,GAAhCiM,CAAoCtjB,GAG/D,GAAIqjB,EACF,OAAO,KAGT,IAAMI,EC7LK,SAASC,eAAelU,GAErC,GADuBA,EAAU+N,gBAAkB/N,EAAU+N,iBAC7D,CAIA,IAAMoG,EAAQnU,EAAUgL,MAAcmJ,KACtC,OAAOA,EAAKA,EAAK3iB,OAAS,IDsLP0iB,CACd1jB,EAAMwP,WAEHoU,EEhMK,SAASC,YAAYrU,GAElC,GADuBA,EAAUiO,gBAAkBjO,EAAUiO,iBAC7D,CAIA,IAAMkG,EAAQnU,EAAUgL,MAAcmJ,KACtC,OAAOA,EAAKA,EAAK3iB,OAAS,IFyLP6iB,CAAa7jB,EAAMwP,WAC9BsU,OAAgCpe,IAAb+d,QAAuC/d,IAAbke,EAC7CnN,EAAOiM,aAAa1iB,EAAMgH,OAAOrH,MAAM8W,KAAhCiM,CAAsC1iB,GAC7CgR,EAAQ+S,aAAavU,EAAUgL,MAAOxa,EAAMgH,OAAOrH,MAAM8W,MACzDuN,EAAkD,WAA/B,UAAAxU,EAAUpO,YAAV,mBAAgBiB,YAAhB,eAAsBC,MAE3CqJ,EAAoB,GA2BxB,OADAA,EAAQD,uBAVRC,GAdEA,EADEmY,EGrMO,SAASG,eAAexV,GACrC,MAAO,CACL,CACEnM,KAAM,cACN2c,QAASxQ,EAAWyV,YACpBnZ,KAAMoZ,YACN1hB,OAAQ,yBAAM,KHgMN2hB,CAAkB3V,QACJ/I,IAAb+d,EI9LA,SAASY,kBACtBrkB,EACAmC,EACAwQ,EACAlE,GAEA,IAAQzH,EAAWhH,EAAXgH,OAER,MAAO,CACL,CACE1E,KAAM,gBACN2c,QAASxQ,EAAW6V,UACpBvZ,KAAMwZ,gBACN1f,MAAO,CAAE1C,QAAOsD,UAAW,QAC3BhD,OAAQ6gB,aAAatc,EAAOtH,MAAM8kB,GAAI,CACpCC,QAAS,EACTC,QAAS,EACTjf,UAAW,UAGf,CACEnD,KAAM,gBACN2c,QAASxQ,EAAWkW,YACpB5Z,KAAM6Z,kBACN/f,MAAO,CAAE1C,QAAOsD,UAAW,UAC3BhD,OAAQ6gB,aAAatc,EAAOtH,MAAM8kB,GAAI,CACpCC,QAAS,EACTC,QAAS,EACTjf,UAAW,YAGf,CACEnD,KAAM,gBACN2c,QAASxQ,EAAWoW,WACpB9Z,KAAM+Z,iBACNjgB,MAAO,CAAE1C,QAAOsD,UAAW,SAC3BhD,OAAQ6gB,aAAatc,EAAOtH,MAAM8kB,GAAI,CACpCC,QAAS,EACTC,QAAS,EACTjf,UAAW,WAGf,CACEnD,KAAM,aAER,CACEA,KAAMqQ,EAAM,iBAAmB,kBAC/BsM,QAAStM,EAAMlE,EAAWsW,eAAiBtW,EAAWuW,gBACtDja,KAAMka,iBACNxiB,OAAQ,yBAAM,IAEhB,CACEH,KAAMqQ,EAAM,kBAAoB,iBAChCsM,QAAStM,EAAMlE,EAAWuW,gBAAkBvW,EAAWsW,eACvDha,KAAMma,kBACNziB,OAAQ,yBAAM,IAEhB,CACEH,KAAM,aAER,CACEA,KAAM,eACN2c,QAASxQ,EAAW0W,aACpBpa,KAAMoZ,YACN1hB,OAAQ,yBAAM,KJ+HN2iB,CAAqBplB,EAAOyjB,EAAU9Q,EAAKlE,QAC7B/I,IAAbke,EKxMA,SAASyB,kBACtBrlB,EACAmC,EACAsM,GAEA,MAAO,CACL,CACEnM,KAAM,cACN2c,QAASxQ,EAAW6W,aACpBva,KAAMwa,kBACN1gB,MAAO,CAAE1C,MAAOA,EAAQ,GACxBM,OAAQ,yBAAM,GACdiZ,QAAmB,IAAVvZ,GAEX,CACEG,KAAM,cACN2c,QAASxQ,EAAW+W,YACpBza,KAAM0a,kBACN5gB,MAAO,CAAE1C,SACTM,OAAQ,yBAAM,IAEhB,CACEH,KAAM,aAER,CACEA,KAAM,YACN2c,QAASxQ,EAAWiX,UACpB3a,KAAMoZ,YACN1hB,OAAQ,yBAAM,KL6KNkjB,CAAqB3lB,EAAO4jB,EAAUnV,GACrCuV,EMlMA,SAAS4B,eACtB5lB,EACAyO,GAEA,IAAQzH,EAAWhH,EAAXgH,OACF6e,EAAgBvC,aAAatc,EAAOtH,MAAM6W,MAAO,CACrDuP,YAAa,YAETC,EAAiBzC,aAAatc,EAAOtH,MAAM6W,MAAO,CACtDuP,YAAa,aAGf,MAAO,CACL,CACExjB,KAAM,YACN2c,QAASxQ,EAAW6V,UACpBvZ,KAAMib,qBACNtK,SAAS,EACTjZ,OAAQojB,GAEV,CACEvjB,KAAM,cACN2c,QAASxQ,EAAWkW,YACpB5Z,KAAMkb,uBACNvK,SAAS,EACTjZ,OAAQ,gBAACzC,GAAD,OACNsjB,aAAatc,EAAOtH,MAAM6W,MAA1B+M,CAAiCtjB,KAChC6lB,EAAc7lB,KACd+lB,EAAe/lB,KAEpB,CACEsC,KAAM,aACN2c,QAASxQ,EAAWoW,WACpB9Z,KAAMmb,sBACNxK,SAAS,EACTjZ,OAAQsjB,GAEV,CACEzjB,KAAM,YACNoZ,SAAS,GAEX,CACEpZ,KAAM,gBACN2c,QAASxQ,EAAW0X,cACpBpb,KAAMqb,eACN1K,UAAW2K,MACX5jB,OAAQ,yBAAM,IAEhB,CACEH,KAAM,eACN2c,QAASxQ,EAAW6X,aACpBvb,KAAMwb,cACN7K,SAAS,EACTjZ,OAAQ,yBAAM,IAEhB,CACEH,KAAM,cACN2c,QAASxQ,EAAW+X,YACpBzb,KAAMoZ,YACNzI,SAAS,EACTjZ,OAAQ,yBAAM,KNuINgkB,CAAkBzmB,EAAOyO,GACxB+U,EO3MA,SAASkD,iBACtB1mB,EACAyO,GAEA,IAAQzH,EAAWhH,EAAXgH,OAER,MAAO,CACL,CACE1E,KAAM,KACN2c,QAASxQ,EAAW8I,UACpB1S,MAAO,CAAE4S,OAAQ,OACjBhV,OAAQ6gB,aAAatc,EAAOtH,MAAM2X,GAAI,CAAEI,OAAQ,QAChD1M,KAAMyM,iBAER,CACElV,KAAM,KACN2c,QAASxQ,EAAW4I,GACpBxS,MAAO,CAAE4S,OAAQ,OACjBhV,OAAQ6gB,aAAatc,EAAOtH,MAAM2X,GAAI,CAAEI,OAAQ,QAChD1M,KAAMuM,uBPyLEqP,CAAoB3mB,EAAOyO,GQ5L1B,SAASmY,oBACtB5mB,EACAojB,EACA3U,GAEA,IAAQzH,EAAWhH,EAAXgH,OACF6f,EAAUC,qBAAU9mB,GACpB+mB,EAASC,aAAShnB,GAClBinB,GAAeJ,IAAYE,EAEjC,MAAO,CACL,CACEzkB,KAAM,cACN2c,QAASxQ,EAAWkF,YACpB5I,KAAMmc,YACNzkB,OAAQigB,aAAa1b,EAAOrH,MAAMgU,aAClC+H,QAAS0H,GAEX,CACE9gB,KAAM,YACNoZ,QAAS0H,GAEX,CACE9gB,KAAM,SACN2c,QAASxQ,EAAW0Y,OACpBpc,KAAMqc,WACN3kB,OAAQigB,aAAa1b,EAAOrH,MAAMwnB,SAEpC,CACE7kB,KAAM,gBACN2c,QAASxQ,EAAW4Y,cACpBtc,KAAMuc,oBACN7kB,OAAQigB,aAAa1b,EAAOrH,MAAM0nB,gBAEpC,CACE/kB,KAAM,YACN2c,QAASxQ,EAAWpL,KACpB0H,KAAMwc,gBACN9kB,OAAQigB,aAAa1b,EAAOrH,MAAM6nB,WAClC9L,SAAU0H,GAEZ,CACE9gB,KAAM,cACN2c,QAASxQ,EAAWgZ,WACpB1c,KAAMqM,WACN3U,OAAQigB,aAAa1b,EAAOrH,MAAM+nB,cAEpC,CACEplB,KAAM,YACNoZ,QAASuL,GAEX,CACE3kB,KAAM,UACN2c,QAASxQ,EAAWkZ,QACpB5c,KAAM4K,eACNlT,OAAQ6gB,aAAatc,EAAOtH,MAAMioB,QAAS,CAAE/R,MAAO,IACpD/Q,MAAO,CAAE+Q,MAAO,GAChB8F,QAASuL,GAEX,CACE3kB,KAAM,UACN2c,QAASxQ,EAAWmZ,WACpB7c,KAAM+K,eACNrT,OAAQ6gB,aAAatc,EAAOtH,MAAMioB,QAAS,CAAE/R,MAAO,IACpD/Q,MAAO,CAAE+Q,MAAO,GAChB8F,QAASuL,GAEX,CACE3kB,KAAM,aACN2c,QAASxQ,EAAW5I,MACpBkF,KAAMmM,iBACNzU,OAAQ6gB,aAAatc,EAAOtH,MAAMmoB,YAClChjB,MAAO,CAAE+Q,MAAO,GAChB8F,QAASuL,GAEX,CACE3kB,KAAM,YACNoZ,QAASuL,GAAeF,GAE1B,CACEzkB,KAAM,gBACN2c,QAASxQ,EAAWwH,aACpBlL,KAAMmL,eACN7C,SAAU,0BACV5Q,OAAQ6gB,aAAatc,EAAOtH,MAAMooB,eAClCpM,QAASuL,GAAeF,GAE1B,CACEzkB,KAAM,cACN2c,QAASxQ,EAAW0H,WACpBpL,KAAMqL,mBACN3T,OAAQ6gB,aAAatc,EAAOtH,MAAMqoB,aAClCrM,QAASuL,GAAeF,GAE1B,CACEzkB,KAAM,eACN2c,QAASxQ,EAAW4H,YACpBtL,KAAMuL,kBACN7T,OAAQ6gB,aAAatc,EAAOtH,MAAMsoB,cAClCtM,QAASuL,GAAeF,GAE1B,CACEzkB,KAAM,aAER,CACEA,KAAM,OACN2c,QAASxQ,EAAWwZ,WACpBld,KAAM2L,WACNjU,OAAQigB,aAAa1b,EAAOrH,MAAM8W,MAClC5R,MAAO,CAAEwJ,KAAM,MRiFP6Z,CAAuBloB,EAAOojB,EAAY3U,IAItC7L,QAAO,SAACiJ,GACpB,MAAkB,cAAdA,EAAKvJ,QAGLuJ,EAAKvJ,OAAS,EAAKsE,MAAM0B,SAASuD,EAAKvJ,YAOlCtB,OAKT,gBAAC,GAAD,CACEuH,KAAMA,EACN9F,OAAQggB,UAAU7iB,KAAKgH,OACvBsE,IAAKtL,KAAK6M,SAETgK,GAAQzF,EACP,gBAAC,GAAD,0BACEhE,IAAG,UAAKgE,EAAMc,KAAX,YAAmBd,EAAMwE,IAC5B/G,WAAYA,EACZpL,KAAM2N,EAAM3N,KACZyO,KAAMd,EAAMc,KACZ0D,GAAIxE,EAAMwE,GACV0F,aAAcA,EAAetb,KAAKsiB,wBAAqBxc,EACvDoa,aAAclgB,KAAKuiB,oBACfrD,IAGN,gBAAC,GAAD,0BAAanT,MAAOA,GAAWmT,KArB5B,S,kBAvJiC3T,a,aSonC/Bgd,GA7rCMne,UAAO4K,IAAV,uEAAG5K,CAAH,o2aAMH,SAACpD,GAAD,OAAYA,EAAMwhB,KAAO,EAAI,KAEjC,SAACxhB,GAAD,OAAWA,EAAMsD,MAAMvI,QACjB,SAACiF,GAAD,OAAWA,EAAMsD,MAAM8K,cACvB,SAACpO,GAAD,OAAWA,EAAMsD,MAAMme,cAkHhB,SAACzhB,GAAD,OAAYA,EAAM0hB,SAAW,UAAY,UAa/C,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMqe,cA0CjC,SAAC3hB,GAAD,OAAYA,EAAM0hB,SAAW,cAAgB1hB,EAAMsD,MAAMK,YAYrD,SAAC3D,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WAChC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAGvB,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMK,YAoC9B,SAAC3D,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,kBAClC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMse,kBAC7B,SAAC5hB,GAAD,OAAWA,EAAMsD,MAAMO,iBAGvB,SAAC7D,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAsBpC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMvI,QAkEvB,SAACiF,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAMlC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMvI,QASjB,SAACiF,GAAD,OAAWA,EAAMsD,MAAMse,kBAkBxB,SAAC5hB,GAAD,OAAWA,EAAMsD,MAAMqe,cAC5B,SAAC3hB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UACzB,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,cAAgB,SA2ClC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,YAW/C,SAAC/L,GAAD,OAAYA,EAAM0hB,SAAW,GAAK,2BAGpC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMyJ,eAalB,SAAC/M,GAAD,OACZ6hB,aAAe,GAAK7hB,EAAMsD,MAAMwe,yBACT,SAAC9hB,GAAD,OAAWA,EAAMsD,MAAMwe,wBACvC,SAAC9hB,GAAD,OAAWA,EAAMsD,MAAMye,kBAMrB,SAAC/hB,GAAD,OAAWA,EAAMsD,MAAMye,kBAyBzB,SAAC/hB,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WACjC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMwe,wBAIlB,SAAC9hB,GAAD,OACZ6hB,aAAe,GAAK7hB,EAAMsD,MAAM0e,wBACT,SAAChiB,GAAD,OAAWA,EAAMsD,MAAM0e,uBACvC,SAAChiB,GAAD,OAAWA,EAAMsD,MAAM2e,iBAGrB,SAACjiB,GAAD,OAAWA,EAAMsD,MAAM0e,uBAIvB,SAAChiB,GAAD,OAAWA,EAAMsD,MAAM2e,iBAKpB,SAACjiB,GAAD,OACZ6hB,aAAe,GAAK7hB,EAAMsD,MAAM4e,4BACT,SAACliB,GAAD,OAAWA,EAAMsD,MAAM4e,2BACvC,SAACliB,GAAD,OAAWA,EAAMsD,MAAM6e,qBAGrB,SAACniB,GAAD,OAAWA,EAAMsD,MAAM4e,2BAIvB,SAACliB,GAAD,OAAWA,EAAMsD,MAAM6e,qBAiBvB,SAACniB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAG7B,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMrE,SAU9B,SAACe,GAAD,OAAWA,EAAMsD,MAAMyJ,eACJ,SAAC/M,GAAD,OAAWA,EAAMsD,MAAMyJ,eAM7C,SAAC/M,GAAD,OACAA,EAAM0hB,SAAW1hB,EAAMsD,MAAMyJ,YAAc/M,EAAMsD,MAAMO,iBAYlD,SAAC7D,GAAD,OAAWA,EAAMsD,MAAMvI,QAEP,SAACiF,GAAD,OAAWoiB,aAAQ,GAAKpiB,EAAMsD,MAAMvI,SAOlC,SAACiF,GAAD,OAAWA,EAAMsD,MAAMvI,QAO3C,SAACiF,GAAD,OAAWA,EAAMsD,MAAMuM,QAWb,SAAC7P,GAAD,OAAYA,EAAM0hB,SAAW,YAAc,UAKpD,SAAC1hB,GAAD,OAAYA,EAAM+L,IAAM,kBAAoB,qBAC3C,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,aAAe,gBAcnC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,IAAM,WAC7B,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,OAmBxC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAInC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMO,iBASrB,SAAC7D,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,kBAK/C,SAAC1hB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAYlC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAclC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAMlB,SAAC/L,GAAD,OAChBA,EAAM0hB,WAAa1hB,EAAMqiB,wBAA0B,OAAS,aACnD,SAACriB,GAAD,OACTA,EAAM0hB,WAAa1hB,EAAMqiB,wBAA0B,IAAO,KAClD,SAACriB,GAAD,OAAYA,EAAM+L,IAAM,cAAgB,iBAQ9B,SAAC/L,GAAD,qbACqZA,EAAMsD,MAAMvI,KAAKiE,QACtb,IACA,OAHgB,8BAQE,SAACgB,GAAD,mnBAEokBA,EAAMsD,MAAMQ,QAAQ9E,QACtmB,IACA,OAJc,uCA6BE,SAACgB,GAAD,OAAWA,EAAMsD,MAAMgf,kBAWtB,SAACtiB,GAAD,OAAWA,EAAMsD,MAAMgf,kBAK5B,SAACtiB,GAAD,OAAWA,EAAMsD,MAAMif,cAC7B,SAACviB,GAAD,OAAWA,EAAMsD,MAAMkf,kBAEtB,SAACxiB,GAAD,OAAWA,EAAMsD,MAAMse,kBAM7B,SAAC5hB,GAAD,OAAWA,EAAMsD,MAAMmf,2BAClB,SAACziB,GAAD,OAAWA,EAAMsD,MAAMof,iBAG1B,SAAC1iB,GAAD,OAAWA,EAAMsD,MAAMmf,2BAwBhC,SAACziB,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WASnB,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMqe,cAC5B,SAAC3hB,GAAD,OAAWA,EAAMsD,MAAMvI,QAenB,SAACiF,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,YAsBvC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMkf,kBAEjB,SAACxiB,GAAD,OAAWA,EAAMsD,MAAMif,cAI5B,SAACviB,GAAD,OAAWA,EAAMsD,MAAMse,kBAc7B,SAAC5hB,GAAD,OAAWA,EAAMsD,MAAMqf,QAcvB,SAAC3iB,GAAD,OAAWA,EAAMsD,MAAMsf,eAIvB,SAAC5iB,GAAD,OAAWA,EAAMsD,MAAMuf,mBAUvB,SAAC7iB,GAAD,OAAWA,EAAMsD,MAAMwf,cAIvB,SAAC9iB,GAAD,OAAWA,EAAMsD,MAAMyf,gBAIvB,SAAC/iB,GAAD,OAAWA,EAAMsD,MAAM0f,WAIvB,SAAChjB,GAAD,OAAWA,EAAMsD,MAAM2f,cAIvB,SAACjjB,GAAD,OAAWA,EAAMsD,MAAM4f,gBAIvB,SAACljB,GAAD,OAAWA,EAAMsD,MAAM6f,YAOvB,SAACnjB,GAAD,OAAWA,EAAMsD,MAAM8f,cAQvB,SAACpjB,GAAD,OAAWA,EAAMsD,MAAM+f,eAIvB,SAACrjB,GAAD,OAAWA,EAAMsD,MAAMggB,gBAMvB,SAACtjB,GAAD,OAAWA,EAAMsD,MAAMigB,iBAKvB,SAACvjB,GAAD,OAAWA,EAAMsD,MAAMkgB,mBAQJ,SAACxjB,GAAD,OAAWA,EAAMsD,MAAMmgB,gBAc1C,SAACzjB,GAAD,OAAWA,EAAMsD,MAAMogB,iBAoBH,SAAC1jB,GAAD,OAAWA,EAAMsD,MAAMqgB,gBAIpC,SAAC3jB,GAAD,OAAWA,EAAMsD,MAAMsgB,yBAOjB,SAAC5jB,GAAD,OAAWA,EAAMsD,MAAMqgB,gBAG7B,SAAC3jB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAKlC,SAAC/L,GAAD,OACZA,EAAM0hB,SAAW,UAAY1hB,EAAMsD,MAAMugB,2BAiBvC,SAAC7jB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAGtB,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMqgB,gBACV,SAAC3jB,GAAD,OAAWA,EAAMsD,MAAMqe,cACvC,SAAC3hB,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,WAInC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMvI,QAGxB,SAACiF,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAGlC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WAGhC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMwgB,iBASnC,SAAC9jB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAItB,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMqgB,gBAC5B,SAAC3jB,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WAC1B,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMqe,cAC5B,SAAC3hB,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,WAInC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMvI,QAGxB,SAACiF,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAG/B,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAGpC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMwgB,iBAQvB,SAAC9jB,GAAD,OAAWA,EAAMsD,MAAMqgB,gBAIjB,SAAC3jB,GAAD,OAAWA,EAAMsD,MAAMqe,cAGzC,SAAC3hB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UACzB,SAAC/L,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,WAInC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMvI,QAGvB,SAACiF,GAAD,OAAWA,EAAMsD,MAAMwgB,iBAYpB,SAAC9jB,GAAD,OAAWA,EAAMsD,MAAMygB,kBAAkB,SAAC/jB,GAAD,OAChEA,EAAMsD,MAAM0gB,uBASY,SAAChkB,GAAD,OAAWA,EAAMsD,MAAM0gB,uBAUvB,SAAChkB,GAAD,OAAWA,EAAMsD,MAAMygB,kBAC3B,SAAC/jB,GAAD,OAAWA,EAAMsD,MAAM0gB,uBAO/B,SAAChkB,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UACnC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAClC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAClC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,OAAS,WAQxC,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAI3B,SAAC/L,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAKhB,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMqe,cAavC,SAAC3hB,GAAD,OAAYA,EAAM0hB,SAAW,OAAS,YAGxC,SAAC1hB,GAAD,OAAWA,EAAMsD,MAAMO,iBASvB,SAAC7D,GAAD,OAAYA,EAAM+L,IAAM,QAAU,UAMhC,SAAC/L,GAAD,OAAWA,EAAMsD,MAAMvI,QAClB,SAACiF,GAAD,OAAWA,EAAMsD,MAAM2gB,uBAuBf,SAACjkB,GAAD,OAAWA,EAAMsD,MAAM4gB,UAqCf,SAAClkB,GAAD,OAAWA,EAAMsD,MAAM8K,cCrrC5C,SAAS+V,UAAT,GAEb,OAAOnS,EAF8C,EAAnBA,UACpBoS,sB,opHCgIT,IAAMC,GAAb,a,mTAAA,4CAwDE,gBAAmBrkB,GAAyC,a,kHAAA,eAC1D,cAAMA,IAvCR5G,MAAQ,CACNkrB,OAAO,EACPC,iBAAiB,EACjBC,mBAAmB,EACnBC,eAAe,EACfC,cAAc,EACdC,gBAAiB,GACjBC,eAAe,GA+B2C,EA1B5DC,QAAUtgB,cA0BkD,EAF5DugB,OAAS,IAAIniB,EAE+C,EAoSpDoiB,aAAe,WACrB,GAAK,EAAKF,QAAQ1c,QAAlB,CAIA,IAAMmc,EACe,QAAnB,EAAKtkB,MAAMglB,KAC0C,QAArDC,iBAAiB,EAAKJ,QAAQ1c,SAAS+c,UAErC,EAAK9rB,MAAMkrB,QAAUA,GACvB,EAAKzd,SAAS,CAAEyd,YA9SwC,EAkTrD/kB,MAAQ,WACb,OAAO,EAAKc,WAAWpH,UAAU,EAAK0I,KAAKvI,MAAM6a,MAnTS,EAsTpDsF,aAAe,WAChB,EAAKvZ,MAAM+N,UAIhB,EAAK/N,MAAM+N,UAAS,WAClB,OAAO,EAAKpM,KAAO,EAAKpC,aAAUT,MA5TsB,EAgUpDqmB,iBAAmB,WAEzB,OADA,EAAKte,SAAS,CAAE0d,iBAAiB,KAC1B,GAlUmD,EAqUpDa,kBAAoB,WAE1B,OADA,EAAKve,SAAS,CAAE0d,iBAAiB,KAC1B,GAvUmD,EA0UpDc,wBAA0B,WAChC,EAAKxe,SAAS,CAAE4d,eAAe,EAAOD,mBAAmB,KA3UC,EA8UpDc,yBAA2B,WAC5B,EAAKlsB,MAAMorB,mBAGhB,EAAK3d,SAAS,CAAE2d,mBAAmB,KAlVuB,EAqVpDe,oBAAsB,SAAChc,GAC7B,EAAK1C,SAAS,CAAE+d,eAAe,EAAMD,gBAAiBpb,KAtVI,EAyVpDic,qBAAuB,WACxB,EAAKpsB,MAAMwrB,eAGhB,EAAK/d,SAAS,CAAE+d,eAAe,KA7V2B,EAgWpDa,mBAAqB,WAC3B,EAAK5e,SAAS,CAAE4d,eAAe,EAAOC,cAAc,KAjWM,EAoWpDgB,oBAAsB,WAC5B,EAAK7e,SAAS,CAAE6d,cAAc,KArW4B,EAwWpDiB,oBAAsB,SAACpc,GAC7B,EAAK1C,SAAS,CAAE4d,eAAe,EAAME,gBAAiBpb,KAzWI,EA4WpDqc,qBAAuB,WACxB,EAAKxsB,MAAMqrB,eAGhB,EAAK5d,SAAS,CAAE4d,eAAe,KAhX2B,EAmXrDoB,aAAe,WACpB,IAAMjd,EAAYkd,YAAUC,QAAQ,EAAKpkB,KAAKvI,MAAM6a,KAC9C+R,EAAc,EAAKrkB,KAAKvI,MAAMsV,GAAG0N,aAAaxT,GACpD,EAAKjH,KAAKM,SAAS+jB,GACnB,EAAKrkB,KAAKK,SAvXgD,EA0XrDikB,WAAa,WAClB,IAAMrd,EAAYkd,YAAUI,MAAM,EAAKvkB,KAAKvI,MAAM6a,KAC5C+R,EAAc,EAAKrkB,KAAKvI,MAAMsV,GAAG0N,aAAaxT,GACpD,EAAKjH,KAAKM,SAAS+jB,GACnB,EAAKrkB,KAAKK,SA9XgD,EAiYrDmkB,YAAc,WACnB,OCnjBW,SAASA,YAAYlS,GAClC,IAAMmS,EAAsB,GACtBC,EAAiB,GA0BvB,OAxBApS,EAAIvb,SAAQ,SAAC8B,GACX,GAAuB,YAAnBA,EAAKiB,KAAKC,KAAoB,CAEhC,IAAMkJ,EAAK0hB,YAAc9rB,GACrBkB,EAAOkJ,EAKPyhB,EAAezhB,GAAM,IACvBlJ,EAAO4qB,YAAc9rB,EAAM6rB,EAAezhB,KAI5CyhB,EAAezhB,QACU9F,IAAvBunB,EAAezhB,GAAoByhB,EAAezhB,GAAM,EAAI,EAE9DwhB,EAAStoB,KAAK,CACZmG,MAAOzJ,EAAKoE,YACZoQ,MAAOxU,EAAKyD,MAAM+Q,MAClBpK,GAAIlJ,QAIH0qB,EDuhBED,CAAY,EAAKxkB,KAAKvI,MAAM6a,MAlYuB,EAqYrDsS,SAAW,WAChB,OExjBW,SAASA,SAAStS,GAC/B,IAAMuS,EAAgB,GA2BtB,OAzBAvS,EAAIG,aAAY,SAAC5Z,GACf,QAAKA,EAAKisB,UAIa,kBAAnBjsB,EAAKiB,KAAKC,MACZlB,EAAKtB,QAAQR,SAAQ,SAACguB,GACpB,IAAI3rB,EAAO,GAEX2rB,EAAShuB,SAAQ,SAACiuB,GACc,cAA1BA,EAAYlrB,KAAKC,OACnBX,GAAQ4rB,EAAY/nB,gBAIxB4nB,EAAM1oB,KAAK,CACT/C,OACA6rB,UAAWF,EAASzoB,MAAM4oB,cAKzB,MAGFL,EF4hBED,CAAS,EAAK5kB,KAAKvI,MAAM6a,MApYhC,EAAK6Q,OAAOjiB,GAAGikB,IAAUpC,aAAc,EAAKe,oBAC5C,EAAKX,OAAOjiB,GAAGikB,IAAUC,cAAe,EAAKrB,qBAC7C,EAAKZ,OAAOjiB,GAAGikB,IAAUrC,cAAe,EAAKkB,qBAC7C,EAAKb,OAAOjiB,GAAGikB,IAAUE,eAAgB,EAAKpB,sBAC9C,EAAKd,OAAOjiB,GAAGikB,IAAUlC,cAAe,EAAKW,qBAC7C,EAAKT,OAAOjiB,GAAGikB,IAAUG,eAAgB,EAAKzB,sBAPY,EAxD9D,O,yKAAA,wCAsEE,6BACExsB,KAAKkuB,OAEDluB,KAAKgH,MAAMmnB,UACbnuB,KAAKouB,eAAepuB,KAAKgH,MAAMmnB,UAGjCnuB,KAAK+rB,eAED/rB,KAAKgH,MAAM0hB,UAIX1oB,KAAKgH,MAAMoN,WACbpU,KAAKitB,eApFX,gCAwFE,4BAA0Bxc,GAAkB,IAmCxC,IAWA,IA9CwC,OAE1C,GAAIzQ,KAAKgH,MAAMT,OAASkK,EAAUlK,QAAUvG,KAAKgH,MAAMT,MAAO,CAC5D,IAAM8nB,EAAWruB,KAAKsuB,YAAYtuB,KAAKgH,MAAMT,OAC7CvG,KAAK2I,KAAK4lB,YAAYF,IAIpB5d,EAAUiY,WAAa1oB,KAAKgH,MAAM0hB,UACpC1oB,KAAK2I,KAAK6Q,OAAV,2CACKxZ,KAAK2I,KAAK3B,OADf,IAEE+B,SAAU,2BAAO,EAAK/B,MAAM0hB,aAI5B1oB,KAAKgH,MAAMmnB,UAAYnuB,KAAKgH,MAAMmnB,WAAa1d,EAAU0d,UAC3DnuB,KAAKouB,eAAepuB,KAAKgH,MAAMmnB,UAK7B1d,EAAUiY,WAAa1oB,KAAKgH,MAAM0hB,UAAY1oB,KAAKgH,MAAMoN,WAC3DpU,KAAKitB,aAGHxc,EAAUub,MAAQhsB,KAAKgH,MAAMglB,KAC/BhsB,KAAK+rB,eAIJ/rB,KAAKwuB,WACLxuB,KAAKI,MAAMmrB,iBACXvrB,KAAKI,MAAMqrB,eACXzrB,KAAKI,MAAMsrB,cACX1rB,KAAKI,MAAMorB,qBAEZxrB,KAAKwuB,WAAY,EACjB,aAAAxuB,KAAKgH,OAAMynB,cAAX,kBAIAzuB,KAAKwuB,YACJxuB,KAAKI,MAAMmrB,iBACVvrB,KAAKI,MAAMqrB,eACXzrB,KAAKI,MAAMsrB,cACX1rB,KAAKI,MAAMorB,qBAEbxrB,KAAKwuB,WAAY,EACjB,aAAAxuB,KAAKgH,OAAM0nB,eAAX,oBAxIN,kBA4IE,gBACE1uB,KAAK4G,WAAa5G,KAAK2uB,mBACvB3uB,KAAKF,MAAQE,KAAK4uB,cAClB5uB,KAAKD,MAAQC,KAAK6uB,cAClB7uB,KAAKoH,OAASpH,KAAK8uB,eACnB9uB,KAAKZ,QAAUY,KAAK+uB,gBACpB/uB,KAAKgI,YAAchI,KAAKgvB,oBACxBhvB,KAAKiI,QAAUjI,KAAKivB,gBACpBjvB,KAAKqH,WAAarH,KAAKkvB,mBACvBlvB,KAAKuH,OAASvH,KAAKmvB,eACnBnvB,KAAKovB,YAAcpvB,KAAKqvB,oBACxBrvB,KAAKsI,WAAatI,KAAKsvB,mBACvBtvB,KAAKuvB,UAAYvvB,KAAKwvB,kBACtBxvB,KAAK2I,KAAO3I,KAAKyvB,aACjBzvB,KAAK0I,SAAW1I,KAAK0vB,mBA1JzB,8BA6JE,4BACE,OAAO,IAAI/oB,EAAiB3G,KAAKgH,MAAMJ,WAAY5G,QA9JvD,2BAiKE,yBACE,OAAOA,KAAK4G,WAAWxH,UAlK3B,+BAqKE,6BACE,OAAOY,KAAK4G,WAAWoB,cAtK3B,2BAyKE,yBACE,OAAOhI,KAAK4G,WAAWqB,QAAQ,CAC7Bb,OAAQpH,KAAKoH,WA3KnB,8BA+KE,4BACE,OAAOpH,KAAK4G,WAAW0B,WAAW,CAChClB,OAAQpH,KAAKoH,WAjLnB,6BAqLE,2BAA0B,WACxB,OAAOpH,KAAK4G,WAAWA,WACpB5D,QAAO,SAAC+D,GAAD,OAA0BA,EAAU4R,aAC3CxR,QAAO,SAACooB,EAAWxoB,GAmBlB,kDACKwoB,GADL,4BAEGxoB,EAAUrE,MApBI,SAAXitB,SACJnuB,EACAmH,EACAiQ,EACAC,GAIA,OAAO,IAAIH,GAAc3R,EAAU4R,UAAW,CAC5C9R,OAAQ,EACRE,YACAvF,OACAmH,OACAiQ,SACAC,sBAQH,MA/MT,4BAkNE,0BACE,OAAO7Y,KAAK4G,WAAW8B,SAAS,CAC9BtB,OAAQpH,KAAKoH,OACbuB,KAAM3I,KAAK2I,SArNjB,yBAyNE,uBACE,OAAO3I,KAAK4G,WAAW9G,QA1N3B,yBA6NE,uBACE,OAAOE,KAAK4G,WAAW7G,QA9N3B,0BAiOE,wBACE,OAAO,IAAI6vB,SAAO,CAChB9vB,MAAOE,KAAKF,MACZC,MAAOC,KAAKD,UApOlB,8BAwOE,4BACE,OAAOC,KAAK4G,WAAWS,eAzO3B,0BA4OE,wBACE,OAAOrH,KAAK4G,WAAWW,OAAO,CAC5BH,OAAQpH,KAAKoH,OACbhI,QAASY,KAAKgI,gBA/OpB,+BAmPE,6BACE,OAAOhI,KAAK4G,WAAWW,OAAO,CAC5BH,OAAQpH,KAAKoH,OACbjI,MAAO,CAAEM,SAAS,EAAM0a,OAAO,GAC/B/a,QAASY,KAAKgI,gBAvPpB,yBA2PE,qBAAoBzB,GAClB,IAAM0U,EAAMjb,KAAK6vB,eAAetpB,GAASvG,KAAKgH,MAAM8oB,cAEpD,OAAOC,cAAYpU,OAAO,CACxBvU,OAAQpH,KAAKoH,OACb6T,MACA7b,QAAS,GAAF,gCACFY,KAAKZ,SADH,yBAEFY,KAAKiI,SAFH,CAGL+nB,YAAW,CAAEnkB,MAAO7L,KAAKgH,MAAMsD,MAAM4gB,SACrC+E,cACA3nB,YAAW,CACTnJ,MAAOa,KAAKsI,aAEdD,YAAO6nB,WAzQf,4BA8QE,wBAAuBhwB,GACrB,OAAOF,KAAKuH,OAAO4oB,MAAMjwB,KA/Q7B,wBAkRE,sBAAqB,WACnB,IAAKF,KAAK6rB,QAAQ1c,QAChB,MAAM,IAAI3M,MAAM,0CAGlB,IAAM4tB,EAAoB,SAApBA,kBAAqB1a,GACzB,OAAOA,EAAG2a,MAAM7sB,MACd,SAAC8sB,GAAD,iBACE,UAAAA,EAAKnvB,aAAL,mBAAYjB,eAAZ,mBAAqBqwB,kBAArB,eAAiC9tB,KAAKC,QACtC,EAAK0E,OAAOtH,MAAM0wB,cAAc9tB,SAIhC+tB,EAAOzwB,KACP2I,EAAO,IAAI+nB,IAAW1wB,KAAK6rB,QAAQ1c,QAAS,CAChDwhB,gBAAiB,CACfC,KAAM5wB,KAAKmsB,iBACXnjB,MAAOhJ,KAAKosB,mBAEdhsB,MAAOJ,KAAKsuB,YAAYtuB,KAAKgH,MAAMT,OACnCwC,SAAU,2BAAO,EAAK/B,MAAM0hB,UAC5B6G,UAAWvvB,KAAKuvB,UAChBsB,oBAAqB,SAAS,oBAAC7D,GAE7B,MAAgChtB,KAAKI,MAAM0wB,iBACzC9D,GADM5sB,EAAR,EAAQA,MAAO2wB,EAAf,EAAeA,aAIf/wB,KAAKuuB,YAAYnuB,GAMf2wB,EAAavtB,MAAK,SAACkS,GAAD,OAAQA,EAAGsb,iBAC3BP,EAAKzpB,MAAM0hB,UACV+H,EAAKzpB,MAAMqiB,yBACV0H,EAAavtB,KAAK4sB,KAEtBK,EAAKlQ,eAGPkQ,EAAK1E,eAIL0E,EAAKQ,iBAOT,OAFAtoB,EAAKwQ,IAAI+X,aAAa,OAAQ,WAEvBvoB,IAvUX,4BA0UE,wBAAsBwoB,GACpB,GAAKA,EAIL,IACE,IAAMtF,EAAU7a,SAASogB,cAAcD,GACnCtF,GACFjL,YAAW,kBAAMiL,EAAQrgB,eAAe,CAAE6lB,SAAU,aAAa,GAEnE,MAAOlf,GAIPmf,IAAOC,MAAM,SAAb,+CAA+DJ,OAxVrE,oBAicE,kBACE,MASInxB,KAAKgH,MARPglB,EADF,EACEA,IACAtD,EAFF,EAEEA,SACAW,EAHF,EAGEA,wBACAb,EAJF,EAIEA,KACAnQ,EALF,EAKEA,MACA+B,EANF,EAMEA,UACAvL,EAPF,EAOEA,WACAqF,EARF,EAQEA,UAEMoX,EAAUtrB,KAAKI,MAAfkrB,MAER,OACE,gBAAC,GAAckG,SAAf,CAAwBjrB,MAAOvG,MAC7B,gBAACiiB,EAAA,EAAD,CACE/N,UAAWA,EACXmE,MAAOA,EACP+B,UAAWA,EACXqX,MAAM,aACNC,QAAQ,SACR1F,IAAKA,EACL2F,QAAM,GAEN,gBAAC,GAAD,CACE3F,IAAKA,EACLjZ,IAAKuY,EACL9C,KAAMA,EACNE,SAAUA,EACVW,wBAAyBA,EACzB/d,IAAKtL,KAAK6rB,WAEVnD,GAAY1oB,KAAK2I,MACjB,gCACE,gBAAC,GAAD,CACEA,KAAM3I,KAAK2I,KACXkG,WAAYA,EACZnG,SAAU1I,KAAK0I,SACfqK,IAAKuY,EACL9H,YAAoC,IAAxBxjB,KAAKgH,MAAM4qB,SACvBrO,OAAQvjB,KAAKqsB,wBACb7e,QAASxN,KAAKssB,yBACd7L,aAAczgB,KAAKgH,MAAMyZ,aACzBK,YAAa9gB,KAAKgH,MAAM8Z,YACxBxF,aAActb,KAAKgH,MAAMsU,aACzB1M,YAAa5O,KAAKgH,MAAM4H,cAE1B,gBAAC,GAAD,CACEjG,KAAM3I,KAAK2I,KACXkG,WAAYA,EACZ1B,SAAUnN,KAAKI,MAAMsrB,aACrBpQ,aAActb,KAAKgH,MAAMsU,aACzBmF,aAAczgB,KAAKgH,MAAMyZ,aACzBK,YAAa9gB,KAAKgH,MAAM8Z,YACxBlS,YAAa5O,KAAKgH,MAAM4H,YACxBpB,QAASxN,KAAK0sB,sBAEhB,gBAAC,GAAD,CACE/jB,KAAM3I,KAAK2I,KACXD,SAAU1I,KAAK0I,SACfmG,WAAYA,EACZkE,IAAKuY,EACL1c,YAAa5O,KAAKgH,MAAM4H,YACxBzB,SAAUnN,KAAKI,MAAMwrB,cACrBrb,OAAQvQ,KAAKI,MAAMurB,gBACnBne,QAASxN,KAAKwsB,uBAEhB,gBAAC,GAAD,CACE7jB,KAAM3I,KAAK2I,KACXD,SAAU1I,KAAK0I,SACfmG,WAAYA,EACZkE,IAAKuY,EACLne,SAAUnN,KAAKI,MAAMqrB,cACrBlb,OAAQvQ,KAAKI,MAAMurB,gBACnBne,QAASxN,KAAK4sB,qBACdpd,WAAYxP,KAAKgH,MAAMwI,WACvBlB,kBAAmBtO,KAAKysB,mBACxBhd,kBAAmBzP,KAAKgH,MAAMyI,kBAC9BC,iBAAkB1P,KAAKgH,MAAM0I,iBAC7Bd,YAAa5O,KAAKgH,MAAM4H,YACxBuE,OAAQnT,KAAKgH,MAAMmM,gBAjhBnC,QAA4B5H,iBAAf8f,GAIJwG,aAAe,CACpB/B,aAAc,GACd9D,IAAK,OACLjY,YAAa,wBACbtE,kBAAmB,+BAGnBC,iBAAkB,8BAGlByD,OAAQ,GACRvM,WAAYkrB,KA4gBhB,IAAMC,GAAmBxmB,cACvB,SAACvE,EAAcsE,GACb,OACE,gBAAC6f,UAAD,MACG,SAAC7gB,GAAD,OAAW,gBAAC,GAAD,gBAAQA,MAAOA,GAAWtD,EAA1B,CAAiCsE,IAAKA,WAM3CymB","file":"shared-editor.efa149f5ab6ce629bebe.js","sourcesContent":["import markdownit, { PluginSimple } from \"markdown-it\";\n\nexport default function rules({\n  rules = {},\n  plugins = [],\n}: {\n  rules?: Record<string, any>;\n  plugins?: PluginSimple[];\n}) {\n  const markdownIt = markdownit(\"default\", {\n    breaks: false,\n    html: false,\n    linkify: false,\n    ...rules,\n  });\n  plugins.forEach((plugin) => markdownIt.use(plugin));\n  return markdownIt;\n}\n","/* eslint-disable @typescript-eslint/ban-ts-comment */\n// @ts-nocheck\n// https://raw.githubusercontent.com/ProseMirror/prosemirror-markdown/master/src/to_markdown.js\n// forked for table support\n\n// ::- A specification for serializing a ProseMirror document as\n// Markdown/CommonMark text.\nexport class MarkdownSerializer {\n  // :: (Object<(state: MarkdownSerializerState, node: Node, parent: Node, index: number)>, Object)\n  // Construct a serializer with the given configuration. The `nodes`\n  // object should map node names in a given schema to function that\n  // take a serializer state and such a node, and serialize the node.\n  //\n  // The `marks` object should hold objects with `open` and `close`\n  // properties, which hold the strings that should appear before and\n  // after a piece of text marked that way, either directly or as a\n  // function that takes a serializer state and a mark, and returns a\n  // string. `open` and `close` can also be functions, which will be\n  // called as\n  //\n  //     (state: MarkdownSerializerState, mark: Mark,\n  //      parent: Fragment, index: number)  string\n  //\n  // Where `parent` and `index` allow you to inspect the mark's\n  // context to see which nodes it applies to.\n  //\n  // Mark information objects can also have a `mixable` property\n  // which, when `true`, indicates that the order in which the mark's\n  // opening and closing syntax appears relative to other mixable\n  // marks can be varied. (For example, you can say `**a *b***` and\n  // `*a **b***`, but not `` `a *b*` ``.)\n  //\n  // To disable character escaping in a mark, you can give it an\n  // `escape` property of `false`. Such a mark has to have the highest\n  // precedence (must always be the innermost mark).\n  //\n  // The `expelEnclosingWhitespace` mark property causes the\n  // serializer to move enclosing whitespace from inside the marks to\n  // outside the marks. This is necessary for emphasis marks as\n  // CommonMark does not permit enclosing whitespace inside emphasis\n  // marks, see: http://spec.commonmark.org/0.26/#example-330\n  constructor(nodes, marks) {\n    // :: Object<(MarkdownSerializerState, Node)> The node serializer\n    // functions for this serializer.\n    this.nodes = nodes;\n    // :: Object The mark serializer info.\n    this.marks = marks;\n  }\n\n  // :: (Node, ?Object)  string\n  // Serialize the content of the given node to\n  // [CommonMark](http://commonmark.org/).\n  serialize(content, options?: { tightLists?: boolean }) {\n    const state = new MarkdownSerializerState(this.nodes, this.marks, options);\n    state.renderContent(content);\n    return state.out;\n  }\n}\n\n// ::- This is an object used to track state and expose\n// methods related to markdown serialization. Instances are passed to\n// node and mark serialization methods (see `toMarkdown`).\nexport class MarkdownSerializerState {\n  inTable = false;\n  inTightList = false;\n  closed = false;\n  delim = \"\";\n\n  constructor(nodes, marks, options) {\n    this.nodes = nodes;\n    this.marks = marks;\n    this.delim = this.out = \"\";\n    this.closed = false;\n    this.inTightList = false;\n    this.inTable = false;\n    // :: Object\n    // The options passed to the serializer.\n    //   tightLists:: ?bool\n    //   Whether to render lists in a tight style. This can be overridden\n    //   on a node level by specifying a tight attribute on the node.\n    //   Defaults to false.\n    this.options = options || {};\n    if (typeof this.options.tightLists === \"undefined\") {\n      this.options.tightLists = true;\n    }\n  }\n\n  flushClose(size) {\n    if (this.closed) {\n      if (!this.atBlank()) {\n        this.out += \"\\n\";\n      }\n      if (size === null || size === undefined) {\n        size = 2;\n      }\n      if (size > 1) {\n        let delimMin = this.delim;\n        const trim = /\\s+$/.exec(delimMin);\n        if (trim) {\n          delimMin = delimMin.slice(0, delimMin.length - trim[0].length);\n        }\n        for (let i = 1; i < size; i++) {\n          this.out += delimMin + \"\\n\";\n        }\n      }\n      this.closed = false;\n    }\n  }\n\n  // :: (string, ?string, Node, ())\n  // Render a block, prefixing each line with `delim`, and the first\n  // line in `firstDelim`. `node` should be the node that is closed at\n  // the end of the block, and `f` is a function that renders the\n  // content of the block.\n  wrapBlock(delim, firstDelim, node, f) {\n    const old = this.delim;\n    this.write(firstDelim || delim);\n    this.delim += delim;\n    f();\n    this.delim = old;\n    this.closeBlock(node);\n  }\n\n  atBlank() {\n    return /(^|\\n)$/.test(this.out);\n  }\n\n  // :: ()\n  // Ensure the current content ends with a newline.\n  ensureNewLine() {\n    if (!this.atBlank()) {\n      this.out += \"\\n\";\n    }\n  }\n\n  // :: (?string)\n  // Prepare the state for writing output (closing closed paragraphs,\n  // adding delimiters, and so on), and then optionally add content\n  // (unescaped) to the output.\n  write(content) {\n    this.flushClose();\n    if (this.delim && this.atBlank()) {\n      this.out += this.delim;\n    }\n    if (content) {\n      this.out += content;\n    }\n  }\n\n  // :: (Node)\n  // Close the block for the given node.\n  closeBlock(node) {\n    this.closed = node;\n  }\n\n  // :: (string, ?bool)\n  // Add the given text to the document. When escape is not `false`,\n  // it will be escaped.\n  text(text, escape) {\n    const lines = text.split(\"\\n\");\n    for (let i = 0; i < lines.length; i++) {\n      const startOfLine = this.atBlank() || this.closed;\n      this.write();\n      this.out += escape !== false ? this.esc(lines[i], startOfLine) : lines[i];\n      if (i !== lines.length - 1) {\n        this.out += \"\\n\";\n      }\n    }\n  }\n\n  // :: (Node)\n  // Render the given node as a block.\n  render(node, parent, index) {\n    if (typeof parent === \"number\") {\n      throw new Error(\"!\");\n    }\n    this.nodes[node.type.name](this, node, parent, index);\n  }\n\n  // :: (Node)\n  // Render the contents of `parent` as block nodes.\n  renderContent(parent) {\n    parent.forEach((node, _, i) => this.render(node, parent, i));\n  }\n\n  // :: (Node)\n  // Render the contents of `parent` as inline content.\n  renderInline(parent) {\n    const active = [];\n    let trailing = \"\";\n    const progress = (node, _, index) => {\n      let marks = node ? node.marks : [];\n\n      // Remove marks from `hard_break` that are the last node inside\n      // that mark to prevent parser edge cases with new lines just\n      // before closing marks.\n      // (FIXME it'd be nice if we had a schema-agnostic way to\n      // identify nodes that serialize as hard breaks)\n      if (node && node.type.name === \"hard_break\") {\n        marks = marks.filter((m) => {\n          if (index + 1 === parent.childCount) {\n            return false;\n          }\n          const next = parent.child(index + 1);\n          return (\n            m.isInSet(next.marks) && (!next.isText || /\\S/.test(next.text))\n          );\n        });\n      }\n\n      let leading = trailing;\n      trailing = \"\";\n      // If whitespace has to be expelled from the node, adjust\n      // leading and trailing accordingly.\n      if (\n        node &&\n        node.isText &&\n        marks.some((mark) => {\n          const info = this.marks[mark.type.name]();\n          return info && info.expelEnclosingWhitespace;\n        })\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars, no-unused-vars\n        const [_, lead, inner, trail] = /^(\\s*)(.*?)(\\s*)$/m.exec(node.text);\n        leading += lead;\n        trailing = trail;\n        if (lead || trail) {\n          node = inner ? node.withText(inner) : null;\n          if (!node) {\n            marks = active;\n          }\n        }\n      }\n\n      const inner = marks.length && marks[marks.length - 1],\n        noEsc = inner && this.marks[inner.type.name]().escape === false;\n      const len = marks.length - (noEsc ? 1 : 0);\n\n      // Try to reorder 'mixable' marks, such as em and strong, which\n      // in Markdown may be opened and closed in different order, so\n      // that order of the marks for the token matches the order in\n      // active.\n      outer: for (let i = 0; i < len; i++) {\n        const mark = marks[i];\n        if (!this.marks[mark.type.name]().mixable) {\n          break;\n        }\n        for (let j = 0; j < active.length; j++) {\n          const other = active[j];\n          if (!this.marks[other.type.name]().mixable) {\n            break;\n          }\n          if (mark.eq(other)) {\n            if (i > j) {\n              marks = marks\n                .slice(0, j)\n                .concat(mark)\n                .concat(marks.slice(j, i))\n                .concat(marks.slice(i + 1, len));\n            } else if (j > i) {\n              marks = marks\n                .slice(0, i)\n                .concat(marks.slice(i + 1, j))\n                .concat(mark)\n                .concat(marks.slice(j, len));\n            }\n            continue outer;\n          }\n        }\n      }\n\n      // Find the prefix of the mark set that didn't change\n      let keep = 0;\n      while (\n        keep < Math.min(active.length, len) &&\n        marks[keep].eq(active[keep])\n      ) {\n        ++keep;\n      }\n\n      // Close the marks that need to be closed\n      while (keep < active.length) {\n        this.text(this.markString(active.pop(), false, parent, index), false);\n      }\n\n      // Output any previously expelled trailing whitespace outside the marks\n      if (leading) {\n        this.text(leading);\n      }\n\n      // Open the marks that need to be opened\n      if (node) {\n        while (active.length < len) {\n          const add = marks[active.length];\n          active.push(add);\n          this.text(this.markString(add, true, parent, index), false);\n        }\n\n        // Render the node. Special case code marks, since their content\n        // may not be escaped.\n        if (noEsc && node.isText) {\n          this.text(\n            this.markString(inner, true, parent, index) +\n              node.text +\n              this.markString(inner, false, parent, index + 1),\n            false\n          );\n        } else {\n          this.render(node, parent, index);\n        }\n      }\n    };\n    parent.forEach(progress);\n    progress(null, null, parent.childCount);\n  }\n\n  // :: (Node, string, (number)  string)\n  // Render a node's content as a list. `delim` should be the extra\n  // indentation added to all lines except the first in an item,\n  // `firstDelim` is a function going from an item index to a\n  // delimiter for the first line of the item.\n  renderList(node, delim, firstDelim) {\n    if (this.closed && this.closed.type === node.type) {\n      this.flushClose(3);\n    } else if (this.inTightList) {\n      this.flushClose(1);\n    }\n\n    const isTight =\n      typeof node.attrs.tight !== \"undefined\"\n        ? node.attrs.tight\n        : this.options.tightLists;\n    const prevTight = this.inTightList;\n    const prevList = this.inList;\n    this.inList = true;\n    this.inTightList = isTight;\n    node.forEach((child, _, i) => {\n      if (i && isTight) {\n        this.flushClose(1);\n      }\n      this.wrapBlock(delim, firstDelim(i), node, () =>\n        this.render(child, node, i)\n      );\n    });\n    this.inList = prevList;\n    this.inTightList = prevTight;\n  }\n\n  renderTable(node) {\n    this.flushClose(1);\n\n    let headerBuffer = \"\";\n    const prevTable = this.inTable;\n    this.inTable = true;\n\n    // ensure there is an empty newline above all tables\n    this.out += \"\\n\";\n\n    // rows\n    node.forEach((row, _, i) => {\n      // cols\n      row.forEach((cell, _, j) => {\n        this.out += j === 0 ? \"| \" : \" | \";\n\n        cell.forEach((para) => {\n          // just padding the output so that empty cells take up the same space\n          // as headings.\n          // TODO: Ideally we'd calc the longest cell length and use that\n          // to pad all the others.\n          if (para.textContent === \"\" && para.content.size === 0) {\n            this.out += \"  \";\n          } else {\n            this.closed = false;\n            this.render(para, row, j);\n          }\n        });\n\n        if (i === 0) {\n          if (cell.attrs.alignment === \"center\") {\n            headerBuffer += \"|:---:\";\n          } else if (cell.attrs.alignment === \"left\") {\n            headerBuffer += \"|:---\";\n          } else if (cell.attrs.alignment === \"right\") {\n            headerBuffer += \"|---:\";\n          } else {\n            headerBuffer += \"|----\";\n          }\n        }\n      });\n\n      this.out += \" |\\n\";\n\n      if (headerBuffer) {\n        this.out += `${headerBuffer}|\\n`;\n        headerBuffer = undefined;\n      }\n    });\n\n    this.inTable = prevTable;\n  }\n\n  // :: (string, ?bool)  string\n  // Escape the given string so that it can safely appear in Markdown\n  // content. If `startOfLine` is true, also escape characters that\n  // has special meaning only at the start of the line.\n  esc(str = \"\", startOfLine) {\n    str = str.replace(/[`*\\\\~[\\]]/g, \"\\\\$&\");\n    if (startOfLine) {\n      str = str.replace(/^[:#\\-*+]/, \"\\\\$&\").replace(/^(\\d+)\\./, \"$1\\\\.\");\n    }\n\n    if (this.inTable) {\n      str = str.replace(/\\|/gi, \"\\\\$&\");\n    }\n\n    return str;\n  }\n\n  quote(str) {\n    const wrap =\n      str.indexOf('\"') === -1 ? '\"\"' : str.indexOf(\"'\") === -1 ? \"''\" : \"()\";\n    return wrap[0] + str + wrap[1];\n  }\n\n  // :: (string, number)  string\n  // Repeat the given string `n` times.\n  repeat(str, n) {\n    let out = \"\";\n    for (let i = 0; i < n; i++) {\n      out += str;\n    }\n    return out;\n  }\n\n  // : (Mark, bool, string?)  string\n  // Get the markdown string for a given opening or closing mark.\n  markString(mark, open, parent, index) {\n    const info = this.marks[mark.type.name]();\n    const value = open ? info.open : info.close;\n    return typeof value === \"string\" ? value : value(this, mark, parent, index);\n  }\n\n  // :: (string)  { leading: ?string, trailing: ?string }\n  // Get leading and trailing whitespace from a string. Values of\n  // leading or trailing property of the return object will be undefined\n  // if there is no match.\n  getEnclosingWhitespace(text) {\n    return {\n      leading: (text.match(/^(\\s+)/) || [])[0],\n      trailing: (text.match(/(\\s+)$/) || [])[0],\n    };\n  }\n}\n","import { PluginSimple } from \"markdown-it\";\nimport { keymap } from \"prosemirror-keymap\";\nimport { MarkdownParser, TokenConfig } from \"prosemirror-markdown\";\nimport { Schema } from \"prosemirror-model\";\nimport { EditorView } from \"prosemirror-view\";\nimport { Editor } from \"~/editor\";\nimport Mark from \"../marks/Mark\";\nimport Node from \"../nodes/Node\";\nimport Extension, { CommandFactory } from \"./Extension\";\nimport makeRules from \"./markdown/rules\";\nimport { MarkdownSerializer } from \"./markdown/serializer\";\n\nexport default class ExtensionManager {\n  extensions: (Node | Mark | Extension)[] = [];\n\n  constructor(\n    extensions: (\n      | Extension\n      | typeof Node\n      | typeof Mark\n      | typeof Extension\n    )[] = [],\n    editor?: Editor\n  ) {\n    extensions.forEach((ext) => {\n      let extension;\n\n      if (typeof ext === \"function\") {\n        extension = new ext(editor?.props);\n      } else {\n        extension = ext;\n      }\n\n      if (editor) {\n        extension.bindEditor(editor);\n      }\n\n      this.extensions.push(extension);\n    });\n  }\n\n  get nodes() {\n    return this.extensions\n      .filter((extension) => extension.type === \"node\")\n      .reduce(\n        (nodes, node: Node) => ({\n          ...nodes,\n          [node.name]: node.schema,\n        }),\n        {}\n      );\n  }\n\n  serializer() {\n    const nodes = this.extensions\n      .filter((extension) => extension.type === \"node\")\n      .reduce(\n        (nodes, extension: Node) => ({\n          ...nodes,\n          [extension.name]: extension.toMarkdown,\n        }),\n        {}\n      );\n\n    const marks = this.extensions\n      .filter((extension) => extension.type === \"mark\")\n      .reduce(\n        (marks, extension: Mark) => ({\n          ...marks,\n          [extension.name]: extension.toMarkdown,\n        }),\n        {}\n      );\n\n    return new MarkdownSerializer(nodes, marks);\n  }\n\n  parser({\n    schema,\n    rules,\n    plugins,\n  }: {\n    schema: Schema;\n    rules?: Record<string, any>;\n    plugins?: PluginSimple[];\n  }): MarkdownParser {\n    const tokens: Record<string, TokenConfig> = this.extensions\n      .filter(\n        (extension) => extension.type === \"mark\" || extension.type === \"node\"\n      )\n      .reduce((nodes, extension: Node | Mark) => {\n        const md = extension.parseMarkdown();\n        if (!md) {\n          return nodes;\n        }\n\n        return {\n          ...nodes,\n          [extension.markdownToken || extension.name]: md,\n        };\n      }, {});\n\n    return new MarkdownParser(schema, makeRules({ rules, plugins }), tokens);\n  }\n\n  get marks() {\n    return this.extensions\n      .filter((extension) => extension.type === \"mark\")\n      .reduce(\n        (marks, { name, schema }: Mark) => ({\n          ...marks,\n          [name]: schema,\n        }),\n        {}\n      );\n  }\n\n  get plugins() {\n    return this.extensions\n      .filter((extension) => \"plugins\" in extension)\n      .reduce((allPlugins, { plugins }) => [...allPlugins, ...plugins], []);\n  }\n\n  get rulePlugins() {\n    return this.extensions\n      .filter((extension) => \"rulePlugins\" in extension)\n      .reduce(\n        (allRulePlugins, { rulePlugins }) => [\n          ...allRulePlugins,\n          ...rulePlugins,\n        ],\n        []\n      );\n  }\n\n  keymaps({ schema }: { schema: Schema }) {\n    const keymaps = this.extensions\n      .filter((extension) => extension.keys)\n      .map((extension) =>\n        [\"node\", \"mark\"].includes(extension.type)\n          ? extension.keys({\n              type: schema[`${extension.type}s`][extension.name],\n              schema,\n            })\n          : (extension as Extension).keys({ schema })\n      );\n\n    return keymaps.map(keymap);\n  }\n\n  inputRules({ schema }: { schema: Schema }) {\n    const extensionInputRules = this.extensions\n      .filter((extension) => [\"extension\"].includes(extension.type))\n      .filter((extension) => extension.inputRules)\n      .map((extension: Extension) => extension.inputRules({ schema }));\n\n    const nodeMarkInputRules = this.extensions\n      .filter((extension) => [\"node\", \"mark\"].includes(extension.type))\n      .filter((extension) => extension.inputRules)\n      .map((extension) =>\n        extension.inputRules({\n          type: schema[`${extension.type}s`][extension.name],\n          schema,\n        })\n      );\n\n    return [...extensionInputRules, ...nodeMarkInputRules].reduce(\n      (allInputRules, inputRules) => [...allInputRules, ...inputRules],\n      []\n    );\n  }\n\n  commands({ schema, view }: { schema: Schema; view: EditorView }) {\n    return this.extensions\n      .filter((extension) => extension.commands)\n      .reduce((allCommands, extension) => {\n        const { name, type } = extension;\n        const commands = {};\n\n        // @ts-expect-error FIXME\n        const value = extension.commands({\n          schema,\n          ...([\"node\", \"mark\"].includes(type)\n            ? {\n                type: schema[`${type}s`][name],\n              }\n            : {}),\n        });\n\n        const apply = (\n          callback: CommandFactory,\n          attrs: Record<string, any>\n        ) => {\n          if (!view.editable) {\n            return false;\n          }\n          view.focus();\n          return callback(attrs)(view.state, view.dispatch, view);\n        };\n\n        const handle = (_name: string, _value: CommandFactory) => {\n          if (Array.isArray(_value)) {\n            commands[_name] = (attrs: Record<string, any>) =>\n              _value.forEach((callback) => apply(callback, attrs));\n          } else if (typeof _value === \"function\") {\n            commands[_name] = (attrs: Record<string, any>) =>\n              apply(_value, attrs);\n          }\n        };\n\n        if (typeof value === \"object\") {\n          Object.entries(value).forEach(([commandName, commandValue]) => {\n            handle(commandName, commandValue);\n          });\n        } else {\n          handle(name, value);\n        }\n\n        return {\n          ...allCommands,\n          ...commands,\n        };\n      }, {});\n  }\n}\n","/**\n * A tiny EventEmitter implementation for the browser.\n */\nexport default class EventEmitter {\n  private listeners: { [name: string]: ((data: unknown) => unknown)[] } = {};\n\n  public addListener(name: string, callback: (data: unknown) => unknown) {\n    if (!this.listeners[name]) {\n      this.listeners[name] = [];\n    }\n\n    this.listeners[name].push(callback);\n  }\n\n  public removeListener(name: string, callback: (data: unknown) => unknown) {\n    this.listeners[name] = this.listeners[name]?.filter(\n      (cb) => cb !== callback\n    );\n  }\n\n  public on = this.addListener;\n  public off = this.removeListener;\n\n  public emit(name: string, data?: unknown) {\n    this.listeners[name]?.forEach((callback) => {\n      callback(data);\n    });\n  }\n}\n","import * as React from \"react\";\nimport scrollIntoView from \"smooth-scroll-into-view-if-needed\";\nimport styled from \"styled-components\";\n\nexport type Props = {\n  selected: boolean;\n  disabled?: boolean;\n  onClick: () => void;\n  icon?: typeof React.Component | React.FC<any>;\n  title: React.ReactNode;\n  shortcut?: string;\n  containerId?: string;\n};\n\nfunction BlockMenuItem({\n  selected,\n  disabled,\n  onClick,\n  title,\n  shortcut,\n  icon,\n  containerId = \"block-menu-container\",\n}: Props) {\n  const Icon = icon;\n\n  const ref = React.useCallback(\n    (node) => {\n      if (selected && node) {\n        scrollIntoView(node, {\n          scrollMode: \"if-needed\",\n          block: \"nearest\",\n          boundary: (parent) => {\n            // All the parent elements of your target are checked until they\n            // reach the #block-menu-container. Prevents body and other parent\n            // elements from being scrolled\n            return parent.id !== containerId;\n          },\n        });\n      }\n    },\n    [selected, containerId]\n  );\n\n  return (\n    <MenuItem\n      selected={selected}\n      onClick={disabled ? undefined : onClick}\n      ref={ref}\n    >\n      {Icon && (\n        <>\n          <Icon color=\"currentColor\" />\n          &nbsp;&nbsp;\n        </>\n      )}\n      {title}\n      {shortcut && <Shortcut>{shortcut}</Shortcut>}\n    </MenuItem>\n  );\n}\n\nconst Shortcut = styled.span`\n  color: ${(props) => props.theme.textTertiary};\n  flex-grow: 1;\n  text-align: right;\n`;\n\nconst MenuItem = styled.button<{\n  selected: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 1;\n  width: 100%;\n  height: 36px;\n  cursor: pointer;\n  border: none;\n  opacity: ${(props) => (props.disabled ? \".5\" : \"1\")};\n  color: ${(props) =>\n    props.selected ? props.theme.white : props.theme.textSecondary};\n  background: ${(props) => (props.selected ? props.theme.primary : \"none\")};\n  padding: 0 16px;\n  outline: none;\n\n  &:active {\n    color: ${(props) => props.theme.white};\n    background: ${(props) => (props.selected ? props.theme.primary : \"none\")};\n\n    ${Shortcut} {\n      color: ${(props) => props.theme.textSecondary};\n    }\n  }\n`;\n\nexport default BlockMenuItem;\n","import { EmbedDescriptor, MenuItem } from \"../types\";\n\ntype Item = MenuItem | EmbedDescriptor;\n\nexport default function filterExcessSeparators(items: Item[]): Item[] {\n  return items\n    .reduce((acc, item) => {\n      // trim separator if the previous item was a separator\n      if (\n        item.name === \"separator\" &&\n        acc[acc.length - 1]?.name === \"separator\"\n      ) {\n        return acc;\n      }\n      return [...acc, item];\n    }, [] as Item[])\n    .filter((item, index, arr) => {\n      if (\n        item.name === \"separator\" &&\n        (index === 0 || index === arr.length - 1)\n      ) {\n        return false;\n      }\n      return true;\n    });\n}\n","import styled from \"styled-components\";\n\nconst Input = styled.input`\n  font-size: 15px;\n  background: ${(props) => props.theme.toolbarInput};\n  color: ${(props) => props.theme.toolbarItem};\n  border-radius: 2px;\n  padding: 3px 8px;\n  border: 0;\n  margin: 0;\n  outline: none;\n  flex-grow: 1;\n\n  @media (hover: none) and (pointer: coarse) {\n    font-size: 16px;\n  }\n`;\n\nexport default Input;\n","import { capitalize } from \"lodash\";\nimport { findDomRefAtPos, findParentNode } from \"prosemirror-utils\";\nimport { EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport { Trans } from \"react-i18next\";\nimport { Portal } from \"react-portal\";\nimport { VisuallyHidden } from \"reakit/VisuallyHidden\";\nimport styled from \"styled-components\";\nimport insertFiles from \"@shared/editor/commands/insertFiles\";\nimport { CommandFactory } from \"@shared/editor/lib/Extension\";\nimport filterExcessSeparators from \"@shared/editor/lib/filterExcessSeparators\";\nimport { EmbedDescriptor, MenuItem } from \"@shared/editor/types\";\nimport { depths } from \"@shared/styles\";\nimport { supportedImageMimeTypes } from \"@shared/utils/files\";\nimport getDataTransferFiles from \"@shared/utils/getDataTransferFiles\";\nimport Scrollable from \"~/components/Scrollable\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport Input from \"./Input\";\n\nconst defaultPosition = {\n  left: -1000,\n  top: 0,\n  bottom: undefined,\n  isAbove: false,\n};\n\nexport type Props<T extends MenuItem = MenuItem> = {\n  rtl: boolean;\n  isActive: boolean;\n  commands: Record<string, CommandFactory>;\n  dictionary: Dictionary;\n  view: EditorView;\n  search: string;\n  uploadFile?: (file: File) => Promise<string>;\n  onFileUploadStart?: () => void;\n  onFileUploadStop?: () => void;\n  onShowToast: (message: string) => void;\n  onLinkToolbarOpen?: () => void;\n  onClose: () => void;\n  onClearSearch: () => void;\n  embeds?: EmbedDescriptor[];\n  renderMenuItem: (\n    item: T,\n    index: number,\n    options: {\n      selected: boolean;\n      onClick: () => void;\n    }\n  ) => React.ReactNode;\n  filterable?: boolean;\n  items: T[];\n  id?: string;\n};\n\ntype State = {\n  insertItem?: EmbedDescriptor;\n  left?: number;\n  top?: number;\n  bottom?: number;\n  isAbove: boolean;\n  selectedIndex: number;\n};\n\nclass CommandMenu<T = MenuItem> extends React.Component<Props<T>, State> {\n  menuRef = React.createRef<HTMLDivElement>();\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    left: -1000,\n    top: 0,\n    bottom: undefined,\n    isAbove: false,\n    selectedIndex: 0,\n    insertItem: undefined,\n  };\n\n  componentDidMount() {\n    window.addEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  shouldComponentUpdate(nextProps: Props, nextState: State) {\n    return (\n      nextProps.search !== this.props.search ||\n      nextProps.isActive !== this.props.isActive ||\n      nextState !== this.state\n    );\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!prevProps.isActive && this.props.isActive) {\n      // reset scroll position to top when opening menu as the contents are\n      // hidden, not unrendered\n      if (this.menuRef.current) {\n        this.menuRef.current.scroll({ top: 0 });\n      }\n      const position = this.calculatePosition(this.props);\n\n      this.setState({\n        insertItem: undefined,\n        selectedIndex: 0,\n        ...position,\n      });\n    } else if (prevProps.search !== this.props.search) {\n      this.setState({ selectedIndex: 0 });\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"keydown\", this.handleKeyDown);\n  }\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    if (!this.props.isActive) {\n      return;\n    }\n\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const item = this.filtered[this.state.selectedIndex];\n\n      if (item) {\n        this.insertItem(item);\n      } else {\n        this.props.onClose();\n      }\n    }\n\n    if (\n      event.key === \"ArrowUp\" ||\n      (event.key === \"Tab\" && event.shiftKey) ||\n      (event.ctrlKey && event.key === \"p\")\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (this.filtered.length) {\n        const prevIndex = this.state.selectedIndex - 1;\n        const prev = this.filtered[prevIndex];\n\n        this.setState({\n          selectedIndex: Math.max(\n            0,\n            prev?.name === \"separator\" ? prevIndex - 1 : prevIndex\n          ),\n        });\n      } else {\n        this.close();\n      }\n    }\n\n    if (\n      event.key === \"ArrowDown\" ||\n      (event.key === \"Tab\" && !event.shiftKey) ||\n      (event.ctrlKey && event.key === \"n\")\n    ) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (this.filtered.length) {\n        const total = this.filtered.length - 1;\n        const nextIndex = this.state.selectedIndex + 1;\n        const next = this.filtered[nextIndex];\n\n        this.setState({\n          selectedIndex: Math.min(\n            next?.name === \"separator\" ? nextIndex + 1 : nextIndex,\n            total\n          ),\n        });\n      } else {\n        this.close();\n      }\n    }\n\n    if (event.key === \"Escape\") {\n      this.close();\n    }\n  };\n\n  insertItem = (item: any) => {\n    switch (item.name) {\n      case \"image\":\n        return this.triggerFilePick(supportedImageMimeTypes.join(\", \"));\n      case \"attachment\":\n        return this.triggerFilePick(\"*\");\n      case \"embed\":\n        return this.triggerLinkInput(item);\n      case \"link\": {\n        this.clearSearch();\n        this.props.onClose();\n        this.props.onLinkToolbarOpen?.();\n        return;\n      }\n      default:\n        this.insertBlock(item);\n    }\n  };\n\n  close = () => {\n    this.props.onClose();\n    this.props.view.focus();\n  };\n\n  handleLinkInputKeydown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (!this.props.isActive) {\n      return;\n    }\n    if (!this.state.insertItem) {\n      return;\n    }\n\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const href = event.currentTarget.value;\n      const matches = this.state.insertItem.matcher(href);\n\n      if (!matches) {\n        this.props.onShowToast(this.props.dictionary.embedInvalidLink);\n        return;\n      }\n\n      this.insertBlock({\n        name: \"embed\",\n        attrs: {\n          href,\n        },\n      });\n    }\n\n    if (event.key === \"Escape\") {\n      this.props.onClose();\n      this.props.view.focus();\n    }\n  };\n\n  handleLinkInputPaste = (event: React.ClipboardEvent<HTMLInputElement>) => {\n    if (!this.props.isActive) {\n      return;\n    }\n    if (!this.state.insertItem) {\n      return;\n    }\n\n    const href = event.clipboardData.getData(\"text/plain\");\n    const matches = this.state.insertItem.matcher(href);\n\n    if (matches) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.insertBlock({\n        name: \"embed\",\n        attrs: {\n          href,\n        },\n      });\n    }\n  };\n\n  triggerFilePick = (accept: string) => {\n    if (this.inputRef.current) {\n      if (accept) {\n        this.inputRef.current.accept = accept;\n      }\n      this.inputRef.current.click();\n    }\n  };\n\n  triggerLinkInput = (item: EmbedDescriptor) => {\n    this.setState({ insertItem: item });\n  };\n\n  handleFilePicked = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = getDataTransferFiles(event);\n\n    const {\n      view,\n      uploadFile,\n      onFileUploadStart,\n      onFileUploadStop,\n      onShowToast,\n    } = this.props;\n    const { state } = view;\n    const parent = findParentNode((node) => !!node)(state.selection);\n\n    this.clearSearch();\n\n    if (!uploadFile) {\n      throw new Error(\"uploadFile prop is required to replace files\");\n    }\n\n    if (parent) {\n      insertFiles(view, event, parent.pos, files, {\n        uploadFile,\n        onFileUploadStart,\n        onFileUploadStop,\n        onShowToast,\n        dictionary: this.props.dictionary,\n        isAttachment: this.inputRef.current?.accept === \"*\",\n      });\n    }\n\n    if (this.inputRef.current) {\n      this.inputRef.current.value = \"\";\n    }\n\n    this.props.onClose();\n  };\n\n  clearSearch = () => {\n    this.props.onClearSearch();\n  };\n\n  insertBlock(item: MenuItem) {\n    this.clearSearch();\n\n    const command = item.name ? this.props.commands[item.name] : undefined;\n\n    if (command) {\n      command(item.attrs);\n    } else {\n      this.props.commands[`create${capitalize(item.name)}`](item.attrs);\n    }\n\n    this.props.onClose();\n  }\n\n  get caretPosition(): { top: number; left: number } {\n    const selection = window.document.getSelection();\n    if (!selection || !selection.anchorNode || !selection.focusNode) {\n      return {\n        top: 0,\n        left: 0,\n      };\n    }\n\n    const range = window.document.createRange();\n    range.setStart(selection.anchorNode, selection.anchorOffset);\n    range.setEnd(selection.focusNode, selection.focusOffset);\n\n    // This is a workaround for an edgecase where getBoundingClientRect will\n    // return zero values if the selection is collapsed at the start of a newline\n    // see reference here: https://stackoverflow.com/a/59780954\n    const rects = range.getClientRects();\n    if (rects.length === 0) {\n      // probably buggy newline behavior, explicitly select the node contents\n      if (range.startContainer && range.collapsed) {\n        range.selectNodeContents(range.startContainer);\n      }\n    }\n\n    const rect = range.getBoundingClientRect();\n    return {\n      top: rect.top,\n      left: rect.left,\n    };\n  }\n\n  calculatePosition(props: Props) {\n    const { view } = props;\n    const { selection } = view.state;\n    let startPos;\n    try {\n      startPos = view.coordsAtPos(selection.from);\n    } catch (err) {\n      console.warn(err);\n      return defaultPosition;\n    }\n\n    const domAtPos = view.domAtPos.bind(view);\n\n    const ref = this.menuRef.current;\n    const offsetHeight = ref ? ref.offsetHeight : 0;\n    const node = findDomRefAtPos(selection.from, domAtPos);\n    const paragraph: any = { node };\n\n    if (\n      !props.isActive ||\n      !paragraph.node ||\n      !paragraph.node.getBoundingClientRect\n    ) {\n      return defaultPosition;\n    }\n\n    const { left } = this.caretPosition;\n    const { top, bottom, right } = paragraph.node.getBoundingClientRect();\n    const margin = 24;\n\n    let leftPos = left + window.scrollX;\n    if (props.rtl && ref) {\n      leftPos = right - ref.scrollWidth;\n    }\n\n    if (startPos.top - offsetHeight > margin) {\n      return {\n        left: leftPos,\n        top: undefined,\n        bottom: window.innerHeight - top - window.scrollY,\n        isAbove: false,\n      };\n    } else {\n      return {\n        left: leftPos,\n        top: bottom + window.scrollY,\n        bottom: undefined,\n        isAbove: true,\n      };\n    }\n  }\n\n  get filtered() {\n    const {\n      embeds = [],\n      search = \"\",\n      uploadFile,\n      commands,\n      filterable = true,\n    } = this.props;\n    let items: (EmbedDescriptor | MenuItem)[] = [...this.props.items];\n    const embedItems: EmbedDescriptor[] = [];\n\n    for (const embed of embeds) {\n      if (embed.title && embed.icon) {\n        embedItems.push({\n          ...embed,\n          name: \"embed\",\n        });\n      }\n    }\n\n    if (embedItems.length) {\n      items = items.concat(\n        {\n          name: \"separator\",\n        },\n        embedItems\n      );\n    }\n\n    const filtered = items.filter((item) => {\n      if (item.name === \"separator\") {\n        return true;\n      }\n\n      // Some extensions may be disabled, remove corresponding menu items\n      if (\n        item.name &&\n        !commands[item.name] &&\n        !commands[`create${capitalize(item.name)}`]\n      ) {\n        return false;\n      }\n\n      // If no image upload callback has been passed, filter the image block out\n      if (!uploadFile && item.name === \"image\") {\n        return false;\n      }\n\n      // some items (defaultHidden) are not visible until a search query exists\n      if (!search) {\n        return !item.defaultHidden;\n      }\n\n      const n = search.toLowerCase();\n      if (!filterable) {\n        return item;\n      }\n      return (\n        (item.title || \"\").toLowerCase().includes(n) ||\n        (item.keywords || \"\").toLowerCase().includes(n)\n      );\n    });\n\n    return filterExcessSeparators(filtered);\n  }\n\n  render() {\n    const { dictionary, isActive, uploadFile } = this.props;\n    const items = this.filtered;\n    const { insertItem, ...positioning } = this.state;\n\n    return (\n      <Portal>\n        <Wrapper\n          id={this.props.id || \"block-menu-container\"}\n          active={isActive}\n          ref={this.menuRef}\n          hiddenScrollbars\n          {...positioning}\n        >\n          {insertItem ? (\n            <LinkInputWrapper>\n              <LinkInput\n                type=\"text\"\n                placeholder={\n                  insertItem.title\n                    ? dictionary.pasteLinkWithTitle(insertItem.title)\n                    : dictionary.pasteLink\n                }\n                onKeyDown={this.handleLinkInputKeydown}\n                onPaste={this.handleLinkInputPaste}\n                autoFocus\n              />\n            </LinkInputWrapper>\n          ) : (\n            <List>\n              {items.map((item, index) => {\n                if (item.name === \"separator\") {\n                  return (\n                    <ListItem key={index}>\n                      <hr />\n                    </ListItem>\n                  );\n                }\n\n                if (!item.title) {\n                  return null;\n                }\n\n                const handlePointer = () => {\n                  if (this.state.selectedIndex !== index) {\n                    this.setState({ selectedIndex: index });\n                  }\n                };\n\n                return (\n                  <ListItem\n                    key={index}\n                    onPointerMove={handlePointer}\n                    onPointerDown={handlePointer}\n                  >\n                    {this.props.renderMenuItem(item as any, index, {\n                      selected: index === this.state.selectedIndex,\n                      onClick: () => this.insertItem(item),\n                    })}\n                  </ListItem>\n                );\n              })}\n              {items.length === 0 && (\n                <ListItem>\n                  <Empty>{dictionary.noResults}</Empty>\n                </ListItem>\n              )}\n            </List>\n          )}\n          {uploadFile && (\n            <VisuallyHidden>\n              <label>\n                <Trans>Import document</Trans>\n                <input\n                  type=\"file\"\n                  ref={this.inputRef}\n                  onChange={this.handleFilePicked}\n                />\n              </label>\n            </VisuallyHidden>\n          )}\n        </Wrapper>\n      </Portal>\n    );\n  }\n}\n\nconst LinkInputWrapper = styled.div`\n  margin: 8px;\n`;\n\nconst LinkInput = styled(Input)`\n  height: 36px;\n  width: 100%;\n  color: ${(props) => props.theme.textSecondary};\n`;\n\nconst List = styled.ol`\n  list-style: none;\n  text-align: left;\n  height: 100%;\n  padding: 8px 0;\n  margin: 0;\n`;\n\nconst ListItem = styled.li`\n  padding: 0;\n  margin: 0;\n`;\n\nconst Empty = styled.div`\n  display: flex;\n  align-items: center;\n  color: ${(props) => props.theme.textSecondary};\n  font-weight: 500;\n  font-size: 14px;\n  height: 36px;\n  padding: 0 16px;\n`;\n\nexport const Wrapper = styled(Scrollable)<{\n  active: boolean;\n  top?: number;\n  bottom?: number;\n  left?: number;\n  isAbove: boolean;\n}>`\n  color: ${(props) => props.theme.textSecondary};\n  font-family: ${(props) => props.theme.fontFamily};\n  position: absolute;\n  z-index: ${depths.editorToolbar};\n  ${(props) => props.top !== undefined && `top: ${props.top}px`};\n  ${(props) => props.bottom !== undefined && `bottom: ${props.bottom}px`};\n  left: ${(props) => props.left}px;\n  background: ${(props) => props.theme.menuBackground};\n  border-radius: 6px;\n  box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px,\n    rgba(0, 0, 0, 0.08) 0px 4px 8px, rgba(0, 0, 0, 0.08) 0px 2px 4px;\n  opacity: 0;\n  transform: scale(0.95);\n  transition: opacity 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n    transform 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n  transition-delay: 150ms;\n  line-height: 0;\n  box-sizing: border-box;\n  pointer-events: none;\n  white-space: nowrap;\n  width: 300px;\n  height: auto;\n  max-height: 324px;\n\n  * {\n    box-sizing: border-box;\n  }\n\n  hr {\n    border: 0;\n    height: 0;\n    border-top: 1px solid ${(props) => props.theme.divider};\n  }\n\n  ${({ active, isAbove }) =>\n    active &&\n    `\n    transform: translateY(${isAbove ? \"6px\" : \"-6px\"}) scale(1);\n    pointer-events: all;\n    opacity: 1;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default CommandMenu;\n","import { findParentNode } from \"prosemirror-utils\";\nimport React from \"react\";\nimport getMenuItems from \"../menus/block\";\nimport BlockMenuItem from \"./BlockMenuItem\";\nimport CommandMenu, { Props } from \"./CommandMenu\";\n\ntype BlockMenuProps = Omit<\n  Props,\n  \"renderMenuItem\" | \"items\" | \"onClearSearch\"\n> &\n  Required<Pick<Props, \"onLinkToolbarOpen\" | \"embeds\">>;\n\nfunction BlockMenu(props: BlockMenuProps) {\n  const clearSearch = () => {\n    const { state, dispatch } = props.view;\n    const parent = findParentNode((node) => !!node)(state.selection);\n\n    if (parent) {\n      dispatch(state.tr.insertText(\"\", parent.pos, state.selection.to));\n    }\n  };\n\n  return (\n    <CommandMenu\n      {...props}\n      filterable={true}\n      onClearSearch={clearSearch}\n      renderMenuItem={(item, _index, options) => (\n        <BlockMenuItem\n          onClick={options.onClick}\n          selected={options.selected}\n          icon={item.icon}\n          title={item.title}\n          shortcut={item.shortcut}\n        />\n      )}\n      items={getMenuItems(props.dictionary)}\n    />\n  );\n}\n\nexport default BlockMenu;\n","import {\n  BlockQuoteIcon,\n  BulletedListIcon,\n  CodeIcon,\n  Heading1Icon,\n  Heading2Icon,\n  Heading3Icon,\n  HorizontalRuleIcon,\n  OrderedListIcon,\n  PageBreakIcon,\n  TableIcon,\n  TodoListIcon,\n  ImageIcon,\n  StarredIcon,\n  WarningIcon,\n  InfoIcon,\n  LinkIcon,\n  AttachmentIcon,\n  ClockIcon,\n  CalendarIcon,\n} from \"outline-icons\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport { metaDisplay } from \"~/utils/keyboard\";\n\nexport default function blockMenuItems(dictionary: Dictionary): MenuItem[] {\n  return [\n    {\n      name: \"heading\",\n      title: dictionary.h1,\n      keywords: \"h1 heading1 title\",\n      icon: Heading1Icon,\n      shortcut: \"^  1\",\n      attrs: { level: 1 },\n    },\n    {\n      name: \"heading\",\n      title: dictionary.h2,\n      keywords: \"h2 heading2\",\n      icon: Heading2Icon,\n      shortcut: \"^  2\",\n      attrs: { level: 2 },\n    },\n    {\n      name: \"heading\",\n      title: dictionary.h3,\n      keywords: \"h3 heading3\",\n      icon: Heading3Icon,\n      shortcut: \"^  3\",\n      attrs: { level: 3 },\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"checkbox_list\",\n      title: dictionary.checkboxList,\n      icon: TodoListIcon,\n      keywords: \"checklist checkbox task\",\n      shortcut: \"^  7\",\n    },\n    {\n      name: \"bullet_list\",\n      title: dictionary.bulletList,\n      icon: BulletedListIcon,\n      shortcut: \"^  8\",\n    },\n    {\n      name: \"ordered_list\",\n      title: dictionary.orderedList,\n      icon: OrderedListIcon,\n      shortcut: \"^  9\",\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"image\",\n      title: dictionary.image,\n      icon: ImageIcon,\n      keywords: \"picture photo\",\n    },\n    {\n      name: \"link\",\n      title: dictionary.link,\n      icon: LinkIcon,\n      shortcut: `${metaDisplay} k`,\n      keywords: \"link url uri href\",\n    },\n    {\n      name: \"attachment\",\n      title: dictionary.file,\n      icon: AttachmentIcon,\n      keywords: \"file upload attach\",\n    },\n    {\n      name: \"table\",\n      title: dictionary.table,\n      icon: TableIcon,\n      attrs: { rowsCount: 3, colsCount: 3 },\n    },\n    {\n      name: \"blockquote\",\n      title: dictionary.quote,\n      icon: BlockQuoteIcon,\n      shortcut: `${metaDisplay} ]`,\n    },\n    {\n      name: \"code_block\",\n      title: dictionary.codeBlock,\n      icon: CodeIcon,\n      shortcut: \"^  \\\\\",\n      keywords: \"script\",\n    },\n    {\n      name: \"hr\",\n      title: dictionary.hr,\n      icon: HorizontalRuleIcon,\n      shortcut: `${metaDisplay} _`,\n      keywords: \"horizontal rule break line\",\n    },\n    {\n      name: \"hr\",\n      title: dictionary.pageBreak,\n      icon: PageBreakIcon,\n      keywords: \"page print break line\",\n      attrs: { markup: \"***\" },\n    },\n    {\n      name: \"date\",\n      title: dictionary.insertDate,\n      keywords: \"clock\",\n      icon: CalendarIcon,\n    },\n    {\n      name: \"time\",\n      title: dictionary.insertTime,\n      keywords: \"clock\",\n      icon: ClockIcon,\n    },\n    {\n      name: \"datetime\",\n      title: dictionary.insertDateTime,\n      keywords: \"clock\",\n      icon: CalendarIcon,\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.infoNotice,\n      icon: InfoIcon,\n      keywords: \"notice card information\",\n      attrs: { style: \"info\" },\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.warningNotice,\n      icon: WarningIcon,\n      keywords: \"notice card error\",\n      attrs: { style: \"warning\" },\n    },\n    {\n      name: \"container_notice\",\n      title: dictionary.tipNotice,\n      icon: StarredIcon,\n      keywords: \"notice card suggestion\",\n      attrs: { style: \"tip\" },\n    },\n  ];\n}\n","import { Node as ProsemirrorNode } from \"prosemirror-model\";\nimport { EditorView, Decoration } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ThemeProvider } from \"styled-components\";\nimport Extension from \"@shared/editor/lib/Extension\";\nimport { ComponentProps } from \"@shared/editor/types\";\nimport { Editor } from \"~/editor\";\n\ntype Component = (props: ComponentProps) => React.ReactElement;\n\nexport default class ComponentView {\n  component: Component;\n  editor: Editor;\n  extension: Extension;\n  node: ProsemirrorNode;\n  view: EditorView;\n  getPos: () => number;\n  decorations: Decoration<{\n    [key: string]: any;\n  }>[];\n\n  isSelected = false;\n  dom: HTMLElement | null;\n\n  // See https://prosemirror.net/docs/ref/#view.NodeView\n  constructor(\n    component: Component,\n    {\n      editor,\n      extension,\n      node,\n      view,\n      getPos,\n      decorations,\n    }: {\n      editor: Editor;\n      extension: Extension;\n      node: ProsemirrorNode;\n      view: EditorView;\n      getPos: () => number;\n      decorations: Decoration<{\n        [key: string]: any;\n      }>[];\n    }\n  ) {\n    this.component = component;\n    this.editor = editor;\n    this.extension = extension;\n    this.getPos = getPos;\n    this.decorations = decorations;\n    this.node = node;\n    this.view = view;\n    this.dom = node.type.spec.inline\n      ? document.createElement(\"span\")\n      : document.createElement(\"div\");\n\n    this.dom.classList.add(`component-${node.type.name}`);\n\n    this.renderElement();\n    window.addEventListener(\"theme-changed\", this.renderElement);\n  }\n\n  renderElement = () => {\n    const { theme } = this.editor.props;\n\n    const children = this.component({\n      theme,\n      node: this.node,\n      isSelected: this.isSelected,\n      isEditable: this.view.editable,\n      getPos: this.getPos,\n    });\n\n    ReactDOM.render(\n      <ThemeProvider theme={theme}>{children}</ThemeProvider>,\n      this.dom\n    );\n  };\n\n  update(node: ProsemirrorNode) {\n    if (node.type !== this.node.type) {\n      return false;\n    }\n\n    this.node = node;\n    this.renderElement();\n    return true;\n  }\n\n  selectNode() {\n    if (this.view.editable) {\n      this.isSelected = true;\n      this.renderElement();\n    }\n  }\n\n  deselectNode() {\n    if (this.view.editable) {\n      this.isSelected = false;\n      this.renderElement();\n    }\n  }\n\n  stopEvent(event: Event) {\n    return event.type !== \"mousedown\" && !event.type.startsWith(\"drag\");\n  }\n\n  destroy() {\n    if (this.dom) {\n      ReactDOM.unmountComponentAtNode(this.dom);\n      window.removeEventListener(\"theme-changed\", this.renderElement);\n    }\n    this.dom = null;\n  }\n\n  ignoreMutation() {\n    return true;\n  }\n}\n","import * as React from \"react\";\nimport { Editor } from \"../\";\n\nconst EditorContext = React.createContext<Editor>({} as Editor);\n\nexport const useEditor = () => React.useContext(EditorContext);\n\nexport default EditorContext;\n","import * as React from \"react\";\nimport styled from \"styled-components\";\nimport BlockMenuItem, { Props as BlockMenuItemProps } from \"./BlockMenuItem\";\n\nconst Emoji = styled.span`\n  font-size: 16px;\n`;\n\ntype Props = {\n  emoji: React.ReactNode;\n  title: React.ReactNode;\n};\n\nconst EmojiTitle = ({ emoji, title }: Props) => {\n  return (\n    <p>\n      <Emoji className=\"emoji\">{emoji}</Emoji>\n      &nbsp;&nbsp;\n      {title}\n    </p>\n  );\n};\n\ntype EmojiMenuItemProps = Omit<BlockMenuItemProps, \"shortcut\" | \"theme\"> & {\n  emoji: string;\n};\n\nexport default function EmojiMenuItem(props: EmojiMenuItemProps) {\n  return (\n    <BlockMenuItem\n      {...props}\n      title={<EmojiTitle emoji={props.emoji} title={props.title} />}\n    />\n  );\n}\n","import FuzzySearch from \"fuzzy-search\";\nimport gemojies from \"gemoji\";\nimport React from \"react\";\nimport CommandMenu, { Props } from \"./CommandMenu\";\nimport EmojiMenuItem from \"./EmojiMenuItem\";\n\ntype Emoji = {\n  name: string;\n  title: string;\n  emoji: string;\n  description: string;\n  attrs: { markup: string; \"data-name\": string };\n};\n\nconst searcher = new FuzzySearch<{\n  names: string[];\n  description: string;\n  emoji: string;\n}>(gemojies, [\"names\"], {\n  caseSensitive: true,\n  sort: true,\n});\n\nclass EmojiMenu extends React.PureComponent<\n  Omit<\n    Props<Emoji>,\n    | \"renderMenuItem\"\n    | \"items\"\n    | \"onLinkToolbarOpen\"\n    | \"embeds\"\n    | \"onClearSearch\"\n  >\n> {\n  get items(): Emoji[] {\n    const { search = \"\" } = this.props;\n\n    const n = search.toLowerCase();\n    const result = searcher.search(n).map((item) => {\n      const description = item.description;\n      const name = item.names[0];\n      return {\n        ...item,\n        name: \"emoji\",\n        title: name,\n        description,\n        attrs: { markup: name, \"data-name\": name },\n      };\n    });\n\n    return result.slice(0, 10);\n  }\n\n  clearSearch = () => {\n    const { state, dispatch } = this.props.view;\n\n    // clear search input\n    dispatch(\n      state.tr.insertText(\n        \"\",\n        state.selection.$from.pos - (this.props.search ?? \"\").length - 1,\n        state.selection.to\n      )\n    );\n  };\n\n  render() {\n    const containerId = \"emoji-menu-container\";\n    return (\n      <CommandMenu\n        {...this.props}\n        id={containerId}\n        filterable={false}\n        onClearSearch={this.clearSearch}\n        renderMenuItem={(item, _index, options) => (\n          <EmojiMenuItem\n            onClick={options.onClick}\n            selected={options.selected}\n            title={item.description}\n            emoji={item.emoji}\n            containerId={containerId}\n          />\n        )}\n        items={this.items}\n      />\n    );\n  }\n}\n\nexport default EmojiMenu;\n","import { Node } from \"prosemirror-model\";\nimport { EditorView } from \"prosemirror-view\";\n\nfunction findPlaceholderLink(doc: Node, href: string) {\n  let result: { pos: number; node: Node } | undefined;\n\n  function findLinks(node: Node, pos = 0) {\n    // get text nodes\n    if (node.type.name === \"text\") {\n      // get marks for text nodes\n      node.marks.forEach((mark) => {\n        // any of the marks links?\n        if (mark.type.name === \"link\") {\n          // any of the links to other docs?\n          if (mark.attrs.href === href) {\n            result = { node, pos };\n          }\n        }\n      });\n    }\n\n    if (!node.content.size) {\n      return;\n    }\n\n    node.descendants(findLinks);\n  }\n\n  findLinks(doc);\n  return result;\n}\n\nconst createAndInsertLink = async function (\n  view: EditorView,\n  title: string,\n  href: string,\n  options: {\n    dictionary: any;\n    onCreateLink: (title: string) => Promise<string>;\n    onShowToast: (message: string) => void;\n  }\n) {\n  const { dispatch, state } = view;\n  const { onCreateLink, onShowToast } = options;\n\n  try {\n    const url = await onCreateLink(title);\n    const result = findPlaceholderLink(view.state.doc, href);\n\n    if (!result) {\n      return;\n    }\n\n    dispatch(\n      view.state.tr\n        .removeMark(\n          result.pos,\n          result.pos + result.node.nodeSize,\n          state.schema.marks.link\n        )\n        .addMark(\n          result.pos,\n          result.pos + result.node.nodeSize,\n          state.schema.marks.link.create({ href: url })\n        )\n    );\n  } catch (err) {\n    const result = findPlaceholderLink(view.state.doc, href);\n    if (!result) {\n      return;\n    }\n\n    dispatch(\n      view.state.tr.removeMark(\n        result.pos,\n        result.pos + result.node.nodeSize,\n        state.schema.marks.link\n      )\n    );\n\n    onShowToast(options.dictionary.createLinkError);\n  }\n};\n\nexport default createAndInsertLink;\n","import { NodeSelection } from \"prosemirror-state\";\nimport { CellSelection } from \"prosemirror-tables\";\nimport { EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport { Portal } from \"react-portal\";\nimport styled from \"styled-components\";\nimport { depths } from \"@shared/styles\";\nimport useComponentSize from \"~/hooks/useComponentSize\";\nimport useEventListener from \"~/hooks/useEventListener\";\nimport useMediaQuery from \"~/hooks/useMediaQuery\";\nimport useViewportHeight from \"~/hooks/useViewportHeight\";\n\ntype Props = {\n  active?: boolean;\n  view: EditorView;\n  children: React.ReactNode;\n  forwardedRef?: React.RefObject<HTMLDivElement> | null;\n};\n\nconst defaultPosition = {\n  left: -1000,\n  top: 0,\n  offset: 0,\n  visible: false,\n};\n\nfunction usePosition({\n  menuRef,\n  isSelectingText,\n  props,\n}: {\n  menuRef: React.RefObject<HTMLDivElement>;\n  isSelectingText: boolean;\n  props: Props;\n}) {\n  const { view, active } = props;\n  const { selection } = view.state;\n  const { width: menuWidth, height: menuHeight } = useComponentSize(menuRef);\n  const viewportHeight = useViewportHeight();\n  const isTouchDevice = useMediaQuery(\"(hover: none) and (pointer: coarse)\");\n\n  if (\n    !active ||\n    !menuWidth ||\n    !menuHeight ||\n    !menuRef.current ||\n    isSelectingText\n  ) {\n    return defaultPosition;\n  }\n\n  // If we're on a mobile device then stick the floating toolbar to the bottom\n  // of the screen above the virtual keyboard.\n  if (isTouchDevice && viewportHeight) {\n    return {\n      left: 0,\n      right: 0,\n      top: viewportHeight - menuHeight,\n      offset: 0,\n      visible: true,\n    };\n  }\n\n  // based on the start and end of the selection calculate the position at\n  // the center top\n  let fromPos;\n  let toPos;\n  try {\n    fromPos = view.coordsAtPos(selection.from);\n    toPos = view.coordsAtPos(selection.to, -1);\n  } catch (err) {\n    console.warn(err);\n    return defaultPosition;\n  }\n\n  // ensure that start < end for the menu to be positioned correctly\n  const selectionBounds = {\n    top: Math.min(fromPos.top, toPos.top),\n    bottom: Math.max(fromPos.bottom, toPos.bottom),\n    left: Math.min(fromPos.left, toPos.left),\n    right: Math.max(fromPos.right, toPos.right),\n  };\n\n  // tables are an oddity, and need their own positioning logic\n  const isColSelection =\n    selection instanceof CellSelection &&\n    selection.isColSelection &&\n    selection.isColSelection();\n  const isRowSelection =\n    selection instanceof CellSelection &&\n    selection.isRowSelection &&\n    selection.isRowSelection();\n\n  if (isColSelection) {\n    const { node: element } = view.domAtPos(selection.from);\n    const { width } = (element as HTMLElement).getBoundingClientRect();\n    selectionBounds.top -= 20;\n    selectionBounds.right = selectionBounds.left + width;\n  }\n\n  if (isRowSelection) {\n    selectionBounds.right = selectionBounds.left = selectionBounds.left - 18;\n  }\n\n  const isImageSelection =\n    selection instanceof NodeSelection && selection.node?.type.name === \"image\";\n\n  // Images need their own positioning to get the toolbar in the center\n  if (isImageSelection) {\n    const element = view.nodeDOM(selection.from);\n\n    // Images are wrapped which impacts positioning - need to traverse through\n    // p > span > div.image\n    const imageElement = (element as HTMLElement).getElementsByTagName(\n      \"img\"\n    )[0];\n    const { left, top, width } = imageElement.getBoundingClientRect();\n\n    return {\n      left: Math.round(left + width / 2 + window.scrollX - menuWidth / 2),\n      top: Math.round(top + window.scrollY - menuHeight),\n      offset: 0,\n      visible: true,\n    };\n  } else {\n    // calcluate the horizontal center of the selection\n    const halfSelection =\n      Math.abs(selectionBounds.right - selectionBounds.left) / 2;\n    const centerOfSelection = selectionBounds.left + halfSelection;\n\n    // position the menu so that it is centered over the selection except in\n    // the cases where it would extend off the edge of the screen. In these\n    // instances leave a margin\n    const margin = 12;\n    const left = Math.min(\n      window.innerWidth - menuWidth - margin,\n      Math.max(margin, centerOfSelection - menuWidth / 2)\n    );\n    const top = Math.min(\n      window.innerHeight - menuHeight - margin,\n      Math.max(margin, selectionBounds.top - menuHeight)\n    );\n\n    // if the menu has been offset to not extend offscreen then we should adjust\n    // the position of the triangle underneath to correctly point to the center\n    // of the selection still\n    const offset = left - (centerOfSelection - menuWidth / 2);\n    return {\n      left: Math.round(left + window.scrollX),\n      top: Math.round(top + window.scrollY),\n      offset: Math.round(offset),\n      visible: true,\n    };\n  }\n}\n\nconst FloatingToolbar = React.forwardRef(\n  (props: Props, forwardedRef: React.RefObject<HTMLDivElement>) => {\n    const menuRef = forwardedRef || React.createRef<HTMLDivElement>();\n    const [isSelectingText, setSelectingText] = React.useState(false);\n\n    const position = usePosition({\n      menuRef,\n      isSelectingText,\n      props,\n    });\n\n    useEventListener(\"mouseup\", () => {\n      setSelectingText(false);\n    });\n\n    useEventListener(\"mousedown\", () => {\n      if (!props.active) {\n        setSelectingText(true);\n      }\n    });\n\n    return (\n      <Portal>\n        <Wrapper\n          active={props.active && position.visible}\n          ref={menuRef}\n          offset={position.offset}\n          style={{\n            top: `${position.top}px`,\n            left: `${position.left}px`,\n          }}\n        >\n          {props.children}\n        </Wrapper>\n      </Portal>\n    );\n  }\n);\n\nconst Wrapper = styled.div<{\n  active?: boolean;\n  offset: number;\n}>`\n  will-change: opacity, transform;\n  padding: 8px 16px;\n  position: absolute;\n  z-index: ${depths.editorToolbar};\n  opacity: 0;\n  background-color: ${(props) => props.theme.toolbarBackground};\n  border-radius: 4px;\n  transform: scale(0.95);\n  transition: opacity 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n    transform 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n  transition-delay: 150ms;\n  line-height: 0;\n  height: 40px;\n  box-sizing: border-box;\n  pointer-events: none;\n  white-space: nowrap;\n\n  &::before {\n    content: \"\";\n    display: block;\n    width: 24px;\n    height: 24px;\n    transform: translateX(-50%) rotate(45deg);\n    background: ${(props) => props.theme.toolbarBackground};\n    border-radius: 3px;\n    z-index: -1;\n    position: absolute;\n    bottom: -2px;\n    left: calc(50% - ${(props) => props.offset || 0}px);\n    pointer-events: none;\n  }\n\n  * {\n    box-sizing: border-box;\n  }\n\n  ${({ active }) =>\n    active &&\n    `\n    transform: translateY(-6px) scale(1);\n    opacity: 1;\n  `};\n\n  @media print {\n    display: none;\n  }\n\n  @media (hover: none) and (pointer: coarse) {\n    &:before {\n      display: none;\n    }\n\n    transition: opacity 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275);\n    transform: scale(1);\n    border-radius: 0;\n    width: 100vw;\n    position: fixed;\n  }\n`;\n\nexport default FloatingToolbar;\n","import { useState, useEffect } from \"react\";\n\nexport default function useComponentSize(\n  ref: React.RefObject<HTMLElement>\n): { width: number; height: number } {\n  const [size, setSize] = useState({\n    width: ref.current?.clientWidth || 0,\n    height: ref.current?.clientHeight || 0,\n  });\n\n  useEffect(() => {\n    const sizeObserver = new ResizeObserver((entries) => {\n      entries.forEach(({ target }) => {\n        if (\n          size.width !== target.clientWidth ||\n          size.height !== target.clientHeight\n        ) {\n          setSize({ width: target.clientWidth, height: target.clientHeight });\n        }\n      });\n    });\n\n    if (ref.current) {\n      sizeObserver.observe(ref.current);\n    }\n\n    return () => sizeObserver.disconnect();\n  }, [ref]);\n\n  return size;\n}\n","import { useLayoutEffect, useState } from \"react\";\n\nexport default function useViewportHeight(): number | void {\n  // https://developer.mozilla.org/en-US/docs/Web/API/VisualViewport#browser_compatibility\n  // Note: No support in Firefox at time of writing, however this mainly exists\n  // for virtual keyboards on mobile devices, so that's okay.\n  const [height, setHeight] = useState<number>(\n    () => window.visualViewport?.height || window.innerHeight\n  );\n\n  useLayoutEffect(() => {\n    const handleResize = () => {\n      setHeight(() => window.visualViewport?.height || window.innerHeight);\n    };\n\n    window.visualViewport?.addEventListener(\"resize\", handleResize);\n\n    return () => {\n      window.visualViewport?.removeEventListener(\"resize\", handleResize);\n    };\n  }, []);\n\n  return height;\n}\n","import * as React from \"react\";\nimport scrollIntoView from \"smooth-scroll-into-view-if-needed\";\nimport styled from \"styled-components\";\n\ntype Props = React.HTMLAttributes<HTMLLIElement> & {\n  icon: React.ReactNode;\n  selected: boolean;\n  title: React.ReactNode;\n  subtitle?: React.ReactNode;\n};\n\nfunction LinkSearchResult({ title, subtitle, selected, icon, ...rest }: Props) {\n  const ref = React.useCallback(\n    (node: HTMLElement | null) => {\n      if (selected && node) {\n        scrollIntoView(node, {\n          scrollMode: \"if-needed\",\n          block: \"center\",\n          boundary: (parent) => {\n            // All the parent elements of your target are checked until they\n            // reach the #link-search-results. Prevents body and other parent\n            // elements from being scrolled\n            return parent.id !== \"link-search-results\";\n          },\n        });\n      }\n    },\n    [selected]\n  );\n\n  return (\n    <ListItem ref={ref} compact={!subtitle} selected={selected} {...rest}>\n      <IconWrapper>{icon}</IconWrapper>\n      <div>\n        <Title>{title}</Title>\n        {subtitle ? <Subtitle selected={selected}>{subtitle}</Subtitle> : null}\n      </div>\n    </ListItem>\n  );\n}\n\nconst IconWrapper = styled.span`\n  flex-shrink: 0;\n  margin-right: 4px;\n  opacity: 0.8;\n  color: ${(props) => props.theme.toolbarItem};\n`;\n\nconst ListItem = styled.li<{\n  selected: boolean;\n  compact: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  padding: 8px;\n  border-radius: 4px;\n  color: ${(props) => props.theme.toolbarItem};\n  background: ${(props) =>\n    props.selected ? props.theme.toolbarHoverBackground : \"transparent\"};\n  font-family: ${(props) => props.theme.fontFamily};\n  text-decoration: none;\n  overflow: hidden;\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n  line-height: ${(props) => (props.compact ? \"inherit\" : \"1.2\")};\n  height: ${(props) => (props.compact ? \"28px\" : \"auto\")};\n`;\n\nconst Title = styled.div`\n  font-size: 14px;\n  font-weight: 500;\n`;\n\nconst Subtitle = styled.div<{\n  selected: boolean;\n}>`\n  font-size: 13px;\n  opacity: ${(props) => (props.selected ? 0.75 : 0.5)};\n`;\n\nexport default LinkSearchResult;\n","import styled from \"styled-components\";\n\ntype Props = { active?: boolean; disabled?: boolean };\n\nexport default styled.button<Props>`\n  display: inline-block;\n  flex: 0;\n  width: 24px;\n  height: 24px;\n  cursor: pointer;\n  border: none;\n  background: none;\n  transition: opacity 100ms ease-in-out;\n  padding: 0;\n  opacity: 0.7;\n  outline: none;\n  pointer-events: all;\n  position: relative;\n  color: ${(props) => props.theme.toolbarItem};\n\n  &:hover {\n    opacity: 1;\n  }\n\n  &:disabled {\n    opacity: 0.3;\n    cursor: default;\n  }\n\n  &:before {\n    position: absolute;\n    content: \"\";\n    top: -4px;\n    right: -4px;\n    left: -4px;\n    bottom: -4px;\n  }\n\n  ${(props) => props.active && \"opacity: 1;\"};\n`;\n","import * as React from \"react\";\nimport styled from \"styled-components\";\nimport Tooltip from \"~/components/Tooltip\";\n\ntype Props = {\n  tooltip?: string;\n};\n\nconst WrappedTooltip: React.FC<Props> = ({ children, tooltip }) => (\n  <Tooltip offset=\"0, 8\" delay={150} tooltip={tooltip} placement=\"top\">\n    <TooltipContent>{children}</TooltipContent>\n  </Tooltip>\n);\n\nconst TooltipContent = styled.span`\n  outline: none;\n`;\n\nexport default WrappedTooltip;\n","import {\n  ArrowIcon,\n  DocumentIcon,\n  CloseIcon,\n  PlusIcon,\n  TrashIcon,\n  OpenIcon,\n} from \"outline-icons\";\nimport { Mark } from \"prosemirror-model\";\nimport { setTextSelection } from \"prosemirror-utils\";\nimport { EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport styled from \"styled-components\";\nimport isUrl from \"@shared/editor/lib/isUrl\";\nimport { isInternalUrl } from \"@shared/utils/urls\";\nimport Flex from \"~/components/Flex\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport { ToastOptions } from \"~/types\";\nimport Input from \"./Input\";\nimport LinkSearchResult from \"./LinkSearchResult\";\nimport ToolbarButton from \"./ToolbarButton\";\nimport Tooltip from \"./Tooltip\";\n\nexport type SearchResult = {\n  title: string;\n  subtitle?: string;\n  url: string;\n};\n\ntype Props = {\n  mark?: Mark;\n  from: number;\n  to: number;\n  dictionary: Dictionary;\n  onRemoveLink?: () => void;\n  onCreateLink?: (title: string) => Promise<void>;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onSelectLink: (options: {\n    href: string;\n    title?: string;\n    from: number;\n    to: number;\n  }) => void;\n  onClickLink: (\n    href: string,\n    event: React.MouseEvent<HTMLButtonElement>\n  ) => void;\n  onShowToast: (message: string, options: ToastOptions) => void;\n  view: EditorView;\n};\n\ntype State = {\n  results: {\n    [keyword: string]: SearchResult[];\n  };\n  value: string;\n  previousValue: string;\n  selectedIndex: number;\n};\n\nclass LinkEditor extends React.Component<Props, State> {\n  discardInputValue = false;\n  initialValue = this.href;\n  initialSelectionLength = this.props.to - this.props.from;\n\n  state: State = {\n    selectedIndex: -1,\n    value: this.href,\n    previousValue: \"\",\n    results: {},\n  };\n\n  get href(): string {\n    return this.props.mark ? this.props.mark.attrs.href : \"\";\n  }\n\n  get suggestedLinkTitle(): string {\n    const { state } = this.props.view;\n    const { value } = this.state;\n    const selectionText = state.doc.cut(\n      state.selection.from,\n      state.selection.to\n    ).textContent;\n\n    return value.trim() || selectionText.trim();\n  }\n\n  componentWillUnmount = () => {\n    // If we discarded the changes then nothing to do\n    if (this.discardInputValue) {\n      return;\n    }\n\n    // If the link is the same as it was when the editor opened, nothing to do\n    if (this.state.value === this.initialValue) {\n      return;\n    }\n\n    // If the link is totally empty or only spaces then remove the mark\n    const href = (this.state.value || \"\").trim();\n    if (!href) {\n      return this.handleRemoveLink();\n    }\n\n    this.save(href, href);\n  };\n\n  save = (href: string, title?: string): void => {\n    href = href.trim();\n\n    if (href.length === 0) {\n      return;\n    }\n\n    this.discardInputValue = true;\n    const { from, to } = this.props;\n\n    // Make sure a protocol is added to the beginning of the input if it's\n    // likely an absolute URL that was entered without one.\n    if (\n      !isUrl(href) &&\n      !href.startsWith(\"/\") &&\n      !href.startsWith(\"#\") &&\n      !href.startsWith(\"mailto:\")\n    ) {\n      href = `https://${href}`;\n    }\n\n    this.props.onSelectLink({ href, title, from, to });\n  };\n\n  handleKeyDown = (event: React.KeyboardEvent): void => {\n    switch (event.key) {\n      case \"Enter\": {\n        event.preventDefault();\n        const { selectedIndex, value } = this.state;\n        const results = this.state.results[value] || [];\n        const { onCreateLink } = this.props;\n\n        if (selectedIndex >= 0) {\n          const result = results[selectedIndex];\n          if (result) {\n            this.save(result.url, result.title);\n          } else if (onCreateLink && selectedIndex === results.length) {\n            this.handleCreateLink(this.suggestedLinkTitle);\n          }\n        } else {\n          // saves the raw input as href\n          this.save(value, value);\n        }\n\n        if (this.initialSelectionLength) {\n          this.moveSelectionToEnd();\n        }\n\n        return;\n      }\n\n      case \"Escape\": {\n        event.preventDefault();\n\n        if (this.initialValue) {\n          this.setState({ value: this.initialValue }, this.moveSelectionToEnd);\n        } else {\n          this.handleRemoveLink();\n        }\n        return;\n      }\n\n      case \"ArrowUp\": {\n        if (event.shiftKey) {\n          return;\n        }\n        event.preventDefault();\n        event.stopPropagation();\n        const prevIndex = this.state.selectedIndex - 1;\n\n        this.setState({\n          selectedIndex: Math.max(-1, prevIndex),\n        });\n        return;\n      }\n\n      case \"ArrowDown\":\n      case \"Tab\": {\n        if (event.shiftKey) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        const { selectedIndex, value } = this.state;\n        const results = this.state.results[value] || [];\n        const total = results.length;\n        const nextIndex = selectedIndex + 1;\n\n        this.setState({\n          selectedIndex: Math.min(nextIndex, total),\n        });\n        return;\n      }\n    }\n  };\n\n  handleFocusLink = (selectedIndex: number) => {\n    this.setState({ selectedIndex });\n  };\n\n  handleChange = async (\n    event: React.ChangeEvent<HTMLInputElement>\n  ): Promise<void> => {\n    const value = event.target.value;\n\n    this.setState({\n      value,\n      selectedIndex: -1,\n    });\n\n    const trimmedValue = value.trim();\n\n    if (trimmedValue && this.props.onSearchLink) {\n      try {\n        const results = await this.props.onSearchLink(trimmedValue);\n        this.setState((state) => ({\n          results: {\n            ...state.results,\n            [trimmedValue]: results,\n          },\n          previousValue: trimmedValue,\n        }));\n      } catch (error) {\n        console.error(error);\n      }\n    }\n  };\n\n  handlePaste = (): void => {\n    setTimeout(() => this.save(this.state.value, this.state.value), 0);\n  };\n\n  handleOpenLink = (event: React.MouseEvent<HTMLButtonElement>): void => {\n    event.preventDefault();\n    this.props.onClickLink(this.href, event);\n  };\n\n  handleCreateLink = async (value: string) => {\n    this.discardInputValue = true;\n    const { onCreateLink } = this.props;\n\n    value = value.trim();\n    if (value.length === 0) {\n      return;\n    }\n\n    if (onCreateLink) {\n      return onCreateLink(value);\n    }\n  };\n\n  handleRemoveLink = (): void => {\n    this.discardInputValue = true;\n\n    const { from, to, mark, view, onRemoveLink } = this.props;\n    const { state, dispatch } = this.props.view;\n\n    if (mark) {\n      dispatch(state.tr.removeMark(from, to, mark));\n    }\n\n    if (onRemoveLink) {\n      onRemoveLink();\n    }\n\n    view.focus();\n  };\n\n  handleSelectLink = (url: string, title: string) => (\n    event: React.MouseEvent\n  ) => {\n    event.preventDefault();\n    this.save(url, title);\n\n    if (this.initialSelectionLength) {\n      this.moveSelectionToEnd();\n    }\n  };\n\n  moveSelectionToEnd = () => {\n    const { to, view } = this.props;\n    const { state, dispatch } = view;\n    dispatch(setTextSelection(to)(state.tr));\n    view.focus();\n  };\n\n  render() {\n    const { dictionary } = this.props;\n    const { value, selectedIndex } = this.state;\n    const results =\n      this.state.results[value.trim()] ||\n      this.state.results[this.state.previousValue] ||\n      [];\n\n    const looksLikeUrl = value.match(/^https?:\\/\\//i);\n    const suggestedLinkTitle = this.suggestedLinkTitle;\n    const isInternal = isInternalUrl(value);\n\n    const showCreateLink =\n      !!this.props.onCreateLink &&\n      !(suggestedLinkTitle === this.initialValue) &&\n      suggestedLinkTitle.length > 0 &&\n      !looksLikeUrl;\n\n    const showResults =\n      !!suggestedLinkTitle && (showCreateLink || results.length > 0);\n\n    return (\n      <Wrapper>\n        <Input\n          value={value}\n          placeholder={\n            showCreateLink\n              ? dictionary.findOrCreateDoc\n              : dictionary.searchOrPasteLink\n          }\n          onKeyDown={this.handleKeyDown}\n          onPaste={this.handlePaste}\n          onChange={this.handleChange}\n          autoFocus={this.href === \"\"}\n        />\n\n        <Tooltip\n          tooltip={isInternal ? dictionary.goToLink : dictionary.openLink}\n        >\n          <ToolbarButton onClick={this.handleOpenLink} disabled={!value}>\n            {isInternal ? (\n              <ArrowIcon color=\"currentColor\" />\n            ) : (\n              <OpenIcon color=\"currentColor\" />\n            )}\n          </ToolbarButton>\n        </Tooltip>\n        <Tooltip tooltip={dictionary.removeLink}>\n          <ToolbarButton onClick={this.handleRemoveLink}>\n            {this.initialValue ? (\n              <TrashIcon color=\"currentColor\" />\n            ) : (\n              <CloseIcon color=\"currentColor\" />\n            )}\n          </ToolbarButton>\n        </Tooltip>\n\n        {showResults && (\n          <SearchResults id=\"link-search-results\">\n            {results.map((result, index) => (\n              <LinkSearchResult\n                key={result.url}\n                title={result.title}\n                subtitle={result.subtitle}\n                icon={<DocumentIcon color=\"currentColor\" />}\n                onPointerMove={() => this.handleFocusLink(index)}\n                onClick={this.handleSelectLink(result.url, result.title)}\n                selected={index === selectedIndex}\n              />\n            ))}\n\n            {showCreateLink && (\n              <LinkSearchResult\n                key=\"create\"\n                title={suggestedLinkTitle}\n                subtitle={dictionary.createNewDoc}\n                icon={<PlusIcon color=\"currentColor\" />}\n                onPointerMove={() => this.handleFocusLink(results.length)}\n                onClick={() => {\n                  this.handleCreateLink(suggestedLinkTitle);\n\n                  if (this.initialSelectionLength) {\n                    this.moveSelectionToEnd();\n                  }\n                }}\n                selected={results.length === selectedIndex}\n              />\n            )}\n          </SearchResults>\n        )}\n      </Wrapper>\n    );\n  }\n}\n\nconst Wrapper = styled(Flex)`\n  margin-left: -8px;\n  margin-right: -8px;\n  min-width: 336px;\n  pointer-events: all;\n  gap: 8px;\n`;\n\nconst SearchResults = styled.ol`\n  background: ${(props) => props.theme.toolbarBackground};\n  position: absolute;\n  top: 100%;\n  width: 100%;\n  height: auto;\n  left: 0;\n  padding: 0;\n  margin: 0;\n  margin-top: -3px;\n  margin-bottom: 0;\n  border-radius: 0 0 4px 4px;\n  overflow-y: auto;\n  overscroll-behavior: none;\n  max-height: 260px;\n\n  @media (hover: none) and (pointer: coarse) {\n    position: fixed;\n    top: auto;\n    bottom: 40px;\n    border-radius: 0;\n    max-height: 50vh;\n    padding: 8px 8px 4px;\n  }\n`;\n\nexport default LinkEditor;\n","import { EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport createAndInsertLink from \"@shared/editor/commands/createAndInsertLink\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport FloatingToolbar from \"./FloatingToolbar\";\nimport LinkEditor, { SearchResult } from \"./LinkEditor\";\n\ntype Props = {\n  isActive: boolean;\n  view: EditorView;\n  dictionary: Dictionary;\n  onCreateLink?: (title: string) => Promise<string>;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onClickLink: (\n    href: string,\n    event: React.MouseEvent<HTMLButtonElement>\n  ) => void;\n  onShowToast: (message: string) => void;\n  onClose: () => void;\n};\n\nfunction isActive(props: Props) {\n  const { view } = props;\n  const { selection } = view.state;\n\n  try {\n    const paragraph = view.domAtPos(selection.from);\n    return props.isActive && !!paragraph.node;\n  } catch (err) {\n    return false;\n  }\n}\n\nexport default class LinkToolbar extends React.Component<Props> {\n  menuRef = React.createRef<HTMLDivElement>();\n\n  state = {\n    left: -1000,\n    top: undefined,\n  };\n\n  componentDidMount() {\n    window.addEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"mousedown\", this.handleClickOutside);\n  }\n\n  handleClickOutside = (event: Event) => {\n    if (\n      event.target instanceof HTMLElement &&\n      this.menuRef.current &&\n      this.menuRef.current.contains(event.target)\n    ) {\n      return;\n    }\n\n    this.props.onClose();\n  };\n\n  handleOnCreateLink = async (title: string) => {\n    const { dictionary, onCreateLink, view, onClose, onShowToast } = this.props;\n\n    onClose();\n    this.props.view.focus();\n\n    if (!onCreateLink) {\n      return;\n    }\n\n    const { dispatch, state } = view;\n    const { from, to } = state.selection;\n    if (from !== to) {\n      // selection must be collapsed\n      return;\n    }\n\n    const href = `creating#${title}`;\n\n    // Insert a placeholder link\n    dispatch(\n      view.state.tr\n        .insertText(title, from, to)\n        .addMark(\n          from,\n          to + title.length,\n          state.schema.marks.link.create({ href })\n        )\n    );\n\n    createAndInsertLink(view, title, href, {\n      onCreateLink,\n      onShowToast,\n      dictionary,\n    });\n  };\n\n  handleOnSelectLink = ({\n    href,\n    title,\n  }: {\n    href: string;\n    title: string;\n    from: number;\n    to: number;\n  }) => {\n    const { view, onClose } = this.props;\n\n    onClose();\n    this.props.view.focus();\n\n    const { dispatch, state } = view;\n    const { from, to } = state.selection;\n    if (from !== to) {\n      // selection must be collapsed\n      return;\n    }\n\n    dispatch(\n      view.state.tr\n        .insertText(title, from, to)\n        .addMark(\n          from,\n          to + title.length,\n          state.schema.marks.link.create({ href })\n        )\n    );\n  };\n\n  render() {\n    const { onCreateLink, onClose, ...rest } = this.props;\n    const { selection } = this.props.view.state;\n    const active = isActive(this.props);\n\n    return (\n      <FloatingToolbar ref={this.menuRef} active={active} {...rest}>\n        {active && (\n          <LinkEditor\n            key={`${selection.from}-${selection.to}`}\n            from={selection.from}\n            to={selection.to}\n            onCreateLink={onCreateLink ? this.handleOnCreateLink : undefined}\n            onSelectLink={this.handleOnSelectLink}\n            onRemoveLink={onClose}\n            {...rest}\n          />\n        )}\n      </FloatingToolbar>\n    );\n  }\n}\n","import styled from \"styled-components\";\n\nconst Separator = styled.div`\n  height: 24px;\n  width: 2px;\n  background: ${(props) => props.theme.toolbarItem};\n  opacity: 0.3;\n  display: inline-block;\n  margin-left: 8px;\n`;\n\nexport default Separator;\n","import * as React from \"react\";\nimport styled from \"styled-components\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { useEditor } from \"./EditorContext\";\nimport ToolbarButton from \"./ToolbarButton\";\nimport ToolbarSeparator from \"./ToolbarSeparator\";\nimport Tooltip from \"./Tooltip\";\n\ntype Props = {\n  items: MenuItem[];\n};\n\nconst FlexibleWrapper = styled.div`\n  color: ${(props) => props.theme.toolbarItem};\n  display: flex;\n  gap: 8px;\n`;\n\nfunction ToolbarMenu(props: Props) {\n  const { commands, view } = useEditor();\n  const { items } = props;\n  const { state } = view;\n\n  return (\n    <FlexibleWrapper>\n      {items.map((item, index) => {\n        if (item.name === \"separator\" && item.visible !== false) {\n          return <ToolbarSeparator key={index} />;\n        }\n        if (item.visible === false || !item.icon) {\n          return null;\n        }\n        const Icon = item.icon;\n        const isActive = item.active ? item.active(state) : false;\n\n        return (\n          <Tooltip tooltip={item.tooltip} key={index}>\n            <ToolbarButton\n              onClick={() => item.name && commands[item.name](item.attrs)}\n              active={isActive}\n            >\n              <Icon color=\"currentColor\" />\n            </ToolbarButton>\n          </Tooltip>\n        );\n      })}\n    </FlexibleWrapper>\n  );\n}\n\nexport default ToolbarMenu;\n","import { some } from \"lodash\";\nimport { NodeSelection, TextSelection } from \"prosemirror-state\";\nimport { CellSelection } from \"prosemirror-tables\";\nimport { EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport createAndInsertLink from \"@shared/editor/commands/createAndInsertLink\";\nimport { CommandFactory } from \"@shared/editor/lib/Extension\";\nimport filterExcessSeparators from \"@shared/editor/lib/filterExcessSeparators\";\nimport getColumnIndex from \"@shared/editor/queries/getColumnIndex\";\nimport getMarkRange from \"@shared/editor/queries/getMarkRange\";\nimport getRowIndex from \"@shared/editor/queries/getRowIndex\";\nimport isMarkActive from \"@shared/editor/queries/isMarkActive\";\nimport isNodeActive from \"@shared/editor/queries/isNodeActive\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport getDividerMenuItems from \"../menus/divider\";\nimport getFormattingMenuItems from \"../menus/formatting\";\nimport getImageMenuItems from \"../menus/image\";\nimport getTableMenuItems from \"../menus/table\";\nimport getTableColMenuItems from \"../menus/tableCol\";\nimport getTableRowMenuItems from \"../menus/tableRow\";\nimport FloatingToolbar from \"./FloatingToolbar\";\nimport LinkEditor, { SearchResult } from \"./LinkEditor\";\nimport ToolbarMenu from \"./ToolbarMenu\";\n\ntype Props = {\n  dictionary: Dictionary;\n  rtl: boolean;\n  isTemplate: boolean;\n  commands: Record<string, CommandFactory>;\n  onOpen: () => void;\n  onClose: () => void;\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  onClickLink: (\n    href: string,\n    event: MouseEvent | React.MouseEvent<HTMLButtonElement>\n  ) => void;\n  onCreateLink?: (title: string) => Promise<string>;\n  onShowToast: (message: string) => void;\n  view: EditorView;\n};\n\nfunction isVisible(props: Props) {\n  const { view } = props;\n  const { selection, doc } = view.state;\n\n  if (isMarkActive(view.state.schema.marks.link)(view.state)) {\n    return true;\n  }\n  if (!selection || selection.empty) {\n    return false;\n  }\n  if (selection instanceof NodeSelection && selection.node.type.name === \"hr\") {\n    return true;\n  }\n  if (\n    selection instanceof NodeSelection &&\n    selection.node.type.name === \"image\"\n  ) {\n    return true;\n  }\n  if (selection instanceof NodeSelection) {\n    return false;\n  }\n\n  const selectionText = doc.cut(selection.from, selection.to).textContent;\n  if (selection instanceof TextSelection && !selectionText) {\n    return false;\n  }\n\n  const slice = selection.content();\n  const fragment = slice.content;\n  const nodes = (fragment as any).content;\n\n  return some(nodes, (n) => n.content.size);\n}\n\nexport default class SelectionToolbar extends React.Component<Props> {\n  isActive = false;\n  menuRef = React.createRef<HTMLDivElement>();\n\n  componentDidUpdate(): void {\n    const visible = isVisible(this.props);\n    if (this.isActive && !visible) {\n      this.isActive = false;\n      this.props.onClose();\n    }\n    if (!this.isActive && visible) {\n      this.isActive = true;\n      this.props.onOpen();\n    }\n  }\n\n  componentDidMount(): void {\n    window.addEventListener(\"mouseup\", this.handleClickOutside);\n  }\n\n  componentWillUnmount(): void {\n    window.removeEventListener(\"mouseup\", this.handleClickOutside);\n  }\n\n  handleClickOutside = (ev: MouseEvent): void => {\n    if (\n      ev.target instanceof HTMLElement &&\n      this.menuRef.current &&\n      this.menuRef.current.contains(ev.target)\n    ) {\n      return;\n    }\n\n    if (!this.isActive) {\n      return;\n    }\n\n    const { view } = this.props;\n    if (view.hasFocus()) {\n      return;\n    }\n\n    const { dispatch } = view;\n\n    dispatch(\n      view.state.tr.setSelection(new TextSelection(view.state.doc.resolve(0)))\n    );\n  };\n\n  handleOnCreateLink = async (title: string): Promise<void> => {\n    const { dictionary, onCreateLink, view, onShowToast } = this.props;\n\n    if (!onCreateLink) {\n      return;\n    }\n\n    const { dispatch, state } = view;\n    const { from, to } = state.selection;\n    if (from === to) {\n      // selection cannot be collapsed\n      return;\n    }\n\n    const href = `creating#${title}`;\n    const markType = state.schema.marks.link;\n\n    // Insert a placeholder link\n    dispatch(\n      view.state.tr\n        .removeMark(from, to, markType)\n        .addMark(from, to, markType.create({ href }))\n    );\n\n    createAndInsertLink(view, title, href, {\n      onCreateLink,\n      onShowToast,\n      dictionary,\n    });\n  };\n\n  handleOnSelectLink = ({\n    href,\n    from,\n    to,\n  }: {\n    href: string;\n    from: number;\n    to: number;\n  }): void => {\n    const { view } = this.props;\n    const { state, dispatch } = view;\n\n    const markType = state.schema.marks.link;\n\n    dispatch(\n      state.tr\n        .removeMark(from, to, markType)\n        .addMark(from, to, markType.create({ href }))\n    );\n  };\n\n  render() {\n    const { dictionary, onCreateLink, isTemplate, rtl, ...rest } = this.props;\n    const { view } = rest;\n    const { state } = view;\n    const { selection }: { selection: any } = state;\n    const isCodeSelection = isNodeActive(state.schema.nodes.code_block)(state);\n    const isDividerSelection = isNodeActive(state.schema.nodes.hr)(state);\n\n    // toolbar is disabled in code blocks, no bold / italic etc\n    if (isCodeSelection) {\n      return null;\n    }\n\n    const colIndex = getColumnIndex(\n      (state.selection as unknown) as CellSelection\n    );\n    const rowIndex = getRowIndex((state.selection as unknown) as CellSelection);\n    const isTableSelection = colIndex !== undefined && rowIndex !== undefined;\n    const link = isMarkActive(state.schema.marks.link)(state);\n    const range = getMarkRange(selection.$from, state.schema.marks.link);\n    const isImageSelection = selection.node?.type?.name === \"image\";\n\n    let items: MenuItem[] = [];\n    if (isTableSelection) {\n      items = getTableMenuItems(dictionary);\n    } else if (colIndex !== undefined) {\n      items = getTableColMenuItems(state, colIndex, rtl, dictionary);\n    } else if (rowIndex !== undefined) {\n      items = getTableRowMenuItems(state, rowIndex, dictionary);\n    } else if (isImageSelection) {\n      items = getImageMenuItems(state, dictionary);\n    } else if (isDividerSelection) {\n      items = getDividerMenuItems(state, dictionary);\n    } else {\n      items = getFormattingMenuItems(state, isTemplate, dictionary);\n    }\n\n    // Some extensions may be disabled, remove corresponding items\n    items = items.filter((item) => {\n      if (item.name === \"separator\") {\n        return true;\n      }\n      if (item.name && !this.props.commands[item.name]) {\n        return false;\n      }\n      return true;\n    });\n\n    items = filterExcessSeparators(items);\n    if (!items.length) {\n      return null;\n    }\n\n    return (\n      <FloatingToolbar\n        view={view}\n        active={isVisible(this.props)}\n        ref={this.menuRef}\n      >\n        {link && range ? (\n          <LinkEditor\n            key={`${range.from}-${range.to}`}\n            dictionary={dictionary}\n            mark={range.mark}\n            from={range.from}\n            to={range.to}\n            onCreateLink={onCreateLink ? this.handleOnCreateLink : undefined}\n            onSelectLink={this.handleOnSelectLink}\n            {...rest}\n          />\n        ) : (\n          <ToolbarMenu items={items} {...rest} />\n        )}\n      </FloatingToolbar>\n    );\n  }\n}\n","import { CellSelection } from \"prosemirror-tables\";\n\nexport default function getColumnIndex(selection: CellSelection) {\n  const isColSelection = selection.isColSelection && selection.isColSelection();\n  if (!isColSelection) {\n    return undefined;\n  }\n\n  const path = (selection.$from as any).path;\n  return path[path.length - 5];\n}\n","import { CellSelection } from \"prosemirror-tables\";\n\nexport default function getRowIndex(selection: CellSelection) {\n  const isRowSelection = selection.isRowSelection && selection.isRowSelection();\n  if (!isRowSelection) {\n    return undefined;\n  }\n\n  const path = (selection.$from as any).path;\n  return path[path.length - 8];\n}\n","import { TrashIcon } from \"outline-icons\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function tableMenuItems(dictionary: Dictionary): MenuItem[] {\n  return [\n    {\n      name: \"deleteTable\",\n      tooltip: dictionary.deleteTable,\n      icon: TrashIcon,\n      active: () => false,\n    },\n  ];\n}\n","import {\n  TrashIcon,\n  AlignLeftIcon,\n  AlignRightIcon,\n  AlignCenterIcon,\n  InsertLeftIcon,\n  InsertRightIcon,\n} from \"outline-icons\";\nimport { EditorState } from \"prosemirror-state\";\nimport isNodeActive from \"@shared/editor/queries/isNodeActive\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function tableColMenuItems(\n  state: EditorState,\n  index: number,\n  rtl: boolean,\n  dictionary: Dictionary\n): MenuItem[] {\n  const { schema } = state;\n\n  return [\n    {\n      name: \"setColumnAttr\",\n      tooltip: dictionary.alignLeft,\n      icon: AlignLeftIcon,\n      attrs: { index, alignment: \"left\" },\n      active: isNodeActive(schema.nodes.th, {\n        colspan: 1,\n        rowspan: 1,\n        alignment: \"left\",\n      }),\n    },\n    {\n      name: \"setColumnAttr\",\n      tooltip: dictionary.alignCenter,\n      icon: AlignCenterIcon,\n      attrs: { index, alignment: \"center\" },\n      active: isNodeActive(schema.nodes.th, {\n        colspan: 1,\n        rowspan: 1,\n        alignment: \"center\",\n      }),\n    },\n    {\n      name: \"setColumnAttr\",\n      tooltip: dictionary.alignRight,\n      icon: AlignRightIcon,\n      attrs: { index, alignment: \"right\" },\n      active: isNodeActive(schema.nodes.th, {\n        colspan: 1,\n        rowspan: 1,\n        alignment: \"right\",\n      }),\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: rtl ? \"addColumnAfter\" : \"addColumnBefore\",\n      tooltip: rtl ? dictionary.addColumnAfter : dictionary.addColumnBefore,\n      icon: InsertLeftIcon,\n      active: () => false,\n    },\n    {\n      name: rtl ? \"addColumnBefore\" : \"addColumnAfter\",\n      tooltip: rtl ? dictionary.addColumnBefore : dictionary.addColumnAfter,\n      icon: InsertRightIcon,\n      active: () => false,\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"deleteColumn\",\n      tooltip: dictionary.deleteColumn,\n      icon: TrashIcon,\n      active: () => false,\n    },\n  ];\n}\n","import { TrashIcon, InsertAboveIcon, InsertBelowIcon } from \"outline-icons\";\nimport { EditorState } from \"prosemirror-state\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function tableRowMenuItems(\n  state: EditorState,\n  index: number,\n  dictionary: Dictionary\n): MenuItem[] {\n  return [\n    {\n      name: \"addRowAfter\",\n      tooltip: dictionary.addRowBefore,\n      icon: InsertAboveIcon,\n      attrs: { index: index - 1 },\n      active: () => false,\n      visible: index !== 0,\n    },\n    {\n      name: \"addRowAfter\",\n      tooltip: dictionary.addRowAfter,\n      icon: InsertBelowIcon,\n      attrs: { index },\n      active: () => false,\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"deleteRow\",\n      tooltip: dictionary.deleteRow,\n      icon: TrashIcon,\n      active: () => false,\n    },\n  ];\n}\n","import {\n  TrashIcon,\n  DownloadIcon,\n  ReplaceIcon,\n  AlignImageLeftIcon,\n  AlignImageRightIcon,\n  AlignImageCenterIcon,\n} from \"outline-icons\";\nimport { EditorState } from \"prosemirror-state\";\nimport isNodeActive from \"@shared/editor/queries/isNodeActive\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function imageMenuItems(\n  state: EditorState,\n  dictionary: Dictionary\n): MenuItem[] {\n  const { schema } = state;\n  const isLeftAligned = isNodeActive(schema.nodes.image, {\n    layoutClass: \"left-50\",\n  });\n  const isRightAligned = isNodeActive(schema.nodes.image, {\n    layoutClass: \"right-50\",\n  });\n\n  return [\n    {\n      name: \"alignLeft\",\n      tooltip: dictionary.alignLeft,\n      icon: AlignImageLeftIcon,\n      visible: true,\n      active: isLeftAligned,\n    },\n    {\n      name: \"alignCenter\",\n      tooltip: dictionary.alignCenter,\n      icon: AlignImageCenterIcon,\n      visible: true,\n      active: (state) =>\n        isNodeActive(schema.nodes.image)(state) &&\n        !isLeftAligned(state) &&\n        !isRightAligned(state),\n    },\n    {\n      name: \"alignRight\",\n      tooltip: dictionary.alignRight,\n      icon: AlignImageRightIcon,\n      visible: true,\n      active: isRightAligned,\n    },\n    {\n      name: \"separator\",\n      visible: true,\n    },\n    {\n      name: \"downloadImage\",\n      tooltip: dictionary.downloadImage,\n      icon: DownloadIcon,\n      visible: !!fetch,\n      active: () => false,\n    },\n    {\n      name: \"replaceImage\",\n      tooltip: dictionary.replaceImage,\n      icon: ReplaceIcon,\n      visible: true,\n      active: () => false,\n    },\n    {\n      name: \"deleteImage\",\n      tooltip: dictionary.deleteImage,\n      icon: TrashIcon,\n      visible: true,\n      active: () => false,\n    },\n  ];\n}\n","import { PageBreakIcon, HorizontalRuleIcon } from \"outline-icons\";\nimport { EditorState } from \"prosemirror-state\";\nimport isNodeActive from \"@shared/editor/queries/isNodeActive\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function dividerMenuItems(\n  state: EditorState,\n  dictionary: Dictionary\n): MenuItem[] {\n  const { schema } = state;\n\n  return [\n    {\n      name: \"hr\",\n      tooltip: dictionary.pageBreak,\n      attrs: { markup: \"***\" },\n      active: isNodeActive(schema.nodes.hr, { markup: \"***\" }),\n      icon: PageBreakIcon,\n    },\n    {\n      name: \"hr\",\n      tooltip: dictionary.hr,\n      attrs: { markup: \"---\" },\n      active: isNodeActive(schema.nodes.hr, { markup: \"---\" }),\n      icon: HorizontalRuleIcon,\n    },\n  ];\n}\n","import {\n  BoldIcon,\n  CodeIcon,\n  Heading1Icon,\n  Heading2Icon,\n  BlockQuoteIcon,\n  LinkIcon,\n  StrikethroughIcon,\n  OrderedListIcon,\n  BulletedListIcon,\n  TodoListIcon,\n  InputIcon,\n  HighlightIcon,\n} from \"outline-icons\";\nimport { EditorState } from \"prosemirror-state\";\nimport { isInTable } from \"prosemirror-tables\";\nimport isInList from \"@shared/editor/queries/isInList\";\nimport isMarkActive from \"@shared/editor/queries/isMarkActive\";\nimport isNodeActive from \"@shared/editor/queries/isNodeActive\";\nimport { MenuItem } from \"@shared/editor/types\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\n\nexport default function formattingMenuItems(\n  state: EditorState,\n  isTemplate: boolean,\n  dictionary: Dictionary\n): MenuItem[] {\n  const { schema } = state;\n  const isTable = isInTable(state);\n  const isList = isInList(state);\n  const allowBlocks = !isTable && !isList;\n\n  return [\n    {\n      name: \"placeholder\",\n      tooltip: dictionary.placeholder,\n      icon: InputIcon,\n      active: isMarkActive(schema.marks.placeholder),\n      visible: isTemplate,\n    },\n    {\n      name: \"separator\",\n      visible: isTemplate,\n    },\n    {\n      name: \"strong\",\n      tooltip: dictionary.strong,\n      icon: BoldIcon,\n      active: isMarkActive(schema.marks.strong),\n    },\n    {\n      name: \"strikethrough\",\n      tooltip: dictionary.strikethrough,\n      icon: StrikethroughIcon,\n      active: isMarkActive(schema.marks.strikethrough),\n    },\n    {\n      name: \"highlight\",\n      tooltip: dictionary.mark,\n      icon: HighlightIcon,\n      active: isMarkActive(schema.marks.highlight),\n      visible: !isTemplate,\n    },\n    {\n      name: \"code_inline\",\n      tooltip: dictionary.codeInline,\n      icon: CodeIcon,\n      active: isMarkActive(schema.marks.code_inline),\n    },\n    {\n      name: \"separator\",\n      visible: allowBlocks,\n    },\n    {\n      name: \"heading\",\n      tooltip: dictionary.heading,\n      icon: Heading1Icon,\n      active: isNodeActive(schema.nodes.heading, { level: 1 }),\n      attrs: { level: 1 },\n      visible: allowBlocks,\n    },\n    {\n      name: \"heading\",\n      tooltip: dictionary.subheading,\n      icon: Heading2Icon,\n      active: isNodeActive(schema.nodes.heading, { level: 2 }),\n      attrs: { level: 2 },\n      visible: allowBlocks,\n    },\n    {\n      name: \"blockquote\",\n      tooltip: dictionary.quote,\n      icon: BlockQuoteIcon,\n      active: isNodeActive(schema.nodes.blockquote),\n      attrs: { level: 2 },\n      visible: allowBlocks,\n    },\n    {\n      name: \"separator\",\n      visible: allowBlocks || isList,\n    },\n    {\n      name: \"checkbox_list\",\n      tooltip: dictionary.checkboxList,\n      icon: TodoListIcon,\n      keywords: \"checklist checkbox task\",\n      active: isNodeActive(schema.nodes.checkbox_list),\n      visible: allowBlocks || isList,\n    },\n    {\n      name: \"bullet_list\",\n      tooltip: dictionary.bulletList,\n      icon: BulletedListIcon,\n      active: isNodeActive(schema.nodes.bullet_list),\n      visible: allowBlocks || isList,\n    },\n    {\n      name: \"ordered_list\",\n      tooltip: dictionary.orderedList,\n      icon: OrderedListIcon,\n      active: isNodeActive(schema.nodes.ordered_list),\n      visible: allowBlocks || isList,\n    },\n    {\n      name: \"separator\",\n    },\n    {\n      name: \"link\",\n      tooltip: dictionary.createLink,\n      icon: LinkIcon,\n      active: isMarkActive(schema.marks.link),\n      attrs: { href: \"\" },\n    },\n  ];\n}\n","/* eslint-disable no-irregular-whitespace */\nimport { lighten, transparentize } from \"polished\";\nimport styled from \"styled-components\";\n\nconst EditorStyles = styled.div<{\n  rtl: boolean;\n  readOnly?: boolean;\n  readOnlyWriteCheckboxes?: boolean;\n  grow?: boolean;\n}>`\n  flex-grow: ${(props) => (props.grow ? 1 : 0)};\n  justify-content: start;\n  color: ${(props) => props.theme.text};\n  font-family: ${(props) => props.theme.fontFamily};\n  font-weight: ${(props) => props.theme.fontWeight};\n  font-size: 1em;\n  line-height: 1.6em;\n  width: 100%;\n\n  > div {\n    background: transparent;\n  }\n\n  & * {\n    box-sizing: content-box;\n  }\n\n  .ProseMirror {\n    position: relative;\n    outline: none;\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    white-space: break-spaces;\n    -webkit-font-variant-ligatures: none;\n    font-variant-ligatures: none;\n    font-feature-settings: \"liga\" 0; /* the above doesn't seem to work in Edge */\n\n    & > .ProseMirror-yjs-cursor {\n      display: none;\n    }\n\n    & > * {\n      margin-top: .5em;\n      margin-bottom: .5em;\n    }\n\n    & > :first-child,\n    & > button:first-child + * {\n      margin-top: 0;\n    }\n\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-top: 1em;\n    }\n\n    h1 {\n      margin-top: .75em;\n      margin-bottom: 0.25em;\n    }\n\n    .ProseMirror-yjs-cursor {\n      position: relative;\n      margin-left: -1px;\n      margin-right: -1px;\n      border-left: 1px solid black;\n      border-right: 1px solid black;\n      height: 1em;\n      word-break: normal;\n\n      &:after {\n        content: \"\";\n        display: block;\n        position: absolute;\n        left: -8px;\n        right: -8px;\n        top: 0;\n        bottom: 0;\n      }\n      > div {\n        opacity: 0;\n        transition: opacity 100ms ease-in-out;\n        position: absolute;\n        top: -1.8em;\n        font-size: 13px;\n        background-color: rgb(250, 129, 0);\n        font-style: normal;\n        line-height: normal;\n        user-select: none;\n        white-space: nowrap;\n        color: white;\n        padding: 2px 6px;\n        font-weight: 500;\n        border-radius: 4px;\n        pointer-events: none;\n        left: -1px;\n      }\n\n      &:hover {\n        > div {\n          opacity: 1;\n        }\n      }\n    }\n  }\n\n  &.show-cursor-names .ProseMirror-yjs-cursor > div {\n    opacity: 1;\n  }\n\n  pre {\n    white-space: pre-wrap;\n  }\n\n  li {\n    position: relative;\n  }\n\n  .image {\n    line-height: 0;\n    text-align: center;\n    max-width: 100%;\n    clear: both;\n\n    img {\n      pointer-events: ${(props) => (props.readOnly ? \"initial\" : \"none\")};\n      display: inline-block;\n      max-width: 100%;\n      max-height: 75vh;\n    }\n\n    .ProseMirror-selectednode img {\n      pointer-events: initial;\n    }\n  }\n\n  .image.placeholder {\n    position: relative;\n    background: ${(props) => props.theme.background};\n    margin-bottom: calc(28px + 1.2em);\n\n    img {\n      opacity: 0.5;\n    }\n  }\n\n  .image-replacement-uploading {\n    img {\n      opacity: 0.5;\n    }\n  }\n\n  .image-right-50 {\n    float: right;\n    width: 50%;\n    margin-left: 2em;\n    margin-bottom: 1em;\n    clear: initial;\n  }\n\n  .image-left-50 {\n    float: left;\n    width: 50%;\n    margin-right: 2em;\n    margin-bottom: 1em;\n    clear: initial;\n  }\n\n  .ProseMirror-hideselection *::selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection *::-moz-selection {\n    background: transparent;\n  }\n  .ProseMirror-hideselection {\n    caret-color: transparent;\n  }\n\n  .ProseMirror-selectednode {\n    outline: 2px solid\n      ${(props) => (props.readOnly ? \"transparent\" : props.theme.selected)};\n  }\n\n  /* Make sure li selections wrap around markers */\n\n  li.ProseMirror-selectednode {\n    outline: none;\n  }\n\n  li.ProseMirror-selectednode:after {\n    content: \"\";\n    position: absolute;\n    left: ${(props) => (props.rtl ? \"-2px\" : \"-32px\")};\n    right: ${(props) => (props.rtl ? \"-32px\" : \"-2px\")};\n    top: -2px;\n    bottom: -2px;\n    border: 2px solid ${(props) => props.theme.selected};\n    pointer-events: none;\n  }\n\n  img.ProseMirror-separator {\n    display: inline;\n    border: none !important;\n    margin: 0 !important;\n  }\n\n  // Removes forced paragraph spaces below images, this is needed to images\n  // being inline nodes that are displayed like blocks\n  .component-image + img.ProseMirror-separator,\n  .component-image + img.ProseMirror-separator + br.ProseMirror-trailingBreak {\n    display: none;\n  }\n\n  .ProseMirror[contenteditable=\"false\"] {\n    .caption {\n      pointer-events: none;\n    }\n    .caption:empty {\n      visibility: hidden;\n    }\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-weight: 500;\n    cursor: text;\n\n    &:not(.placeholder):before {\n      display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n      font-family: ${(props) => props.theme.fontFamilyMono};\n      color: ${(props) => props.theme.textSecondary};\n      font-size: 13px;\n      line-height: 0;\n      margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -24px;\n      transition: opacity 150ms ease-in-out;\n      opacity: 0;\n      width: 24px;\n    }\n\n    &:hover,\n    &:focus-within {\n      .heading-actions {\n        opacity: 1;\n      }\n    }\n  }\n\n  .heading-content {\n    &:before {\n      content: \"\";\n      display: inline;\n    }\n  }\n\n  .heading-name {\n    color: ${(props) => props.theme.text};\n    pointer-events: none;\n    display: block;\n    position: relative;\n    top: -60px;\n    visibility: hidden;\n\n    &:hover {\n      text-decoration: none;\n    }\n  }\n\n  .heading-name:first-child,\n  .heading-name:first-child + .ProseMirror-yjs-cursor {\n    & + h1,\n    & + h2,\n    & + h3,\n    & + h4 {\n      margin-top: 0;\n    }\n  }\n\n  a:first-child {\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-top: 0;\n    }\n  }\n\n  h1:not(.placeholder):before {\n    content: \"H1\";\n  }\n  h2:not(.placeholder):before {\n    content: \"H2\";\n  }\n  h3:not(.placeholder):before {\n    content: \"H3\";\n  }\n  h4:not(.placeholder):before {\n    content: \"H4\";\n  }\n  h5:not(.placeholder):before {\n    content: \"H5\";\n  }\n  h6:not(.placeholder):before {\n    content: \"H6\";\n  }\n\n  .ProseMirror-focused {\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      &:not(.placeholder):before {\n        opacity: 1;\n      }\n    }\n  }\n\n  .with-emoji {\n    margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -1em;\n  }\n\n  .heading-anchor,\n  .heading-fold {\n    display: inline-block;\n    color: ${(props) => props.theme.text};\n    opacity: .75;\n    cursor: pointer;\n    background: none;\n    outline: none;\n    border: 0;\n    margin: 0;\n    padding: 0;\n    text-align: left;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 14px;\n    line-height: 0;\n    width: 12px;\n    height: 24px;\n\n    &:focus,\n    &:hover {\n      opacity: 1;\n    }\n  }\n\n  .heading-anchor {\n    box-sizing: border-box;\n  }\n\n  .heading-actions {\n    opacity: 0;\n    background: ${(props) => props.theme.background};\n    margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -26px;\n    flex-direction: ${(props) => (props.rtl ? \"row-reverse\" : \"row\")};\n    display: inline-flex;\n    position: relative;\n    top: -2px;\n    width: 26px;\n    height: 24px;\n\n    &.collapsed {\n      opacity: 1;\n    }\n\n    &.collapsed .heading-anchor {\n      opacity: 0;\n    }\n\n    &.collapsed .heading-fold {\n      opacity: 1;\n    }\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    &:hover {\n      .heading-anchor {\n        opacity: 0.75 !important;\n      }\n      .heading-anchor:hover {\n        opacity: 1 !important;\n      }\n    }\n  }\n\n  .heading-fold {\n    display: inline-block;\n    transform-origin: center;\n    padding: 0;\n\n    &.collapsed {\n      svg {\n        transform: rotate(${(props) => (props.rtl ? \"90deg\" : \"-90deg\")});\n      }\n      transition-delay: 0.1s;\n      opacity: 1;\n    }\n  }\n\n  .placeholder:before {\n    display: block;\n    opacity: 0;\n    transition: opacity 150ms ease-in-out;\n    content: ${(props) => (props.readOnly ? \"\" : \"attr(data-empty-text)\")};\n    pointer-events: none;\n    height: 0;\n    color: ${(props) => props.theme.placeholder};\n  }\n\n  /** Show the placeholder if focused or the first visible item nth(2) accounts for block insert trigger */\n  .ProseMirror-focused .placeholder:before,\n  .placeholder:nth-child(1):before,\n  .placeholder:nth-child(2):before {\n    opacity: 1;\n  }\n\n  .notice-block {\n    display: flex;\n    align-items: center;\n    background: ${(props) =>\n      transparentize(0.9, props.theme.noticeInfoBackground)};\n    border-left: 4px solid ${(props) => props.theme.noticeInfoBackground};\n    color: ${(props) => props.theme.noticeInfoText};\n    border-radius: 4px;\n    padding: 8px 10px 8px 8px;\n    margin: 8px 0;\n\n    a {\n      color: ${(props) => props.theme.noticeInfoText};\n    }\n\n    a:not(.heading-name) {\n      text-decoration: underline;\n    }\n\n    p:first-child {\n      margin-top: 0;\n    }\n\n    p:last-child {\n      margin-bottom: 0;\n    }\n  }\n\n  .notice-block .content {\n    flex-grow: 1;\n    min-width: 0;\n  }\n\n  .notice-block .icon {\n    width: 24px;\n    height: 24px;\n    align-self: flex-start;\n    margin-${(props) => (props.rtl ? \"left\" : \"right\")}: 4px;\n    color: ${(props) => props.theme.noticeInfoBackground};\n  }\n\n  .notice-block.tip {\n    background: ${(props) =>\n      transparentize(0.9, props.theme.noticeTipBackground)};\n    border-left: 4px solid ${(props) => props.theme.noticeTipBackground};\n    color: ${(props) => props.theme.noticeTipText};\n\n    .icon {\n      color: ${(props) => props.theme.noticeTipBackground};\n    }\n\n    a {\n      color: ${(props) => props.theme.noticeTipText};\n    }\n  }\n\n  .notice-block.warning {\n    background: ${(props) =>\n      transparentize(0.9, props.theme.noticeWarningBackground)};\n    border-left: 4px solid ${(props) => props.theme.noticeWarningBackground};\n    color: ${(props) => props.theme.noticeWarningText};\n\n    .icon {\n      color: ${(props) => props.theme.noticeWarningBackground};\n    }\n\n    a {\n      color: ${(props) => props.theme.noticeWarningText};\n    }\n  }\n\n  blockquote {\n    margin: 0;\n    padding-left: 1.5em;\n    font-style: italic;\n    overflow: hidden;\n    position: relative;\n\n    &:before {\n      content: \"\";\n      display: inline-block;\n      width: 2px;\n      border-radius: 1px;\n      position: absolute;\n      margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -1.5em;\n      top: 0;\n      bottom: 0;\n      background: ${(props) => props.theme.quote};\n    }\n  }\n\n  b,\n  strong {\n    font-weight: 600;\n  }\n\n  .template-placeholder {\n    color: ${(props) => props.theme.placeholder};\n    border-bottom: 1px dotted ${(props) => props.theme.placeholder};\n    border-radius: 2px;\n    cursor: text;\n\n    &:hover {\n      border-bottom: 1px dotted\n        ${(props) =>\n          props.readOnly ? props.theme.placeholder : props.theme.textSecondary};\n    }\n  }\n\n  p {\n    margin: 0;\n\n    span:first-child + br:last-child {\n      display: none;\n    }\n\n    a {\n      color: ${(props) => props.theme.text};\n      text-decoration: underline;\n      text-decoration-color: ${(props) => lighten(0.5, props.theme.text)};\n      text-decoration-thickness: 1px;\n      text-underline-offset: .15em;\n      font-weight: 500;\n\n      &:hover {\n        text-decoration: underline;\n        text-decoration-color: ${(props) => props.theme.text};\n        text-decoration-thickness: 1px;\n      }\n    }\n  }\n\n  a {\n    color: ${(props) => props.theme.link};\n    cursor: pointer;\n  }\n\n  .ProseMirror-focused {\n    a {\n      cursor: text;\n    }\n  }\n\n  a:hover {\n    text-decoration: ${(props) => (props.readOnly ? \"underline\" : \"none\")};\n  }\n\n  ul,\n  ol {\n    margin: ${(props) => (props.rtl ? \"0 -26px 0 0.1em\" : \"0 0.1em 0 -26px\")};\n    padding: ${(props) => (props.rtl ? \"0 44px 0 0\" : \"0 0 0 44px\")};\n  }\n\n  ol ol {\n    list-style: lower-alpha;\n  }\n\n  ol ol ol {\n    list-style: lower-roman;\n  }\n\n  ul.checkbox_list {\n    list-style: none;\n    padding: 0;\n    margin-left: ${(props) => (props.rtl ? \"0\" : \"-24px\")};\n    margin-right: ${(props) => (props.rtl ? \"-24px\" : \"0\")};\n  }\n\n  ul li,\n  ol li {\n    position: relative;\n    white-space: initial;\n\n    p {\n      white-space: pre-wrap;\n    }\n\n    > div {\n      width: 100%;\n    }\n  }\n\n  ul.checkbox_list li {\n    display: flex;\n    padding-${(props) => (props.rtl ? \"right\" : \"left\")}: 24px;\n  }\n\n  ul.checkbox_list li.checked > div > p {\n    color: ${(props) => props.theme.textSecondary};\n    text-decoration: line-through;\n  }\n\n  ul li::before,\n  ol li::before {\n    background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iOCIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iOCIgeT0iMTEiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+CjxyZWN0IHg9IjgiIHk9IjE1IiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iNyIgd2lkdGg9IjMiIGhlaWdodD0iMiIgcng9IjEiIGZpbGw9IiM0RTVDNkUiLz4KPHJlY3QgeD0iMTMiIHk9IjExIiB3aWR0aD0iMyIgaGVpZ2h0PSIyIiByeD0iMSIgZmlsbD0iIzRFNUM2RSIvPgo8cmVjdCB4PSIxMyIgeT0iMTUiIHdpZHRoPSIzIiBoZWlnaHQ9IjIiIHJ4PSIxIiBmaWxsPSIjNEU1QzZFIi8+Cjwvc3ZnPgo=\") no-repeat;\n    background-position: 0 2px;\n    content: \"\";\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline-block\")};\n    cursor: grab;\n    width: 24px;\n    height: 24px;\n    position: absolute;\n    ${(props) => (props.rtl ? \"right\" : \"left\")}: -40px;\n    opacity: 0;\n    transition: opacity 200ms ease-in-out;\n  }\n\n  ul li[draggable=true]::before,\n  ol li[draggable=true]::before {\n    cursor: grabbing;\n  }\n\n  ul > li.counter-2::before,\n  ol li.counter-2::before {\n    ${(props) => (props.rtl ? \"right\" : \"left\")}: -50px;\n  }\n\n  ul > li.hovering::before,\n  ol li.hovering::before {\n    opacity: 0.5;\n  }\n\n  ul li.ProseMirror-selectednode::after,\n  ol li.ProseMirror-selectednode::after {\n    display: none;\n  }\n\n  ul.checkbox_list li::before {\n    ${(props) => (props.rtl ? \"right\" : \"left\")}: 0;\n  }\n\n  ul.checkbox_list li .checkbox {\n    display: inline-block;\n    cursor: pointer;\n    pointer-events: ${(props) =>\n      props.readOnly && !props.readOnlyWriteCheckboxes ? \"none\" : \"initial\"};\n    opacity: ${(props) =>\n      props.readOnly && !props.readOnlyWriteCheckboxes ? 0.75 : 1};\n    margin: ${(props) => (props.rtl ? \"0 0 0 0.5em\" : \"0 0.5em 0 0\")};\n    width: 14px;\n    height: 14px;\n    position: relative;\n    top: 1px;\n    transition: transform 100ms ease-in-out;\n    opacity: .8;\n\n    background-image: ${(props) =>\n      `url(\"data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3 0C1.34315 0 0 1.34315 0 3V11C0 12.6569 1.34315 14 3 14H11C12.6569 14 14 12.6569 14 11V3C14 1.34315 12.6569 0 11 0H3ZM3 2C2.44772 2 2 2.44772 2 3V11C2 11.5523 2.44772 12 3 12H11C11.5523 12 12 11.5523 12 11V3C12 2.44772 11.5523 2 11 2H3Z' fill='${props.theme.text.replace(\n        \"#\",\n        \"%23\"\n      )}' /%3E%3C/svg%3E%0A\");`}\n\n    &[aria-checked=true] {\n      opacity: 1;\n      background-image: ${(props) =>\n        `url(\n          \"data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3 0C1.34315 0 0 1.34315 0 3V11C0 12.6569 1.34315 14 3 14H11C12.6569 14 14 12.6569 14 11V3C14 1.34315 12.6569 0 11 0H3ZM4.26825 5.85982L5.95873 7.88839L9.70003 2.9C10.0314 2.45817 10.6582 2.36863 11.1 2.7C11.5419 3.03137 11.6314 3.65817 11.3 4.1L6.80002 10.1C6.41275 10.6164 5.64501 10.636 5.2318 10.1402L2.7318 7.14018C2.37824 6.71591 2.43556 6.08534 2.85984 5.73178C3.28412 5.37821 3.91468 5.43554 4.26825 5.85982Z' fill='${props.theme.primary.replace(\n            \"#\",\n            \"%23\"\n          )}' /%3E%3C/svg%3E%0A\"\n        )`};\n    }\n\n    &:active {\n      transform: scale(0.9);\n    }\n  }\n\n  li p:first-child {\n    margin: 0;\n    word-break: break-word;\n  }\n\n  hr {\n    position: relative;\n    height: 1em;\n    border: 0;\n  }\n\n  hr:before {\n    content: \"\";\n    display: block;\n    position: absolute;\n    border-top: 1px solid ${(props) => props.theme.horizontalRule};\n    top: 0.5em;\n    left: 0;\n    right: 0;\n  }\n\n  hr.page-break {\n    page-break-after: always;\n  }\n\n  hr.page-break:before {\n    border-top: 1px dashed ${(props) => props.theme.horizontalRule};\n  }\n\n  code {\n    border-radius: 4px;\n    border: 1px solid ${(props) => props.theme.codeBorder};\n    background: ${(props) => props.theme.codeBackground};\n    padding: 3px 4px;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 80%;\n  }\n\n  mark {\n    border-radius: 1px;\n    color: ${(props) => props.theme.textHighlightForeground};\n    background: ${(props) => props.theme.textHighlight};\n\n    a {\n      color: ${(props) => props.theme.textHighlightForeground};\n    }\n  }\n\n  .external-link {\n    display: inline-block;\n    position: relative;\n    top: 2px;\n    width: 16px;\n    height: 16px;\n  }\n\n  .code-actions,\n  .notice-actions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    position: absolute;\n    z-index: 1;\n    top: 8px;\n    right: 8px;\n  }\n\n  .notice-actions {\n    ${(props) => (props.rtl ? \"left\" : \"right\")}: 8px;\n  }\n\n  .code-block,\n  .notice-block {\n    position: relative;\n\n    select,\n    button {\n      background: ${(props) => props.theme.background};\n      color: ${(props) => props.theme.text};\n      border-width: 1px;\n      font-size: 13px;\n      display: none;\n      border-radius: 4px;\n      padding: 2px 4px;\n      height: 18px;\n    }\n\n    button {\n      padding: 2px 4px;\n    }\n\n    &:hover {\n      select {\n        display: ${(props) => (props.readOnly ? \"none\" : \"inline\")};\n      }\n\n      button {\n        display: inline;\n      }\n    }\n\n    select:focus,\n    select:active,\n    button:focus,\n    button:active {\n      display: inline;\n    }\n  }\n\n  pre {\n    display: block;\n    overflow-x: auto;\n    padding: 0.75em 1em;\n    line-height: 1.4em;\n    position: relative;\n    background: ${(props) => props.theme.codeBackground};\n    border-radius: 4px;\n    border: 1px solid ${(props) => props.theme.codeBorder};\n    margin: .5em 0;\n\n    -webkit-font-smoothing: initial;\n    font-family: ${(props) => props.theme.fontFamilyMono};\n    font-size: 13px;\n    direction: ltr;\n    text-align: left;\n    white-space: pre;\n    word-spacing: normal;\n    word-break: normal;\n    -moz-tab-size: 4;\n    -o-tab-size: 4;\n    tab-size: 4;\n    -webkit-hyphens: none;\n    -moz-hyphens: none;\n    -ms-hyphens: none;\n    hyphens: none;\n    color: ${(props) => props.theme.code};\n\n    code {\n      font-size: 13px;\n      background: none;\n      padding: 0;\n      border: 0;\n    }\n  }\n\n  .token.comment,\n  .token.prolog,\n  .token.doctype,\n  .token.cdata {\n    color: ${(props) => props.theme.codeComment};\n  }\n\n  .token.punctuation {\n    color: ${(props) => props.theme.codePunctuation};\n  }\n\n  .token.namespace {\n    opacity: 0.7;\n  }\n\n  .token.operator,\n  .token.boolean,\n  .token.number {\n    color: ${(props) => props.theme.codeNumber};\n  }\n\n  .token.property {\n    color: ${(props) => props.theme.codeProperty};\n  }\n\n  .token.tag {\n    color: ${(props) => props.theme.codeTag};\n  }\n\n  .token.string {\n    color: ${(props) => props.theme.codeString};\n  }\n\n  .token.selector {\n    color: ${(props) => props.theme.codeSelector};\n  }\n\n  .token.attr-name {\n    color: ${(props) => props.theme.codeAttr};\n  }\n\n  .token.entity,\n  .token.url,\n  .language-css .token.string,\n  .style .token.string {\n    color: ${(props) => props.theme.codeEntity};\n  }\n\n  .token.attr-value,\n  .token.keyword,\n  .token.control,\n  .token.directive,\n  .token.unit {\n    color: ${(props) => props.theme.codeKeyword};\n  }\n\n  .token.function {\n    color: ${(props) => props.theme.codeFunction};\n  }\n\n  .token.statement,\n  .token.regex,\n  .token.atrule {\n    color: ${(props) => props.theme.codeStatement};\n  }\n\n  .token.placeholder,\n  .token.variable {\n    color: ${(props) => props.theme.codePlaceholder};\n  }\n\n  .token.deleted {\n    text-decoration: line-through;\n  }\n\n  .token.inserted {\n    border-bottom: 1px dotted ${(props) => props.theme.codeInserted};\n    text-decoration: none;\n  }\n\n  .token.italic {\n    font-style: italic;\n  }\n\n  .token.important,\n  .token.bold {\n    font-weight: bold;\n  }\n\n  .token.important {\n    color: ${(props) => props.theme.codeImportant};\n  }\n\n  .token.entity {\n    cursor: help;\n  }\n\n  table {\n    width: 100%;\n    border-collapse: collapse;\n    border-radius: 4px;\n    margin-top: 1em;\n    box-sizing: border-box;\n\n    * {\n      box-sizing: border-box;\n    }\n\n    tr {\n      position: relative;\n      border-bottom: 1px solid ${(props) => props.theme.tableDivider};\n    }\n\n    th {\n      background: ${(props) => props.theme.tableHeaderBackground};\n    }\n\n    td,\n    th {\n      position: relative;\n      vertical-align: top;\n      border: 1px solid ${(props) => props.theme.tableDivider};\n      position: relative;\n      padding: 4px 8px;\n      text-align: ${(props) => (props.rtl ? \"right\" : \"left\")};\n      min-width: 100px;\n    }\n\n    .selectedCell {\n      background: ${(props) =>\n        props.readOnly ? \"inherit\" : props.theme.tableSelectedBackground};\n\n      /* fixes Firefox background color painting over border:\n       * https://bugzilla.mozilla.org/show_bug.cgi?id=688556 */\n      background-clip: padding-box;\n    }\n\n    .grip-column {\n      /* usage of ::after for all of the table grips works around a bug in\n       * prosemirror-tables that causes Safari to hang when selecting a cell\n       * in an empty table:\n       * https://github.com/ProseMirror/prosemirror/issues/947 */\n      &::after {\n        content: \"\";\n        cursor: pointer;\n        position: absolute;\n        top: -16px;\n        ${(props) => (props.rtl ? \"right\" : \"left\")}: 0;\n        width: 100%;\n        height: 12px;\n        background: ${(props) => props.theme.tableDivider};\n        border-bottom: 3px solid ${(props) => props.theme.background};\n        display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      }\n\n      &:hover::after {\n        background: ${(props) => props.theme.text};\n      }\n      &.first::after {\n        border-top-${(props) => (props.rtl ? \"right\" : \"left\")}-radius: 3px;\n      }\n      &.last::after {\n        border-top-${(props) => (props.rtl ? \"left\" : \"right\")}-radius: 3px;\n      }\n      &.selected::after {\n        background: ${(props) => props.theme.tableSelected};\n      }\n    }\n\n    .grip-row {\n      &::after {\n        content: \"\";\n        cursor: pointer;\n        position: absolute;\n        ${(props) => (props.rtl ? \"right\" : \"left\")}: -16px;\n        top: 0;\n        height: 100%;\n        width: 12px;\n        background: ${(props) => props.theme.tableDivider};\n        border-${(props) => (props.rtl ? \"left\" : \"right\")}: 3px solid;\n        border-color: ${(props) => props.theme.background};\n        display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      }\n\n      &:hover::after {\n        background: ${(props) => props.theme.text};\n      }\n      &.first::after {\n        border-top-${(props) => (props.rtl ? \"right\" : \"left\")}-radius: 3px;\n      }\n      &.last::after {\n        border-bottom-${(props) => (props.rtl ? \"right\" : \"left\")}-radius: 3px;\n      }\n      &.selected::after {\n        background: ${(props) => props.theme.tableSelected};\n      }\n    }\n\n    .grip-table {\n      &::after {\n        content: \"\";\n        cursor: pointer;\n        background: ${(props) => props.theme.tableDivider};\n        width: 13px;\n        height: 13px;\n        border-radius: 13px;\n        border: 2px solid ${(props) => props.theme.background};\n        position: absolute;\n        top: -18px;\n        ${(props) => (props.rtl ? \"right\" : \"left\")}: -18px;\n        display: ${(props) => (props.readOnly ? \"none\" : \"block\")};\n      }\n\n      &:hover::after {\n        background: ${(props) => props.theme.text};\n      }\n      &.selected::after {\n        background: ${(props) => props.theme.tableSelected};\n      }\n    }\n  }\n\n  .scrollable-wrapper {\n    position: relative;\n    margin: 0.5em 0px;\n    scrollbar-width: thin;\n    scrollbar-color: transparent transparent;\n\n    &:hover {\n      scrollbar-color: ${(props) => props.theme.scrollbarThumb} ${(props) =>\n  props.theme.scrollbarBackground};\n    }\n\n    & ::-webkit-scrollbar {\n      height: 14px;\n      background-color: transparent;\n    }\n\n    &:hover ::-webkit-scrollbar {\n      background-color: ${(props) => props.theme.scrollbarBackground};\n    }\n\n    & ::-webkit-scrollbar-thumb {\n      background-color: transparent;\n      border: 3px solid transparent;\n      border-radius: 7px;\n    }\n\n    &:hover ::-webkit-scrollbar-thumb {\n      background-color: ${(props) => props.theme.scrollbarThumb};\n      border-color: ${(props) => props.theme.scrollbarBackground};\n    }\n  }\n\n  .scrollable {\n    overflow-y: hidden;\n    overflow-x: auto;\n    padding-${(props) => (props.rtl ? \"right\" : \"left\")}: 1em;\n    margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -1em;\n    border-${(props) => (props.rtl ? \"right\" : \"left\")}: 1px solid transparent;\n    border-${(props) => (props.rtl ? \"left\" : \"right\")}: 1px solid transparent;\n    transition: border 250ms ease-in-out 0s;\n  }\n\n  .scrollable-shadow {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    ${(props) => (props.rtl ? \"right\" : \"left\")}: -1em;\n    width: 16px;\n    transition: box-shadow 250ms ease-in-out;\n    border: 0px solid transparent;\n    border-${(props) => (props.rtl ? \"right\" : \"left\")}-width: 1em;\n    pointer-events: none;\n\n    &.left {\n      box-shadow: 16px 0 16px -16px inset rgba(0, 0, 0, 0.25);\n      border-left: 1em solid ${(props) => props.theme.background};\n    }\n\n    &.right {\n      right: 0;\n      left: auto;\n      box-shadow: -16px 0 16px -16px inset rgba(0, 0, 0, 0.25);\n    }\n  }\n\n  .block-menu-trigger {\n    opacity: 0;\n    pointer-events: none;\n    display: ${(props) => (props.readOnly ? \"none\" : \"inline\")};\n    width: 24px;\n    height: 24px;\n    color: ${(props) => props.theme.textSecondary};\n    background: none;\n    position: absolute;\n    transition: color 150ms cubic-bezier(0.175, 0.885, 0.32, 1.275),\n      opacity 150ms ease-in-out;\n    outline: none;\n    border: 0;\n    padding: 0;\n    margin-top: 1px;\n    margin-${(props) => (props.rtl ? \"right\" : \"left\")}: -28px;\n    border-radius: 4px;\n\n    &:hover,\n    &:focus {\n      cursor: pointer;\n      color: ${(props) => props.theme.text};\n      background: ${(props) => props.theme.secondaryBackground};\n    }\n  }\n\n  .ProseMirror-focused .block-menu-trigger,\n  .block-menu-trigger:active,\n  .block-menu-trigger:focus {\n    opacity: 1;\n    pointer-events: initial;\n  }\n\n  .ProseMirror-gapcursor {\n    display: none;\n    pointer-events: none;\n    position: absolute;\n  }\n\n  .ProseMirror-gapcursor:after {\n    content: \"\";\n    display: block;\n    position: absolute;\n    top: -2px;\n    width: 20px;\n    border-top: 1px solid ${(props) => props.theme.cursor};\n    animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n  }\n\n  .folded-content {\n    display: none;\n  }\n\n  @keyframes ProseMirror-cursor-blink {\n    to {\n      visibility: hidden;\n    }\n  }\n\n  .ProseMirror-focused .ProseMirror-gapcursor {\n    display: block;\n  }\n\n  @media print {\n    .placeholder:before,\n    .block-menu-trigger,\n    .heading-actions,\n    h1:not(.placeholder):before,\n    h2:not(.placeholder):before,\n    h3:not(.placeholder):before,\n    h4:not(.placeholder):before,\n    h5:not(.placeholder):before,\n    h6:not(.placeholder):before {\n      display: none;\n    }\n\n    .page-break {\n      opacity: 0;\n    }\n\n    em,\n    blockquote {\n      font-family: \"SF Pro Text\", ${(props) => props.theme.fontFamily};\n    }\n  }\n`;\n\nexport default EditorStyles;\n","import * as React from \"react\";\nimport { DefaultTheme, useTheme } from \"styled-components\";\n\ntype Props = {\n  children: (theme: DefaultTheme) => React.ReactElement;\n};\n\nexport default function WithTheme({ children }: Props) {\n  const theme = useTheme();\n  return children(theme);\n}\n","/* global File Promise */\nimport { PluginSimple } from \"markdown-it\";\nimport { baseKeymap } from \"prosemirror-commands\";\nimport { dropCursor } from \"prosemirror-dropcursor\";\nimport { gapCursor } from \"prosemirror-gapcursor\";\nimport { inputRules, InputRule } from \"prosemirror-inputrules\";\nimport { keymap } from \"prosemirror-keymap\";\nimport { MarkdownParser } from \"prosemirror-markdown\";\nimport {\n  Schema,\n  NodeSpec,\n  MarkSpec,\n  Node as ProsemirrorNode,\n} from \"prosemirror-model\";\nimport { EditorState, Selection, Plugin, Transaction } from \"prosemirror-state\";\nimport { Decoration, EditorView } from \"prosemirror-view\";\nimport * as React from \"react\";\nimport { DefaultTheme, ThemeProps } from \"styled-components\";\nimport Extension, { CommandFactory } from \"@shared/editor/lib/Extension\";\nimport ExtensionManager from \"@shared/editor/lib/ExtensionManager\";\nimport getHeadings from \"@shared/editor/lib/getHeadings\";\nimport getTasks from \"@shared/editor/lib/getTasks\";\nimport { MarkdownSerializer } from \"@shared/editor/lib/markdown/serializer\";\nimport Mark from \"@shared/editor/marks/Mark\";\nimport Node from \"@shared/editor/nodes/Node\";\nimport ReactNode from \"@shared/editor/nodes/ReactNode\";\nimport fullExtensionsPackage from \"@shared/editor/packages/full\";\nimport { EmbedDescriptor, EventType } from \"@shared/editor/types\";\nimport EventEmitter from \"@shared/utils/events\";\nimport Flex from \"~/components/Flex\";\nimport { Dictionary } from \"~/hooks/useDictionary\";\nimport Logger from \"~/utils/Logger\";\nimport BlockMenu from \"./components/BlockMenu\";\nimport ComponentView from \"./components/ComponentView\";\nimport EditorContext from \"./components/EditorContext\";\nimport EmojiMenu from \"./components/EmojiMenu\";\nimport { SearchResult } from \"./components/LinkEditor\";\nimport LinkToolbar from \"./components/LinkToolbar\";\nimport SelectionToolbar from \"./components/SelectionToolbar\";\nimport EditorContainer from \"./components/Styles\";\nimport WithTheme from \"./components/WithTheme\";\n\nexport { default as Extension } from \"@shared/editor/lib/Extension\";\n\nexport type Props = {\n  /** An optional identifier for the editor context. It is used to persist local settings */\n  id?: string;\n  /** The editor content, should only be changed if you wish to reset the content */\n  value?: string;\n  /** The initial editor content */\n  defaultValue: string;\n  /** Placeholder displayed when the editor is empty */\n  placeholder: string;\n  /** Extensions to load into the editor */\n  extensions?: (typeof Node | typeof Mark | typeof Extension | Extension)[];\n  /** If the editor should be focused on mount */\n  autoFocus?: boolean;\n  /** If the editor should not allow editing */\n  readOnly?: boolean;\n  /** If the editor should still allow editing checkboxes when it is readOnly */\n  readOnlyWriteCheckboxes?: boolean;\n  /** A dictionary of translated strings used in the editor */\n  dictionary: Dictionary;\n  /** The reading direction of the text content, if known */\n  dir?: \"rtl\" | \"ltr\";\n  /** If the editor should vertically grow to fill available space */\n  grow?: boolean;\n  /** If the editor should display template options such as inserting placeholders */\n  template?: boolean;\n  /** An enforced maximum content length */\n  maxLength?: number;\n  /** Heading id to scroll to when the editor has loaded */\n  scrollTo?: string;\n  /** Callback for handling uploaded images, should return the url of uploaded file */\n  uploadFile?: (file: File) => Promise<string>;\n  /** Callback when editor is blurred, as native input */\n  onBlur?: () => void;\n  /** Callback when editor is focused, as native input */\n  onFocus?: () => void;\n  /** Callback when user uses save key combo */\n  onSave?: (options: { done: boolean }) => void;\n  /** Callback when user uses cancel key combo */\n  onCancel?: () => void;\n  /** Callback when user changes editor content */\n  onChange?: (value: () => string | undefined) => void;\n  /** Callback when a file upload begins */\n  onFileUploadStart?: () => void;\n  /** Callback when a file upload ends */\n  onFileUploadStop?: () => void;\n  /** Callback when a link is created, should return url to created document */\n  onCreateLink?: (title: string) => Promise<string>;\n  /** Callback when user searches for documents from link insert interface */\n  onSearchLink?: (term: string) => Promise<SearchResult[]>;\n  /** Callback when user clicks on any link in the document */\n  onClickLink: (\n    href: string,\n    event: MouseEvent | React.MouseEvent<HTMLButtonElement>\n  ) => void;\n  /** Callback when user hovers on any link in the document */\n  onHoverLink?: (event: MouseEvent) => boolean;\n  /** Callback when user clicks on any hashtag in the document */\n  onClickHashtag?: (tag: string, event: MouseEvent) => void;\n  /** Callback when user presses any key with document focused */\n  onKeyDown?: (event: React.KeyboardEvent<HTMLDivElement>) => void;\n  /** Collection of embed types to render in the document */\n  embeds: EmbedDescriptor[];\n  /** Whether embeds should be rendered without an iframe */\n  embedsDisabled?: boolean;\n  /** Callback when a toast message is triggered (eg \"link copied\") */\n  onShowToast: (message: string) => void;\n  className?: string;\n  style?: React.CSSProperties;\n};\n\ntype State = {\n  /** If the document text has been detected as using RTL script */\n  isRTL: boolean;\n  /** If the editor is currently focused */\n  isEditorFocused: boolean;\n  /** If the toolbar for a text selection is visible */\n  selectionMenuOpen: boolean;\n  /** If the block insert menu is visible (triggered with /) */\n  blockMenuOpen: boolean;\n  /** If the insert link toolbar is visible */\n  linkMenuOpen: boolean;\n  /** The search term currently filtering the block menu */\n  blockMenuSearch: string;\n  /** If the emoji insert menu is visible */\n  emojiMenuOpen: boolean;\n};\n\n/**\n * The shared editor at the root of all rich editable text in Outline. Do not\n * use this component directly, it should by lazy loaded. Use\n * ~/components/Editor instead.\n */\nexport class Editor extends React.PureComponent<\n  Props & ThemeProps<DefaultTheme>,\n  State\n> {\n  static defaultProps = {\n    defaultValue: \"\",\n    dir: \"auto\",\n    placeholder: \"Write something nice\",\n    onFileUploadStart: () => {\n      // no default behavior\n    },\n    onFileUploadStop: () => {\n      // no default behavior\n    },\n    embeds: [],\n    extensions: fullExtensionsPackage,\n  };\n\n  state = {\n    isRTL: false,\n    isEditorFocused: false,\n    selectionMenuOpen: false,\n    blockMenuOpen: false,\n    linkMenuOpen: false,\n    blockMenuSearch: \"\",\n    emojiMenuOpen: false,\n  };\n\n  isBlurred: boolean;\n  extensions: ExtensionManager;\n  element = React.createRef<HTMLDivElement>();\n  view: EditorView;\n  schema: Schema;\n  serializer: MarkdownSerializer;\n  parser: MarkdownParser;\n  pasteParser: MarkdownParser;\n  plugins: Plugin[];\n  keymaps: Plugin[];\n  inputRules: InputRule[];\n  nodeViews: {\n    [name: string]: (\n      node: ProsemirrorNode,\n      view: EditorView,\n      getPos: () => number,\n      decorations: Decoration<{\n        [key: string]: any;\n      }>[]\n    ) => ComponentView;\n  };\n\n  nodes: { [name: string]: NodeSpec };\n  marks: { [name: string]: MarkSpec };\n  commands: Record<string, CommandFactory>;\n  rulePlugins: PluginSimple[];\n  events = new EventEmitter();\n\n  public constructor(props: Props & ThemeProps<DefaultTheme>) {\n    super(props);\n    this.events.on(EventType.linkMenuOpen, this.handleOpenLinkMenu);\n    this.events.on(EventType.linkMenuClose, this.handleCloseLinkMenu);\n    this.events.on(EventType.blockMenuOpen, this.handleOpenBlockMenu);\n    this.events.on(EventType.blockMenuClose, this.handleCloseBlockMenu);\n    this.events.on(EventType.emojiMenuOpen, this.handleOpenEmojiMenu);\n    this.events.on(EventType.emojiMenuClose, this.handleCloseEmojiMenu);\n  }\n\n  /**\n   * We use componentDidMount instead of constructor as the init method requires\n   * that the dom is already mounted.\n   */\n  public componentDidMount() {\n    this.init();\n\n    if (this.props.scrollTo) {\n      this.scrollToAnchor(this.props.scrollTo);\n    }\n\n    this.calculateDir();\n\n    if (this.props.readOnly) {\n      return;\n    }\n\n    if (this.props.autoFocus) {\n      this.focusAtEnd();\n    }\n  }\n\n  public componentDidUpdate(prevProps: Props) {\n    // Allow changes to the 'value' prop to update the editor from outside\n    if (this.props.value && prevProps.value !== this.props.value) {\n      const newState = this.createState(this.props.value);\n      this.view.updateState(newState);\n    }\n\n    // pass readOnly changes through to underlying editor instance\n    if (prevProps.readOnly !== this.props.readOnly) {\n      this.view.update({\n        ...this.view.props,\n        editable: () => !this.props.readOnly,\n      });\n    }\n\n    if (this.props.scrollTo && this.props.scrollTo !== prevProps.scrollTo) {\n      this.scrollToAnchor(this.props.scrollTo);\n    }\n\n    // Focus at the end of the document if switching from readOnly and autoFocus\n    // is set to true\n    if (prevProps.readOnly && !this.props.readOnly && this.props.autoFocus) {\n      this.focusAtEnd();\n    }\n\n    if (prevProps.dir !== this.props.dir) {\n      this.calculateDir();\n    }\n\n    if (\n      !this.isBlurred &&\n      !this.state.isEditorFocused &&\n      !this.state.blockMenuOpen &&\n      !this.state.linkMenuOpen &&\n      !this.state.selectionMenuOpen\n    ) {\n      this.isBlurred = true;\n      this.props.onBlur?.();\n    }\n\n    if (\n      this.isBlurred &&\n      (this.state.isEditorFocused ||\n        this.state.blockMenuOpen ||\n        this.state.linkMenuOpen ||\n        this.state.selectionMenuOpen)\n    ) {\n      this.isBlurred = false;\n      this.props.onFocus?.();\n    }\n  }\n\n  private init() {\n    this.extensions = this.createExtensions();\n    this.nodes = this.createNodes();\n    this.marks = this.createMarks();\n    this.schema = this.createSchema();\n    this.plugins = this.createPlugins();\n    this.rulePlugins = this.createRulePlugins();\n    this.keymaps = this.createKeymaps();\n    this.serializer = this.createSerializer();\n    this.parser = this.createParser();\n    this.pasteParser = this.createPasteParser();\n    this.inputRules = this.createInputRules();\n    this.nodeViews = this.createNodeViews();\n    this.view = this.createView();\n    this.commands = this.createCommands();\n  }\n\n  private createExtensions() {\n    return new ExtensionManager(this.props.extensions, this);\n  }\n\n  private createPlugins() {\n    return this.extensions.plugins;\n  }\n\n  private createRulePlugins() {\n    return this.extensions.rulePlugins;\n  }\n\n  private createKeymaps() {\n    return this.extensions.keymaps({\n      schema: this.schema,\n    });\n  }\n\n  private createInputRules() {\n    return this.extensions.inputRules({\n      schema: this.schema,\n    });\n  }\n\n  private createNodeViews() {\n    return this.extensions.extensions\n      .filter((extension: ReactNode) => extension.component)\n      .reduce((nodeViews, extension: ReactNode) => {\n        const nodeView = (\n          node: ProsemirrorNode,\n          view: EditorView,\n          getPos: () => number,\n          decorations: Decoration<{\n            [key: string]: any;\n          }>[]\n        ) => {\n          return new ComponentView(extension.component, {\n            editor: this,\n            extension,\n            node,\n            view,\n            getPos,\n            decorations,\n          });\n        };\n\n        return {\n          ...nodeViews,\n          [extension.name]: nodeView,\n        };\n      }, {});\n  }\n\n  private createCommands() {\n    return this.extensions.commands({\n      schema: this.schema,\n      view: this.view,\n    });\n  }\n\n  private createNodes() {\n    return this.extensions.nodes;\n  }\n\n  private createMarks() {\n    return this.extensions.marks;\n  }\n\n  private createSchema() {\n    return new Schema({\n      nodes: this.nodes,\n      marks: this.marks,\n    });\n  }\n\n  private createSerializer() {\n    return this.extensions.serializer();\n  }\n\n  private createParser() {\n    return this.extensions.parser({\n      schema: this.schema,\n      plugins: this.rulePlugins,\n    });\n  }\n\n  private createPasteParser() {\n    return this.extensions.parser({\n      schema: this.schema,\n      rules: { linkify: true, emoji: false },\n      plugins: this.rulePlugins,\n    });\n  }\n\n  private createState(value?: string) {\n    const doc = this.createDocument(value || this.props.defaultValue);\n\n    return EditorState.create({\n      schema: this.schema,\n      doc,\n      plugins: [\n        ...this.plugins,\n        ...this.keymaps,\n        dropCursor({ color: this.props.theme.cursor }),\n        gapCursor(),\n        inputRules({\n          rules: this.inputRules,\n        }),\n        keymap(baseKeymap),\n      ],\n    });\n  }\n\n  private createDocument(content: string) {\n    return this.parser.parse(content);\n  }\n\n  private createView() {\n    if (!this.element.current) {\n      throw new Error(\"createView called before ref available\");\n    }\n\n    const isEditingCheckbox = (tr: Transaction) => {\n      return tr.steps.some(\n        (step: any) =>\n          step.slice?.content?.firstChild?.type.name ===\n          this.schema.nodes.checkbox_item.name\n      );\n    };\n\n    const self = this; // eslint-disable-line\n    const view = new EditorView(this.element.current, {\n      handleDOMEvents: {\n        blur: this.handleEditorBlur,\n        focus: this.handleEditorFocus,\n      },\n      state: this.createState(this.props.value),\n      editable: () => !this.props.readOnly,\n      nodeViews: this.nodeViews,\n      dispatchTransaction: function (transaction) {\n        // callback is bound to have the view instance as its this binding\n        const { state, transactions } = this.state.applyTransaction(\n          transaction\n        );\n\n        this.updateState(state);\n\n        // If any of the transactions being dispatched resulted in the doc\n        // changing then call our own change handler to let the outside world\n        // know\n        if (\n          transactions.some((tr) => tr.docChanged) &&\n          (!self.props.readOnly ||\n            (self.props.readOnlyWriteCheckboxes &&\n              transactions.some(isEditingCheckbox)))\n        ) {\n          self.handleChange();\n        }\n\n        self.calculateDir();\n\n        // Because Prosemirror and React are not linked we must tell React that\n        // a render is needed whenever the Prosemirror state changes.\n        self.forceUpdate();\n      },\n    });\n\n    // Tell third-party libraries and screen-readers that this is an input\n    view.dom.setAttribute(\"role\", \"textbox\");\n\n    return view;\n  }\n\n  public scrollToAnchor(hash: string) {\n    if (!hash) {\n      return;\n    }\n\n    try {\n      const element = document.querySelector(hash);\n      if (element) {\n        setTimeout(() => element.scrollIntoView({ behavior: \"smooth\" }), 0);\n      }\n    } catch (err) {\n      // querySelector will throw an error if the hash begins with a number\n      // or contains a period. This is protected against now by safeSlugify\n      // however previous links may be in the wild.\n      Logger.debug(\"editor\", `Attempted to scroll to invalid hash: ${hash}`);\n    }\n  }\n\n  private calculateDir = () => {\n    if (!this.element.current) {\n      return;\n    }\n\n    const isRTL =\n      this.props.dir === \"rtl\" ||\n      getComputedStyle(this.element.current).direction === \"rtl\";\n\n    if (this.state.isRTL !== isRTL) {\n      this.setState({ isRTL });\n    }\n  };\n\n  public value = (): string => {\n    return this.serializer.serialize(this.view.state.doc);\n  };\n\n  private handleChange = () => {\n    if (!this.props.onChange) {\n      return;\n    }\n\n    this.props.onChange(() => {\n      return this.view ? this.value() : undefined;\n    });\n  };\n\n  private handleEditorBlur = () => {\n    this.setState({ isEditorFocused: false });\n    return false;\n  };\n\n  private handleEditorFocus = () => {\n    this.setState({ isEditorFocused: true });\n    return false;\n  };\n\n  private handleOpenSelectionMenu = () => {\n    this.setState({ blockMenuOpen: false, selectionMenuOpen: true });\n  };\n\n  private handleCloseSelectionMenu = () => {\n    if (!this.state.selectionMenuOpen) {\n      return;\n    }\n    this.setState({ selectionMenuOpen: false });\n  };\n\n  private handleOpenEmojiMenu = (search: string) => {\n    this.setState({ emojiMenuOpen: true, blockMenuSearch: search });\n  };\n\n  private handleCloseEmojiMenu = () => {\n    if (!this.state.emojiMenuOpen) {\n      return;\n    }\n    this.setState({ emojiMenuOpen: false });\n  };\n\n  private handleOpenLinkMenu = () => {\n    this.setState({ blockMenuOpen: false, linkMenuOpen: true });\n  };\n\n  private handleCloseLinkMenu = () => {\n    this.setState({ linkMenuOpen: false });\n  };\n\n  private handleOpenBlockMenu = (search: string) => {\n    this.setState({ blockMenuOpen: true, blockMenuSearch: search });\n  };\n\n  private handleCloseBlockMenu = () => {\n    if (!this.state.blockMenuOpen) {\n      return;\n    }\n    this.setState({ blockMenuOpen: false });\n  };\n\n  public focusAtStart = () => {\n    const selection = Selection.atStart(this.view.state.doc);\n    const transaction = this.view.state.tr.setSelection(selection);\n    this.view.dispatch(transaction);\n    this.view.focus();\n  };\n\n  public focusAtEnd = () => {\n    const selection = Selection.atEnd(this.view.state.doc);\n    const transaction = this.view.state.tr.setSelection(selection);\n    this.view.dispatch(transaction);\n    this.view.focus();\n  };\n\n  public getHeadings = () => {\n    return getHeadings(this.view.state.doc);\n  };\n\n  public getTasks = () => {\n    return getTasks(this.view.state.doc);\n  };\n\n  public render() {\n    const {\n      dir,\n      readOnly,\n      readOnlyWriteCheckboxes,\n      grow,\n      style,\n      className,\n      dictionary,\n      onKeyDown,\n    } = this.props;\n    const { isRTL } = this.state;\n\n    return (\n      <EditorContext.Provider value={this}>\n        <Flex\n          onKeyDown={onKeyDown}\n          style={style}\n          className={className}\n          align=\"flex-start\"\n          justify=\"center\"\n          dir={dir}\n          column\n        >\n          <EditorContainer\n            dir={dir}\n            rtl={isRTL}\n            grow={grow}\n            readOnly={readOnly}\n            readOnlyWriteCheckboxes={readOnlyWriteCheckboxes}\n            ref={this.element}\n          />\n          {!readOnly && this.view && (\n            <>\n              <SelectionToolbar\n                view={this.view}\n                dictionary={dictionary}\n                commands={this.commands}\n                rtl={isRTL}\n                isTemplate={this.props.template === true}\n                onOpen={this.handleOpenSelectionMenu}\n                onClose={this.handleCloseSelectionMenu}\n                onSearchLink={this.props.onSearchLink}\n                onClickLink={this.props.onClickLink}\n                onCreateLink={this.props.onCreateLink}\n                onShowToast={this.props.onShowToast}\n              />\n              <LinkToolbar\n                view={this.view}\n                dictionary={dictionary}\n                isActive={this.state.linkMenuOpen}\n                onCreateLink={this.props.onCreateLink}\n                onSearchLink={this.props.onSearchLink}\n                onClickLink={this.props.onClickLink}\n                onShowToast={this.props.onShowToast}\n                onClose={this.handleCloseLinkMenu}\n              />\n              <EmojiMenu\n                view={this.view}\n                commands={this.commands}\n                dictionary={dictionary}\n                rtl={isRTL}\n                onShowToast={this.props.onShowToast}\n                isActive={this.state.emojiMenuOpen}\n                search={this.state.blockMenuSearch}\n                onClose={this.handleCloseEmojiMenu}\n              />\n              <BlockMenu\n                view={this.view}\n                commands={this.commands}\n                dictionary={dictionary}\n                rtl={isRTL}\n                isActive={this.state.blockMenuOpen}\n                search={this.state.blockMenuSearch}\n                onClose={this.handleCloseBlockMenu}\n                uploadFile={this.props.uploadFile}\n                onLinkToolbarOpen={this.handleOpenLinkMenu}\n                onFileUploadStart={this.props.onFileUploadStart}\n                onFileUploadStop={this.props.onFileUploadStop}\n                onShowToast={this.props.onShowToast}\n                embeds={this.props.embeds}\n              />\n            </>\n          )}\n        </Flex>\n      </EditorContext.Provider>\n    );\n  }\n}\n\nconst LazyLoadedEditor = React.forwardRef<Editor, Props>(\n  (props: Props, ref) => {\n    return (\n      <WithTheme>\n        {(theme) => <Editor theme={theme} {...props} ref={ref} />}\n      </WithTheme>\n    );\n  }\n);\n\nexport default LazyLoadedEditor;\n","import { Node } from \"prosemirror-model\";\nimport headingToSlug from \"./headingToSlug\";\n\nexport type Heading = {\n  title: string;\n  level: number;\n  id: string;\n};\n\n/**\n * Iterates through the document to find all of the headings and their level.\n *\n * @param doc Prosemirror document node\n * @returns Array<Heading>\n */\nexport default function getHeadings(doc: Node) {\n  const headings: Heading[] = [];\n  const previouslySeen = {};\n\n  doc.forEach((node) => {\n    if (node.type.name === \"heading\") {\n      // calculate the optimal id\n      const id = headingToSlug(node);\n      let name = id;\n\n      // check if we've already used it, and if so how many times?\n      // Make the new id based on that number ensuring that we have\n      // unique ID's even when headings are identical\n      if (previouslySeen[id] > 0) {\n        name = headingToSlug(node, previouslySeen[id]);\n      }\n\n      // record that we've seen this id for the next loop\n      previouslySeen[id] =\n        previouslySeen[id] !== undefined ? previouslySeen[id] + 1 : 1;\n\n      headings.push({\n        title: node.textContent,\n        level: node.attrs.level,\n        id: name,\n      });\n    }\n  });\n  return headings;\n}\n","import { Node } from \"prosemirror-model\";\n\nexport type Task = {\n  text: string;\n  completed: boolean;\n};\n\n/**\n * Iterates through the document to find all of the tasks and their completion\n * state.\n *\n * @param doc Prosemirror document node\n * @returns Array<Task>\n */\nexport default function getTasks(doc: Node): Task[] {\n  const tasks: Task[] = [];\n\n  doc.descendants((node) => {\n    if (!node.isBlock) {\n      return false;\n    }\n\n    if (node.type.name === \"checkbox_list\") {\n      node.content.forEach((listItem) => {\n        let text = \"\";\n\n        listItem.forEach((contentNode) => {\n          if (contentNode.type.name === \"paragraph\") {\n            text += contentNode.textContent;\n          }\n        });\n\n        tasks.push({\n          text,\n          completed: listItem.attrs.checked,\n        });\n      });\n    }\n\n    return true;\n  });\n\n  return tasks;\n}\n"],"sourceRoot":""}
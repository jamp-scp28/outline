(window.webpackJsonp=window.webpackJsonp||[]).push([["document"],{Wa2q:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return DocumentScene}));r("rB9j"),r("Rm1S"),r("EnZy"),r("oVuX"),r("tkto"),r("yXV3"),r("pNMO"),r("zKZe");var n=r("q1tI"),o=r("SJh+"),i=r("1RBS"),a=(r("07d7"),r("FZtP"),r("E9XD"),r("+2oP"),r("ExoC"),r("NBAS"),r("SuFq"),r("5s+n"),r("4Brf"),r("0oug"),r("4mDm"),r("PKPk"),r("3bBZ"),r("ls82"),r("ma9I"),r("QLaP")),c=r.n(a),u=r("2vnA"),s=r("TyAF"),l=r("6krI"),p=r("OrGx"),f=r("oN2z"),d=r("yxUM"),y=r("wsPv"),h=r("R9tu");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m,b,_,v,P,g,O=function(e){!function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&_setPrototypeOf(e,t)}(HideSidebar,e);var t=_createSuper(HideSidebar);function HideSidebar(){return _classCallCheck(this,HideSidebar),t.apply(this,arguments)}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(HideSidebar,[{key:"componentDidMount",value:function componentDidMount(){this.props.ui.enableEditMode()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.ui.disableEditMode()}},{key:"render",value:function render(){return this.props.children||null}}]),HideSidebar}(n.Component),S=r("E4Hn");function DataLoader_typeof(e){return(DataLoader_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,o,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function _initializerDefineProperty(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function DataLoader_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function DataLoader_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function DataLoader_setPrototypeOf(e,t){return(DataLoader_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function DataLoader_createSuper(e){var t=function DataLoader_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=DataLoader_getPrototypeOf(e);if(t){var o=DataLoader_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return DataLoader_possibleConstructorReturn(this,r)}}function DataLoader_possibleConstructorReturn(e,t){if(t&&("object"===DataLoader_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return DataLoader_assertThisInitialized(e)}function DataLoader_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DataLoader_getPrototypeOf(e){return(DataLoader_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _applyDecoratedDescriptor(e,t,r,n,o){var i={};return Object.keys(n).forEach((function(e){i[e]=n[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D=Object(s.c)((b=function(e){!function DataLoader_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&DataLoader_setPrototypeOf(e,t)}(DataLoader,e);var t=DataLoader_createSuper(DataLoader);function DataLoader(){var e,r;DataLoader_classCallCheck(this,DataLoader);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return DataLoader_possibleConstructorReturn(r,(e=r=t.call.apply(t,[this].concat(o)),_initializerDefineProperty(r,"document",_,DataLoader_assertThisInitialized(r)),_initializerDefineProperty(r,"revision",v,DataLoader_assertThisInitialized(r)),_initializerDefineProperty(r,"shapshot",P,DataLoader_assertThisInitialized(r)),_initializerDefineProperty(r,"error",g,DataLoader_assertThisInitialized(r)),r.onCreateLink=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var t,n;return regeneratorRuntime.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t=r.document,c()(t,"document must be loaded to create link"),o.next=4,r.props.documents.create({collectionId:t.collectionId,parentDocumentId:t.parentDocumentId,title:e,text:""});case 4:return n=o.sent,o.abrupt("return",n.url);case 6:case"end":return o.stop()}}),_callee)})));return function(t){return e.apply(this,arguments)}}(),r.loadRevision=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var e;return regeneratorRuntime.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=r.props.match.params.revisionId)){t.next=5;break}return t.next=4,r.props.revisions.fetch(e);case 4:r.revision=t.sent;case 5:case"end":return t.stop()}}),_callee2)}))),r.loadDocument=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var e,t,n,o,i,a,c;return regeneratorRuntime.wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return e=r.props.match.params,t=e.shareId,n=e.documentSlug,o=e.revisionId,r.document&&r.props.ui.setActiveDocument(r.document),u.prev=2,u.next=5,r.props.documents.fetchWithSharedTree(n,{shareId:t});case 5:if(i=u.sent,r.sharedTree=i.sharedTree,r.document=i.document,!o||"latest"===o){u.next=13;break}return u.next=11,r.loadRevision();case 11:u.next=14;break;case 13:r.revision=void 0;case 14:u.next=20;break;case 16:return u.prev=16,u.t0=u.catch(2),r.error=u.t0,u.abrupt("return");case 20:if(!(a=r.document)){u.next=28;break}if(c=r.props.policies.abilities(a.id),r.props.ui.setActiveDocument(a),c.update||!r.isEditRoute){u.next=27;break}return y.a.push(a.url),u.abrupt("return");case 27:c.read&&r.props.shares.fetch(a.id).catch((function(e){if(!(e instanceof d.d))throw e}));case 28:case"end":return u.stop()}}),_callee3,null,[[2,16]])}))),e))}return function DataLoader_createClass(e,t,r){return t&&DataLoader_defineProperties(e.prototype,t),r&&DataLoader_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(DataLoader,[{key:"componentDidMount",value:function componentDidMount(){var e=this.props,t=e.documents,r=e.match;this.document=t.getByUrl(r.params.documentSlug),this.sharedTree=this.document?t.getSharedTree(this.document.id):void 0,this.loadDocument()}},{key:"componentDidUpdate",value:function componentDidUpdate(e){if(this.document){var t=this.document;!this.props.policies.get(t.id)&&!this.error&&this.props.auth.user&&this.props.auth.user.id&&this.loadDocument()}var r=this.props.match.params.revisionId;e.match.params.revisionId!==r&&r&&"latest"!==r&&this.loadRevision()}},{key:"isEditRoute",get:function get(){return this.props.match.path===h.j}},{key:"isEditing",get:function get(){var e,t;return this.isEditRoute||(null===(e=this.props.auth)||void 0===e||null===(t=e.team)||void 0===t?void 0:t.collaborativeEditing)}},{key:"render",value:function render(){var e=this.props,t=e.location,r=e.policies,o=e.auth,i=e.match,a=e.ui,c=i.params.revisionId;if(this.error)return this.error instanceof d.e?n.createElement(p.a,null):n.createElement(l.a,null);var u=o.team,s=this.document,f=this.revision;if(!s||!u||c&&!f)return n.createElement(n.Fragment,null,n.createElement(S.a,{location:t}),this.isEditing&&!(null!=u&&u.collaborativeEditing)&&n.createElement(O,{ui:a}));var y=r.abilities(s.id),h=u.collaborativeEditing?"":this.isEditing?"editing":"read-only";return n.createElement(n.Fragment,{key:h},this.isEditing&&!u.collaborativeEditing&&n.createElement(O,{ui:a}),this.props.children({document:s,revision:f,abilities:y,isEditing:this.isEditing,readOnly:!this.isEditing||!y.update||s.isArchived||!!c,onCreateLink:this.onCreateLink,sharedTree:this.sharedTree}))}}]),DataLoader}(n.Component),_=_applyDecoratedDescriptor(b.prototype,"document",[u.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=_applyDecoratedDescriptor(b.prototype,"revision",[u.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=_applyDecoratedDescriptor(b.prototype,"shapshot",[u.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=_applyDecoratedDescriptor(b.prototype,"error",[u.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=b))||m,k=Object(f.a)(D),w=r("cmEr"),E=r("Iks1"),j=r("MwZc");function SocketPresence_typeof(e){return(SocketPresence_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function SocketPresence_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SocketPresence_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function SocketPresence_setPrototypeOf(e,t){return(SocketPresence_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function SocketPresence_createSuper(e){var t=function SocketPresence_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var r,n=SocketPresence_getPrototypeOf(e);if(t){var o=SocketPresence_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return SocketPresence_possibleConstructorReturn(this,r)}}function SocketPresence_possibleConstructorReturn(e,t){if(t&&("object"===SocketPresence_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function SocketPresence_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function SocketPresence_getPrototypeOf(e){return(SocketPresence_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e){!function SocketPresence_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&SocketPresence_setPrototypeOf(e,t)}(SocketPresence,e);var t=SocketPresence_createSuper(SocketPresence);function SocketPresence(){var e,r;SocketPresence_classCallCheck(this,SocketPresence);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return SocketPresence_possibleConstructorReturn(r,(e=r=t.call.apply(t,[this].concat(o)),r.setupOnce=function(){r.context&&r.context!==r.previousContext&&(r.previousContext=r.context,r.context.authenticated&&r.emitJoin(),r.context.on("authenticated",(function(){r.emitJoin()})))},r.emitJoin=function(){r.context&&r.context.emit("join",{documentId:r.props.documentId,isEditing:r.props.isEditing})},r.emitPresence=function(){r.context&&r.context.emit("presence",{documentId:r.props.documentId,isEditing:r.props.isEditing})},e))}return function SocketPresence_createClass(e,t,r){return t&&SocketPresence_defineProperties(e.prototype,t),r&&SocketPresence_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(SocketPresence,[{key:"componentDidMount",value:function componentDidMount(){var e=this;this.editingInterval=setInterval((function(){e.props.isEditing&&e.emitPresence()}),E.c),this.setupOnce()}},{key:"componentDidUpdate",value:function componentDidUpdate(e){this.setupOnce(),e.isEditing!==this.props.isEditing&&this.emitPresence()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.context&&(this.context.emit("leave",{documentId:this.props.documentId}),this.context.off("authenticated",this.emitJoin)),clearInterval(this.editingInterval)}},{key:"render",value:function render(){return this.props.children||null}}]),SocketPresence}(n.Component);x.contextType=j.a;var R=["document","isEditing"];function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function DocumentScene(e){var t=Object(i.a)().ui,r=Object(o.a)(),a=e.match.params,c=a.documentSlug,u=a.revisionId;n.useEffect((function(){return function(){return t.clearActiveDocument()}}),[t]);var s=c?c.split("-"):[],l=[s.length?s[s.length-1]:void 0,u].join("/"),p=r.collaborativeEditing;return n.createElement(k,{key:l,match:e.match,history:e.history,location:e.location},(function(t){var r=t.document,o=t.isEditing,i=_objectWithoutProperties(t,R);return!r.isArchived&&!r.isDeleted&&!u&&!p?n.createElement(x,{documentId:r.id,isEditing:o},n.createElement(w.a,_extends({document:r,match:e.match},i))):n.createElement(w.a,_extends({document:r,match:e.match},i))}))}}}]);
//# sourceMappingURL=document.01633dc99a8f71b96264.js.map
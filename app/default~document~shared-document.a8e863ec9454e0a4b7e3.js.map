{"version":3,"sources":["webpack:///./node_modules/core-js/modules/esnext.string.match-all.js","webpack:///./app/scenes/Document/components/Loading.tsx","webpack:///./app/scenes/ErrorOffline.tsx","webpack:///./app/hooks/useUserLocale.ts","webpack:///./node_modules/is-printable-key-event/dist/index.js","webpack:///./shared/utils/getTasks.ts","webpack:///./app/components/Branding.tsx","webpack:///./app/components/ConnectionStatus.tsx","webpack:///./app/hooks/useWindowScrollPosition.ts","webpack:///./app/scenes/Document/components/Contents.tsx","webpack:///./app/scenes/Document/components/AsyncMultiplayerEditor.ts","webpack:///./app/components/ContentEditable.tsx","webpack:///./app/hooks/useOnScreen.ts","webpack:///./app/scenes/Document/components/EditableTitle.tsx","webpack:///./app/hooks/useEmojiWidth.ts","webpack:///./app/scenes/Document/components/Editor.tsx","webpack:///./app/components/Collaborators.tsx","webpack:///./app/menus/NewChildDocumentMenu.tsx","webpack:///./app/menus/TableOfContentsMenu.tsx","webpack:///./app/menus/TemplatesMenu.tsx","webpack:///./app/scenes/Document/components/ObservingBanner.tsx","webpack:///./app/scenes/Document/components/PublicBreadcrumb.tsx","webpack:///./app/scenes/Document/components/SharePopover.tsx","webpack:///./app/scenes/Document/components/ShareButton.tsx","webpack:///./app/scenes/Document/components/Header.tsx","webpack:///./app/scenes/Document/components/KeyboardShortcutsButton.tsx","webpack:///./app/scenes/Document/components/MarkAsViewed.ts","webpack:///./app/scenes/Document/components/Notices.tsx","webpack:///./app/scenes/Document/components/ReferenceListItem.tsx","webpack:///./app/scenes/Document/components/PublicReferences.tsx","webpack:///./app/scenes/Document/components/References.tsx","webpack:///./app/scenes/Document/components/Document.tsx","webpack:///./app/utils/emoji.ts","webpack:///./app/scenes/Document/components/Container.ts","webpack:///./node_modules/core-js/modules/es.string.match-all.js"],"names":["Loading","location","t","useTranslation","column","auto","title","state","ErrorOffline","useUserLocale","auth","useStores","user","language","module","exports","e","o","a","r","i","l","call","m","c","d","Object","defineProperty","enumerable","get","Symbol","toStringTag","value","__esModule","create","bind","n","default","prototype","hasOwnProperty","p","s","keys","reduce","concat","indexOf","key","modifier","legacyModifier","whiteSpace","navigation","editing","ui","device","imeCompositionKeys","koreanSpecific","japaneseSpecific","commonFunction","multimedia","multimediaNumpad","audio","speech","application","browser","mobilePhone","tv","mediaControls","CHECKBOX_REGEX","getTasks","text","matches","matchAll","total","length","completed","accumulator","match","Link","styled","props","theme","sidebarBackground","breakpoint","depths","sidebar","Branding","href","env","URL","OutlineLogo","size","Button","NudeButton","Centered","div","observer","ConnectionStatus","useTheme","multiplayerStatus","Tooltip","tooltip","placement","Fade","color","sidebarText","getPosition","x","window","pageXOffset","y","pageYOffset","defaultOptions","throttle","Contents","headings","isFullWidth","React","activeSlug","setActiveSlug","position","useWindowScrollPosition","options","opts","assign","useState","setPosition","useEffect","handleScroll","addEventListener","supportsPassiveListener","passive","cancel","removeEventListener","heading","element","document","getElementById","decodeURIComponent","id","getBoundingClientRect","top","last","Math","max","headingAdjustment","memo","level","Infinity","Wrapper","Sticky","Heading","List","map","ListItem","active","Empty","divider","h3","Text","li","primary","ol","MultiplayerEditor","ContentEditable","ref","disabled","onChange","onInput","onBlur","onKeyDown","children","className","maxLength","autoFocus","placeholder","readOnly","dir","onClick","rest","contentRef","innerValue","setInnerValue","lastValue","focus","current","focusAtStart","placeCaret","focusAtEnd","getComputedDirection","getComputedStyle","direction","wrappedEvent","callback","event","innerText","isPrintableKeyEvent","preventDefault","isVisible","useOnScreen","isSupported","isIntersecting","setIntersecting","IntersectionObserver","entry","observe","unobserve","handlePaste","clipboardData","getData","execCommand","Content","contentEditable","onPaste","data-placeholder","suppressContentEditableWarning","role","atStart","getSelection","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","span","background","backgroundTransition","lineHeight","fontSize","EditableTitle","onSave","onGoToNextInput","starrable","normalizedTitle","titleWithDefault","handleClick","handleKeyDown","isModKey","done","shiftKey","publish","handleChange","test","getCurrentDateAsString","getCurrentTimeAsString","getCurrentDateTimeAsString","emojiWidth","useEmojiWidth","emoji","createElement","style","visibility","left","width","body","appendChild","removeChild","parseInt","Title","$emojiWidth","$isStarred","isStarred","MAX_TITLE_LENGTH","StarButton","Star","AnimatedStar","light","DocumentEditor","titleRef","useRouteMatch","onChangeTitle","isDraft","shareId","multiplayer","handleBlur","autosave","handleGoToNextInput","insertParagraph","view","dispatch","tr","insert","schema","nodes","paragraph","EditorComponent","Editor","Flex","DocumentMetaWithViews","to","path","matchDocumentHistory","documentUrl","documentHistoryUrl","rtl","defaultValue","scrollTo","hash","extensions","fullPackage","grow","Collaborators","useCurrentUser","team","useCurrentTeam","currentUserId","requestedUserIds","setRequestedUserIds","users","presence","documentPresence","documentPresenceArray","Array","from","values","presentIds","userId","editingIds","filter","isEditing","collaborators","orderedData","includes","collaboratorIds","isSuspended","ids","sort","fetchPage","limit","popover","usePopoverState","gutter","PopoverDisclosure","height","Facepile","renderAvatar","collaborator","isPresent","isObserving","observingUserId","isObservable","collaborativeEditing","Avatar","isCurrentUser","profileOnClick","ev","stopPropagation","setObservingUser","undefined","Popover","aria-label","tabIndex","DocumentViews","isOpen","visible","NewChildDocumentMenu","label","menu","useMenuState","modal","collections","collection","collectionId","collectionName","name","MenuButton","ContextMenu","Template","items","type","Trans","defaults","components","em","newDocumentPath","parentDocumentId","TableOfContentsMenu","unstable_preventOverflow","unstable_fixed","unstable_flip","minHeading","push","icon","iconColor","borderOnHover","neutral","TemplateItem","Author","TemplatesMenu","onSelectTemplate","documents","templates","templatesInCollection","otherTemplates","renderTemplate","template","MenuItem","author","createdBy","disclosure","Separator","transition","stiffness","damping","Positioner","Banner","header","white","$color","ObservingBanner","AnimatePresence","initial","opacity","animate","exit","userName","PublicBreadcrumb","documentId","sharedTree","pathToDocument","traveler","previousPath","forEach","childNode","newPath","slice","item","url","Breadcrumb","h2","SwitchWrapper","InputLink","Input","SwitchLabel","SwitchText","SharePopover","share","sharedParent","onRequestClose","shares","showToast","useToasts","isCopied","setIsCopied","timeout","buttonRef","can","usePolicy","documentAbilities","canPublish","update","isTemplate","sharing","isPubliclyShared","published","useKeyDown","clearTimeout","handlePublishedChange","getByDocumentId","invariant","save","currentTarget","checked","message","handleChildDocumentsChange","includeChildDocuments","handleCopied","setTimeout","userLocale","locale","dateLocale","Notice","documentTitle","Switch","lastAccessedAt","timeAgo","formatDistanceToNow","Date","parse","addSuffix","labelHidden","CopyToClipboard","onCopy","ShareButton","getByDocumentParents","delay","hide","Status","Action","slate","DocumentHeader","documentHasHeadings","isPublishing","isRevision","isSaving","savingIsDisabled","publishingIsDisabled","resolvedTheme","isMobile","useMobile","isNew","isPersistedOnce","handleSave","handlePublish","isDeleted","canToggleEmbeds","documentEmbeds","canEdit","toc","tocVisible","shortcut","hideTableOfContents","showTableOfContents","editAction","noun","as","editDocumentUrl","appearanceAction","setTheme","Theme","Dark","Light","Header","hasSidebar","breadcrumb","actions","DocumentBreadcrumb","isArchived","Badge","metaDisplay","createChildDocument","templateId","DocumentMenu","showToggleEmbeds","showDisplayOptions","KeyboardShortcutsButton","useBoolean","keyboardShortcutsOpen","handleOpenKeyboardShortcuts","handleCloseKeyboardShortcuts","Guide","KeyboardShortcuts","MarkAsViewed","componentDidMount","this","viewTimeout","updateLastViewed","componentWillUnmount","render","Notices","description","PlaceholderIcon","archivedAt","deletedAt","updatedBy","Time","dateTime","updatedAt","permanentlyDeletedDescription","permanentlyDeletedAt","InputIcon","DocumentLink","hover","listItemHoverBackground","textSecondary","ReferenceListItem","anchor","showCollection","parseTitle","pathname","gap","EmojiIcon","replace","PublicReferences","result","findChildren","node","Subheading","$active","References","useLocation","fetchBacklinks","backlinks","getBacklinkedDocuments","getDocumentChildren","showBacklinks","showChildDocuments","isBacklinksTab","Tabs","Tab","isActive","backlinkedDocument","urlId","DocumentScene","getEditorText","replaceDocument","editorRef","editor","parser","setSelection","AllSelection","doc","replaceSelectionWith","isEditorDirty","Document","updateIsDirty","onSynced","toasts","history","restore","revisionId","client","post","response","data","goToMove","abilities","move","documentMoveUrl","goToEdit","goToHistory","ctrlKey","endsWith","onPublish","publishedAt","onToggleTableOfContents","trim","tasks","isDirty","savedDocument","lastRevision","revision","setActiveDocument","editorText","isEmpty","updateIsDirtyDebounced","onFileUploadStart","isUploading","onFileUploadStop","getHeadings","h","join","updateTasks","action","goBack","handleRef","componentDidUpdate","prevProps","hasEmptyTitle","delete","isShare","embedsDisabled","hasHeadings","showContents","canonicalUrl","updateDocumentUrl","ErrorBoundary","RegisterKeyDown","trigger","handler","altKey","Background","component","Modal","DocumentMove","PageTitle","favicon","LoadingIndicator","Container","justify","when","MaxWidth","archived","fullWidth","fallback","PlaceholderDocument","onSearchLink","onCreateLink","onCancel","readOnlyWriteCheckboxes","ReferencesWrapper","isOnlyTitle","isCustomDomain","observable","withTranslation","withStores","withRouter","$","createIteratorConstructor","requireObjectCoercible","toLength","aFunction","anObject","classof","isRegExp","getRegExpFlags","createNonEnumerableProperty","fails","wellKnownSymbol","speciesConstructor","advanceStringIndex","InternalStateModule","IS_PURE","MATCH_ALL","REGEXP_STRING","REGEXP_STRING_ITERATOR","setInternalState","set","getInternalState","getterFor","RegExpPrototype","RegExp","regExpBuiltinExec","exec","nativeMatchAll","WORKS_WITH_NON_GLOBAL_REGEX","$RegExpStringIterator","RegExpStringIterator","regexp","string","global","fullUnicode","unicode","next","R","S","TypeError","regExpExec","String","lastIndex","$matchAll","C","flagsValue","flags","matcher","source","target","proto","forced","rx","O","apply","arguments"],"mappings":"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","file":"default~document~shared-document.a8e863ec9454e0a4b7e3.js","sourcesContent":["// TODO: Remove from `core-js@4`\nrequire('./es.string.match-all');\n","import { Location } from \"history\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport CenteredContent from \"~/components/CenteredContent\";\nimport PageTitle from \"~/components/PageTitle\";\nimport PlaceholderDocument from \"~/components/PlaceholderDocument\";\nimport Container from \"./Container\";\n\ntype Props = {\n  location: Location<{ title?: string }>;\n};\n\nexport default function Loading({ location }: Props) {\n  const { t } = useTranslation();\n  return (\n    <Container column auto>\n      <PageTitle\n        title={location.state ? location.state.title : t(\"Untitled\")}\n      />\n      <CenteredContent>\n        <PlaceholderDocument />\n      </CenteredContent>\n    </Container>\n  );\n}\n","import * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport CenteredContent from \"~/components/CenteredContent\";\nimport Empty from \"~/components/Empty\";\nimport PageTitle from \"~/components/PageTitle\";\n\nconst ErrorOffline = () => {\n  const { t } = useTranslation();\n  return (\n    <CenteredContent>\n      <PageTitle title={t(\"Offline\")} />\n      <h1>{t(\"Offline\")}</h1>\n      <Empty>{t(\"We were unable to load the document while offline.\")}</Empty>\n    </CenteredContent>\n  );\n};\n\nexport default ErrorOffline;\n","import useStores from \"./useStores\";\n\nexport default function useUserLocale() {\n  const { auth } = useStores();\n\n  if (!auth.user || !auth.user.language) {\n    return undefined;\n  }\n\n  return auth.user.language;\n}\n","module.exports=function(e){var o={};function a(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=o,a.d=function(e,o,t){a.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},a.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},a.t=function(e,o){if(1&o&&(e=a(e)),8&o)return e;if(4&o&&\"object\"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:e}),2&o&&\"string\"!=typeof e)for(var r in e)a.d(t,r,function(o){return e[o]}.bind(null,r));return t},a.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(o,\"a\",o),o},a.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},a.p=\"\",a(a.s=0)}([function(e,o,a){\"use strict\";Object.defineProperty(o,\"__esModule\",{value:!0});var t=a(1),r=Object.keys(t.default).reduce((function(e,o){return e.concat(t.default[o])}),[]);o.default=function(e){return-1===r.indexOf(e.key)}},function(e,o,a){\"use strict\";Object.defineProperty(o,\"__esModule\",{value:!0});o.default={modifier:[\"Alt\",\"AltGraph\",\"CapsLock\",\"Control\",\"Fn\",\"FnLock\",\"Meta\",\"NumLock\",\"ScrollLock\",\"Shift\",\"Symbol\",\"SymbolLock\"],legacyModifier:[\"Hyper\",\"Super\"],whiteSpace:[\"Enter\",\"Tab\"],navigation:[\"ArrowDown\",\"ArrowLeft\",\"ArrowRight\",\"ArrowUp\",\"End\",\"Home\",\"PageDown\",\"PageUp\"],editing:[\"Backspace\",\"Clear\",\"Copy\",\"CrSel\",\"Cut\",\"Delete\",\"EraseEof\",\"ExSel\",\"Insert\",\"Paste\",\"Redo\",\"Undo\"],ui:[\"Accept\",\"Again\",\"Attn\",\"Cancel\",\"ContextMenu\",\"Escape\",\"Execute\",\"Find\",\"Help\",\"Pause\",\"Play\",\"Props\",\"Select\",\"ZoomIn\",\"ZoomOut\"],device:[\"BrightnessDown\",\"BrightnessUp\",\"Eject\",\"LogOff\",\"Power\",\"PowerOff\",\"PrintScreen\",\"Hibernate\",\"Standby\",\"WakeUp\"],imeCompositionKeys:[\"AllCandidates\",\"Alphanumeric\",\"CodeInput\",\"Compose\",\"Convert\",\"Dead\",\"FinalMode\",\"GroupFirst\",\"GroupLast\",\"GroupNext\",\"GroupPrevious\",\"ModeChange\",\"NextCandidate\",\"NonConvert\",\"PreviousCandidate\",\"Process\",\"SingleCandidate\"],koreanSpecific:[\"HangulMode\",\"HanjaMode\",\"JunjaMode\"],japaneseSpecific:[\"Eisu\",\"Hankaku\",\"Hiragana\",\"HiraganaKatakana\",\"KanaMode\",\"KanjiMode\",\"Katakana\",\"Romaji\",\"Zenkaku\",\"ZenkakuHankaku\"],commonFunction:[\"F1\",\"F2\",\"F3\",\"F4\",\"F5\",\"F6\",\"F7\",\"F8\",\"F9\",\"F10\",\"F11\",\"F12\",\"Soft1\",\"Soft2\",\"Soft3\",\"Soft4\"],multimedia:[\"ChannelDown\",\"ChannelUp\",\"Close\",\"MailForward\",\"MailReply\",\"MailSend\",\"MediaClose\",\"MediaFastForward\",\"MediaPause\",\"MediaPlay\",\"MediaPlayPause\",\"MediaRecord\",\"MediaRewind\",\"MediaStop\",\"MediaTrackNext\",\"MediaTrackPrevious\",\"New\",\"Open\",\"Print\",\"Save\",\"SpellCheck\"],multimediaNumpad:[\"Key11\",\"Key12\"],audio:[\"AudioBalanceLeft\",\"AudioBalanceRight\",\"AudioBassBoostDown\",\"AudioBassBoostToggle\",\"AudioBassBoostUp\",\"AudioFaderFront\",\"AudioFaderRear\",\"AudioSurroundModeNext\",\"AudioTrebleDown\",\"AudioTrebleUp\",\"AudioVolumeDown\",\"AudioVolumeUp\",\"AudioVolumeMute\",\"MicrophoneToggle\",\"MicrophoneVolumeDown\",\"MicrophoneVolumeUp\",\"MicrophoneVolumeMute\"],speech:[\"SpeechCorrectionList\",\"SpeechInputToggle\"],application:[\"LaunchApplication1\",\"LaunchApplication2\",\"LaunchCalendar\",\"LaunchContacts\",\"LaunchMail\",\"LaunchMediaPlayer\",\"LaunchMusicPlayer\",\"LaunchPhone\",\"LaunchScreenSaver\",\"LaunchSpreadsheet\",\"LaunchWebBrowser\",\"LaunchWebCam\",\"LaunchWordProcessor\"],browser:[\"BrowserBack\",\"BrowserFavorites\",\"BrowserForward\",\"BrowserHome\",\"BrowserRefresh\",\"BrowserSearch\",\"BrowserStop\"],mobilePhone:[\"AppSwitch\",\"Call\",\"Camera\",\"CameraFocus\",\"EndCall\",\"GoBack\",\"GoHome\",\"HeadsetHook\",\"LastNumberRedial\",\"Notification\",\"MannerMode\",\"VoiceDial\"],tv:[\"TV\",\"TV3DMode\",\"TVAntennaCable\",\"TVAudioDescription\",\"TVAudioDescriptionMixDown\",\"TVAudioDescriptionMixUp\",\"TVContentsMenu\",\"TVDataService\",\"TVInput\",\"TVInputComponent1\",\"TVInputComponent2\",\"TVInputComposite1\",\"TVInputComposite2\",\"TVInputHDMI1\",\"TVInputHDMI2\",\"TVInputHDMI3\",\"TVInputHDMI4\",\"TVInputVGA1\",\"TVMediaContext\",\"TVNetwork\",\"TVNumberEntry\",\"TVPower\",\"TVRadioService\",\"TVSatellite\",\"TVSatelliteBS\",\"TVSatelliteCS\",\"TVSatelliteToggle\",\"TVTerrestrialAnalog\",\"TVTerrestrialDigital\",\"TVTimer\"],mediaControls:[\"AVRInput\",\"AVRPower\",\"ColorF0Red\",\"ColorF1Green\",\"ColorF2Yellow\",\"ColorF3Blue\",\"ColorF4Grey\",\"ColorF5Brown\",\"ClosedCaptionToggle\",\"Dimmer\",\"DisplaySwap\",\"DVR\",\"Exit\",\"FavoriteClear0\",\"FavoriteClear1\",\"FavoriteClear2\",\"FavoriteClear3\",\"FavoriteRecall0\",\"FavoriteRecall1\",\"FavoriteRecall2\",\"FavoriteRecall3\",\"FavoriteStore0\",\"FavoriteStore1\",\"FavoriteStore2\",\"FavoriteStore3\",\"Guide\",\"GuideNextDay\",\"GuidePreviousDay\",\"Info\",\"InstantReplay\",\"Link\",\"ListProgram\",\"LiveContent\",\"Lock\",\"MediaApps\",\"MediaAudioTrack\",\"MediaLast\",\"MediaSkipBackward\",\"MediaSkipForward\",\"MediaStepBackward\",\"MediaStepForward\",\"MediaTopMenu\",\"NavigateIn\",\"NavigateNext\",\"NavigateOut\",\"NavigatePrevious\",\"NextFavoriteChannel\",\"NextUserProfile\",\"OnDemand\",\"Pairing\",\"PinPDown\",\"PinPMove\",\"PinPToggle\",\"PinPUp\",\"PlaySpeedDown\",\"PlaySpeedReset\",\"PlaySpeedUp\",\"RandomToggle\",\"RcLowBattery\",\"RecordSpeedNext\",\"RfBypass\",\"ScanChannelsToggle\",\"ScreenModeNext\",\"Settings\",\"SplitScreenToggle\",\"STBInput\",\"STBPower\",\"Subtitle\",\"Teletext\",\"VideoModeNext\",\"Wink\",\"ZoomToggle\"]}}]).default;","const CHECKBOX_REGEX = /\\[(X|\\s|_|-)\\]\\s(.*)?/gi;\n\nexport default function getTasks(text: string) {\n  const matches = [...text.matchAll(CHECKBOX_REGEX)];\n  const total = matches.length;\n\n  if (!total) {\n    return {\n      completed: 0,\n      total: 0,\n    };\n  } else {\n    const notCompleted = matches.reduce(\n      (accumulator, match) =>\n        match[1] === \" \" ? accumulator + 1 : accumulator,\n      0\n    );\n    return {\n      completed: total - notCompleted,\n      total,\n    };\n  }\n}\n","import * as React from \"react\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport { depths } from \"@shared/styles\";\nimport env from \"~/env\";\nimport OutlineLogo from \"./OutlineLogo\";\n\ntype Props = {\n  href?: string;\n};\n\nfunction Branding({ href = env.URL }: Props) {\n  return (\n    <Link href={href}>\n      <OutlineLogo size={16} />\n      &nbsp;Outline\n    </Link>\n  );\n}\n\nconst Link = styled.a`\n  justify-content: center;\n  padding-bottom: 16px;\n\n  font-weight: 600;\n  font-size: 14px;\n  text-decoration: none;\n  border-top-right-radius: 2px;\n  color: ${(props) => props.theme.text};\n  display: flex;\n  align-items: center;\n\n  svg {\n    fill: ${(props) => props.theme.text};\n  }\n\n  &:hover {\n    background: ${(props) => props.theme.sidebarBackground};\n  }\n\n  ${breakpoint(\"tablet\")`\n    z-index: ${depths.sidebar + 1};\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    padding: 16px;\n  `};\n`;\n\nexport default Branding;\n","import { observer } from \"mobx-react\";\nimport { DisconnectedIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styled, { useTheme } from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport Fade from \"~/components/Fade\";\nimport NudeButton from \"~/components/NudeButton\";\nimport Tooltip from \"~/components/Tooltip\";\nimport useStores from \"~/hooks/useStores\";\n\nfunction ConnectionStatus() {\n  const { ui } = useStores();\n  const theme = useTheme();\n  const { t } = useTranslation();\n\n  return ui.multiplayerStatus === \"connecting\" ||\n    ui.multiplayerStatus === \"disconnected\" ? (\n    <Tooltip\n      tooltip={\n        <Centered>\n          <strong>{t(\"Server connection lost\")}</strong>\n          <br />\n          {t(\"Edits you make will sync once youre online\")}\n        </Centered>\n      }\n      placement=\"bottom\"\n    >\n      <Button>\n        <Fade>\n          <DisconnectedIcon color={theme.sidebarText} />\n        </Fade>\n      </Button>\n    </Tooltip>\n  ) : null;\n}\n\nconst Button = styled(NudeButton)`\n  display: none;\n  position: fixed;\n  bottom: 0;\n  right: 32px;\n  margin: 24px;\n\n  ${breakpoint(\"tablet\")`\n    display: block;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nconst Centered = styled.div`\n  text-align: center;\n`;\n\nexport default observer(ConnectionStatus);\n","// Based on https://github.com/rehooks/window-scroll-position which is no longer\n// maintained.\nimport { throttle } from \"lodash\";\nimport { useState, useEffect } from \"react\";\nimport { supportsPassiveListener } from \"~/utils/browser\";\n\nconst getPosition = () => ({\n  x: window.pageXOffset,\n  y: window.pageYOffset,\n});\n\nconst defaultOptions = {\n  throttle: 100,\n};\n\nexport default function useWindowScrollPosition(options: {\n  throttle: number;\n}): {\n  x: number;\n  y: number;\n} {\n  const opts = Object.assign({}, defaultOptions, options);\n  const [position, setPosition] = useState(getPosition());\n\n  useEffect(() => {\n    const handleScroll = throttle(() => {\n      setPosition(getPosition());\n    }, opts.throttle);\n    window.addEventListener(\n      \"scroll\",\n      handleScroll,\n      supportsPassiveListener\n        ? {\n            passive: true,\n          }\n        : false\n    );\n    return () => {\n      handleScroll.cancel();\n      window.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [opts.throttle]);\n\n  return position;\n}\n","import * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport Text from \"~/components/Text\";\nimport useWindowScrollPosition from \"~/hooks/useWindowScrollPosition\";\n\nconst HEADING_OFFSET = 20;\n\ntype Props = {\n  isFullWidth: boolean;\n  headings: {\n    title: string;\n    level: number;\n    id: string;\n  }[];\n};\n\nexport default function Contents({ headings, isFullWidth }: Props) {\n  const [activeSlug, setActiveSlug] = React.useState<string>();\n  const position = useWindowScrollPosition({\n    throttle: 100,\n  });\n\n  React.useEffect(() => {\n    for (let key = 0; key < headings.length; key++) {\n      const heading = headings[key];\n      const element = window.document.getElementById(\n        decodeURIComponent(heading.id)\n      );\n\n      if (element) {\n        const bounding = element.getBoundingClientRect();\n\n        if (bounding.top > HEADING_OFFSET) {\n          const last = headings[Math.max(0, key - 1)];\n          setActiveSlug(last.id);\n          return;\n        }\n      }\n    }\n  }, [position, headings]);\n\n  // calculate the minimum heading level and adjust all the headings to make\n  // that the top-most. This prevents the contents from being weirdly indented\n  // if all of the headings in the document are level 3, for example.\n  const minHeading = headings.reduce(\n    (memo, heading) => (heading.level < memo ? heading.level : memo),\n    Infinity\n  );\n  const headingAdjustment = minHeading - 1;\n  const { t } = useTranslation();\n\n  return (\n    <Wrapper isFullWidth={isFullWidth}>\n      <Sticky>\n        <Heading>{t(\"Contents\")}</Heading>\n        {headings.length ? (\n          <List>\n            {headings.map((heading) => (\n              <ListItem\n                key={heading.id}\n                level={heading.level - headingAdjustment}\n                active={activeSlug === heading.id}\n              >\n                <Link href={`#${heading.id}`}>{heading.title}</Link>\n              </ListItem>\n            ))}\n          </List>\n        ) : (\n          <Empty>\n            {t(\"Headings you add to the document will appear here\")}\n          </Empty>\n        )}\n      </Sticky>\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled.div<{ isFullWidth: boolean }>`\n  width: 256px;\n  display: none;\n\n  ${breakpoint(\"tablet\")`\n    display: block;\n  `};\n\n  ${(props) =>\n    !props.isFullWidth &&\n    breakpoint(\"desktopLarge\")`\n    transform: translateX(-256px);\n    width: 0;\n    `}\n`;\n\nconst Sticky = styled.div`\n  position: sticky;\n  top: 80px;\n  max-height: calc(100vh - 80px);\n\n  box-shadow: 1px 0 0 ${(props) => props.theme.divider};\n  margin-top: 40px;\n  margin-right: 52px;\n  min-width: 204px;\n  width: 204px;\n  min-height: 40px;\n  overflow-y: auto;\n`;\n\nconst Heading = styled.h3`\n  font-size: 11px;\n  font-weight: 600;\n  text-transform: uppercase;\n  color: ${(props) => props.theme.sidebarText};\n  letter-spacing: 0.04em;\n`;\n\nconst Empty = styled(Text)`\n  margin: 1em 0 4em;\n  padding-right: 2em;\n  font-size: 14px;\n`;\n\nconst ListItem = styled.li<{ level: number; active?: boolean }>`\n  margin-left: ${(props) => (props.level - 1) * 10}px;\n  margin-bottom: 8px;\n  padding-right: 2em;\n  line-height: 1.3;\n  border-right: 3px solid\n    ${(props) => (props.active ? props.theme.divider : \"transparent\")};\n\n  a {\n    color: ${(props) =>\n      props.active ? props.theme.primary : props.theme.text};\n  }\n`;\n\nconst Link = styled.a`\n  color: ${(props) => props.theme.text};\n  font-size: 14px;\n\n  &:hover {\n    color: ${(props) => props.theme.primary};\n  }\n`;\n\nconst List = styled.ol`\n  padding: 0;\n  list-style: none;\n`;\n","import * as React from \"react\";\n\nconst MultiplayerEditor = React.lazy(\n  () =>\n    import(\n      /* webpackChunkName: \"multiplayer-editor\" */\n      \"./MultiplayerEditor\"\n    )\n);\n\nexport default MultiplayerEditor;\n","import isPrintableKeyEvent from \"is-printable-key-event\";\nimport * as React from \"react\";\nimport styled from \"styled-components\";\nimport useOnScreen from \"~/hooks/useOnScreen\";\n\ntype Props = Omit<React.HTMLAttributes<HTMLSpanElement>, \"ref\" | \"onChange\"> & {\n  disabled?: boolean;\n  readOnly?: boolean;\n  onClick?: React.MouseEventHandler<HTMLDivElement>;\n  onChange?: (text: string) => void;\n  onBlur?: React.FocusEventHandler<HTMLSpanElement> | undefined;\n  onInput?: React.FormEventHandler<HTMLSpanElement> | undefined;\n  onKeyDown?: React.KeyboardEventHandler<HTMLSpanElement> | undefined;\n  placeholder?: string;\n  maxLength?: number;\n  autoFocus?: boolean;\n  children?: React.ReactNode;\n  value: string;\n};\n\nexport type RefHandle = {\n  focus: () => void;\n  focusAtStart: () => void;\n  focusAtEnd: () => void;\n  getComputedDirection: () => string;\n};\n\n/**\n * Defines a content editable component with the same interface as a native\n * HTMLInputElement (or, as close as we can get).\n */\nconst ContentEditable = React.forwardRef(\n  (\n    {\n      disabled,\n      onChange,\n      onInput,\n      onBlur,\n      onKeyDown,\n      value,\n      children,\n      className,\n      maxLength,\n      autoFocus,\n      placeholder,\n      readOnly,\n      dir,\n      onClick,\n      ...rest\n    }: Props,\n    ref: React.RefObject<RefHandle>\n  ) => {\n    const contentRef = React.useRef<HTMLSpanElement>(null);\n    const [innerValue, setInnerValue] = React.useState<string>(value);\n    const lastValue = React.useRef(\"\");\n\n    React.useImperativeHandle(ref, () => ({\n      focus: () => {\n        contentRef.current?.focus();\n      },\n      focusAtStart: () => {\n        if (contentRef.current) {\n          contentRef.current.focus();\n          placeCaret(contentRef.current, true);\n        }\n      },\n      focusAtEnd: () => {\n        if (contentRef.current) {\n          contentRef.current.focus();\n          placeCaret(contentRef.current, false);\n        }\n      },\n      getComputedDirection: () => {\n        if (contentRef.current) {\n          return window.getComputedStyle(contentRef.current).direction;\n        }\n        return \"ltr\";\n      },\n    }));\n\n    const wrappedEvent = (\n      callback:\n        | React.FocusEventHandler<HTMLSpanElement>\n        | React.FormEventHandler<HTMLSpanElement>\n        | React.KeyboardEventHandler<HTMLSpanElement>\n        | undefined\n    ) => (event: any) => {\n      const text = contentRef.current?.innerText || \"\";\n\n      if (maxLength && isPrintableKeyEvent(event) && text.length >= maxLength) {\n        event?.preventDefault();\n        return;\n      }\n\n      if (text !== lastValue.current) {\n        lastValue.current = text;\n        onChange && onChange(text);\n      }\n\n      callback?.(event);\n    };\n\n    // This is to account for being within a React.Suspense boundary, in this\n    // case the component may be rendered with display: none. React 18 may solve\n    // this in the future by delaying useEffect hooks:\n    // https://github.com/facebook/react/issues/14536#issuecomment-861980492\n    const isVisible = useOnScreen(contentRef);\n\n    React.useEffect(() => {\n      if (autoFocus && isVisible && !disabled && !readOnly) {\n        contentRef.current?.focus();\n      }\n    }, [autoFocus, disabled, isVisible, readOnly, contentRef]);\n\n    React.useEffect(() => {\n      if (value !== contentRef.current?.innerText) {\n        setInnerValue(value);\n      }\n    }, [value, contentRef]);\n\n    // Ensure only plain text can be pasted into title when pasting from another\n    // rich text editor\n    const handlePaste = React.useCallback(\n      (event: React.ClipboardEvent<HTMLSpanElement>) => {\n        event.preventDefault();\n        const text = event.clipboardData.getData(\"text/plain\");\n        window.document.execCommand(\"insertText\", false, text);\n      },\n      []\n    );\n\n    return (\n      <div className={className} dir={dir} onClick={onClick}>\n        <Content\n          ref={contentRef}\n          contentEditable={!disabled && !readOnly}\n          onInput={wrappedEvent(onInput)}\n          onBlur={wrappedEvent(onBlur)}\n          onKeyDown={wrappedEvent(onKeyDown)}\n          onPaste={handlePaste}\n          data-placeholder={placeholder}\n          suppressContentEditableWarning\n          role=\"textbox\"\n          {...rest}\n        >\n          {innerValue}\n        </Content>\n        {children}\n      </div>\n    );\n  }\n);\n\nfunction placeCaret(element: HTMLElement, atStart: boolean) {\n  if (\n    typeof window.getSelection !== \"undefined\" &&\n    typeof document.createRange !== \"undefined\"\n  ) {\n    const range = document.createRange();\n    range.selectNodeContents(element);\n    range.collapse(atStart);\n    const sel = window.getSelection();\n    sel?.removeAllRanges();\n    sel?.addRange(range);\n  }\n}\n\nconst Content = styled.span`\n  background: ${(props) => props.theme.background};\n  transition: ${(props) => props.theme.backgroundTransition};\n  color: ${(props) => props.theme.text};\n  -webkit-text-fill-color: ${(props) => props.theme.text};\n  outline: none;\n  resize: none;\n  cursor: text;\n\n  &:empty {\n    display: inline-block;\n  }\n\n  &:empty::before {\n    display: inline-block;\n    color: ${(props) => props.theme.placeholder};\n    -webkit-text-fill-color: ${(props) => props.theme.placeholder};\n    content: attr(data-placeholder);\n    pointer-events: none;\n    height: 0;\n  }\n`;\n\nexport default ContentEditable;\n","import * as React from \"react\";\n\n/**\n * Hook to return if a given ref is visible on screen.\n *\n * @returns boolean if the node is visible\n */\nexport default function useOnScreen(ref: React.RefObject<HTMLElement>) {\n  const isSupported = \"IntersectionObserver\" in window;\n  const [isIntersecting, setIntersecting] = React.useState(!isSupported);\n\n  React.useEffect(() => {\n    const element = ref.current;\n    let observer: IntersectionObserver | undefined;\n\n    if (isSupported) {\n      observer = new IntersectionObserver(([entry]) => {\n        // Update our state when observer callback fires\n        setIntersecting(entry.isIntersecting);\n      });\n    }\n\n    if (element) {\n      observer?.observe(element);\n    }\n    return () => {\n      if (element) {\n        observer?.unobserve(element);\n      }\n    };\n  }, []);\n\n  return isIntersecting;\n}\n","import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport { MAX_TITLE_LENGTH } from \"@shared/constants\";\nimport { light } from \"@shared/styles/theme\";\nimport {\n  getCurrentDateAsString,\n  getCurrentDateTimeAsString,\n  getCurrentTimeAsString,\n} from \"@shared/utils/date\";\nimport Document from \"~/models/Document\";\nimport ContentEditable, { RefHandle } from \"~/components/ContentEditable\";\nimport Star, { AnimatedStar } from \"~/components/Star\";\nimport useEmojiWidth from \"~/hooks/useEmojiWidth\";\nimport { isModKey } from \"~/utils/keyboard\";\n\ntype Props = {\n  value: string;\n  placeholder: string;\n  document: Document;\n  /** Should the title be editable, policies will also be considered separately */\n  readOnly?: boolean;\n  /** Whether the title show the option to star, policies will also be considered separately (defaults to true) */\n  starrable?: boolean;\n  /** Callback called on any edits to text */\n  onChange: (text: string) => void;\n  /** Callback called when the user expects to move to the \"next\" input */\n  onGoToNextInput: (insertParagraph?: boolean) => void;\n  /** Callback called when the user expects to save (CMD+S) */\n  onSave?: (options: { publish?: boolean; done?: boolean }) => void;\n  /** Callback called when focus leaves the input */\n  onBlur?: React.FocusEventHandler<HTMLSpanElement>;\n};\n\nconst lineHeight = \"1.25\";\nconst fontSize = \"2.25em\";\n\nconst EditableTitle = React.forwardRef(\n  (\n    {\n      value,\n      document,\n      readOnly,\n      onChange,\n      onSave,\n      onGoToNextInput,\n      onBlur,\n      starrable,\n      placeholder,\n    }: Props,\n    ref: React.RefObject<RefHandle>\n  ) => {\n    const normalizedTitle =\n      !value && readOnly ? document.titleWithDefault : value;\n\n    const handleClick = React.useCallback(() => {\n      ref.current?.focus();\n    }, [ref]);\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent) => {\n        if (event.key === \"Enter\") {\n          event.preventDefault();\n\n          if (isModKey(event)) {\n            onSave?.({\n              done: true,\n            });\n            return;\n          }\n\n          onGoToNextInput(true);\n          return;\n        }\n\n        if (event.key === \"Tab\" || event.key === \"ArrowDown\") {\n          event.preventDefault();\n          onGoToNextInput();\n          return;\n        }\n\n        if (event.key === \"p\" && isModKey(event) && event.shiftKey) {\n          event.preventDefault();\n          onSave?.({\n            publish: true,\n            done: true,\n          });\n          return;\n        }\n\n        if (event.key === \"s\" && isModKey(event)) {\n          event.preventDefault();\n          onSave?.({});\n          return;\n        }\n      },\n      [onGoToNextInput, onSave]\n    );\n\n    const handleChange = React.useCallback(\n      (text: string) => {\n        if (/\\/date\\s$/.test(text)) {\n          onChange(getCurrentDateAsString());\n          ref.current?.focusAtEnd();\n        } else if (/\\/time$/.test(text)) {\n          onChange(getCurrentTimeAsString());\n          ref.current?.focusAtEnd();\n        } else if (/\\/datetime$/.test(text)) {\n          onChange(getCurrentDateTimeAsString());\n          ref.current?.focusAtEnd();\n        } else {\n          onChange(text);\n        }\n      },\n      [ref, onChange]\n    );\n\n    const emojiWidth = useEmojiWidth(document.emoji, {\n      fontSize,\n      lineHeight,\n    });\n\n    return (\n      <Title\n        onClick={handleClick}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onBlur={onBlur}\n        placeholder={placeholder}\n        value={normalizedTitle}\n        $emojiWidth={emojiWidth}\n        $isStarred={document.isStarred}\n        autoFocus={!value}\n        maxLength={MAX_TITLE_LENGTH}\n        readOnly={readOnly}\n        dir=\"auto\"\n        ref={ref}\n      >\n        {starrable !== false && <StarButton document={document} size={32} />}\n      </Title>\n    );\n  }\n);\n\nconst StarButton = styled(Star)`\n  position: relative;\n  top: 4px;\n  left: 10px;\n  overflow: hidden;\n  width: 24px;\n\n  svg {\n    position: relative;\n    left: -4px;\n  }\n`;\n\ntype TitleProps = {\n  $isStarred: boolean;\n  $emojiWidth: number;\n};\n\nconst Title = styled(ContentEditable)<TitleProps>`\n  line-height: ${lineHeight};\n  margin-top: 1em;\n  margin-bottom: 0.5em;\n  font-size: ${fontSize};\n  font-weight: 500;\n  border: 0;\n  padding: 0;\n  cursor: ${(props) => (props.readOnly ? \"default\" : \"text\")};\n\n  > span {\n    outline: none;\n  }\n\n  &::placeholder {\n    color: ${(props) => props.theme.placeholder};\n    -webkit-text-fill-color: ${(props) => props.theme.placeholder};\n  }\n\n  ${breakpoint(\"tablet\")`\n    margin-left: ${(props: TitleProps) => -props.$emojiWidth}px;\n  `};\n\n  ${AnimatedStar} {\n    opacity: ${(props) => (props.$isStarred ? \"1 !important\" : 0)};\n  }\n\n  &:hover {\n    ${AnimatedStar} {\n      opacity: 0.5;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n  }\n\n  @media print {\n    color: ${light.text};\n    -webkit-text-fill-color: ${light.text};\n    background: none;\n  }\n`;\n\nexport default observer(EditableTitle);\n","import * as React from \"react\";\n\ntype Options = {\n  fontSize?: string;\n  lineHeight?: string;\n};\n\n/**\n * Measures the width of an emoji character\n */\nexport default function useEmojiWidth(\n  emoji: string | undefined,\n  { fontSize = \"2.25em\", lineHeight = \"1.25\" }: Options\n) {\n  return React.useMemo(() => {\n    const element = window.document.createElement(\"span\");\n    if (!emoji) {\n      return 0;\n    }\n\n    element.innerText = `${emoji}\\u00A0`;\n    element.style.visibility = \"hidden\";\n    element.style.position = \"absolute\";\n    element.style.left = \"-9999px\";\n    element.style.lineHeight = lineHeight;\n    element.style.fontSize = fontSize;\n    element.style.width = \"max-content\";\n    window.document.body?.appendChild(element);\n    const width = window.getComputedStyle(element).width;\n    window.document.body?.removeChild(element);\n    return parseInt(width, 10);\n  }, [emoji, fontSize, lineHeight]);\n}\n","import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport fullPackage from \"@shared/editor/packages/full\";\nimport Document from \"~/models/Document\";\nimport { RefHandle } from \"~/components/ContentEditable\";\nimport DocumentMetaWithViews from \"~/components/DocumentMetaWithViews\";\nimport Editor, { Props as EditorProps } from \"~/components/Editor\";\nimport Flex from \"~/components/Flex\";\nimport {\n  documentHistoryUrl,\n  documentUrl,\n  matchDocumentHistory,\n} from \"~/utils/routeHelpers\";\nimport MultiplayerEditor from \"./AsyncMultiplayerEditor\";\nimport EditableTitle from \"./EditableTitle\";\n\ntype Props = Omit<EditorProps, \"extensions\"> & {\n  onChangeTitle: (text: string) => void;\n  title: string;\n  id: string;\n  document: Document;\n  isDraft: boolean;\n  multiplayer?: boolean;\n  onSave: (options: {\n    done?: boolean;\n    autosave?: boolean;\n    publish?: boolean;\n  }) => void;\n  children: React.ReactNode;\n};\n\n/**\n * The main document editor includes an editable title with metadata below it,\n * and support for hover previews of internal links.\n */\nfunction DocumentEditor(props: Props, ref: React.RefObject<any>) {\n  const titleRef = React.useRef<RefHandle>(null);\n  const { t } = useTranslation();\n  const match = useRouteMatch();\n  const {\n    document,\n    title,\n    onChangeTitle,\n    isDraft,\n    shareId,\n    readOnly,\n    children,\n    multiplayer,\n    ...rest\n  } = props;\n\n  const focusAtStart = React.useCallback(() => {\n    if (ref.current) {\n      ref.current.focusAtStart();\n    }\n  }, [ref]);\n\n  const handleBlur = React.useCallback(() => {\n    props.onSave({ autosave: true });\n  }, [props]);\n\n  const handleGoToNextInput = React.useCallback(\n    (insertParagraph: boolean) => {\n      if (insertParagraph && ref.current) {\n        const { view } = ref.current;\n        const { dispatch, state } = view;\n        dispatch(state.tr.insert(0, state.schema.nodes.paragraph.create()));\n      }\n\n      focusAtStart();\n    },\n    [focusAtStart, ref]\n  );\n\n  const EditorComponent = multiplayer ? MultiplayerEditor : Editor;\n\n  return (\n    <Flex auto column>\n      <EditableTitle\n        ref={titleRef}\n        value={title}\n        readOnly={readOnly}\n        document={document}\n        onGoToNextInput={handleGoToNextInput}\n        onChange={onChangeTitle}\n        onBlur={handleBlur}\n        starrable={!shareId}\n        placeholder={t(\"Untitled\")}\n      />\n      {!shareId && (\n        <DocumentMetaWithViews\n          isDraft={isDraft}\n          document={document}\n          to={\n            match.path === matchDocumentHistory\n              ? documentUrl(document)\n              : documentHistoryUrl(document)\n          }\n          rtl={\n            titleRef.current?.getComputedDirection() === \"rtl\" ? true : false\n          }\n        />\n      )}\n      <EditorComponent\n        ref={ref}\n        autoFocus={!!title && !props.defaultValue}\n        placeholder={t(\"Type '/' to insert, or start writing\")}\n        scrollTo={window.location.hash}\n        readOnly={readOnly}\n        shareId={shareId}\n        extensions={fullPackage}\n        grow\n        {...rest}\n      />\n      {children}\n    </Flex>\n  );\n}\n\nexport default observer(React.forwardRef(DocumentEditor));\n","import { sortBy, filter, uniq, isEqual } from \"lodash\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { usePopoverState, PopoverDisclosure } from \"reakit/Popover\";\nimport Document from \"~/models/Document\";\nimport { AvatarWithPresence } from \"~/components/Avatar\";\nimport DocumentViews from \"~/components/DocumentViews\";\nimport Facepile from \"~/components/Facepile\";\nimport NudeButton from \"~/components/NudeButton\";\nimport Popover from \"~/components/Popover\";\nimport useCurrentTeam from \"~/hooks/useCurrentTeam\";\nimport useCurrentUser from \"~/hooks/useCurrentUser\";\nimport useStores from \"~/hooks/useStores\";\n\ntype Props = {\n  document: Document;\n};\n\nfunction Collaborators(props: Props) {\n  const { t } = useTranslation();\n  const user = useCurrentUser();\n  const team = useCurrentTeam();\n  const currentUserId = user?.id;\n  const [requestedUserIds, setRequestedUserIds] = React.useState<string[]>([]);\n  const { users, presence, ui } = useStores();\n  const { document } = props;\n  const documentPresence = presence.get(document.id);\n  const documentPresenceArray = documentPresence\n    ? Array.from(documentPresence.values())\n    : [];\n\n  const presentIds = documentPresenceArray.map((p) => p.userId);\n  const editingIds = documentPresenceArray\n    .filter((p) => p.isEditing)\n    .map((p) => p.userId);\n\n  // ensure currently present via websocket are always ordered first\n  const collaborators = React.useMemo(\n    () =>\n      sortBy(\n        filter(\n          users.orderedData,\n          (user) =>\n            (presentIds.includes(user.id) ||\n              document.collaboratorIds.includes(user.id)) &&\n            !user.isSuspended\n        ),\n        (user) => presentIds.includes(user.id)\n      ),\n    [document.collaboratorIds, users.orderedData, presentIds]\n  );\n\n  // load any users we don't yet have in memory\n  React.useEffect(() => {\n    const ids = uniq([...document.collaboratorIds, ...presentIds])\n      .filter((userId) => !users.get(userId))\n      .sort();\n\n    if (!isEqual(requestedUserIds, ids) && ids.length > 0) {\n      setRequestedUserIds(ids);\n      users.fetchPage({ ids, limit: 100 });\n    }\n  }, [document, users, presentIds, document.collaboratorIds, requestedUserIds]);\n\n  const popover = usePopoverState({\n    gutter: 0,\n    placement: \"bottom-end\",\n  });\n\n  return (\n    <>\n      <PopoverDisclosure {...popover}>\n        {(props) => (\n          <NudeButton width={collaborators.length * 32} height={32} {...props}>\n            <Facepile\n              users={collaborators}\n              renderAvatar={(collaborator) => {\n                const isPresent = presentIds.includes(collaborator.id);\n                const isEditing = editingIds.includes(collaborator.id);\n                const isObserving = ui.observingUserId === collaborator.id;\n                const isObservable =\n                  team.collaborativeEditing && collaborator.id !== user.id;\n\n                return (\n                  <AvatarWithPresence\n                    key={collaborator.id}\n                    user={collaborator}\n                    isPresent={isPresent}\n                    isEditing={isEditing}\n                    isObserving={isObserving}\n                    isCurrentUser={currentUserId === collaborator.id}\n                    profileOnClick={false}\n                    onClick={\n                      isObservable\n                        ? (ev) => {\n                            if (isPresent) {\n                              ev.preventDefault();\n                              ev.stopPropagation();\n                              ui.setObservingUser(\n                                isObserving ? undefined : collaborator.id\n                              );\n                            }\n                          }\n                        : undefined\n                    }\n                  />\n                );\n              }}\n            />\n          </NudeButton>\n        )}\n      </PopoverDisclosure>\n      <Popover {...popover} width={300} aria-label={t(\"Viewers\")} tabIndex={0}>\n        <DocumentViews document={document} isOpen={popover.visible} />\n      </Popover>\n    </>\n  );\n}\n\nexport default observer(Collaborators);\n","import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { useMenuState, MenuButton, MenuButtonHTMLProps } from \"reakit/Menu\";\nimport Document from \"~/models/Document\";\nimport ContextMenu from \"~/components/ContextMenu\";\nimport Template from \"~/components/ContextMenu/Template\";\nimport useStores from \"~/hooks/useStores\";\nimport { newDocumentPath } from \"~/utils/routeHelpers\";\n\ntype Props = {\n  label?: (props: MenuButtonHTMLProps) => React.ReactNode;\n  document: Document;\n};\n\nfunction NewChildDocumentMenu({ document, label }: Props) {\n  const menu = useMenuState({\n    modal: true,\n  });\n  const { collections } = useStores();\n  const { t } = useTranslation();\n  const collection = collections.get(document.collectionId);\n  const collectionName = collection ? collection.name : t(\"collection\");\n\n  return (\n    <>\n      <MenuButton {...menu}>{label}</MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"New child document\")}>\n        <Template\n          {...menu}\n          items={[\n            {\n              type: \"route\",\n              title: (\n                <span>\n                  <Trans\n                    defaults=\"New document in <em>{{ collectionName }}</em>\"\n                    values={{\n                      collectionName,\n                    }}\n                    components={{\n                      em: <strong />,\n                    }}\n                  />\n                </span>\n              ),\n              to: newDocumentPath(document.collectionId),\n            },\n            {\n              type: \"route\",\n              title: t(\"New nested document\"),\n              to: newDocumentPath(document.collectionId, {\n                parentDocumentId: document.id,\n              }),\n            },\n          ]}\n        />\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(NewChildDocumentMenu);\n","import { observer } from \"mobx-react\";\nimport { TableOfContentsIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { MenuButton, useMenuState } from \"reakit/Menu\";\nimport Button from \"~/components/Button\";\nimport ContextMenu from \"~/components/ContextMenu\";\nimport Template from \"~/components/ContextMenu/Template\";\nimport { MenuItem } from \"~/types\";\n\ntype Props = {\n  headings: {\n    title: string;\n    level: number;\n    id: string;\n  }[];\n};\n\nfunction TableOfContentsMenu({ headings }: Props) {\n  const menu = useMenuState({\n    modal: true,\n    unstable_preventOverflow: true,\n    unstable_fixed: true,\n    unstable_flip: true,\n  });\n  const { t } = useTranslation();\n  const minHeading = headings.reduce(\n    (memo, heading) => (heading.level < memo ? heading.level : memo),\n    Infinity\n  );\n\n  // @ts-expect-error check\n  const items: MenuItem[] = React.useMemo(() => {\n    const i = [\n      {\n        type: \"heading\",\n        visible: true,\n        title: t(\"Contents\"),\n      },\n      ...headings.map((heading) => ({\n        type: \"link\",\n        href: `#${heading.id}`,\n        title: t(heading.title),\n        level: heading.level - minHeading,\n      })),\n    ];\n\n    if (i.length === 1) {\n      i.push({\n        type: \"link\",\n        href: \"#\",\n        title: t(\"Headings you add to the document will appear here\"),\n        // @ts-expect-error check\n        disabled: true,\n      });\n    }\n\n    return i;\n  }, [t, headings, minHeading]);\n\n  return (\n    <>\n      <MenuButton {...menu}>\n        {(props) => (\n          <Button\n            {...props}\n            icon={<TableOfContentsIcon />}\n            iconColor=\"currentColor\"\n            borderOnHover\n            neutral\n          />\n        )}\n      </MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"Table of contents\")}>\n        <Template {...menu} items={items} />\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(TableOfContentsMenu);\n","import { observer } from \"mobx-react\";\nimport { DocumentIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { MenuButton, useMenuState } from \"reakit/Menu\";\nimport styled from \"styled-components\";\nimport Document from \"~/models/Document\";\nimport Button from \"~/components/Button\";\nimport ContextMenu from \"~/components/ContextMenu\";\nimport MenuItem from \"~/components/ContextMenu/MenuItem\";\nimport Separator from \"~/components/ContextMenu/Separator\";\nimport useStores from \"~/hooks/useStores\";\n\ntype Props = {\n  document: Document;\n  onSelectTemplate: (template: Document) => void;\n};\n\nfunction TemplatesMenu({ onSelectTemplate, document }: Props) {\n  const menu = useMenuState({\n    modal: true,\n  });\n  const { documents } = useStores();\n  const { t } = useTranslation();\n  const templates = documents.templates;\n\n  if (!templates.length) {\n    return null;\n  }\n\n  const templatesInCollection = templates.filter(\n    (t) => t.collectionId === document.collectionId\n  );\n  const otherTemplates = templates.filter(\n    (t) => t.collectionId !== document.collectionId\n  );\n\n  const renderTemplate = (template: Document) => (\n    <MenuItem\n      key={template.id}\n      onClick={() => onSelectTemplate(template)}\n      icon={<DocumentIcon />}\n      {...menu}\n    >\n      <TemplateItem>\n        <strong>{template.titleWithDefault}</strong>\n        <br />\n        <Author>\n          {t(\"By {{ author }}\", {\n            author: template.createdBy.name,\n          })}\n        </Author>\n      </TemplateItem>\n    </MenuItem>\n  );\n\n  return (\n    <>\n      <MenuButton {...menu}>\n        {(props) => (\n          <Button {...props} disclosure neutral>\n            {t(\"Templates\")}\n          </Button>\n        )}\n      </MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"Templates\")}>\n        {templatesInCollection.map(renderTemplate)}\n        {otherTemplates.length && templatesInCollection.length ? (\n          <Separator />\n        ) : undefined}\n        {otherTemplates.map(renderTemplate)}\n      </ContextMenu>\n    </>\n  );\n}\n\nconst TemplateItem = styled.div`\n  text-align: left;\n`;\n\nconst Author = styled.div`\n  font-size: 13px;\n`;\n\nexport default observer(TemplatesMenu);\n","import { m, AnimatePresence } from \"framer-motion\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport { depths } from \"@shared/styles\";\nimport useStores from \"~/hooks/useStores\";\n\nconst transition = {\n  type: \"spring\",\n  stiffness: 500,\n  damping: 30,\n};\n\n/**\n * A small banner that is displayed at the top of the screen when the user is\n * observing another user while editing a document\n */\nfunction ObservingBanner() {\n  const { ui, users } = useStores();\n  const { t } = useTranslation();\n  const user = ui.observingUserId ? users.get(ui.observingUserId) : undefined;\n\n  return (\n    <Positioner>\n      <AnimatePresence>\n        {user && (\n          <Banner\n            $color={user.color}\n            transition={transition}\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: -5 }}\n            exit={{ opacity: 0, y: -30 }}\n          >\n            {t(\"Observing {{ userName }}\", { userName: user.name })}\n          </Banner>\n        )}\n      </AnimatePresence>\n    </Positioner>\n  );\n}\n\nconst Positioner = styled.div`\n  position: fixed;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n`;\n\nconst Banner = styled(m.div)<{ $color: string }>`\n  padding: 6px 6px 1px;\n  font-size: 13px;\n  font-weight: 500;\n  z-index: ${depths.header + 1};\n  color: ${(props) => props.theme.white};\n  background: ${(props) => props.$color};\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n`;\n\nexport default observer(ObservingBanner);\n","import * as React from \"react\";\nimport Breadcrumb from \"~/components/Breadcrumb\";\nimport { MenuInternalLink, NavigationNode } from \"~/types\";\n\ntype Props = {\n  documentId: string;\n  shareId: string;\n  sharedTree: NavigationNode | undefined;\n};\n\nfunction pathToDocument(\n  sharedTree: NavigationNode | undefined,\n  documentId: string\n) {\n  let path: NavigationNode[] = [];\n\n  const traveler = (\n    nodes: NavigationNode[],\n    previousPath: NavigationNode[]\n  ) => {\n    nodes.forEach((childNode) => {\n      const newPath = [...previousPath, childNode];\n\n      if (childNode.id === documentId) {\n        path = newPath;\n        return;\n      }\n\n      return traveler(childNode.children, newPath);\n    });\n  };\n\n  if (sharedTree) {\n    traveler([sharedTree], []);\n  }\n\n  return path;\n}\n\nconst PublicBreadcrumb: React.FC<Props> = ({\n  documentId,\n  shareId,\n  sharedTree,\n  children,\n}) => {\n  const items: MenuInternalLink[] = React.useMemo(\n    () =>\n      pathToDocument(sharedTree, documentId)\n        .slice(0, -1)\n        .map((item) => {\n          return { ...item, type: \"route\", to: `/share/${shareId}${item.url}` };\n        }),\n    [sharedTree, shareId, documentId]\n  );\n\n  return <Breadcrumb items={items} children={children} />;\n};\n\nexport default PublicBreadcrumb;\n","import { formatDistanceToNow } from \"date-fns\";\nimport invariant from \"invariant\";\nimport { observer } from \"mobx-react\";\nimport { GlobeIcon, PadlockIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport Document from \"~/models/Document\";\nimport Share from \"~/models/Share\";\nimport Button from \"~/components/Button\";\nimport CopyToClipboard from \"~/components/CopyToClipboard\";\nimport Flex from \"~/components/Flex\";\nimport Input from \"~/components/Input\";\nimport Notice from \"~/components/Notice\";\nimport Switch from \"~/components/Switch\";\nimport Text from \"~/components/Text\";\nimport useKeyDown from \"~/hooks/useKeyDown\";\nimport usePolicy from \"~/hooks/usePolicy\";\nimport useStores from \"~/hooks/useStores\";\nimport useToasts from \"~/hooks/useToasts\";\nimport useUserLocale from \"~/hooks/useUserLocale\";\nimport { dateLocale } from \"~/utils/i18n\";\n\ntype Props = {\n  document: Document;\n  share: Share | null | undefined;\n  sharedParent: Share | null | undefined;\n  onRequestClose: () => void;\n  visible: boolean;\n};\n\nfunction SharePopover({\n  document,\n  share,\n  sharedParent,\n  onRequestClose,\n  visible,\n}: Props) {\n  const { t } = useTranslation();\n  const { shares, auth } = useStores();\n  const { showToast } = useToasts();\n  const [isCopied, setIsCopied] = React.useState(false);\n  const timeout = React.useRef<ReturnType<typeof setTimeout>>();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n  const can = usePolicy(share ? share.id : \"\");\n  const documentAbilities = usePolicy(document.id);\n  const canPublish =\n    can.update &&\n    !document.isTemplate &&\n    auth.team?.sharing &&\n    documentAbilities.share;\n  const isPubliclyShared =\n    (share && share.published) ||\n    (sharedParent && sharedParent.published && !document.isDraft);\n\n  useKeyDown(\"Escape\", onRequestClose);\n\n  React.useEffect(() => {\n    if (visible) {\n      document.share();\n      buttonRef.current?.focus();\n    }\n\n    return () => (timeout.current ? clearTimeout(timeout.current) : undefined);\n  }, [document, visible]);\n\n  const handlePublishedChange = React.useCallback(\n    async (event) => {\n      const share = shares.getByDocumentId(document.id);\n      invariant(share, \"Share must exist\");\n\n      try {\n        await share.save({\n          published: event.currentTarget.checked,\n        });\n      } catch (err) {\n        showToast(err.message, {\n          type: \"error\",\n        });\n      }\n    },\n    [document.id, shares, showToast]\n  );\n\n  const handleChildDocumentsChange = React.useCallback(\n    async (event) => {\n      const share = shares.getByDocumentId(document.id);\n      invariant(share, \"Share must exist\");\n\n      try {\n        await share.save({\n          includeChildDocuments: event.currentTarget.checked,\n        });\n      } catch (err) {\n        showToast(err.message, {\n          type: \"error\",\n        });\n      }\n    },\n    [document.id, shares, showToast]\n  );\n\n  const handleCopied = React.useCallback(() => {\n    setIsCopied(true);\n    timeout.current = setTimeout(() => {\n      setIsCopied(false);\n      onRequestClose();\n      showToast(t(\"Share link copied\"), {\n        type: \"info\",\n      });\n    }, 250);\n  }, [t, onRequestClose, showToast]);\n\n  const userLocale = useUserLocale();\n  const locale = userLocale ? dateLocale(userLocale) : undefined;\n\n  return (\n    <>\n      <Heading>\n        {isPubliclyShared ? (\n          <GlobeIcon size={28} color=\"currentColor\" />\n        ) : (\n          <PadlockIcon size={28} color=\"currentColor\" />\n        )}{\" \"}\n        {t(\"Share this document\")}\n      </Heading>\n\n      {sharedParent && !document.isDraft && (\n        <Notice>\n          <Trans\n            defaults=\"This document is shared because the parent <em>{{ documentTitle }}</em> is publicly shared\"\n            values={{\n              documentTitle: sharedParent.documentTitle,\n            }}\n            components={{\n              em: <strong />,\n            }}\n          />\n        </Notice>\n      )}\n\n      {canPublish ? (\n        <SwitchWrapper>\n          <Switch\n            id=\"published\"\n            label={t(\"Publish to internet\")}\n            onChange={handlePublishedChange}\n            checked={share ? share.published : false}\n            disabled={!share}\n          />\n          <SwitchLabel>\n            <SwitchText>\n              {share?.published\n                ? t(\"Anyone with the link can view this document\")\n                : t(\"Only team members with permission can view\")}\n              {share?.lastAccessedAt && (\n                <>\n                  .{\" \"}\n                  {t(\"The shared link was last accessed {{ timeAgo }}.\", {\n                    timeAgo: formatDistanceToNow(\n                      Date.parse(share?.lastAccessedAt),\n                      {\n                        addSuffix: true,\n                        locale,\n                      }\n                    ),\n                  })}\n                </>\n              )}\n            </SwitchText>\n          </SwitchLabel>\n        </SwitchWrapper>\n      ) : (\n        <Text type=\"secondary\">\n          {t(\"Only team members with permission can view\")}\n        </Text>\n      )}\n\n      {canPublish && share?.published && !document.isDraft && (\n        <SwitchWrapper>\n          <Switch\n            id=\"includeChildDocuments\"\n            label={t(\"Share nested documents\")}\n            onChange={handleChildDocumentsChange}\n            checked={share ? share.includeChildDocuments : false}\n            disabled={!share}\n          />\n          <SwitchLabel>\n            <SwitchText>\n              {share.includeChildDocuments\n                ? t(\"Nested documents are publicly available\")\n                : t(\"Nested documents are not shared\")}\n            </SwitchText>\n          </SwitchLabel>\n        </SwitchWrapper>\n      )}\n      <Flex>\n        <InputLink\n          type=\"text\"\n          label={t(\"Link\")}\n          placeholder={`${t(\"Loading\")}`}\n          value={share ? share.url : \"\"}\n          labelHidden\n          readOnly\n        />\n        <CopyToClipboard text={share ? share.url : \"\"} onCopy={handleCopied}>\n          <Button\n            type=\"submit\"\n            disabled={isCopied || !share}\n            ref={buttonRef}\n            primary\n          >\n            {t(\"Copy link\")}\n          </Button>\n        </CopyToClipboard>\n      </Flex>\n    </>\n  );\n}\n\nconst Heading = styled.h2`\n  display: flex;\n  align-items: center;\n  margin-top: 12px;\n  margin-left: -4px;\n`;\n\nconst SwitchWrapper = styled.div`\n  margin: 20px 0;\n`;\n\nconst InputLink = styled(Input)`\n  flex-grow: 1;\n  margin-right: 8px;\n`;\n\nconst SwitchLabel = styled(Flex)`\n  svg {\n    flex-shrink: 0;\n  }\n`;\n\nconst SwitchText = styled(Text)`\n  margin: 0;\n  font-size: 15px;\n`;\n\nexport default observer(SharePopover);\n","import { observer } from \"mobx-react\";\nimport { GlobeIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { usePopoverState, PopoverDisclosure } from \"reakit/Popover\";\nimport Document from \"~/models/Document\";\nimport Button from \"~/components/Button\";\nimport Popover from \"~/components/Popover\";\nimport Tooltip from \"~/components/Tooltip\";\nimport useStores from \"~/hooks/useStores\";\nimport SharePopover from \"./SharePopover\";\n\ntype Props = {\n  document: Document;\n};\n\nfunction ShareButton({ document }: Props) {\n  const { t } = useTranslation();\n  const { shares } = useStores();\n  const share = shares.getByDocumentId(document.id);\n  const sharedParent = shares.getByDocumentParents(document.id);\n  const isPubliclyShared =\n    share?.published || (sharedParent?.published && !document.isDraft);\n\n  const popover = usePopoverState({\n    gutter: 0,\n    placement: \"bottom-end\",\n    unstable_fixed: true,\n  });\n\n  return (\n    <>\n      <PopoverDisclosure {...popover}>\n        {(props) => (\n          <Tooltip\n            tooltip={\n              isPubliclyShared ? (\n                <Trans>\n                  Anyone with the link <br />\n                  can view this document\n                </Trans>\n              ) : (\n                \"\"\n              )\n            }\n            delay={500}\n            placement=\"bottom\"\n          >\n            <Button\n              icon={isPubliclyShared ? <GlobeIcon /> : undefined}\n              neutral\n              {...props}\n            >\n              {t(\"Share\")}\n            </Button>\n          </Tooltip>\n        )}\n      </PopoverDisclosure>\n\n      <Popover {...popover} aria-label={t(\"Share\")}>\n        <SharePopover\n          document={document}\n          share={share}\n          sharedParent={sharedParent}\n          onRequestClose={popover.hide}\n          visible={popover.visible}\n        />\n      </Popover>\n    </>\n  );\n}\n\nexport default observer(ShareButton);\n","import { observer } from \"mobx-react\";\nimport {\n  TableOfContentsIcon,\n  EditIcon,\n  PlusIcon,\n  MoonIcon,\n  MoreIcon,\n  SunIcon,\n} from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { Theme } from \"~/stores/UiStore\";\nimport Document from \"~/models/Document\";\nimport { Action, Separator } from \"~/components/Actions\";\nimport Badge from \"~/components/Badge\";\nimport Button from \"~/components/Button\";\nimport Collaborators from \"~/components/Collaborators\";\nimport DocumentBreadcrumb from \"~/components/DocumentBreadcrumb\";\nimport Header from \"~/components/Header\";\nimport Tooltip from \"~/components/Tooltip\";\nimport useMobile from \"~/hooks/useMobile\";\nimport usePolicy from \"~/hooks/usePolicy\";\nimport useStores from \"~/hooks/useStores\";\nimport DocumentMenu from \"~/menus/DocumentMenu\";\nimport NewChildDocumentMenu from \"~/menus/NewChildDocumentMenu\";\nimport TableOfContentsMenu from \"~/menus/TableOfContentsMenu\";\nimport TemplatesMenu from \"~/menus/TemplatesMenu\";\nimport { NavigationNode } from \"~/types\";\nimport { metaDisplay } from \"~/utils/keyboard\";\nimport { newDocumentPath, editDocumentUrl } from \"~/utils/routeHelpers\";\nimport ObservingBanner from \"./ObservingBanner\";\nimport PublicBreadcrumb from \"./PublicBreadcrumb\";\nimport ShareButton from \"./ShareButton\";\n\ntype Props = {\n  document: Document;\n  documentHasHeadings: boolean;\n  sharedTree: NavigationNode | undefined;\n  shareId: string | null | undefined;\n  isDraft: boolean;\n  isEditing: boolean;\n  isRevision: boolean;\n  isSaving: boolean;\n  isPublishing: boolean;\n  publishingIsDisabled: boolean;\n  savingIsDisabled: boolean;\n  onSelectTemplate: (template: Document) => void;\n  onSave: (options: {\n    done?: boolean;\n    publish?: boolean;\n    autosave?: boolean;\n  }) => void;\n  headings: {\n    title: string;\n    level: number;\n    id: string;\n  }[];\n};\n\nfunction DocumentHeader({\n  document,\n  documentHasHeadings,\n  shareId,\n  isEditing,\n  isDraft,\n  isPublishing,\n  isRevision,\n  isSaving,\n  savingIsDisabled,\n  publishingIsDisabled,\n  sharedTree,\n  onSelectTemplate,\n  onSave,\n  headings,\n}: Props) {\n  const { t } = useTranslation();\n  const { ui, auth } = useStores();\n  const { resolvedTheme } = ui;\n  const { team } = auth;\n  const isMobile = useMobile();\n\n  // We cache this value for as long as the component is mounted so that if you\n  // apply a template there is still the option to replace it until the user\n  // navigates away from the doc\n  const [isNew] = React.useState(document.isPersistedOnce);\n\n  const handleSave = React.useCallback(() => {\n    onSave({\n      done: true,\n    });\n  }, [onSave]);\n\n  const handlePublish = React.useCallback(() => {\n    onSave({\n      done: true,\n      publish: true,\n    });\n  }, [onSave]);\n\n  const { isDeleted, isTemplate } = document;\n  const can = usePolicy(document.id);\n  const canToggleEmbeds = team?.documentEmbeds;\n  const canEdit = can.update && !isEditing;\n  const toc = (\n    <Tooltip\n      tooltip={ui.tocVisible ? t(\"Hide contents\") : t(\"Show contents\")}\n      shortcut=\"ctrl+alt+h\"\n      delay={250}\n      placement=\"bottom\"\n    >\n      <Button\n        onClick={\n          ui.tocVisible ? ui.hideTableOfContents : ui.showTableOfContents\n        }\n        icon={<TableOfContentsIcon />}\n        iconColor=\"currentColor\"\n        borderOnHover\n        neutral\n      />\n    </Tooltip>\n  );\n  const editAction = (\n    <Action>\n      <Tooltip\n        tooltip={t(\"Edit {{noun}}\", {\n          noun: document.noun,\n        })}\n        shortcut=\"e\"\n        delay={500}\n        placement=\"bottom\"\n      >\n        <Button\n          as={Link}\n          icon={<EditIcon />}\n          to={editDocumentUrl(document)}\n          neutral\n        >\n          {t(\"Edit\")}\n        </Button>\n      </Tooltip>\n    </Action>\n  );\n  const appearanceAction = (\n    <Action>\n      <Tooltip\n        tooltip={\n          resolvedTheme === \"light\" ? t(\"Switch to dark\") : t(\"Switch to light\")\n        }\n        delay={500}\n        placement=\"bottom\"\n      >\n        <Button\n          icon={resolvedTheme === \"light\" ? <SunIcon /> : <MoonIcon />}\n          onClick={() =>\n            ui.setTheme(resolvedTheme === \"light\" ? Theme.Dark : Theme.Light)\n          }\n          neutral\n          borderOnHover\n        />\n      </Tooltip>\n    </Action>\n  );\n\n  if (shareId) {\n    return (\n      <Header\n        title={document.title}\n        hasSidebar={!!sharedTree}\n        breadcrumb={\n          isMobile ? (\n            <TableOfContentsMenu headings={headings} />\n          ) : (\n            <PublicBreadcrumb\n              documentId={document.id}\n              shareId={shareId}\n              sharedTree={sharedTree}\n            >\n              {documentHasHeadings ? toc : null}\n            </PublicBreadcrumb>\n          )\n        }\n        actions={\n          <>\n            {appearanceAction}\n            {canEdit ? editAction : <div />}\n          </>\n        }\n      />\n    );\n  }\n\n  return (\n    <>\n      <Header\n        hasSidebar\n        breadcrumb={\n          isMobile ? (\n            <TableOfContentsMenu headings={headings} />\n          ) : (\n            <DocumentBreadcrumb document={document}>\n              {!isEditing && toc}\n            </DocumentBreadcrumb>\n          )\n        }\n        title={\n          <>\n            {document.title}{\" \"}\n            {document.isArchived && <Badge>{t(\"Archived\")}</Badge>}\n          </>\n        }\n        actions={\n          <>\n            <ObservingBanner />\n\n            {!isPublishing && isSaving && !team?.collaborativeEditing && (\n              <Status>{t(\"Saving\")}</Status>\n            )}\n            {!isDeleted && <Collaborators document={document} />}\n            {(isEditing || team?.collaborativeEditing) && !isTemplate && isNew && (\n              <Action>\n                <TemplatesMenu\n                  document={document}\n                  onSelectTemplate={onSelectTemplate}\n                />\n              </Action>\n            )}\n            {!isEditing && !isDeleted && (!isMobile || !isTemplate) && (\n              <Action>\n                <ShareButton document={document} />\n              </Action>\n            )}\n            {isEditing && (\n              <>\n                <Action>\n                  <Tooltip\n                    tooltip={t(\"Save\")}\n                    shortcut={`${metaDisplay}+enter`}\n                    delay={500}\n                    placement=\"bottom\"\n                  >\n                    <Button\n                      onClick={handleSave}\n                      disabled={savingIsDisabled}\n                      neutral={isDraft}\n                    >\n                      {isDraft ? t(\"Save Draft\") : t(\"Done Editing\")}\n                    </Button>\n                  </Tooltip>\n                </Action>\n              </>\n            )}\n            {canEdit && !team?.collaborativeEditing && editAction}\n            {canEdit && can.createChildDocument && !isMobile && (\n              <Action>\n                <NewChildDocumentMenu\n                  document={document}\n                  label={(props) => (\n                    <Tooltip\n                      tooltip={t(\"New document\")}\n                      shortcut=\"n\"\n                      delay={500}\n                      placement=\"bottom\"\n                    >\n                      <Button icon={<PlusIcon />} {...props} neutral>\n                        {t(\"New doc\")}\n                      </Button>\n                    </Tooltip>\n                  )}\n                />\n              </Action>\n            )}\n            {canEdit && isTemplate && !isDraft && !isRevision && (\n              <Action>\n                <Button\n                  icon={<PlusIcon />}\n                  as={Link}\n                  to={newDocumentPath(document.collectionId, {\n                    templateId: document.id,\n                  })}\n                  primary\n                >\n                  {t(\"New from template\")}\n                </Button>\n              </Action>\n            )}\n            {can.update && isDraft && !isRevision && (\n              <Action>\n                <Tooltip\n                  tooltip={t(\"Publish\")}\n                  shortcut={`${metaDisplay}+shift+p`}\n                  delay={500}\n                  placement=\"bottom\"\n                >\n                  <Button\n                    onClick={handlePublish}\n                    disabled={publishingIsDisabled}\n                  >\n                    {isPublishing ? `${t(\"Publishing\")}` : t(\"Publish\")}\n                  </Button>\n                </Tooltip>\n              </Action>\n            )}\n            {!isEditing && (\n              <>\n                {!isDeleted && <Separator />}\n                <Action>\n                  <DocumentMenu\n                    document={document}\n                    isRevision={isRevision}\n                    label={(props) => (\n                      <Button\n                        icon={<MoreIcon />}\n                        iconColor=\"currentColor\"\n                        {...props}\n                        borderOnHover\n                        neutral\n                      />\n                    )}\n                    showToggleEmbeds={canToggleEmbeds}\n                    showDisplayOptions\n                  />\n                </Action>\n              </>\n            )}\n          </>\n        }\n      />\n    </>\n  );\n}\n\nconst Status = styled(Action)`\n  padding-left: 0;\n  padding-right: 4px;\n  color: ${(props) => props.theme.slate};\n`;\n\nexport default observer(DocumentHeader);\n","import { KeyboardIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport KeyboardShortcuts from \"~/scenes/KeyboardShortcuts\";\nimport Guide from \"~/components/Guide\";\nimport NudeButton from \"~/components/NudeButton\";\nimport Tooltip from \"~/components/Tooltip\";\nimport useBoolean from \"~/hooks/useBoolean\";\n\nfunction KeyboardShortcutsButton() {\n  const { t } = useTranslation();\n  const [\n    keyboardShortcutsOpen,\n    handleOpenKeyboardShortcuts,\n    handleCloseKeyboardShortcuts,\n  ] = useBoolean();\n  return (\n    <>\n      <Guide\n        isOpen={keyboardShortcutsOpen}\n        onRequestClose={handleCloseKeyboardShortcuts}\n        title={t(\"Keyboard shortcuts\")}\n      >\n        <KeyboardShortcuts />\n      </Guide>\n      <Tooltip tooltip={t(\"Keyboard shortcuts\")} shortcut=\"?\" delay={500}>\n        <Button onClick={handleOpenKeyboardShortcuts}>\n          <KeyboardIcon />\n        </Button>\n      </Tooltip>\n    </>\n  );\n}\n\nconst Button = styled(NudeButton)`\n  display: none;\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  margin: 24px;\n\n  ${breakpoint(\"tablet\")`\n    display: block;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default KeyboardShortcutsButton;\n","import * as React from \"react\";\nimport Document from \"~/models/Document\";\n\nconst MARK_AS_VIEWED_AFTER = 3 * 1000;\ntype Props = {\n  document: Document;\n};\n\nclass MarkAsViewed extends React.Component<Props> {\n  viewTimeout: ReturnType<typeof setTimeout>;\n\n  componentDidMount() {\n    const { document } = this.props;\n    this.viewTimeout = setTimeout(async () => {\n      const view = await document.view();\n\n      if (view) {\n        document.updateLastViewed(view);\n      }\n    }, MARK_AS_VIEWED_AFTER);\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.viewTimeout);\n  }\n\n  render() {\n    return this.props.children || null;\n  }\n}\n\nexport default MarkAsViewed;\n","import { TrashIcon, ArchiveIcon, ShapesIcon, InputIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport Document from \"~/models/Document\";\nimport Notice from \"~/components/Notice\";\nimport Time from \"~/components/Time\";\n\ntype Props = {\n  document: Document;\n  readOnly: boolean;\n};\n\nexport default function Notices({ document, readOnly }: Props) {\n  const { t } = useTranslation();\n\n  function permanentlyDeletedDescription() {\n    if (!document.permanentlyDeletedAt) {\n      return;\n    }\n\n    return document.template ? (\n      <Trans>\n        This template will be permanently deleted in{\" \"}\n        <Time dateTime={document.permanentlyDeletedAt} /> unless restored.\n      </Trans>\n    ) : (\n      <Trans>\n        This document will be permanently deleted in{\" \"}\n        <Time dateTime={document.permanentlyDeletedAt} /> unless restored.\n      </Trans>\n    );\n  }\n\n  return (\n    <>\n      {document.isTemplate && !readOnly && (\n        <Notice\n          icon={<ShapesIcon />}\n          description={\n            <Trans>\n              Highlight some text and use the{\" \"}\n              <PlaceholderIcon color=\"currentColor\" /> control to add\n              placeholders that can be filled out when creating new documents\n            </Trans>\n          }\n        >\n          {t(\"Youre editing a template\")}\n        </Notice>\n      )}\n      {document.archivedAt && !document.deletedAt && (\n        <Notice icon={<ArchiveIcon />}>\n          {t(\"Archived by {{userName}}\", {\n            userName: document.updatedBy.name,\n          })}\n          &nbsp;\n          <Time dateTime={document.updatedAt} addSuffix />\n        </Notice>\n      )}\n      {document.deletedAt && (\n        <Notice\n          icon={<TrashIcon />}\n          description={permanentlyDeletedDescription()}\n        >\n          {t(\"Deleted by {{userName}}\", {\n            userName: document.updatedBy.name,\n          })}\n          &nbsp;\n          <Time dateTime={document.deletedAt} addSuffix />\n        </Notice>\n      )}\n    </>\n  );\n}\n\nconst PlaceholderIcon = styled(InputIcon)`\n  position: relative;\n  top: 6px;\n  margin-top: -6px;\n`;\n","import { observer } from \"mobx-react\";\nimport { DocumentIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport parseTitle from \"@shared/utils/parseTitle\";\nimport Document from \"~/models/Document\";\nimport EmojiIcon from \"~/components/EmojiIcon\";\nimport Flex from \"~/components/Flex\";\nimport { hover } from \"~/styles\";\nimport { NavigationNode } from \"~/types\";\n\ntype Props = {\n  shareId?: string;\n  document: Document | NavigationNode;\n  anchor?: string;\n  showCollection?: boolean;\n};\n\nconst DocumentLink = styled(Link)`\n  display: block;\n  margin: 2px -8px;\n  padding: 6px 8px;\n  border-radius: 8px;\n  max-height: 50vh;\n  min-width: 100%;\n  overflow: hidden;\n  position: relative;\n\n  &:${hover},\n  &:active,\n  &:focus {\n    background: ${(props) => props.theme.listItemHoverBackground};\n  }\n`;\n\nconst Content = styled(Flex)`\n  color: ${(props) => props.theme.textSecondary};\n  margin-left: -4px;\n`;\n\nconst Title = styled.div`\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 14px;\n  font-weight: 500;\n  line-height: 1.25;\n  padding-top: 3px;\n  white-space: nowrap;\n  color: ${(props) => props.theme.text};\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen,\n    Ubuntu, Cantarell, \"Open Sans\", \"Helvetica Neue\", sans-serif;\n`;\n\nfunction ReferenceListItem({\n  document,\n  showCollection,\n  anchor,\n  shareId,\n  ...rest\n}: Props) {\n  const { emoji } = parseTitle(document.title);\n\n  return (\n    <DocumentLink\n      to={{\n        pathname: shareId ? `/share/${shareId}${document.url}` : document.url,\n        hash: anchor ? `d-${anchor}` : undefined,\n        state: {\n          title: document.title,\n        },\n      }}\n      {...rest}\n    >\n      <Content gap={4} dir=\"auto\">\n        {emoji ? (\n          <EmojiIcon emoji={emoji} />\n        ) : (\n          <DocumentIcon color=\"currentColor\" />\n        )}\n        <Title>\n          {emoji ? document.title.replace(emoji, \"\") : document.title}\n        </Title>\n      </Content>\n    </DocumentLink>\n  );\n}\n\nexport default observer(ReferenceListItem);\n","import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport Subheading from \"~/components/Subheading\";\nimport { NavigationNode } from \"~/types\";\nimport ReferenceListItem from \"./ReferenceListItem\";\n\ntype Props = {\n  shareId: string;\n  documentId: string;\n  sharedTree?: NavigationNode;\n};\n\nfunction PublicReferences(props: Props) {\n  const { t } = useTranslation();\n  const { shareId, documentId, sharedTree } = props;\n\n  // The sharedTree is the entire document tree starting at the shared document\n  // we must filter down the tree to only the part with the document we're\n  // currently viewing\n  const children = React.useMemo(() => {\n    let result: NavigationNode[];\n\n    function findChildren(node?: NavigationNode) {\n      if (!node) {\n        return;\n      }\n\n      if (node.id === documentId) {\n        result = node.children;\n      } else {\n        node.children.forEach((node) => {\n          if (result) {\n            return;\n          }\n\n          findChildren(node);\n        });\n      }\n\n      return result;\n    }\n\n    return findChildren(sharedTree) || [];\n  }, [documentId, sharedTree]);\n\n  if (!children.length) {\n    return null;\n  }\n\n  return (\n    <>\n      <Subheading>{t(\"Nested documents\")}</Subheading>\n      {children.map((node) => (\n        <ReferenceListItem key={node.id} document={node} shareId={shareId} />\n      ))}\n    </>\n  );\n}\n\nexport default observer(PublicReferences);\n","import { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { Trans } from \"react-i18next\";\nimport { useLocation } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport Document from \"~/models/Document\";\nimport Fade from \"~/components/Fade\";\nimport Tab from \"~/components/Tab\";\nimport Tabs from \"~/components/Tabs\";\nimport useStores from \"~/hooks/useStores\";\nimport ReferenceListItem from \"./ReferenceListItem\";\n\ntype Props = {\n  document: Document;\n};\n\nfunction References({ document }: Props) {\n  const { collections, documents } = useStores();\n  const location = useLocation();\n\n  React.useEffect(() => {\n    documents.fetchBacklinks(document.id);\n  }, [documents, document.id]);\n\n  const backlinks = documents.getBacklinkedDocuments(document.id);\n  const collection = collections.get(document.collectionId);\n  const children = collection\n    ? collection.getDocumentChildren(document.id)\n    : [];\n  const showBacklinks = !!backlinks.length;\n  const showChildDocuments = !!children.length;\n  const isBacklinksTab = location.hash === \"#backlinks\" || !showChildDocuments;\n  const height = Math.max(backlinks.length, children.length) * 40;\n\n  return showBacklinks || showChildDocuments ? (\n    <Fade>\n      <Tabs>\n        {showChildDocuments && (\n          <Tab to=\"#children\" isActive={() => !isBacklinksTab}>\n            <Trans>Nested documents</Trans>\n          </Tab>\n        )}\n        {showBacklinks && (\n          <Tab to=\"#backlinks\" isActive={() => isBacklinksTab}>\n            <Trans>Backlinks</Trans>\n          </Tab>\n        )}\n      </Tabs>\n      <Content style={{ height }}>\n        {showBacklinks && (\n          <List $active={isBacklinksTab}>\n            {backlinks.map((backlinkedDocument) => (\n              <ReferenceListItem\n                anchor={document.urlId}\n                key={backlinkedDocument.id}\n                document={backlinkedDocument}\n                showCollection={\n                  backlinkedDocument.collectionId !== document.collectionId\n                }\n              />\n            ))}\n          </List>\n        )}\n        {showChildDocuments && (\n          <List $active={!isBacklinksTab}>\n            {children.map((node) => {\n              // If we have the document in the store already then use it to get the extra\n              // contextual info, otherwise the collection node will do (only has title and id)\n              const document = documents.get(node.id);\n              return (\n                <ReferenceListItem\n                  key={node.id}\n                  document={document || node}\n                  showCollection={false}\n                />\n              );\n            })}\n          </List>\n        )}\n      </Content>\n    </Fade>\n  ) : null;\n}\n\nconst Content = styled.div`\n  position: relative;\n`;\n\nconst List = styled.div<{ $active: boolean }>`\n  visibility: ${({ $active }) => ($active ? \"visible\" : \"hidden\")};\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n`;\n\nexport default observer(References);\n","import { debounce } from \"lodash\";\nimport { action, observable } from \"mobx\";\nimport { observer } from \"mobx-react\";\nimport { AllSelection } from \"prosemirror-state\";\nimport * as React from \"react\";\nimport { WithTranslation, withTranslation } from \"react-i18next\";\nimport {\n  Prompt,\n  Route,\n  RouteComponentProps,\n  StaticContext,\n  withRouter,\n  Redirect,\n} from \"react-router\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport { Heading } from \"@shared/editor/lib/getHeadings\";\nimport getTasks from \"@shared/utils/getTasks\";\nimport RootStore from \"~/stores/RootStore\";\nimport Document from \"~/models/Document\";\nimport Revision from \"~/models/Revision\";\nimport DocumentMove from \"~/scenes/DocumentMove\";\nimport Branding from \"~/components/Branding\";\nimport ConnectionStatus from \"~/components/ConnectionStatus\";\nimport ErrorBoundary from \"~/components/ErrorBoundary\";\nimport Flex from \"~/components/Flex\";\nimport LoadingIndicator from \"~/components/LoadingIndicator\";\nimport Modal from \"~/components/Modal\";\nimport PageTitle from \"~/components/PageTitle\";\nimport PlaceholderDocument from \"~/components/PlaceholderDocument\";\nimport RegisterKeyDown from \"~/components/RegisterKeyDown\";\nimport withStores from \"~/components/withStores\";\nimport type { Editor as TEditor } from \"~/editor\";\nimport { NavigationNode } from \"~/types\";\nimport { client } from \"~/utils/ApiClient\";\nimport { isCustomDomain } from \"~/utils/domains\";\nimport { emojiToUrl } from \"~/utils/emoji\";\nimport { isModKey } from \"~/utils/keyboard\";\nimport {\n  documentMoveUrl,\n  documentHistoryUrl,\n  editDocumentUrl,\n  documentUrl,\n  updateDocumentUrl,\n} from \"~/utils/routeHelpers\";\nimport Container from \"./Container\";\nimport Contents from \"./Contents\";\nimport Editor from \"./Editor\";\nimport Header from \"./Header\";\nimport KeyboardShortcutsButton from \"./KeyboardShortcutsButton\";\nimport MarkAsViewed from \"./MarkAsViewed\";\nimport Notices from \"./Notices\";\nimport PublicReferences from \"./PublicReferences\";\nimport References from \"./References\";\n\nconst AUTOSAVE_DELAY = 3000;\n\ntype Props = WithTranslation &\n  RootStore &\n  RouteComponentProps<\n    Record<string, string>,\n    StaticContext,\n    { restore?: boolean; revisionId?: string }\n  > & {\n    sharedTree?: NavigationNode;\n    abilities: Record<string, any>;\n    document: Document;\n    revision?: Revision;\n    readOnly: boolean;\n    shareId?: string;\n    onCreateLink?: (title: string) => Promise<string>;\n    onSearchLink?: (term: string) => any;\n  };\n\n@observer\nclass DocumentScene extends React.Component<Props> {\n  @observable\n  editor: TEditor | null;\n\n  @observable\n  isUploading = false;\n\n  @observable\n  isSaving = false;\n\n  @observable\n  isPublishing = false;\n\n  @observable\n  isEditorDirty = false;\n\n  @observable\n  isEmpty = true;\n\n  @observable\n  lastRevision: number = this.props.document.revision;\n\n  @observable\n  title: string = this.props.document.title;\n\n  @observable\n  headings: Heading[] = [];\n\n  getEditorText: () => string = () => this.props.document.text;\n\n  componentDidMount() {\n    this.updateIsDirty();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { auth, document, t } = this.props;\n\n    if (prevProps.readOnly && !this.props.readOnly) {\n      this.updateIsDirty();\n    }\n\n    if (this.props.readOnly || auth.team?.collaborativeEditing) {\n      this.lastRevision = document.revision;\n    }\n\n    if (\n      !this.props.readOnly &&\n      !auth.team?.collaborativeEditing &&\n      prevProps.document.revision !== this.lastRevision\n    ) {\n      if (auth.user && document.updatedBy.id !== auth.user.id) {\n        this.props.toasts.showToast(\n          t(`Document updated by {{userName}}`, {\n            userName: document.updatedBy.name,\n          }),\n          {\n            timeout: 30 * 1000,\n            type: \"warning\",\n            action: {\n              text: \"Reload\",\n              onClick: () => {\n                window.location.href = documentUrl(document);\n              },\n            },\n          }\n        );\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (\n      this.isEmpty &&\n      this.props.document.createdBy.id === this.props.auth.user?.id &&\n      this.props.document.isDraft &&\n      this.props.document.isActive &&\n      this.props.document.hasEmptyTitle &&\n      this.props.document.isPersistedOnce\n    ) {\n      this.props.document.delete();\n    }\n  }\n\n  replaceDocument = (template: Document | Revision) => {\n    const editorRef = this.editor;\n\n    if (!editorRef) {\n      return;\n    }\n\n    const { view, parser } = editorRef;\n    view.dispatch(\n      view.state.tr\n        .setSelection(new AllSelection(view.state.doc))\n        .replaceSelectionWith(parser.parse(template.text))\n    );\n\n    this.isEditorDirty = true;\n\n    if (template instanceof Document) {\n      this.props.document.templateId = template.id;\n    }\n\n    if (!this.title) {\n      this.title = template.title;\n      this.props.document.title = template.title;\n    }\n\n    this.props.document.text = template.text;\n    this.updateIsDirty();\n    this.onSave({\n      autosave: true,\n      publish: false,\n      done: false,\n    });\n  };\n\n  onSynced = async () => {\n    const { toasts, history, location, t } = this.props;\n    const restore = location.state?.restore;\n    const revisionId = location.state?.revisionId;\n    const editorRef = this.editor;\n\n    if (!editorRef || !restore) {\n      return;\n    }\n\n    const response = await client.post(\"/revisions.info\", {\n      id: revisionId,\n    });\n\n    if (response) {\n      this.replaceDocument(response.data);\n      toasts.showToast(t(\"Document restored\"));\n      history.replace(this.props.document.url, history.location.state);\n    }\n  };\n\n  goToMove = (ev: KeyboardEvent) => {\n    if (!this.props.readOnly) {\n      return;\n    }\n    ev.preventDefault();\n    const { document, abilities } = this.props;\n\n    if (abilities.move) {\n      this.props.history.push(documentMoveUrl(document));\n    }\n  };\n\n  goToEdit = (ev: KeyboardEvent) => {\n    if (!this.props.readOnly) {\n      return;\n    }\n    ev.preventDefault();\n    const { document, abilities } = this.props;\n\n    if (abilities.update) {\n      this.props.history.push(editDocumentUrl(document));\n    }\n  };\n\n  goToHistory = (ev: KeyboardEvent) => {\n    if (!this.props.readOnly) {\n      return;\n    }\n    if (ev.ctrlKey) {\n      return;\n    }\n    ev.preventDefault();\n    const { document, location } = this.props;\n\n    if (location.pathname.endsWith(\"history\")) {\n      this.props.history.push(document.url);\n    } else {\n      this.props.history.push(documentHistoryUrl(document));\n    }\n  };\n\n  onPublish = (ev: React.MouseEvent | KeyboardEvent) => {\n    ev.preventDefault();\n    const { document } = this.props;\n    if (document.publishedAt) {\n      return;\n    }\n    this.onSave({\n      publish: true,\n      done: true,\n    });\n  };\n\n  onToggleTableOfContents = (ev: KeyboardEvent) => {\n    if (!this.props.readOnly) {\n      return;\n    }\n    ev.preventDefault();\n    const { ui } = this.props;\n\n    if (ui.tocVisible) {\n      ui.hideTableOfContents();\n    } else {\n      ui.showTableOfContents();\n    }\n  };\n\n  onSave = async (\n    options: {\n      done?: boolean;\n      publish?: boolean;\n      autosave?: boolean;\n    } = {}\n  ) => {\n    const { document, auth } = this.props;\n    // prevent saves when we are already saving\n    if (document.isSaving) {\n      return;\n    }\n\n    // get the latest version of the editor text value\n    const text = this.getEditorText ? this.getEditorText() : document.text;\n\n    // prevent save before anything has been written (single hash is empty doc)\n    if (text.trim() === \"\" && document.title.trim() === \"\") {\n      return;\n    }\n\n    document.text = text;\n    document.tasks = getTasks(document.text);\n\n    // prevent autosave if nothing has changed\n    if (options.autosave && !this.isEditorDirty && !document.isDirty()) {\n      return;\n    }\n\n    this.isSaving = true;\n    this.isPublishing = !!options.publish;\n\n    try {\n      let savedDocument = document;\n\n      if (auth.team?.collaborativeEditing) {\n        // update does not send \"text\" field to the API, this is a workaround\n        // while the multiplayer editor is toggleable. Once it's finalized\n        // this can be cleaned up to single code path\n        savedDocument = await document.update({\n          ...options,\n          lastRevision: this.lastRevision,\n        });\n      } else {\n        savedDocument = await document.save({\n          ...options,\n          lastRevision: this.lastRevision,\n        });\n      }\n\n      this.isEditorDirty = false;\n      this.lastRevision = savedDocument.revision;\n\n      if (options.done) {\n        this.props.history.push(savedDocument.url);\n        this.props.ui.setActiveDocument(savedDocument);\n      } else if (document.isNew) {\n        this.props.history.push(editDocumentUrl(savedDocument));\n        this.props.ui.setActiveDocument(savedDocument);\n      }\n    } catch (err) {\n      this.props.toasts.showToast(err.message, {\n        type: \"error\",\n      });\n    } finally {\n      this.isSaving = false;\n      this.isPublishing = false;\n    }\n  };\n\n  autosave = debounce(() => {\n    this.onSave({\n      done: false,\n      autosave: true,\n    });\n  }, AUTOSAVE_DELAY);\n\n  updateIsDirty = () => {\n    const { document } = this.props;\n    const editorText = this.getEditorText().trim();\n    this.isEditorDirty = editorText !== document.text.trim();\n\n    // a single hash is a doc with just an empty title\n    this.isEmpty =\n      (!editorText || editorText === \"#\" || editorText === \"\\\\\") && !this.title;\n  };\n\n  updateIsDirtyDebounced = debounce(this.updateIsDirty, 500);\n\n  onFileUploadStart = () => {\n    this.isUploading = true;\n  };\n\n  onFileUploadStop = () => {\n    this.isUploading = false;\n  };\n\n  onChange = (getEditorText: () => string) => {\n    const { document, auth } = this.props;\n    this.getEditorText = getEditorText;\n\n    // Keep headings in sync for table of contents\n    const headings = this.editor?.getHeadings() ?? [];\n    if (\n      headings.map((h) => h.level + h.title).join(\"\") !==\n      this.headings.map((h) => h.level + h.title).join(\"\")\n    ) {\n      this.headings = headings;\n    }\n\n    // Keep derived task list in sync\n    const tasks = this.editor?.getTasks();\n    const total = tasks?.length ?? 0;\n    const completed = tasks?.filter((t) => t.completed).length ?? 0;\n    document.updateTasks(total, completed);\n\n    // If the multiplayer editor is enabled we're done here as changes are saved\n    // through the persistence protocol. The rest of this method is legacy.\n    if (auth.team?.collaborativeEditing) {\n      return;\n    }\n\n    // document change while read only is presumed to be a checkbox edit,\n    // in that case we don't delay in saving for a better user experience.\n    if (this.props.readOnly) {\n      this.updateIsDirty();\n      this.onSave({\n        done: false,\n        autosave: true,\n      });\n    } else {\n      this.updateIsDirtyDebounced();\n      this.autosave();\n    }\n  };\n\n  onChangeTitle = action((value: string) => {\n    this.title = value;\n    this.props.document.title = value;\n    this.updateIsDirty();\n    this.autosave();\n  });\n\n  goBack = () => {\n    if (!this.props.readOnly) {\n      this.props.history.push(this.props.document.url);\n    }\n  };\n\n  handleRef = (ref: TEditor | null) => {\n    this.editor = ref;\n    this.headings = this.editor?.getHeadings() ?? [];\n  };\n\n  render() {\n    const {\n      document,\n      revision,\n      readOnly,\n      abilities,\n      auth,\n      ui,\n      shareId,\n      t,\n    } = this.props;\n    const team = auth.team;\n    const isShare = !!shareId;\n    const value = revision ? revision.text : document.text;\n    const embedsDisabled =\n      (team && team.documentEmbeds === false) || document.embedsDisabled;\n\n    const hasHeadings = this.headings.length > 0;\n    const showContents =\n      ui.tocVisible &&\n      ((readOnly && hasHeadings) || team?.collaborativeEditing);\n    const collaborativeEditing =\n      team?.collaborativeEditing &&\n      !document.isArchived &&\n      !document.isDeleted &&\n      !revision &&\n      !isShare;\n\n    const canonicalUrl = shareId\n      ? this.props.match.url\n      : updateDocumentUrl(this.props.match.url, document);\n\n    return (\n      <ErrorBoundary>\n        {this.props.location.pathname !== canonicalUrl && (\n          <Redirect\n            to={{\n              pathname: canonicalUrl,\n              state: this.props.location.state,\n              hash: this.props.location.hash,\n            }}\n          />\n        )}\n        <RegisterKeyDown trigger=\"m\" handler={this.goToMove} />\n        <RegisterKeyDown trigger=\"e\" handler={this.goToEdit} />\n        <RegisterKeyDown trigger=\"Escape\" handler={this.goBack} />\n        <RegisterKeyDown trigger=\"h\" handler={this.goToHistory} />\n        <RegisterKeyDown\n          trigger=\"p\"\n          handler={(event) => {\n            if (isModKey(event) && event.shiftKey) {\n              this.onPublish(event);\n            }\n          }}\n        />\n        <RegisterKeyDown\n          trigger=\"h\"\n          handler={(event) => {\n            if (event.ctrlKey && event.altKey) {\n              this.onToggleTableOfContents(event);\n            }\n          }}\n        />\n        <Background key={revision ? revision.id : document.id} column auto>\n          <Route\n            path={`${document.url}/move`}\n            component={() => (\n              <Modal\n                title={`Move ${document.noun}`}\n                onRequestClose={this.goBack}\n                isOpen\n              >\n                <DocumentMove\n                  document={document}\n                  onRequestClose={this.goBack}\n                />\n              </Modal>\n            )}\n          />\n          <PageTitle\n            title={document.titleWithDefault.replace(document.emoji || \"\", \"\")}\n            favicon={document.emoji ? emojiToUrl(document.emoji) : undefined}\n          />\n          {(this.isUploading || this.isSaving) && <LoadingIndicator />}\n          <Container justify=\"center\" column auto>\n            {!readOnly && (\n              <>\n                <Prompt\n                  when={\n                    this.isEditorDirty &&\n                    !this.isUploading &&\n                    !team?.collaborativeEditing\n                  }\n                  message={(location, action) => {\n                    if (\n                      // a URL replace matching the current document indicates a title change\n                      // no guard is needed for this transition\n                      action === \"REPLACE\" &&\n                      location.pathname === editDocumentUrl(document)\n                    ) {\n                      return true;\n                    }\n\n                    return t(\n                      `You have unsaved changes.\\nAre you sure you want to discard them?`\n                    ) as string;\n                  }}\n                />\n                <Prompt\n                  when={this.isUploading && !this.isEditorDirty}\n                  message={t(\n                    `Images are still uploading.\\nAre you sure you want to discard them?`\n                  )}\n                />\n              </>\n            )}\n            <Header\n              document={document}\n              documentHasHeadings={hasHeadings}\n              shareId={shareId}\n              isRevision={!!revision}\n              isDraft={document.isDraft}\n              isEditing={!readOnly && !team?.collaborativeEditing}\n              isSaving={this.isSaving}\n              isPublishing={this.isPublishing}\n              publishingIsDisabled={\n                document.isSaving || this.isPublishing || this.isEmpty\n              }\n              savingIsDisabled={document.isSaving || this.isEmpty}\n              sharedTree={this.props.sharedTree}\n              onSelectTemplate={this.replaceDocument}\n              onSave={this.onSave}\n              headings={this.headings}\n            />\n            <MaxWidth\n              archived={document.isArchived}\n              showContents={showContents}\n              isEditing={!readOnly}\n              isFullWidth={document.fullWidth}\n              column\n              auto\n            >\n              <Notices document={document} readOnly={readOnly} />\n              <React.Suspense fallback={<PlaceholderDocument />}>\n                <Flex auto={!readOnly}>\n                  {showContents && (\n                    <Contents\n                      headings={this.headings}\n                      isFullWidth={document.fullWidth}\n                    />\n                  )}\n                  <Editor\n                    id={document.id}\n                    key={embedsDisabled ? \"disabled\" : \"enabled\"}\n                    ref={this.handleRef}\n                    multiplayer={collaborativeEditing}\n                    shareId={shareId}\n                    isDraft={document.isDraft}\n                    template={document.isTemplate}\n                    title={revision ? revision.title : document.title}\n                    document={document}\n                    value={readOnly ? value : undefined}\n                    defaultValue={value}\n                    embedsDisabled={embedsDisabled}\n                    onSynced={this.onSynced}\n                    onFileUploadStart={this.onFileUploadStart}\n                    onFileUploadStop={this.onFileUploadStop}\n                    onSearchLink={this.props.onSearchLink}\n                    onCreateLink={this.props.onCreateLink}\n                    onChangeTitle={this.onChangeTitle}\n                    onChange={this.onChange}\n                    onSave={this.onSave}\n                    onPublish={this.onPublish}\n                    onCancel={this.goBack}\n                    readOnly={readOnly}\n                    readOnlyWriteCheckboxes={readOnly && abilities.update}\n                  >\n                    {shareId && (\n                      <ReferencesWrapper isOnlyTitle={document.isOnlyTitle}>\n                        <PublicReferences\n                          shareId={shareId}\n                          documentId={document.id}\n                          sharedTree={this.props.sharedTree}\n                        />\n                      </ReferencesWrapper>\n                    )}\n                    {!isShare && !revision && (\n                      <>\n                        <MarkAsViewed document={document} />\n                        <ReferencesWrapper isOnlyTitle={document.isOnlyTitle}>\n                          <References document={document} />\n                        </ReferencesWrapper>\n                      </>\n                    )}\n                  </Editor>\n                </Flex>\n              </React.Suspense>\n            </MaxWidth>\n            {isShare && !isCustomDomain() && (\n              <Branding href=\"//www.getoutline.com?ref=sharelink\" />\n            )}\n          </Container>\n        </Background>\n        {!isShare && (\n          <>\n            <KeyboardShortcutsButton />\n            <ConnectionStatus />\n          </>\n        )}\n      </ErrorBoundary>\n    );\n  }\n}\n\nconst Background = styled(Container)`\n  background: ${(props) => props.theme.background};\n  transition: ${(props) => props.theme.backgroundTransition};\n`;\n\nconst ReferencesWrapper = styled.div<{ isOnlyTitle?: boolean }>`\n  margin-top: ${(props) => (props.isOnlyTitle ? -45 : 16)}px;\n\n  @media print {\n    display: none;\n  }\n`;\n\ntype MaxWidthProps = {\n  isEditing?: boolean;\n  isFullWidth?: boolean;\n  archived?: boolean;\n  showContents?: boolean;\n};\n\nconst MaxWidth = styled(Flex)<MaxWidthProps>`\n  // Adds space to the gutter to make room for heading annotations\n  padding: 0 32px;\n  transition: padding 100ms;\n  max-width: 100vw;\n  width: 100%;\n\n  padding-bottom: 16px;\n\n  ${breakpoint(\"tablet\")`\n    padding: 0 44px;\n    margin: 4px auto 12px;\n    max-width: ${(props: MaxWidthProps) =>\n      props.isFullWidth\n        ? \"100vw\"\n        : `calc(64px + 46em + ${props.showContents ? \"256px\" : \"0px\"});`}\n  `};\n\n  ${breakpoint(\"desktopLarge\")`\n    max-width: ${(props: MaxWidthProps) =>\n      props.isFullWidth ? \"100vw\" : `calc(64px + 52em);`}\n  `};\n`;\n\nexport default withTranslation()(withStores(withRouter(DocumentScene)));\n","export function emojiToUrl(text: string) {\n  return `data:image/svg+xml;data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${text}</text></svg>`;\n}\n","import styled from \"styled-components\";\nimport Flex from \"~/components/Flex\";\n\nconst Container = styled(Flex)`\n  position: relative;\n`;\n\nexport default Container;\n","'use strict';\n/* eslint-disable es/no-string-prototype-matchall -- safe */\nvar $ = require('../internals/export');\nvar createIteratorConstructor = require('../internals/create-iterator-constructor');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar anObject = require('../internals/an-object');\nvar classof = require('../internals/classof-raw');\nvar isRegExp = require('../internals/is-regexp');\nvar getRegExpFlags = require('../internals/regexp-flags');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar fails = require('../internals/fails');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar speciesConstructor = require('../internals/species-constructor');\nvar advanceStringIndex = require('../internals/advance-string-index');\nvar InternalStateModule = require('../internals/internal-state');\nvar IS_PURE = require('../internals/is-pure');\n\nvar MATCH_ALL = wellKnownSymbol('matchAll');\nvar REGEXP_STRING = 'RegExp String';\nvar REGEXP_STRING_ITERATOR = REGEXP_STRING + ' Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(REGEXP_STRING_ITERATOR);\nvar RegExpPrototype = RegExp.prototype;\nvar regExpBuiltinExec = RegExpPrototype.exec;\nvar nativeMatchAll = ''.matchAll;\n\nvar WORKS_WITH_NON_GLOBAL_REGEX = !!nativeMatchAll && !fails(function () {\n  'a'.matchAll(/./);\n});\n\nvar regExpExec = function (R, S) {\n  var exec = R.exec;\n  var result;\n  if (typeof exec == 'function') {\n    result = exec.call(R, S);\n    if (typeof result != 'object') throw TypeError('Incorrect exec result');\n    return result;\n  } return regExpBuiltinExec.call(R, S);\n};\n\n// eslint-disable-next-line max-len -- ignore\nvar $RegExpStringIterator = createIteratorConstructor(function RegExpStringIterator(regexp, string, global, fullUnicode) {\n  setInternalState(this, {\n    type: REGEXP_STRING_ITERATOR,\n    regexp: regexp,\n    string: string,\n    global: global,\n    unicode: fullUnicode,\n    done: false\n  });\n}, REGEXP_STRING, function next() {\n  var state = getInternalState(this);\n  if (state.done) return { value: undefined, done: true };\n  var R = state.regexp;\n  var S = state.string;\n  var match = regExpExec(R, S);\n  if (match === null) return { value: undefined, done: state.done = true };\n  if (state.global) {\n    if (String(match[0]) == '') R.lastIndex = advanceStringIndex(S, toLength(R.lastIndex), state.unicode);\n    return { value: match, done: false };\n  }\n  state.done = true;\n  return { value: match, done: false };\n});\n\nvar $matchAll = function (string) {\n  var R = anObject(this);\n  var S = String(string);\n  var C, flagsValue, flags, matcher, global, fullUnicode;\n  C = speciesConstructor(R, RegExp);\n  flagsValue = R.flags;\n  if (flagsValue === undefined && R instanceof RegExp && !('flags' in RegExpPrototype)) {\n    flagsValue = getRegExpFlags.call(R);\n  }\n  flags = flagsValue === undefined ? '' : String(flagsValue);\n  matcher = new C(C === RegExp ? R.source : R, flags);\n  global = !!~flags.indexOf('g');\n  fullUnicode = !!~flags.indexOf('u');\n  matcher.lastIndex = toLength(R.lastIndex);\n  return new $RegExpStringIterator(matcher, S, global, fullUnicode);\n};\n\n// `String.prototype.matchAll` method\n// https://tc39.es/ecma262/#sec-string.prototype.matchall\n$({ target: 'String', proto: true, forced: WORKS_WITH_NON_GLOBAL_REGEX }, {\n  matchAll: function matchAll(regexp) {\n    var O = requireObjectCoercible(this);\n    var flags, S, matcher, rx;\n    if (regexp != null) {\n      if (isRegExp(regexp)) {\n        flags = String(requireObjectCoercible('flags' in RegExpPrototype\n          ? regexp.flags\n          : getRegExpFlags.call(regexp)\n        ));\n        if (!~flags.indexOf('g')) throw TypeError('`.matchAll` does not allow non-global regexes');\n      }\n      if (WORKS_WITH_NON_GLOBAL_REGEX) return nativeMatchAll.apply(O, arguments);\n      matcher = regexp[MATCH_ALL];\n      if (matcher === undefined && IS_PURE && classof(regexp) == 'RegExp') matcher = $matchAll;\n      if (matcher != null) return aFunction(matcher).call(regexp, O);\n    } else if (WORKS_WITH_NON_GLOBAL_REGEX) return nativeMatchAll.apply(O, arguments);\n    S = String(O);\n    rx = new RegExp(regexp, 'g');\n    return IS_PURE ? $matchAll.call(rx, S) : rx[MATCH_ALL](S);\n  }\n});\n\nIS_PURE || MATCH_ALL in RegExpPrototype || createNonEnumerableProperty(RegExpPrototype, MATCH_ALL, $matchAll);\n"],"sourceRoot":""}